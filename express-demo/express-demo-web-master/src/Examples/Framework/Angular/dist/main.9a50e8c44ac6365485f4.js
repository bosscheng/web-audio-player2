(self.webpackChunkzego_express_demo=self.webpackChunkzego_express_demo||[]).push([[179],{255:e=>{function t(e){return Promise.resolve().then(()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=255,e.exports=t},576:function(e,t,r){var o;"undefined"!=typeof self&&self,e.exports=(o=r(276),function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(o,s,(function(t){return e[t]}).bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.E_CLIENT_TYPE=t.ENUM_SOURCE_TYPE=t.ENUM_DISPATCH_TYPE=t.ENUM_BROADCASTER_STATUS=t.ENUM_PLAY_SOURCE_TYPE=t.ENUM_PUBLISH_STATE_NEGO=t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=t.QUALITYLEVEL=t.MIXSTREAM_ERROR_CODE=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD_PRI=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.STREAM_DELETE_REASON=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.ENUM_STREAM_UPDATE_TYPE=t.ENUM_STREAM_CMD_PRI=t.ENUM_STREAM_SUB_CMD=t.ENUM_PUBLISH_STREAM_STATE=t.MAX_RETRY_CONNECT_INTERVAL=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.MAX_MIX_TASK_ID_LENGTH=t.MAX_MESSAGE_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_PROBE_STATE=t.ENUM_PLAY_STATE_NEGO=t.ENUM_PLAYER_STATE=t.ENUM_PLAY_STATE=t.ENUM_PUBLISH_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.sdkErrorList=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.ZegoExpressWebRTM=t.ZegoDataReport=t.ZegoLogger=t.ZegoExpressWebRTMEngine=t.getReportSeq=t.getSeq=t.QUALITY_CONSTANT=t.QualityGrade=t.REPORT_ACTION=t.ENUM_RETRY_STATE=t.ENUM_PLAY_STATE_UPDATE=t.ENUM_PUBLISH_STATE_UPDATE=t.LinkedList=t.ListNode=void 0,t.PROTO_VERSION="2.8.1",t.ROOMVERSION="V1",function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.sdkErrorList={CLIENT:"Client.",SERVER:"Server.",SUCCESS:{code:"Success",msg:"success."},PARAM:{code:"Error.Param",msg:"input error."},HEARTBEAT_TIMEOUT:{code:"Error.Timeout",msg:"heartbeat timeout."},LOGIN_TIMEOUT:{code:"Error.Timeout",msg:"login timeout."},SEND_MSG_TIMEOUT:{code:"Error.Timeout",msg:"send customsg timeout."},RESET_QUEUE:{code:"Error.Timeout",msg:"msg waiting ack is clear when reset."},LOGIN_DISCONNECT:{code:"Error.Network",msg:"network is broken and login fail."},KICK_OUT:{code:"Error.Kickout",msg:"kickout reason="},UNKNOWN:{code:"Error.Unknown",msg:"unknown error."},FREQ_LIMITED:{code:"Error.requencyLimited",msg:"Frequency Limited."}},t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1500},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_PUBLISH_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,publishing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,playing:6,stop:7,didNotStart:8},t.ENUM_PLAYER_STATE={start:0,playing:1,stop:2},t.ENUM_PLAY_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6},t.ENUM_PROBE_STATE={tryProbe:0,probed:2},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=1,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_MIX_TASK_ID_LENGTH=256,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,t.MAX_RETRY_CONNECT_INTERVAL=12,t.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},t.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},t.ENUM_STREAM_CMD_PRI={liveBegin:"zegochat_js.room_stream_create_req",liveEnd:"zegochat_js.room_stream_delete_req",liveUpdate:"zegochat_js.room_stream_update_req"},t.ENUM_STREAM_UPDATE_TYPE={added:1,deleted:0},function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={})),t.STREAM_DELETE_REASON={0:{code:1,description:"user_stop_publishing_stream_normal"},1:{code:2,description:"user_heart_beat_timeout"},2:{code:3,description:"user_repeat_login"},3:{code:4,description:"user_kicked_out"},4:{code:5,description:"user_offline"},100:{code:6,description:"remove_by_server"}},t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.ENUM_STREAM_UPDATE_CMD_PRI={added:1,updated:2,deleted:3},t.SERVER_ERROR_CODE=1e4,t.MIXSTREAM_ERROR_CODE=1e4,function(e){e[e.low=1]="low",e[e.stantard=2]="stantard",e[e.hight=3]="hight",e[e.custome=4]="custome"}(t.QUALITYLEVEL||(t.QUALITYLEVEL={})),t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},t.ENUM_PUBLISH_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6},function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra"}(t.ENUM_PLAY_SOURCE_TYPE||(t.ENUM_PLAY_SOURCE_TYPE={})),function(e){e[e.stop=0]="stop",e[e.start=1]="start"}(t.ENUM_BROADCASTER_STATUS||(t.ENUM_BROADCASTER_STATUS={})),function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra",e[e.customUrl=2]="customUrl"}(t.ENUM_DISPATCH_TYPE||(t.ENUM_DISPATCH_TYPE={})),function(e){e[e.CDN=0]="CDN",e[e.BGP=1]="BGP"}(t.ENUM_SOURCE_TYPE||(t.ENUM_SOURCE_TYPE={})),function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}));var o=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._id=null,this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=o;var s=function(){function e(){this.start=new o,this.end=new o,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new o(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this.insertBefore(this._numNodes>0?this.start.next:this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=s,t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2,stop:3},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},function(e){e[e.Unknown=-1]="Unknown",e[e.Excellent=0]="Excellent",e[e.Good=1]="Good",e[e.Middle=2]="Middle",e[e.Poor=3]="Poor",e[e.Die=4]="Die"}(t.QualityGrade||(t.QualityGrade={})),function(e){e[e.MinQuality=0]="MinQuality",e[e.DieQuality=0]="DieQuality",e[e.PoorMinQuality=1]="PoorMinQuality",e[e.MiddleMinQuality=30]="MiddleMinQuality",e[e.GoodMinQuality=60]="GoodMinQuality",e[e.ExcellentMinQuality=85]="ExcellentMinQuality",e[e.MaxQuality=100]="MaxQuality"}(t.QUALITY_CONSTANT||(t.QUALITY_CONSTANT={}));var i=r(11);Object.defineProperty(t,"getSeq",{enumerable:!0,get:function(){return i.getSeq}}),Object.defineProperty(t,"getReportSeq",{enumerable:!0,get:function(){return i.getReportSeq}}),Object.defineProperty(t,"ZegoExpressWebRTMEngine",{enumerable:!0,get:function(){return i.ZegoExpressWebRTMEngine}}),Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return i.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return i.ZegoDataReport}}),Object.defineProperty(t,"ZegoExpressWebRTM",{enumerable:!0,get:function(){return i.ZegoExpressWebRTM}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoWechatLogEvent=t.ZegoRTCLogEvent=void 0;var o=r(4),s=function(e){return e};t.ZegoRTCLogEvent={kZegoTaskCreateStream:{event:"/sdk/create_stream",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kParamError:o.errorCodeList.PUBLISHER_PARAM,kScreenCancelError:o.errorCodeList.PUBLISH_SCREEN_CANCELED,kScreenFailedError:o.errorCodeList.PUBLISHER_SCREEN_FAILED,kScreenNotSupportError:o.errorCodeList.PUBLISH_SCREEN_NOT_SUPPORT,kHttpsRequiredError:o.errorCodeList.PUBLISHER_HTTPS_REQUIRED,kGetUserMediaError:o.errorCodeList.PUBLISHER_GET_USER_MEDIA_FAIL},stream_type:s,screen:s,camera:s,custom:s},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishParamError:o.errorCodeList.PUBLISHER_PARAM,kPublishNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:o.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPublishNoPreviewError:o.errorCodeList.PUBLISH_NO_PREVIEW,kPublishNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:o.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kMediaServerForbidError:o.errorCodeList.PUBLISHER_MEDIA_SERVER_FORBID,kPublishSessionClosedError:o.errorCodeList.PUBLISHER_SESSION_CLOSED,kPublishNegoTimeoutError:o.errorCodeList.PUBLISHER_SERVER_NEGO_TIMEOUT,kCreateOfferError:o.errorCodeList.PUBLISHER_CREATE_OFFER_ERROR,kSetLocalDescError:o.errorCodeList.PUBLISHER_SET_LOCAL_DESC_ERROR,kSessionTimeoutError:o.errorCodeList.PUBLISHER_SESSION_TIMEOUT,kSessionRequestError:o.errorCodeList.PUBLISHER_SESSION_REQUEST_FAIL,kSetRemoteDescError:o.errorCodeList.PUBLISHER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:o.errorCodeList.PUBLISHER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:o.errorCodeList.PUBLISHER_WEBSOCKET_DISCONNECTED,kMediaDescError:o.errorCodeList.PUBLISHER_MEDIA_DESC_ERROR,kCandidateError:o.errorCodeList.PUBLISHER_CANDIDATE_ERROR,kIsPublishing:o.errorCodeList.PUBLISHER_IS_PUBLISHING,kClientIPChangedError:o.errorCodeList.PUBLISHER_CLIENT_IP_CHANGED,kTTLOverTimeError:o.errorCodeList.PUBLISHER_TTL_OVERTIME},publishOption:s,message:s,session_id:s,stream:s,video_en_codec_id:s,cap_w:s,cap_h:s,w:s,h:s,video_en_fps:s,video_en_bps:s,audio_c_channel_count:s,audio_en_bps:s,aec_level:s,ans_level:s,agc:s,traffic_control_min_video_bitrate:s},kZegoTaskVideoCaptureSize:{event:"/sdk/api/publish_video_c_size",session_id:s,w:s,h:s},kZegoTaskVideoPlaySize:{event:"/sdk/play_video_size_changed",session_id:s,w:s,h:s},kZegoTaskRePublish:{event:"/sdk/republish",stream:s},kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPlayParamError:o.errorCodeList.PLAYER_PARAM,kPlayStreamIDToLongError:o.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:o.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:o.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:o.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPlayUnsupportedResourceMode:o.errorCodeList.PLAYER_UNSUPPORTED_PROTOCOL,kPlayRetryTimeoutError:o.errorCodeList.PLAYER_RETRY_TIMEOUT,kPlaySessionClosedError:o.errorCodeList.PLAYER_SESSION_CLOSED,kPlaySessionResetError:o.errorCodeList.PLAYER_SESSION_RESET,kPlayNegoTimeoutError:o.errorCodeList.PLAYER_SERVER_NEGO_TIMEOUT,kCreateOfferError:o.errorCodeList.PLAYER_CREATE_OFFER_ERROR,kSetLocalDescError:o.errorCodeList.PLAYER_SET_LOCAL_DESC_ERROR,kSessionRequestError:o.errorCodeList.PLAYER_SESSION_REQUEST_FAIL,kSessionTimeoutError:o.errorCodeList.PLAYER_SESSION_TIMEOUT,kSetRemoteDescError:o.errorCodeList.PLAYER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:o.errorCodeList.PLAYER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:o.errorCodeList.PLAYER_WEBSOCKET_DISCONNECTED,kCandidateError:o.errorCodeList.PLAYER_CANDIDATE_ERROR,kMediaDescError:o.errorCodeList.PLAYER_MEDIA_DESC_ERROR,kIsPlaying:o.errorCodeList.PLAYER_IS_PLAYING,kClientIPChangedError:o.errorCodeList.PLAYER_CLIENT_IP_CHANGED,kTTLOverTimeError:o.errorCodeList.PLAYER_TTL_OVERTIME,kProbeTimeOutError:o.errorCodeList.PLAYER_PROBE_TIMEOUT},playOption:s,message:s,session_id:s,stream:s,audio_activate:s,video_activate:s},kZegoTaskRePlay:{event:"/sdk/replay",stream:s},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoPlayContentChanged:{event:"/sdk/play_content_changed",session_id:s,video_activate:s,audio_activate:s},kZegoTaskMixStart:{event:"/mix/start_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:o.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:o.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:o.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:o.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:o.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:o.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:o.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:o.errorCodeList.NOT_LOGIN},mix_stream_id:s,stream_cnt:s,input_stream_list:s,output_target_list:s},kZegoTaskMixStop:{event:"/mix/stop_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:o.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:o.errorCodeList.NOT_LOGIN}},kZegoTaskMixConfig:{event:"/mix/config_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:o.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:o.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID,kNoLoginError:o.errorCodeList.NOT_LOGIN},config:s},kZegoTaskEnumDevices:{event:"/device/list",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},dev_list:s},kZegoTaskAudioOutput:{event:"/device/audio_capture",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:s,device:s},kZegoTaskVideoCapture:{event:"/device/video_capture",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:s,device:s},kZegoTaskDeviceInterrupt:{event:"/device/interrupt",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:s,interrupt:s},kZegoTaskSetDebug:"/sdk/set_debug",kZegoTaskSetLog:"/sdk/set_log_config",kZegoTaskUseVideoDevice:{event:"/device/api/video_c",error:{kParamError:o.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:o.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG},device:s},kZegoTaskUseAudioDevice:{event:"/device/api/audio_c",error:{kParamError:o.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:o.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG},device:s},kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",capability:s},kZegoTaskMutePublishVideo:"/sdk/mute_publish_video",kZegoTaskMutePublishAudio:"/sdk/mute_publish_audio",kZegoTaskMuteMicrophone:"/sdk/mute_microphone",kZegoTaskMutePlayVideo:"/sdk/mute_play_video",kZegoTaskMutePlayAudio:"/sdk/mute_play_audio",kZegoTaskRemoteCameraUpdate:{event:"/sdk/remote_camera_update",stream:s,status:s},kZegoTaskRemoteMicUpdate:{event:"/sdk/remote_mic_update",stream:s,status:s},kZegoTaskGetSoundLevel:{event:"/sdk/get_sound_level",error:{kGetSoundLevelError:o.errorCodeList.GET_SOUND_LEVEL_FAIL}},kZegoTaskStopSoundLevel:"/sdk/stop_sound_level",kZegoTaskAddPublishCdnUrl:{event:"/sdk/add_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskRemovePublishCdnUrl:{event:"/sdk/remove_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM},stream:s,target_url:s},kZegoTaskClearPublishCdnUrl:{event:"/sdk/clear_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskPublishTarget:{event:"/sdk/publish_target",error:{kParamError:o.errorCodeList.INPUT_PARAM,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kNoLoginError:o.errorCodeList.NOT_LOGIN,kNoResponseError:o.errorCodeList.PUBLISH_TARGET_NO_RESPONSE,kBizChannelError:o.errorCodeList.BIZ_CHANNEL_ERROR,kInvalidChannelError:o.errorCodeList.INVALID_CHANNEL,kUnknownServerError:o.errorCodeList.UNKNOWN_SERVER_ERROR}},kZegoTaskDestroyStream:{event:"/sdk/destroy_stream",error:{kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG}},kZegoTaskScreenSharingEnded:"/sdk/screen_share_end",kZegoTaskAudioOutputChanged:{event:"/device/api/audio_output",session_id:s,stream:s,device:s,reason:s},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoSetAudioConfig:{event:"/sdk/set_audio_config",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoSetVideoConfig:{event:"/sdk/set_video_config",error:{kParamError:o.errorCodeList.INPUT_PARAM,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG}},kZegoReplaceTrack:{event:"/sdk/replace_track",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:s,update_stream:s},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:s},kZegoTaskLiveRoomSendStreamExtraInfo:{event:"/liveroom/send_stream_extra_info",error:{kParamError:o.errorCodeList.INPUT_PARAM,kExtraInfoNullError:o.errorCodeList.PUBLISHER_EXTRA_INFO_NULL,kNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kUpdateStreamInfoFailError:o.errorCodeList.PUBLISHER_UPDATE_STREAM_INFO_FAIL},stream:s,stream_extra_info:s,room_sid:s},kZegoTaskPlayDecodeFirstVideoFrame:{event:"/sdk/play_decode_first_video_frame",session_id:s,fft_consumed:s},kZegoVisibilityChange:{event:"/app/background"},kZegoSetCaptureVolume:{event:"/sdk/set_capture_volume",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoListener:{event:"/sdk/listener"},kZegoNetProbe:{event:"/sdk/net_probe"},kZegoNetProbeResult:{event:"/sdk/net_probe_result"}},t.ZegoWechatLogEvent={kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",error:{kCheckSystemGetSettingFailError:o.errorCodeList.WX_GET_SETTING_FAIL},capability:s},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPublishParamError:o.errorCodeList.PUBLISHER_PARAM,kPublishStreamIDTooLongError:o.errorCodeList.STREAMID_TOO_LONG,kPublishStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPublishNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:o.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPublishNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:o.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kIsPublishing:o.errorCodeList.PUBLISHER_IS_PUBLISHING},publishOption:s,stream:s,message:s},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kPlayStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPlayParamError:o.errorCodeList.PLAYER_PARAM,kPlayStreamIDTooLongError:o.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:o.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:o.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:o.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPlayRetryTimeoutError:o.errorCodeList.PLAYER_RETRY_TIMEOUT,kIsPlaying:o.errorCodeList.PLAYER_IS_PLAYING},playOption:s,message:s,session_id:s,stream:s,audio_activate:s,video_activate:s},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoTaskRePublish:"/sdk/republish",kZegoTaskRePlay:"/sdk/replay",kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:s,update_stream:s},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:s},kZegoTaskMixStart:{event:"/mix/start_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:o.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:o.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:o.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:o.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:o.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:o.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:o.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR},mix_stream_id:s,stream_cnt:s,input_stream_list:s,output_target_list:s},kZegoTaskMixStop:{event:"/mix/stop_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:o.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR}},kZegoTaskMixConfig:{event:"/mix/config_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:o.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:o.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID},config:s},kZegoTaskLiveRoomSendStreamExtraInfo:{event:"/liveroom/send_stream_extra_info",error:{kParamError:o.errorCodeList.INPUT_PARAM,kExtraInfoNullError:o.errorCodeList.PUBLISHER_EXTRA_INFO_NULL,kNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kUpdateStreamInfoFailError:o.errorCodeList.PUBLISHER_UPDATE_STREAM_INFO_FAIL},stream:s,stream_extra_info:s,room_sid:s}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_WECHATMINI_ACTION=t.ZEGO_WEBRTC_ACTION=void 0,function(e){e.CONSTRUCTOR="zc.0",e.CHECK_SUPPORT="zc.csr",e.CREATE_STREAM="zc.cs",e.DESTROY_STREAM="zc.ds",e.START_PUBLISHING_STREAM="zc.sps.0",e.START_PLAYING_STREAM="zc.sps.1",e.STOP_PUBLISHING_STREAM="zc.sps.0.0",e.STOP_PLAYING_STREAM="zc.sps.1.0",e.ON_STREAM="zc.os",e.ON_PUSH_STREAM_UPDATE="zc.opsu",e.ACTIVATE_SEI_INSERT="zc.asi",e.BIND_WINDOW_LISTENER="zc.wl",e.MUTE_PUBLISH_STREAM_VIDEO="zc.mpsv.0",e.MUTE_PUBLISH_STREAM_AUDIO="zc.mpsa.0",e.MUTE_MIC="zc.mm",e.MUTE_PLAY_STREAM_VIDEO="zc.mpsv.1",e.MUTE_PLAY_STREAM_AUDIO="zc.mpsa.1",e.SET_AUDIO_OUTPUT="zc.sao",e.SET_CUSTOM_SIGNAL_URL="zc.scsu",e.SET_TURN_OVER_TCP_ONLY="zc.stoto",e.SET_VIDEO_CONFIG="zc.svc",e.SET_AUDIO_CONFIG="zc.sac",e.REPLACE_TRACK="zc.rp",e.PRELOAD_EFFECT="zc.pe.0",e.PLAY_EFFECT="zc.pe.1",e.PAUSE_EFFECT="zc.pe.2",e.RESUME_EFFECT="zc.re",e.STOP_EFFECT="zc.se",e.UNLOAD_EFFECT="zc.ue",e.SET_EFFECT_VOLUME="zc.sev",e.START_MIXING_AUDIO="zc.sma.0",e.STOP_MIXING_AUDIO="zc.sma.1",e.MIXING_BUFFER="zc.mb",e.STOP_MIXING_BUFFER="zc.smb",e.SET_MIXING_AUDIO_VOLUME="zc.smav",e.ENABLE_STREAM="zc.es",e.ENABLE_MIC_ONLY="zc.emo",e.RDH_ACTIVE="zc.rdh.a",e.RDH_MAX_TIME="zc.rdh.m",e.RDH_WEBRTC_URL_RSP="zc.rdh.hfwur",e.PUBLISH_STATE_HANDLE="zc.psh.0",e.PLAY_STATE_HANDLE="zc.psh.1",e.STATECENTER_ACTION_LISTENER="zc.sc.al",e.SIGNAL_SET_SESSION_INFO="zc.s.ssi",e.SIGNAL_RESET_CONNECT_TIMER="zc.s.rct",e.SIGNAL_BIND_WEBSOCKET_HANDLE="zc.s.bwh",e.SIGNAL_RESET_CHECK_MESSAGE="zc.s.rcm",e.SIGNAL_UPDATE_TOKEN="zc.s.ut",e.SIGNAL_SEND_MESSAGE_WITH_CALLBACK="zc.s.smwc",e.SIGNAL_CONNECT_SERVER="zc.s.cs.0",e.SIGNAL_START_CONNECT_TIMER="zc.s.sct",e.SIGNAL_DISCONNECT_SERVER="zc.s.dc",e.SIGNAL_CREATE_SESSION="zc.s.cs.1",e.SIGNAL_REMOVE_SESSION="zc.s.rs",e.SIGNAL_SEND_REMOVE_SESSION="zc.s.srs",e.SIGNAL_SEND_MESSAGE="zc.s.sm",e.SIGNAL_HANDLE_RESPOND_DATA="zc.s.hrd",e.SIGNAL_ADD_SESSION="zc.s.as",e.SIGNAL_HANDLE_PUSH_DATA="zc.s.hpd",e.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA="zc.s.hprsd",e.SIGNAL_SEND_MEDIA_DESC="zc.s.smd",e.SIGNAL_SEND_CANDIDATE_INFO="zc.s.sci",e.SIGNAL_SEND_MEDIA_DESC_ACK="zc.s.smda",e.SIGNAL_SEND_CANDIDATE_INFO_ACK="zc.s.scia",e.SIGNAL_SEND_CLOSE_SESSION_ACK="zc.s.scsa",e.SIGNAL_SEND_RESET_SESSION_ACK="zc.s.srsa",e.SIGNAL_REGISTER_PUSH_CALLBACK="zc.s.rpc",e.SIGNAL_CHECK_MESSAGE_TIMEOUT="zc.s.cmt",e.SIGNAL_SEND_HEARTBEAT="zc.s.sh",e.SIGNAL_QUALITY_REPORT="zc.s.qr",e.SIGNAL_SEND_STREAM_STATUS="zc.s.sss",e.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM="zc.s.apvs",e.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM="zc.s.apas",e.SIGNAL_SEND_BROADCAST_STATUS="zc.s.sbs",e.SIGNAL_SEND_NET_PROBE="zc.s.snp",e.SIGNAL_SEND_NET_QUALITY_INFO_PUSH_ACK="zc.s.npa",e.PUBLISHER_START_PUBLISH="zc.p.0.sp.0",e.PUBLISHER_PUBLISH_SUCCESS="zc.p.ps",e.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS="zc.p.0.ocpss",e.PUBLISHER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.0.hcsws",e.PUBLISHER_ON_CREATE_OFFER_SUCCESS="zc.p.0.ocos",e.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.0.oslds",e.PUBLISHER_ON_GET_REMOTE_DESCRIPTION="zc.p.0.ogrd",e.PUBLISHER_ON_RECV_MEDIA_DESC="zc.p.0.ormd",e.PUBLISHER_ON_RECV_CANDIDATE_INFO="zc.p.0.orci.0",e.PUBLISHER_ON_RECV_PUBLISH_EVENT="zc.p.0.orpe",e.PUBLISHER_ON_RECV_CLIENT_INFO="zc.p.0.orci.1",e.PUBLISHER_ON_ICE_CANDIDATE="zc.p.0.oic",e.PUBLISHER_ON_CONNECTION_STATE_CHANGE="zc.p.0.ocsc",e.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.0.oicsc",e.PUBLISHER_RESET_PUBLISH="zc.p.0.rp",e.PUBLISHER_SET_PLAYER_QUALITY_TIMER="zc.p.0.spqt",e.PUBLISHER_UPLOAD_PUBLISH_QUALITY="zc.p.0.upq",e.PUBLISHER_ON_RECV_RESET_SESSION="zc.p.0.orrs",e.PUBLISHER_ON_RECV_CLOSE_SESSION="zc.p.0.orcs",e.PUBLISHER_SEND_CANDIDATE_INFO="zc.p.0.sci",e.PUBLISHER_STATE_ERROR="zc.p.0.psr",e.PUBLISHER_STOP_PUBLISH="zc.p.0.sp.1",e.PUBLISHER_ON_DISCONNECT="zc.p.0.od",e.PUBLISHER_START_SOUND_LEVEL="zc.p.0.ssl.0",e.PUBLISHER_STOP_SOUND_LEVEL="zc.p.0.ssl.1",e.PUBLISHER_PLAY_EFFECT="zc.p.0.pe.0",e.PUBLISHER_PAUSE_EFFECT="zc.p.0.pe.1",e.PUBLISHER_RESUME_EFFECT="zc.p.0.re",e.PUBLISHER_STOP_EFFECT="zc.p.0.se",e.PUBLISHER_START_MIXING_AUDIO="zc.p.0.sma.0",e.PUBLISHER_STOP_MIXING_AUDIO="zc.p.0.sma.1",e.PUBLISHER_MIXING_BUFFER="zc.p.0.mb",e.PUBLISHER_SET_MIXING_AUDIO_VOLUME="zc.p.0.smav",e.PUBLISHER_HANDLE_ENC_BITRATE="zc.p.0.heb",e.PUBLISHER_ON_RECV_NET_QUALITY_INFO="zc.p.0.nqi",e.PLAYER_START_PLAY="zc.p.1.sp.0",e.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS="zc.p.ocpss.1",e.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.hcsws.1",e.PLAYER_ON_CREATE_OFFER_SUCCESS="zc.p.ocos.1",e.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.oslds.1",e.PLAYER_ON_RECV_MEDIA_DESC="zc.p.ormd.1",e.PLAYER_ON_RECV_CANDIDATE_INFO="zc.p.orci.1",e.PLAYER_ON_RECV_PLAY_EVENT="zc.p.orpe.1",e.PLAYER_ON_RECV_CLIENT_INFO="zc.p.orci.1.1",e.PLAYER_ON_ICE_CANDIDATE="zc.p.oic.1",e.PLAYER_ON_CONNECTION_STATE_CHANGE="zc.p.ocsc.1",e.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.oicsc.1",e.PLAYER_RESET_PLAY="zc.p.rp.1",e.PLAYER_SET_PLAYER_QUALITY_TIMER="zc.p.spqt.1",e.PLAYER_UPLOAD_PLAYER_QUALITY="zc.p.upq.1",e.PLAYER_ON_RECV_RESET_SESSION="zc.p.orrs.1",e.PLAYER_ON_RECV_CLOSE_SESSION="zc.p.orcs.1",e.PLAYER_ON_RECV_STREAM_STATUS="zc.p.orss.1",e.PLAYER_ON_GOT_REMOTE_STREAM="zc.p.ogrs.1",e.PLAYER_SEND_CANDIDATE_INFO="zc.p.sci.1",e.PLAYER_STATE_ERROR="zc.p.psr.1",e.PLAYER_STOP_PLAY="zc.p.1.sp.1",e.PLAYER_ON_DISCONNECT="zc.p.od.1",e.PLAYER_START_SOUND_LEVEL="zc.p.ssl.1",e.PLAYER_STOP_SOUND_LEVEL="zc.p.ssl.1.1",e.PLAYER_ON_RECV_NET_QUALITY_INFO="zc.p.1.nqi",e.PUBLISH_SET_CAPTURE_VOLUME="zc.p.scv",e.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ="zc.sh.msbss",e.STREAMHANDLER_MERGE_STREAM="zc.sh.ms",e.STREAMHANDLER_PATCH_STREAM_LIST="zc.sh.psl"}(t.ZEGO_WEBRTC_ACTION||(t.ZEGO_WEBRTC_ACTION={})),function(e){e.ADD_PUBLISH_CDN_URL="zw.apcu",e.REMOVE_PUBLISH_CDN_URL="zw.rpcu",e.STOP_MIXER_TASK="zw.smt",e.ON_STREAM="zw.os",e.ON_PUSH_STREAM_UPDATE="zw.opsu",e.ON_PUBLISH_STATE_UPDATE="zw.w.opsu",e.ON_PUBLISH_STATE_UPDATE_HANDLE="zw.w.opsuh",e.WECHATMINI_SETPREFERPLAYSOURCETYPE="zw.w.sppst.1",e.WECHATMINI_BIND_LISTENER="zw.w.bl",e.WECHATMINI_DELETE_LISTENER="zw.w.dl",e.WECHATMINI_UPDATE_PLAYER_STATE="zw.w.ups",e.WECHATMINI_UPDATE_PLAYER_NET_STATUS="zw.w.upns",e.WECHATMINI_SET_CUSTOM_SIGNAL_URL="zw.w.scsu",e.WECHATMINI_GET_NEXT_URL="zw.w.gnu",e.WECHATMINI_BIND_STREAM_CENTER_HANDLER="zw.w.bsch",e.WECHATMINI_BIND_RTM_LISTENER="zw.w.brl",e.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE="zw.pu.sppst.0",e.PUBLISHMODULE_START_PUBLISHING_STREAM="zw.pu.sps.0",e.PUBLISHMODULE_STOP_PUBLISHING_STREAM="zw.pu.sps.0.0",e.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL="zw.pu.fpsu.0",e.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP="zw.pu.hfspur.0",e.PUBLISHMODULE_DO_PUBLISH_STREAM="zw.pu.dps.0",e.PUBLISHMODULE_UPDATE_STREAM_INFO="zw.pu.upi",e.PUBLISHMODULE_HANDLE_STREAM_UPDATE_RSP="zw.pu.hsur",e.PLAYMODULE_START_PLAYING_STREAM="zw.pl.sps.1",e.PLAYMODULE_STOP_PLAYING_STREAM="zw.pl.sps.1.0",e.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN="zw.pl.spsfc",e.PLAYMODULE_START_PLAYING_STREAM_FROM_BGP="zw.pl.spsfb",e.PLAYMODULE_DO_PLAY_STREAM="zw.pl.dps",e.PLAYMODULE_FETCH_PLAY_STREAM_URL="zw.pl.fpsu",e.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP="zw.pl.hfsur",e.STREAMCENTERWECHAT_RESET="zw.scw.r.0",e.STREAMCENTERWECHAT_START_PUBLISHING_STREAM="zw.scw.sps.0",e.STREAMCENTERWECHAT_START_PLAYING_STREAM="zw.scw.sps.1",e.STREAMCENTERWECHAT_START_PLAYER="zw.scw.sp.0",e.STREAMCENTERWECHAT_ON_STREAM_URL_UPDATE="zw.scw.opuu.0",e.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE="zw.scw.ups.0",e.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS="zw.scw.upns",e.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE="zw.scw.ups.0.0",e.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE="zw.scw.ups.1.0",e.STREAMCENTERWECHAT_GET_NEXT_URL="zw.scw.gnu",e.STREAMCENTERWECHAT_STOP_PUBLISHING_STREAM="zw.scw.sps.0.0",e.STREAMCENTERWECHAT_STOP_PLAYING_STREAM="zw.scw.sps.1.0",e.STREAMCENTERWECHAT_STOP_PLAYER="zw.scw.sp.1",e.STREAMCENTERWECHAT_ON_PLAY_START="zw.scw.ops.0",e.STREAMCENTERWECHAT_ON_PLAY_STOP="zw.scw.ops.1",e.STREAMCENTERWECHAT_ON_PLAY_RETRY="zw.scw.opr",e.PLAYWECHAT_TRY_START_PLAYER="zw.pw.tsp.0",e.PLAYWECHAT_UPDATE_EVENT="zw.pw.ue",e.PLAYWECHAT_GET_PLAY_URL="zw.pw.gpu"}(t.ZEGO_WECHATMINI_ACTION||(t.ZEGO_WECHATMINI_ACTION={}))},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(s,i){function n(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(n,a)}l((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,o,s,i,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,o=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!((s=(s=n.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){n=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){n.label=i[1];break}if(6===i[0]&&n.label<s[1]){n.label=s[1],s=i;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(i);break}s[2]&&n.ops.pop(),n.trys.pop();continue}i=t.call(e,n)}catch(e){i=[6,e],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=void 0;var i=r(0),n=r(1),a=r(12),l=function(){function e(){}return e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,r){t.success&&(r[e+"SuccessCallback"]=t.success),t.error&&(r[e+"ErrorCallback"]=t.error)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,r,o,s){e.registerCallback(t,{success:function(t,s){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];e.dataReportEvent(r,o,t,s,i)}},s)},e.actionLogReportCallback=function(t,r,o,s,i){e.actionSuccessCallback(t,r)&&e.actionSuccessCallback(t,r)(o,s)},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:"};if(0===e)return{code:0,message:""};var r={code:0,message:"liveroom cmd error"};return r.code=e,r.message=e>1e9?t[1e9]+e:t[e]?t[e]+" code:"+e:"unknown error code:"+e,r},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return e>1e9&&(r.code=e-1e9+52e6),t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"ROOM_ERROR_AUTHENTICATION_FAILED",2003:"ROOM_ERROR_LOGIN_TIMEOUT"}[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.mixServerError=function(e){var t={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",190:"MIXER_START_REQUEST_ERROR"},r="MIXER_INNER_ERROR";return e>1e9&&t[e-1e9]&&(r=t[e-1e9]),r},e.getKickoutError=function(e){var t={};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,r,o,s){switch(r){case"eventStart":e.eventStart(t,o);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,o,s[0]);break;case"addEventMsg":e.addEventMsg(t,o,s[0],s[1]);break;case"addEvent":e.addEvent(t,o);break;case"eventEnd":e.eventEnd(t,o);break;case"addMsgInfo":e.addMsgInfo(t,s[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeStreamList=function(e,t,r,o){var s,i=[],n=[],a=[];r||(r=[]);for(var l=0;l<r.length;l++)if(r[l].anchor_id_name!=e&&r[l].user_id!=e){s=!1;for(var c=0;c<t.length;c++)if(r[l].stream_id===t[c].stream_id){r[l].extra_info!==t[c].extra_info&&a.push(r[l]),s=!0;break}s||i.push(r[l])}for(var d=0;d<t.length;d++){s=!1;for(var u=0;u<r.length;u++)if(t[d].stream_id===r[u].stream_id){s=!0;break}s||n.push(t[d])}for(t.splice(0),l=0;l<r.length;l++)t.push(r[l]);o(i,n,a)},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r},e.uuid=function(e,t){var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[];if(t=t||o.length,e)for(r=0;r<e;r++)s[r]=o[0|Math.random()*t];else{var i=void 0;for(s[8]=s[13]=s[18]=s[23]="-",s[14]="4",r=0;r<36;r++)s[r]||(i=0|16*Math.random(),s[r]=o[19==r?3&i|8:i])}return s.join("")},e.supportDetection=function(e,t,r,i){return o(this,void 0,void 0,function(){var o,n,a,l,c,d,u,h;return s(this,function(s){switch(s.label){case 0:return o={webRTC:!1,customCapture:!1,camera:!1,microphone:!1,videoCodec:{H264:!1,H265:!1,VP8:!1,VP9:!1},screenSharing:e,errInfo:{}},i&&"screenSharing"===i?[2,t({result:e,errInfo:o.errInfo})]:i&&"customCapture"!==i||(((n=document.createElement("video")).captureStream||n.mozCaptureStream)&&(o.customCapture=!0),"customCapture"!==i)?(a=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l="https:"!==window.location.protocol&&"file:"!==window.location.protocol&&-1==window.location.hostname.indexOf("127.0.0.1")&&-1==window.location.hostname.indexOf("localhost"),i&&"camera"!==i&&"microphone"!==i?[3,9]:a?l?(o.camera=!1,console.error("webrtc requires https or localhost"),[3,9]):[3,1]:[3,9]):(t({result:o.customCapture,errInfo:o.errInfo}),[2]);case 1:if(i&&"camera"!==i)return[3,5];s.label=2;case 2:return s.trys.push([2,4,,5]),[4,navigator.mediaDevices.getUserMedia({video:!0})];case 3:return(c=s.sent())&&(o.camera=!0)&&c.getTracks().forEach(function(e){return e.stop()}),[3,5];case 4:return d=s.sent(),o.errInfo.camera={name:d.name,message:d.message},console.error("camera devices detect error: ",d.name,d.message),[3,5];case 5:if(i&&"microphone"!==i)return[3,9];s.label=6;case 6:return s.trys.push([6,8,,9]),[4,navigator.mediaDevices.getUserMedia({audio:!0})];case 7:return(u=s.sent())&&(o.microphone=!0)&&u.getTracks().forEach(function(e){return e.stop()}),[3,9];case 8:return h=s.sent(),o.errInfo.microphone={name:h.name,message:h.message},console.error("microphone devices detect error: ",h.name,h.message),[3,9];case 9:return"camera"===i||"microphone"===i?(t({result:o[i],errInfo:o.errInfo}),[2]):(this.supportVideoCodeType(function(e,r){i||(o.videoCodec.H264=e.H264,o.videoCodec.H265=e.H265,o.videoCodec.VP8=e.VP8,o.videoCodec.VP9=e.VP9,o.webRTC=e.webRTC),r&&("string"==typeof r?o.errInfo.extendedDate=r:o.errInfo.webRTC={name:r.name,message:r.message},console.error("videoCodec detect error: "+r)),t&&t(i?{result:e[i],errInfo:o.errInfo}:o)},r,i),[2])}})})},e.getDevices=function(e,t){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(t){for(var r=[],o=[],s=[],i=0;i<t.length;i++){var n=t[i];"audioinput"===n.kind&&r.push({deviceName:n.label,deviceID:n.deviceId}),"audiooutput"===n.kind&&o.push({deviceName:n.label,deviceID:n.deviceId}),"videoinput"===n.kind&&s.push({deviceName:n.label,deviceID:n.deviceId})}e&&e({microphones:r,speakers:o,cameras:s})}).catch(function(e){console.error("enumerate devices wrong "+e),t&&t(n.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kEnumDevicesError)}):t&&t(n.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kBrowserNotSupportError)},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var o=0;o<r;o++){var s=parseInt(e[o]),i=parseInt(t[o]);if(s>i)return 1;if(s<i)return-1}return 0},e.isSupportLive=function(e,t){var r=wx.getSystemInfoSync().SDKVersion,o={code:0,msg:""};this.compareVersion(r,"1.7.0")<0&&(o={code:10001,msg:"\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u76f8\u5173\u7ec4\u4ef6"},e&&e(o)),wx.getSetting({success:function(t){var r=t.authSetting;r["scope.camera"]&&r["scope.record"]||(o={code:10002,msg:"\u9700\u8981\u6444\u50cf\u5934\u548c\u5f55\u97f3\u529f\u80fd\u7684\u6388\u6743"}),e&&e(o)},fail:function(e){console.error("get setting error",e),t&&t(e)}})},e.supportVideoCodeType=function(e,t,r){return o(this,void 0,void 0,function(){var o,i,n,l,c,d,u,h,p,g;return s(this,function(s){switch(s.label){case 0:return o={webRTC:!1,H264:!1,VP8:!1,VP9:!1,H265:!1},r?1!==t||"VP8"!==r&&"H264"!==r?[3,2]:[4,(g=new a.CheckModule).checkSupportByType(r)]:[3,2];case 1:return"boolean"==typeof(i=s.sent())?(o[r]=i,[2,e(o)]):(o[r]=!1,[2,e(o,i)]);case 2:if("webRTC"!==r&&1!==t)return[3,7];s.label=3;case 3:return s.trys.push([3,5,,6]),[4,(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})];case 4:return s.sent(),o.webRTC=!0,[3,6];case 5:return n=s.sent(),e&&e(o,n),[3,6];case 6:if("webRTC"===r)return[2,e(o)];s.label=7;case 7:if(1===t){for(l="",d=[],u=0,h=c=["VP8","H264"];u<h.length;u++)p=h[u],g=new a.CheckModule,d.push(g.checkSupportByType(p));return Promise.all(d).then(function(t){t.forEach(function(e,t){"boolean"==typeof e?o[c[t]]=!0:(o[c[t]]=!1,l=e)}),l?e(o,l):e(o)}),[2]}try{(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){if(o.webRTC=!0,t&&t.sdp){var s=t.sdp.split("\r\n");if(o.H264=s.some(function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H264/")>-1}),"H264"===r)return e(o);if(o.VP8=s.some(function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP8/")>-1}),"VP8"===r)return e(o);o.VP9=s.some(function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP9/")>-1}),o.H265=s.some(function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H265/")>-1}),e&&e(o)}})}catch(t){e&&e(o,t)}return[2]}})})},e.inlineWorker=function(e){if(Worker&&e){var t=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],r=URL.createObjectURL(new window.Blob([t],{type:"text/javascript"}));return new Worker(r)}return null},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),o=null!=window.opr,s=e.indexOf("Chrome")&&window.chrome,i=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":r?"Firefox":o?"Opera":s?"Chrome":i?"Safari":"Unkown"},e.getPublisherStateType=function(e){return 0==e||1==e?0==e?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"},e.getPlayerStateType=function(e){return 0==e||1==e?0==e?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"},e.getSteamUpdateType=function(e){return 0==e?"DELETE":"ADD"},e.checkScreenParams=function(t,r){if("object"==typeof t&&void 0!==t.videoQuality&&!e.checkInteger(t.videoQuality))return r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," videoQuality must be integer number"),!1;if("object"==typeof t&&4===t.videoQuality){if(void 0===t.bitRate)return r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate is required when videoQuality is 4"),!1;if(!e.checkInteger(t.bitRate))return r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1;if(t.bitRate>10240)return r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps"),!1;if(void 0===t.frameRate)return r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate is required when videoQuality is 4"),!1;if(!e.checkInteger(t.frameRate))return r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate must be integer number"),!1;if(void 0===t.width)return r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width is required when videoQuality is 4"),!1;if(!e.checkInteger(t.width))return r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width must be integer number"),!1;if(void 0===t.height)return r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height is required when videoQuality is 4"),!1;if(!e.checkInteger(t.height))return r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height must be integer number"),!1}return!0},e.checkCameraParams=function(t,r){return t.width&&e.checkValidNumber(t.width)?t.height&&e.checkValidNumber(t.height)?t.frameRate&&e.checkValidNumber(t.frameRate)?!(!t.bitRate||!e.checkValidNumber(t.bitRate))||(r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1):(r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate must be integer number"),!1):(r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height must be integer number"),!1):(r(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width must be integer number"),!1)},e.isParamEmpty=function(e){return null!=e&&""!==e},e.isTypeString=function(e){return"string"==typeof e},e.isTooLong=function(e,t){return!(e.length>=t)},e.isReDispatch=function(e){var t=e.message.match(/action:(\d+)/),r=t?Number(t[1]):NaN;return[n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kTTLOverTimeError,n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kClientIPChangedError,n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kTTLOverTimeError,n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kClientIPChangedError].includes(e)||[6].includes(r)},e.arrAvg=function(e,t,r){return e.push(t),e.length>r&&e.shift(),e.reduce(function(e,t){return e+t})/e.length},e.getNetQuality=function(e,t,r){return void 0!==r?.15*this.calcQualityOfJitter(r)+.85*Math.min(this.calcQualityOfRtt(e),this.calcQualityOfLostRate(t,!1)):Math.min(this.calcQualityOfRtt(e),this.calcQualityOfLostRate(t,!0))},e.calcQualityOfRtt=function(e){return e<600?97-Math.pow(.09*e,1.1):18*Math.exp(.002*(600-e))},e.calcQualityOfJitter=function(e){return e<=50?98-Math.pow(e,1.15):i.QUALITY_CONSTANT.PoorMinQuality},e.calcQualityOfLostRate=function(e,t){if(t)return e<=55?99-Math.pow(.8*e,1.18):i.QUALITY_CONSTANT.PoorMinQuality;var r=100*e;return r<=40?96-Math.pow(r,1.22):i.QUALITY_CONSTANT.PoorMinQuality},e.quality2QualityGrade=function(e){return e>=i.QUALITY_CONSTANT.ExcellentMinQuality?i.QualityGrade.Excellent:e>=i.QUALITY_CONSTANT.GoodMinQuality?i.QualityGrade.Good:e>=i.QUALITY_CONSTANT.MiddleMinQuality?i.QualityGrade.Middle:e>=i.QUALITY_CONSTANT.PoorMinQuality?i.QualityGrade.Poor:i.QualityGrade.Die},e}();t.ClientUtil=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=t.innerErrList=void 0,t.innerErrList={SUCCESS:{code:0,message:""},SEND_MSG_TIMEOUT:{code:"Error.Timeout",message:"send custom message timeout."}},t.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},STREAMID_TOO_LONG:{code:1000014,message:"stream ID is too long"},STREAM_ID_NULL:{code:1000015,message:"streamID is empty"},STREAM_ID_INVALID_CHARACTER:{code:1000016,message:"stream ID contains illegal characters"},NETWORK_BROKEN:{code:1000017,message:"network is broken"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},GET_SOUND_LEVEL_FAIL:{code:1000019,message:"get sound level error"},INPUT_PARAM:{code:1100001,message:"input parm error."},TIMEOUT:{code:1100002,message:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},UNKNOWN_SERVER_ERROR:{code:1100999,message:"unknown server error"},INIT_SDK_WRONG:{code:1101e3,message:"init sdk wrong"},WX_GET_SETTING_FAIL:{code:1101001,message:"wx get setting fail"},USER_ID_NULL:{code:1002005,message:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,message:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,message:"user ID is too long"},USER_NAME_NULL:{code:1002008,message:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,message:"username is too long"},ROOM_ID_NULL:{code:1002011,message:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,message:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,message:"room ID is too long"},LOGIN_TIMEOUT:{code:1002031,message:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,message:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,message:"kickout may be the same user ID login other"},ROOM_RETRY_TIMEOUT:{code:1002053,message:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,message:"server has sent a signal to kick out"},ROOM_INNER_ERROR:{code:1002099,message:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,message:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,message:"parse json error."},LOGIN_PROCESSING:{code:1102012,message:"login is processing."},LIVEROOM_REQUEST_ERROR:{code:1102013,message:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,message:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,message:"user login state is wrong."},TOKEN_ERROR:{code:1102016,message:"token error"},DISPATCH_ERROR:{code:1102017,message:"dispatch error"},TOKEN_EXPIRED:{code:1102018,message:"token expired"},SUBCMD_ERROR:{code:1102019,message:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,message:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},DISPATCH_TIMEOUT:{code:1102022,message:"dispatch request timeout"},CONNECT_FAILED:{code:1102023,message:"connect signal fail"},INVALID_CHANNEL:{code:1102024,message:"invalid channel"},PUBLISHER_MEDIA_SERVER_FORBID:{code:1003025,message:"stream is forbided by media server"},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,message:"extra info of publishing stream is null"},PUBLISHER_EXTRA_INFO_TOO_LONG:{code:1003051,message:"stream extra info is too long"},PUBLISHER_PARAM:{code:1103001,message:"input param error"},PUBLISHER_BROWSER_NOT_SUPPORT:{code:1103002,message:"browser do not support"},PUBLISHER_DISPATCH_FAIL:{code:1103003,message:"dispatch request error"},PUBLISHER_SCREEN_FAILED:{code:1103010,message:"screen fail"},ENUMERATE_DEVICES_FAIL:{code:1103011,message:"enumerate devices fail"},PUBLISHER_DISPATCH_REQUEST_FAIL:{code:1103020,message:"dispatch request fail"},PUBLISHER_SESSION_REQUEST_FAIL:{code:1103021,message:"session request fail"},PUBLISHER_CREATE_OFFER_ERROR:{code:1103022,message:"create offer error"},PUBLISHER_SET_LOCAL_DESC_ERROR:{code:1103023,message:"setLocalDescription error"},PUBLISHER_MEDIA_DESC_ERROR:{code:1103024,message:"mediaDesc error"},PUBLISHER_SET_REMOTE_DESC_ERROR:{code:1103025,message:"other side offer error"},PUBLISHER_CANDIDATE_ERROR:{code:1103026,message:"candidate error"},PUBLISHER_SESSION_CLOSED:{code:1103027,message:"server session closed"},PUBLISHER_MEDIA_CONNECTION_ERROR:{code:1103028,message:"ice connection error"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,message:"constraint error"},PUBLISHER_SERVER_NEGO_TIMEOUT:{code:1103030,message:"negotiation timeout"},PUBLISH_NOT_PUBLISH:{code:1103040,message:"publisher not found"},PUBLISH_DEVICE_OUT_ERR:{code:1103041,message:"device change "},PUBLISH_SCREEN_CANCELED:{code:1103042,message:"screen canceled"},PUBLISH_SCREEN_NOT_SUPPORT:{code:1103043,message:"screen not support"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},VIDEO_DEVICE_FALSE:{code:1103045,message:"video is false"},AUDIO_DEVICE_FALSE:{code:1103046,message:"audio is false"},TRACK_NOT_FOUND:{code:1103047,message:"track is not found"},DEVICE_NOT_FOUND:{code:1103048,message:"device is not found"},REPEATED_PULL:{code:1103049,message:"repeated pull same stream"},PUBLISHER_WEBSOCKET_DISCONNECTED:{code:1103050,message:"websocket disconnected"},PUBLISHER_RETRY_TIMEOUT:{code:1103051,message:"publisher retry timeout"},PUBLISHER_CDN_PUSH_ERROR:{code:1103052,message:"publisher cdn push error"},PUBLISHER_HTTPS_REQUIRED:{code:1103053,message:"https is required"},PUBLISHER_NO_PREVIEW:{code:1103054,message:"no preview"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISHER_IS_PUBLISHING:{code:1103056,message:"publish is publishing"},PUBLISHER_DECODE_AUDIO_FAIL:{code:1103057,message:"decode audio data fail"},PUBLISHER_CLIENT_IP_CHANGED:{code:1103058,message:"client ip changed"},PUBLISHER_TTL_OVERTIME:{code:1103059,message:"ttl over time"},PUBLISHER_SESSION_TIMEOUT:{code:1103060,message:"session request timeout"},PUBLISHER_GET_USER_MEDIA_FAIL:{code:1103061,message:"get media fail"},PUBLISHER_UPDATE_STREAM_INFO_FAIL:{code:1103062,message:"update stream info fail"},PUBLISH_TARGET_NO_RESPONSE:{code:1103063,message:"publish target no response"},PLAYER_PARAM:{code:1104001,message:"input parm error"},PLAYER_DISPATCH_REQUEST_FAIL:{code:1104020,message:"dispatch request fail"},PLAYER_SESSION_REQUEST_FAIL:{code:1104021,message:"session request fail"},PLAYER_CREATE_OFFER_ERROR:{code:1104022,message:"create offer error"},PLAYER_SET_LOCAL_DESC_ERROR:{code:1104023,message:"setLocalDescription error"},PLAYER_MEDIA_DESC_ERROR:{code:1104024,message:"mediaDesc error"},PLAYER_SET_REMOTE_DESC_ERROR:{code:1104025,message:"other side offer error"},PLAYER_CANDIDATE_ERROR:{code:1104026,message:"candidate error"},PLAYER_SESSION_CLOSED:{code:1104027,message:"server session closed"},PLAYER_MEDIA_CONNECTION_ERROR:{code:1104028,message:"ice connection error"},PLAYER_WEBSOCKET_DISCONNECTED:{code:1104029,message:"websocket disconnected"},PLAYER_SERVER_NEGO_TIMEOUT:{code:1104030,message:"negotiation timeout"},PLAYER_RETRY_TIMEOUT:{code:1104031,message:"player retry timeout"},PLAYER_IS_PLAYING:{code:1104032,message:"player is playing"},PLAYER_CLIENT_IP_CHANGED:{code:1104033,message:"client ip changed"},PLAYER_TTL_OVERTIME:{code:1104034,message:"ttl is over time"},PLAYER_SESSION_RESET:{code:1104035,message:"reset session push"},PLAYER_SESSION_TIMEOUT:{code:1104036,message:"session request timeout"},PLAYER_PROBE_TIMEOUT:{code:1104037,message:"probe time out"},PLAYER_UNSUPPORTED_PROTOCOL:{code:1104038,message:"resource mode is not supported"},MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,message:"mix stream input parameters are wrong"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"},DEVICE_ERROR_TYPE_UNPLUGGED:{code:1006006,message:"the device is unplugged"},IM_CONTENT_NULL:{code:1009001,message:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,message:"message content is too long"},IM_SEND_FAILED:{code:1009010,message:"failed to send message"},FREQ_LIMITED:{code:1109001,message:"frequency limited."}}},function(e,t,r){"use strict";var o=this&&this.__spreadArray||function(e,t){for(var r=0,o=t.length,s=e.length;r<o;r++,s++)e[s]=t[r];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.SdpUtil=void 0;var s=function(){function e(){}return e.zegoSdp=function(e){var t=e.split("\r\n"),r=[],s=[];t.forEach(function(e){var t=e.match(/a=rtpmap:(\d+)\s+((H264\/90000)|(opus\/48000\/2))/);t&&t[1]&&t[2]&&("H264/90000"===t[2]&&r.push(t[1]),"opus/48000/2"===t[2]&&s.push(t[1]))});var i=[];return t.map(function(e){var t=!0,n=e.match(/((a=rtcp-fb:)|(a=rtpmap:)|(a=fmtp:))(\d+)/);if(n&&n[5]&&(o(o([],r),s).some(function(e){return e==n[5]})||(t=!1)),e.indexOf("m=video")>-1){var a=e.split(" ");e=o([a[0],a[1],a[2]],r).join(" ")}else e.indexOf("m=audio")>-1&&(a=e.split(" "),e=o([a[0],a[1],a[2]],s).join(" "));t&&i.push(e)}),i.join("\r\n")},e.getSDPByVideDecodeType=function(e,t){var r={str:"",arr:[],obj:{H264:[],H265:[],VP8:[],VP9:[],OHTER:[]}};if(!e.includes("m=video"))return e;var s=/m=video.+/.exec(e)[0];s=s.match(/[\s|\d]+/g)[1].replace(" ",""),r.str=s,r.arr=r.str.split(" "),r.arr.forEach(function(t){var o=new RegExp("a=rtpmap:"+t+".+").exec(e)[0];o.includes("H264")?r.obj.H264.push(t):o.includes("H265")?r.obj.H265.push(t):o.includes("VP8")?r.obj.VP8.push(t):o.includes("VP9")?r.obj.VP9.push(t):r.obj.OHTER.push(t)}),r.obj.OHTER.forEach(function(t){var o=new RegExp("a=fmtp:"+t+".+apt=(\\d+)").exec(e),s=o&&o[1];s&&(r.obj.H264.includes(s)?r.obj.H264.push(t):r.obj.H265.includes(s)?r.obj.H265.push(t):r.obj.VP8.includes(s)?r.obj.VP8.push(t):r.obj.VP9.includes(s)&&r.obj.VP9.push(t))});var i=[];return"VP9"===t?i=o(o(o([],r.obj.H265),r.obj.H264),r.obj.VP8):"VP8"===t?i=o(o(o([],r.obj.H265),r.obj.H264),r.obj.VP9):"H264"===t?i=o(o(o([],r.obj.H265),r.obj.VP8),r.obj.VP9):"H265"===t&&(i=o(o(o([],r.obj.VP8),r.obj.H264),r.obj.VP9)),i.forEach(function(t){var o=r.arr.indexOf(t);r.arr.splice(o,1);var s=new RegExp("a=rtpmap:"+t+".+\\s\\n","g"),i=new RegExp("a=rtcp-fb:"+t+".+\\s\\n","g"),n=new RegExp("a=fmtp:"+t+".+\\s\\n","g");e=(e=(e=e.replace(s,"")).replace(i,"")).replace(n,"")}),e=e.replace(s,r.arr.join(" "))},e}();t.SdpUtil=s},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoWebRTC=void 0;var s=r(0),i=r(3),n=r(13),a=r(14),l=r(2),c=r(1),d=r(15),u=r(21),h=r(4),p=function(){function e(e,t,r,o){void 0===o&&(o=0),this.mediaEleSources=[],this.logger=e,this.dataReport=t,this.ac=new("undefined"!=typeof webkitAudioContext?webkitAudioContext:AudioContext),this.stateCenter=new n.StateCenter(this.logger,this.dataReport),this.stateCenter.clientType="webrtc",this.stateCenter.type=2===o?"PRIVATE":"PUBLIC",this.RTM=r,this.streamCenter=new u.ZegoStreamCenterWeb(this.logger,this.stateCenter,this.dataReport,this.RTM,this.ac,this.mediaEleSources),this.rtcModules=new d.RTCModules(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.RTM,this.ac),this.stateCenter.networkState=navigator?navigator.onLine?s.ENUM_NETWORK_STATE.online:s.ENUM_NETWORK_STATE.offline:s.ENUM_NETWORK_STATE.online}return e.prototype.mutePublishStreamVideo=function(e,t,r){this.logger.info(l.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" call");var o=s.getReportSeq();if(this.dataReport.newReport(o,c.ZegoRTCLogEvent.kZegoTaskMutePublishVideo),"boolean"!=typeof t||void 0!==r&&"boolean"!=typeof r)return this.logger.error(l.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" option error"),!1;var i=this.rtcModules.advancedModule.enableStream(e,{video:!t,retain:r});return this.dataReport.uploadReport(o),this.logger.info(l.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" end"),i},e.prototype.mutePublishStreamAudio=function(e,t){this.logger.info(l.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" call");var r=s.getReportSeq();if(this.dataReport.newReport(r,c.ZegoRTCLogEvent.kZegoTaskMutePublishAudio),"boolean"!=typeof t)return this.logger.error(l.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" option error"),!1;var o=this.rtcModules.advancedModule.enableStream(e,{audio:!t});return this.dataReport.uploadReport(r),this.logger.info(l.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" end"),o},e.prototype.mutePlayStreamVideo=function(e,t){this.logger.info(l.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_VIDEO+" call "+e+" "+t);var r=s.getReportSeq();this.dataReport.newReport(r,c.ZegoRTCLogEvent.kZegoTaskMutePlayVideo);var o=this.rtcModules.playModule.mutePlayStream(e,"video",t);return this.dataReport.uploadReport(r),this.logger.info(l.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_VIDEO+" end"),o},e.prototype.mutePlayStreamAudio=function(e,t){this.logger.info(l.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_AUDIO+" call "+e+" "+t);var r=s.getReportSeq();this.dataReport.newReport(r,c.ZegoRTCLogEvent.kZegoTaskMutePlayAudio);var o=this.rtcModules.playModule.mutePlayStream(e,"audio",t);return this.dataReport.uploadReport(r),this.logger.info(l.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_AUDIO+"end"),o},e.prototype.muteMicrophone=function(e){this.logger.info(l.ZEGO_WEBRTC_ACTION.MUTE_MIC+" call");var t=s.getReportSeq();if(this.dataReport.newReport(t,c.ZegoRTCLogEvent.kZegoTaskMuteMicrophone),"boolean"!=typeof e)return this.logger.error(l.ZEGO_WEBRTC_ACTION.MUTE_MIC+" option error"),!1;var r=this.rtcModules.advancedModule.enableMicrophoneOnly(!e);return this.dataReport.uploadReport(t),this.logger.info(l.ZEGO_WEBRTC_ACTION.MUTE_MIC+" end"),r},e.prototype.isMicrophoneMuted=function(){return!this.streamCenter.isMicEnabled},e.prototype.setAudioOutput=function(e,t){return this.logger.info(l.ZEGO_WEBRTC_ACTION.SET_AUDIO_OUTPUT+" call"),"string"!=typeof t?(this.logger.error("audiooutput is not string"),!1):this.rtcModules.playModule.setStreamAudioOutput(e,t)},e.prototype.setCustomSignalUrl=function(e){if(this.logger.info(l.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" call: "+e),e&&0!=e.length){var t=!0;e.forEach(function(e){return 0!=e.indexOf("wss://")&&(t=!1)}),t?this.stateCenter.customUrl=e:this.logger.error(l.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" url is not correct")}else this.logger.error(l.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" param error")},e.prototype.setQualityMonitorCycle=function(e){return"number"==typeof e&&e>=1e3?(this.streamCenter.setQualityMonitorCycle(e),!0):(this.logger.error("zc.sqmc.0 time must be number and bigger than 1000"),!1)},e.prototype.startPlayingStream=function(e,t){return this.logger.info(l.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" call by user"),this.rtcModules.playModule.startPlayingStream(e,t)},e.prototype.stopPlayingStream=function(e){this.logger.info(l.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call by user"),this.rtcModules.playModule.stopPlayingStream(e)},e.prototype.setTurnOverTcpOnly=function(e){this.logger.info(l.ZEGO_WEBRTC_ACTION.SET_TURN_OVER_TCP_ONLY+" call "+e),"boolean"==typeof e?this.stateCenter.turnOverTcpOnly=e:this.logger.error("zc.p.stoto.0 param must be param")},e.prototype.createStream=function(e){return this.rtcModules.publishModule.createStream(e)},e.prototype.destroyStream=function(e){this.rtcModules.publishModule.destroyStream(e)},e.prototype.startPublishingStream=function(e,t,r){return this.logger.info(l.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" call by user"),this.rtcModules.publishModule.startPublishingStream(e,t,r)},e.prototype.activateSEIInsert=function(e){return this.rtcModules.publishModule.activateSEIInsert(e.stream,e.action,e.infoType)},e.prototype.stopPublishingStream=function(e){return this.logger.info(l.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" call by user"),this.rtcModules.publishModule.stopPublishingStream(e)},e.prototype.setVideoConfig=function(e,t){return this.rtcModules.advancedModule.setVideoConfig(e,t)},e.prototype.setAudioConfig=function(e,t){return this.rtcModules.advancedModule.setAudioConfig(e,t)},e.prototype.replaceTrack=function(e,t){return this.rtcModules.advancedModule.replaceTrack(e,t)},e.prototype.preloadEffect=function(e,t,r){this.rtcModules.audioMixModule.preloadEffect(e,t,r)},e.prototype.playEffect=function(e,t,r){this.rtcModules.audioMixModule.playEffect(e,t,r)},e.prototype.pauseEffect=function(e,t){return this.rtcModules.audioMixModule.pauseEffect(e,t)},e.prototype.resumeEffect=function(e,t){return this.rtcModules.audioMixModule.resumeEffect(e,t)},e.prototype.stopEffect=function(e,t){return this.rtcModules.audioMixModule.stopEffect(e,t)},e.prototype.unloadEffect=function(e){return this.rtcModules.audioMixModule.unloadEffect(e)},e.prototype.setEffectVolume=function(e,t,r){return this.rtcModules.audioMixModule.setEffectVolume(e,t,r)},e.prototype.startMixingAudio=function(e,t){return this.rtcModules.audioMixModule.startMixingAudio(e,t)},e.prototype.stopMixingAudio=function(e,t){return this.rtcModules.audioMixModule.stopMixingAudio(e,t)},e.prototype.mixingBuffer=function(e,t,r,o){this.rtcModules.audioMixModule.mixingBuffer(e,t,r,o)},e.prototype.stopMixingBuffer=function(e,t){return this.rtcModules.audioMixModule.stopMixingBuffer(e,t)},e.prototype.setMixingAudioVolume=function(e,t,r){return this.rtcModules.audioMixModule.setMixingAudioVolume(e,t,r)},e.prototype.checkSystemRequirements=function(t,r){var o=this,n=navigator&&navigator.mediaDevices&&(e.screenShotReady||"getDisplayMedia"in navigator.mediaDevices);return this.logger.info(l.ZEGO_WEBRTC_ACTION.CHECK_SUPPORT+" call"+navigator.userAgent),new Promise(function(e){var a=s.getReportSeq();o.dataReport.newReport(a,c.ZegoRTCLogEvent.kZegoTaskCheckSystemRequirements.event);var l=r||"all",d=function(t){o.dataReport.addMsgInfo(a,{capability:c.ZegoRTCLogEvent.kZegoTaskCheckSystemRequirements.capability(t)}),o.dataReport.uploadReport(a);var r=o.stateCenter.checkList.indexOf(l);o.stateCenter.checkList.splice(r,1),e(t)};return["webRTC","customCapture","camera","microphone","screenSharing","H264","VP8","all"].includes(l)&&[0,1].includes(t)?o.stateCenter.checkList.includes(l)||o.stateCenter.checkList.includes("all")?d({result:!1,errInfo:{extendedDate:"The last test of the same type has not returned a result "}}):(o.stateCenter.checkList.push(l),void i.ClientUtil.supportDetection(n,d,t,r)):d({result:!1,errInfo:{extendedDate:"param error"}})})},e.prototype.enumDevices=function(){var e=this;return this.logger.info("zc.ed.0 call"),new Promise(function(t,r){var o=s.getReportSeq();e.dataReport.newReport(o,c.ZegoRTCLogEvent.kZegoTaskEnumDevices.event),i.ClientUtil.getDevices(function(r){var s=[];r.cameras.forEach(function(e){return s.push({device:e.deviceName,type:0})}),r.microphones.forEach(function(e){return s.push({device:e.deviceName,type:1})}),r.speakers.forEach(function(e){return s.push({device:e.deviceName,type:2})}),e.dataReport.addMsgInfo(o,{dev_list:c.ZegoRTCLogEvent.kZegoTaskEnumDevices.dev_list(s)}),e.dataReport.uploadReport(o),t(r)},function(t){e.dataReport.addMsgInfo(o,t),e.dataReport.uploadReport(o),r(t)})})},e.prototype.getAudioInfo=function(e,t,r){if(!e)return this.logger.error("loclStream is empty!"),!1;var s=o({},r);return new a.MediaUtil(this.ac,s).connectToSource(e,function(e){t(e)})},e.prototype.getSoundLevel=function(e,t,r){this.rtcModules.audioMixModule.getSoundLevel(e,t,r)},e.prototype.stopSoundLevel=function(e){this.logger.info("zc.ssl call");var t=s.getReportSeq();this.dataReport.newReport(t,c.ZegoRTCLogEvent.kZegoTaskStopSoundLevel);var r=this.stateCenter.audioStreamList[e.id];r.mic.disconnect(),r.script.disconnect(),delete this.stateCenter.audioStreamList[e.id],this.dataReport.uploadReport(t)},e.handleDataAvailable=function(t){t.data&&t.data.size>0&&e.recordedBlobs.push(t.data)},e.prototype.startRecord=function(t){var r=this,o=t.captureStream();e.recordedBlobs=[];var i={mimeType:"video/webm;codecs=vp9"};s.MediaRecorder.isTypeSupported(i.mimeType)||s.MediaRecorder.isTypeSupported((i={mimeType:"video/webm;codecs=vp8"}).mimeType)||s.MediaRecorder.isTypeSupported((i={mimeType:"video/webm"}).mimeType)||(i={mimeType:""});try{e.mediaRecorder=new s.MediaRecorder(o,i)}catch(e){return void this.logger.error("Exception while creating ZegoMediaRecorder:",e)}e.mediaRecorder.onstop=function(e){r.logger.warn("Recorder stopped: "+e)},e.mediaRecorder.ondataavailable=e.handleDataAvailable,e.mediaRecorder.start(10)},e.prototype.stopRecord=function(){e.mediaRecorder?e.mediaRecorder.stop():this.logger.warn("please invoke startRecord first")},e.prototype.resumeRecord=function(){e.mediaRecorder?e.mediaRecorder.resume():this.logger.warn("please invoke startRecord first")},e.prototype.pauseRecord=function(){e.mediaRecorder?e.mediaRecorder.pause():this.logger.warn("please invoke startRecord first")},e.prototype.saveRecord=function(t){if(e.mediaRecorder&&e.recordedBlobs){var r=new Blob(e.recordedBlobs,{type:"video/webm"}),o=window.URL.createObjectURL(r),s=document.createElement("a");s.style.display="none",s.href=o,s.download=t+".webm",document.body.appendChild(s),s.click(),setTimeout(function(){document.body.removeChild(s),window.URL.revokeObjectURL(o)},100)}else this.logger.warn("please invoke startRecord first")},e.prototype.takeSnapShot=function(e,t){if(e&&0!==e.videoHeight){var r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight;var o=r.getContext("2d");o&&o.drawImage(e,0,0,r.width,r.height),t.src=r.toDataURL("image/jpeg")}else this.logger.error("video can not empty")},e.prototype.saveSnapShot=function(e,t){if(e&&0!==e.videoHeight){var r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight;var o=r.getContext("2d");o&&o.drawImage(e,0,0,r.width,r.height),r.toBlob(function(e){var r=window.URL.createObjectURL(e),o=document.createElement("a");o.style.display="none",o.href=r,o.download=t+".jpeg",document.body.appendChild(o),o.click(),setTimeout(function(){document.body.removeChild(o),window.URL.revokeObjectURL(r)},100)})}else this.logger.error("video can not empty")},e.prototype.useVideoDevice=function(e,t){return this.rtcModules.advancedModule.useVideoDevice(e,t)},e.prototype.useAudioDevice=function(e,t){return this.rtcModules.advancedModule.useAudioDevice(e,t)},e.prototype.setSoundLevelDelegate=function(e,t){this.logger.info("zc.ssd.0 call"),"boolean"==typeof e?t&&(!i.ClientUtil.checkInteger(t)||t<100||t>3e3)?this.logger.error("zc.ssd.0 soundLevel interval must be integer number which is between 100 and 3000"):this.streamCenter.setSoundLevelDelegate(e,t):this.logger.error("zc.ssd.0 param 1 must be boolean")},e.prototype.on=function(e,t){return this.rtcModules.bindListener(e,t)},e.prototype.off=function(e,t){return this.rtcModules.deleteListener(e,t)},e.prototype.getVersion=function(){return s.PROTO_VERSION},e.prototype.setStreamExtraInfo=function(e,t){var r=this;return new Promise(function(o,i){var n=s.getReportSeq();r.dataReport.newReport(n,c.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.event),r.dataReport.addMsgInfo(n,{stream:c.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream(e),stream_extra_info:c.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream_extra_info(t)});var a=function(e,t){r.logger.error("zb.ssei "+t),r.dataReport.addMsgInfo(n,{error:e.code,message:e.message+" "+t}),r.dataReport.uploadReport(n),i({errorCode:e.code,extendedData:e.message+" "+t})};if("string"==typeof e&&""!=e)if("string"==typeof t&&""!=t)if(r.RTM.service.isDisConnect())a(c.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login");else if(r.stateCenter.publishStreamList[e]){var l=r.streamCenter.getRoomByStreamID(e);l?(r.dataReport.addMsgInfo(n,{room_sid:c.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.room_sid(l.sessionID)}),l.streamHandler.setStreamExtraInfo(e,t,o,a),r.dataReport.uploadReport(n)):a(c.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login")}else a(c.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError,"publish stream no found");else a(c.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"extraInfo must be string and no empty");else a(c.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"streamID must be string and not empty")})},e.prototype.addPublishCdnUrl=function(e,t){return this.logger.info("zg.cm.apu call ",e,t),this.rtcModules.advancedModule.publishTarget({type:"addpush",streamID:e,pushUrl:t})},e.prototype.removePublishCdnUrl=function(e,t){return this.logger.info("zg.cm.apu call ",e,t),this.rtcModules.advancedModule.publishTarget({type:"delpush",streamID:e,pushUrl:t})},e.prototype.startMixerTask=function(e){var t=this;return new Promise(function(r,o){e.outputConfig&&e.outputConfig.outputFps&&(e.outputConfig.outputFPS=e.outputConfig.outputFps);var n=s.getReportSeq();t.dataReport.newReport(n,c.ZegoRTCLogEvent.kZegoTaskMixStart.event),i.ClientUtil.logReportCallback("kZegoTaskMixStart"+e.taskID,t.dataReport,n,t.stateCenter.reportList);var a=function(r){var s,a,l,c="",d=h.errorCodeList;r.errorCode<2e9&&r.errorCode>1e9?l=d[c=i.ClientUtil.mixServerError(r.errorCode)]:r.errorCode<1e6&&(l=i.ClientUtil.decodeServerError(r.errorCode,r.extendedData),c=i.ClientUtil.getLiveRoomError(r.errorCode)),t.dataReport.addMsgInfo(n,l||r),t.dataReport.uploadReport(n),i.ClientUtil.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),c&&(r.errorCode=null===(s=d[c])||void 0===s?void 0:s.code,r.extendedData=(null===(a=d[c])||void 0===a?void 0:a.message)||""),o(r)},l=t.stateCenter.roomList[0];l?l.streamHandler.updateMixStream(e,function(o){t.dataReport.uploadReport(n),i.ClientUtil.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),r(o)},a):a({errorCode:c.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.code,extendedData:c.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.message})})},e.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise(function(r,o){var n=s.getReportSeq();t.dataReport.newReport(n,c.ZegoRTCLogEvent.kZegoTaskMixConfig.event),i.ClientUtil.logReportCallback("kZegoTaskMixConfig",t.dataReport,n,t.stateCenter.reportList);var a=t.stateCenter.roomList[0];a?a.streamHandler.setMixerTaskConfig(e).then(function(e){t.dataReport.uploadReport(n),i.ClientUtil.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),r(e)}).catch(function(e){t.dataReport.addMsgInfo(n,e),t.dataReport.uploadReport(n),i.ClientUtil.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),o(e)}):o({errorCode:c.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.code,extendedData:c.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.message})})},e.prototype.stopMixerTask=function(e){var t=this;return new Promise(function(r,o){var n=s.getReportSeq();if(t.dataReport.newReport(n,c.ZegoRTCLogEvent.kZegoTaskMixStop.event),!e||"string"!=typeof e||e.length>s.MAX_MIX_TASK_ID_LENGTH||!i.ClientUtil.checkIllegalCharacters(e))return t.logger.error("zb.rh.lg taskID must be string less 256"),t.dataReport.addMsgInfo(n,{error:c.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,message:c.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"}),t.dataReport.uploadReport(n),void o({errorCode:c.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,extendedData:c.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"});var a=function(e){var r,a,l,c="",d=h.errorCodeList;e.errorCode<2e9&&e.errorCode>1e9?l=d[c=i.ClientUtil.mixServerError(e.errorCode-s.MIXSTREAM_ERROR_CODE)]:e.errorCode<1e6&&(l=i.ClientUtil.decodeServerError(e.errorCode,e.extendedData),c=i.ClientUtil.getLiveRoomError(e.errorCode)),t.dataReport.addMsgInfo(n,l||e),t.dataReport.uploadReport(n),c&&(e.errorCode=null===(r=d[c])||void 0===r?void 0:r.code,e.extendedData=(null===(a=d[c])||void 0===a?void 0:a.message)||""),o(e)},l=t.stateCenter.roomList[0];l?l.streamHandler.stopMixStream(e,function(e){t.dataReport.uploadReport(n),r(e)},a):a({errorCode:c.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.code,extendedData:c.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.message})})},e.prototype.setCaptureVolume=function(e,t){return this.rtcModules.publishModule.setCaptureVolume(e,t)},e.prototype.getRoomInfo=function(){var e=this.stateCenter.roomList[0];return null==e?void 0:e.streamHandler.getRoomInfo()},e.screenShotReady=!1,e}();t.ZegoWebRTC=p,window.addEventListener("message",function(e){var t=e.data.type,r=e.origin;r!==window.location.origin&&console.warn("ScreenStream: you should discard foreign event from origin:",r),"SS_PING"===t&&(p.screenShotReady=!0)})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPreview=void 0;var o=r(0),s=r(1),i=r(2),n=function(){function e(e,t,r,s){var i=this;this.localStream=null,this.videoInfo={},this.previewSuc=!1,this.soundLevel=0,this.script=null,this.mic=null,this.audioTrack=null,this.activeteSEIConfig=null,this.isAudioEnabled=!0,this.gainNode=null,this.enableMicrophone=function(e,t){if(!i.localStream)return i.logger.error("zp.em.2 no localStream"),!1;for(var r in i.localStream.getAudioTracks().forEach(function(t){t.enabled=e}),i.audioTrack&&(i.audioTrack.enabled=e&&t.isMicEnabled),t.publisherList){var s=t.publisherList[r].publisher;s.localStream==i.localStream&&s.signal.sendStreamStatus(o.getSeq(),s.sessionId,i.localStream.getVideoTracks()[0]&&!0===i.localStream.getVideoTracks()[0].enabled?0:2,e?0:2,s.streamId)}return i.isAudioEnabled=e,i.logger.debug("zp.em.2 call success"),!0},this.enableMicrophoneOnly=function(e){return i.micTrack?(i.micTrack.enabled=i.isAudioEnabled&&e,i.logger.debug("zp.emo.2 call success"),!0):(i.logger.error("zp.emo.2 no micTrack"),!1)},this.enableCamera=function(e,t,r){var s,n;if(!i.localStream)return i.logger.error("zp.ec.2 no localStream"),!1;(!r||e)&&i.localStream.getVideoTracks().forEach(function(t){if(t.enabled=e,e&&void 0!==typeof t.getSettings().width&&t.getSettings().width>0){var r=t.getSettings().width-1;t.applyConstraints({width:r}),setTimeout(function(){t.applyConstraints({width:i.videoInfo.width})},200)}});var a=function(a){var l=t.publisherList[a].publisher;if(l.localStream==i.localStream){if(r&&!e){var c=i.localStream.clone(),d=c.getVideoTracks()[0];null==(u=null===(s=l.peerConnection)||void 0===s?void 0:s.getSenders().find(function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.kind)===d.kind}))||u.replaceTrack(d),c.getTracks().forEach(function(e){return e.stop()})}else if(e){var u;null==(u=null===(n=l.peerConnection)||void 0===n?void 0:n.getSenders().find(function(e){var t;return"video"===(null===(t=e.track)||void 0===t?void 0:t.kind)}))||u.replaceTrack(i.localStream.getVideoTracks()[0])}l.signal.sendStreamStatus(o.getSeq(),l.sessionId,e?0:2,i.localStream.getAudioTracks()[0]&&1==i.localStream.getAudioTracks()[0].enabled?0:2,l.streamId)}};for(var l in t.publisherList)a(l);return i.logger.info("zp.ec.2 call success"),!0},this.logger=e,this.previewType=s,this.ac=t,this.streamCenter=r}return Object.defineProperty(e.prototype,"micTrack",{get:function(){return"camera"===this.previewType&&this.audioTrack||null},enumerable:!1,configurable:!0}),e.prototype.getMediaStreamConstraints=function(e,t){var r={audio:null,video:null};if(r.audio=!0,r.video={width:640,height:480,frameRate:15,bitRate:800},e.audio?void 0===e.audioInput&&void 0===e.ANS&&void 0===e.AGC&&void 0===e.AEC&&void 0===e.channelCount?(r.audio={},r.audio.noiseSuppression=!0,r.audio.autoGainControl=!0,r.audio.echoCancellation=!0,r.audio.channelCount=1):(r.audio={},null!=e.audioInput&&(r.audio.deviceId=e.audioInput),void 0!==e.ANS&&(r.audio.noiseSuppression=e.ANS),void 0!==e.AGC&&(r.audio.autoGainControl=e.AGC),void 0!==e.AEC&&(r.audio.echoCancellation=e.AEC),void 0!==e.channelCount&&(r.audio.channelCount=e.channelCount)):!1===e.audio&&(r.audio=!1),e.video){var s=640,i=480,n=15,a=800;if(1===e.videoQuality?(s=o.ENUM_RESOLUTION_TYPE.LOW.width,i=o.ENUM_RESOLUTION_TYPE.LOW.height,n=o.ENUM_RESOLUTION_TYPE.LOW.frameRate,a=o.ENUM_RESOLUTION_TYPE.LOW.bitRate):2===e.videoQuality?(s=o.ENUM_RESOLUTION_TYPE.MEDIUM.width,i=o.ENUM_RESOLUTION_TYPE.MEDIUM.height,n=o.ENUM_RESOLUTION_TYPE.MEDIUM.frameRate,a=o.ENUM_RESOLUTION_TYPE.MEDIUM.bitRate):3===e.videoQuality?(s=o.ENUM_RESOLUTION_TYPE.HIGH.width,i=o.ENUM_RESOLUTION_TYPE.HIGH.height,n=o.ENUM_RESOLUTION_TYPE.HIGH.frameRate,a=o.ENUM_RESOLUTION_TYPE.HIGH.bitRate):4===e.videoQuality?(s=e.width,i=e.height,n=e.frameRate,a=e.bitRate||800):this.logger.info("zp.gmsc.2 use default"),t&&(e.width&&(s=e.width),e.height&&(i=e.height),e.frameRate&&(n=e.frameRate),e.bitRate&&(a=e.bitRate)),!1===e.horizontal){var l=i;i=s,s=l}!0===e.isSwitch&&(l=i,i=s,s=l),r.video={width:s,height:i,frameRate:n,bitRate:a},null!=e.facingMode?r.video.facingMode=e.facingMode:null!=e.videoInput&&null!=e.videoInput&&""!=e.videoInput&&(r.video.deviceId={exact:e.videoInput}),this.logger.info("zp.gmsc.2 width: "+s+" height: "+i+" rate: "+n)}else!1===e.video&&(e.audioBitrate&&(r.video={}),r.video=!1);return r},e.prototype.startPreview=function(e,t,r){var o=this;if(this.logger.debug("zp.sv.2 called"),this.mediaStreamConfig=e,void 0!==navigator.mediaDevices&&null!=navigator.mediaDevices.getUserMedia){if(e.source instanceof MediaStream){var i=e.source.getVideoTracks(),n=i.length>0?i[0].getSettings():{width:0,height:0,frameRate:0};return this.logger.debug("zp.sv.2 use external media stream"),this.previewSuc=!0,this.localStream=e.source,e.source.getAudioTracks().length>0&&(this.audioTrack=e.source.getAudioTracks()[0]),this.videoInfo={width:n.width,height:n.height,frameRate:n.frameRate,bitRate:e.bitRate||0,startBitrate:e.startBitrate,channelCount:e.channelCount||(this.audioTrack&&this.audioTrack.getSettings?this.audioTrack.getSettings().channelCount:1),audioBitrate:1e3*e.audioBitrate||48e3},void(t&&t(this.localStream))}if(e.source instanceof HTMLMediaElement){var a=this.captureStream(e.source,e);a?(this.videoInfo.bitRate=e.bitRate||0,this.previewSuc=!0,a.getAudioTracks().length>0&&(this.audioTrack=a.getAudioTracks()[0]),t&&t(a)):r&&r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError)}else{var l=this.getMediaStreamConstraints(e);this.videoInfo=l.video,this.videoInfo?(this.videoInfo.audioBitrate=1e3*e.audioBitrate||48e3,this.videoInfo.startBitrate=e.startBitrate):e.audioBitrate&&(this.videoInfo={audioBitrate:1e3*e.audioBitrate||48e3}),this.mediaStreamConfig.video=!!l.video,this.mediaStreamConfig.audio=!!l.audio,this.logger.info("zp.sv.2 ",JSON.stringify(l)),navigator.mediaDevices.getUserMedia(l).then(function(r){o.logger.info("zp.sv.2 success"),o.localStream=r,o.previewSuc=!0,r.getAudioTracks().length>0&&(o.audioTrack=o.localStream.getAudioTracks()[0]),o.videoInfo&&(o.videoInfo.channelCount=e.channelCount||(o.audioTrack&&o.audioTrack.getSettings?o.audioTrack.getSettings().channelCount:1)),t&&t(r)},function(e){if(o.logger.info("zp.sv.2 failed ",e.name," ",e.message),r){var t=s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kGetUserMediaError;t.message=t.message+" "+e.name+e.message,r(t)}})}}else r&&r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError)},e.prototype.captureStream=function(e,t){if(!e)return this.logger.info("zp.cs.2 no local video"),null;var r;if(e.captureStream)r=e.captureStream(),this.logger.debug("zp.cs.2 captureStream");else{if(!e.mozCaptureStream)return this.logger.info("zp.cs.2 don't support"),null;r=e.mozCaptureStream(),this.logger.debug("zp.cs.2 mozCaptureStream")}return 0==r.getTracks().length?(this.logger.error("zp.cs.2 external capture tracks no found"),null):(this.localStream=r,this.videoInfo={width:e.videoWidth,height:e.videoHeight,frameRate:0,bitRate:0,channelCount:t.channelCount||(this.audioTrack&&this.audioTrack.getSettings?this.audioTrack.getSettings().channelCount:1),audioBitrate:1e3*t.audioBitrate||48e3,startBitrate:t.startBitrate},this.logger.debug("zp.cs.2 called success"),this.localStream)},e.prototype.stopPreview=function(){this.logger.info("zp.sv.2.1 called"),this.localStream&&(this.localStream.getTracks().reverse().forEach(function(e){return e.stop()}),this.audioTrack&&this.audioTrack.stop(),this.localStream=null,this.videoInfo={})},e.prototype.startSoundLevel=function(){var e=this;if(this.localStream&&0!=this.localStream.getAudioTracks().length){this.script&&this.script.disconnect()&&(this.script=null),this.mic&&this.mic.disconnect()&&(this.mic=null);try{this.mic=this.ac.createMediaStreamSource(this.localStream),this.script=this.ac.createScriptProcessor(4096,1,1),this.mic.connect(this.script),this.script.connect(this.ac.destination),this.script.onaudioprocess=function(t){for(var r=t.inputBuffer.getChannelData(0),o=0,s=0;s<r.length;s++)o<r[s]&&(o=r[s]);e.soundLevel=100*o},this.ac.resume()}catch(e){this.logger.error(i.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" get sound level failed "+e)}}},e.prototype.stopSoundLevel=function(){this.soundLevel=0,this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect(),this.script=null,this.mic=null},e.prototype.restartSoundLevel=function(){this.streamCenter.soundLevelDelegate?(this.stopSoundLevel(),this.startSoundLevel()):this.stopSoundLevel()},e}();t.ZegoPreview=n},function(e,t,r){e.exports=function e(t,r,o){function s(n,a){if(!r[n]){if(!t[n]){if(i)return i(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[n]={exports:{}};t[n][0].call(c.exports,function(e){return s(t[n][1][e]||e)},c,c.exports,e,t,r,o)}return r[n].exports}for(var i=!1,n=0;n<o.length;n++)s(o[n]);return s}({1:[function(e,t,r){"use strict";var o=(0,e("./adapter_factory.js").adapterFactory)({window:window});t.exports=o},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=o.log,c=o.detectBrowser(e),d={browserDetails:c,commonShim:l,extractVersion:o.extractVersion,disableLog:o.disableLog,disableWarnings:o.disableWarnings};switch(c.browser){case"chrome":if(!s||!s.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),d;r("adapter.js shimming chrome."),d.browserShim=s,s.shimGetUserMedia(e),s.shimMediaStream(e),s.shimPeerConnection(e),s.shimOnTrack(e),s.shimAddTrackRemoveTrack(e),s.shimGetSendersWithDtmf(e),s.shimGetStats(e),s.shimSenderReceiverGetStats(e),s.fixNegotiationNeeded(e),l.shimRTCIceCandidate(e),l.shimConnectionState(e),l.shimMaxMessageSize(e),l.shimSendThrowTypeError(e),l.removeAllowExtmapMixed(e);break;case"firefox":if(!n||!n.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),d;r("adapter.js shimming firefox."),d.browserShim=n,n.shimGetUserMedia(e),n.shimPeerConnection(e),n.shimOnTrack(e),n.shimRemoveStream(e),n.shimSenderGetStats(e),n.shimReceiverGetStats(e),n.shimRTCDataChannel(e),l.shimRTCIceCandidate(e),l.shimConnectionState(e),l.shimMaxMessageSize(e),l.shimSendThrowTypeError(e);break;case"edge":if(!i||!i.shimPeerConnection||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),d;r("adapter.js shimming edge."),d.browserShim=i,i.shimGetUserMedia(e),i.shimGetDisplayMedia(e),i.shimPeerConnection(e),i.shimReplaceTrack(e),l.shimMaxMessageSize(e),l.shimSendThrowTypeError(e);break;case"safari":if(!a||!t.shimSafari)return r("Safari shim is not included in this adapter release."),d;r("adapter.js shimming safari."),d.browserShim=a,a.shimRTCIceServerUrls(e),a.shimCreateOfferLegacy(e),a.shimCallbacksAPI(e),a.shimLocalStreamsAPI(e),a.shimRemoteStreamsAPI(e),a.shimTrackEventTransceiver(e),a.shimGetUserMedia(e),l.shimRTCIceCandidate(e),l.shimMaxMessageSize(e),l.shimSendThrowTypeError(e),l.removeAllowExtmapMixed(e);break;default:r("Unsupported browser!")}return d};var o=c(e("./utils")),s=c(e("./chrome/chrome_shim")),i=c(e("./edge/edge_shim")),n=c(e("./firefox/firefox_shim")),a=c(e("./safari/safari_shim")),l=c(e("./common_shim"));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(o){var s;s=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===o.track.id}):{track:o.track};var i=new Event("track");i.track=o.track,i.receiver=s,i.transceiver={receiver:s},i.streams=[t.stream],r.dispatchEvent(i)}),t.stream.getTracks().forEach(function(o){var s;s=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===o.id}):{track:o};var i=new Event("track");i.track=o,i.receiver=s,i.transceiver={receiver:s},i.streams=[t.stream],r.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else n.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e})},r.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===t.kind?e.createDTMFSender(t):null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,o){var s=r.apply(this,arguments);return s||(s=t(this,e),this._senders.push(s)),s};var s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){s.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}},r.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,o){var s=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof arguments[0]))return t.apply(this,[]);var n=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},a=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};return arguments.length>=2?t.apply(this,[function(e){i[1](a(n(e)))},arguments[0]]):new Promise(function(e,r){t.apply(s,[function(t){e(a(n(t)))},r])}).then(r,o)}}},r.shimSenderReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return n.filterStats(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=s.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return n.filterStats(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,o=void 0,s=void 0;return this.getSenders().forEach(function(e){e.track===t&&(r?s=!0:r=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(o?s=!0:o=e),e.track===t}),s||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}},r.shimAddTrackRemoveTrackWithNative=a,r.shimAddTrackRemoveTrack=function(e){if(e.RTCPeerConnection){var t=n.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return a(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var s=new e.MediaStream(t.getTracks());this._streams[t.id]=s,this._reverseStreams[s.id]=t,t=s}o.apply(this,[t])};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var o=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var s=[].slice.call(arguments,1);if(1!==s.length||!s[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var i=this._streams[r.id];if(i)i.addTrack(t),Promise.resolve().then(function(){o.dispatchEvent(new Event("negotiationneeded"))});else{var n=new e.MediaStream([t]);this._streams[r.id]=n,this._reverseStreams[n.id]=r,this.addStream(n)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[function(r){var o=c(e,r);t[0].apply(null,[o])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then(function(t){return c(e,t)})}});var i=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=d(this,arguments[0]),i.apply(this,arguments)):i.apply(this,arguments)};var l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=l.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var r=void 0;Object.keys(this._streams).forEach(function(o){t._streams[o].getTracks().find(function(t){return e.track===t})&&(r=t._streams[o])}),r&&(1===r.getTracks().length?this.removeStream(this._reverseStreams[r.id]):r.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var o=e._reverseStreams[t];r=r.replace(new RegExp(e._streams[o.id].id,"g"),o.id)}),new RTCSessionDescription({type:t.type,sdp:r})}function d(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var o=e._reverseStreams[t],s=e._streams[o.id];r=r.replace(new RegExp(o.id,"g"),s.id)}),new RTCSessionDescription({type:t.type,sdp:r})}},r.shimPeerConnection=function(e){if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},r.fixNegotiationNeeded=function(e){n.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));function a(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var o=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(o)&&this._shimmedLocalStreams[r.id].push(o):this._shimmedLocalStreams[r.id]=[r,o],o};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var o=this.getSenders();r.apply(this,arguments);var s=this.getSenders().filter(function(e){return-1===o.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(s)};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],o.apply(this,arguments)};var s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var o=t._shimmedLocalStreams[r].indexOf(e);-1!==o&&t._shimmedLocalStreams[r].splice(o,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),s.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(function(t){var o=r.video&&r.video.width,s=r.video&&r.video.height;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:r.video&&r.video.frameRate||3}},o&&(r.video.mandatory.maxWidth=o),s&&(r.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices){var r=s.detectBrowser(e),n=function(e){if("object"!==(void 0===e?"undefined":o(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var s="object"===o(e[r])?e[r]:{ideal:e[r]};void 0!==s.exact&&"number"==typeof s.exact&&(s.min=s.max=s.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==s.ideal){t.optional=t.optional||[];var n={};"number"==typeof s.ideal?(n[i("min",r)]=s.ideal,t.optional.push(n),(n={})[i("max",r)]=s.ideal,t.optional.push(n)):(n[i("",r)]=s.ideal,t.optional.push(n))}void 0!==s.exact&&"number"!=typeof s.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=s.exact):["min","max"].forEach(function(e){void 0!==s[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=s[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,s){if(r.version>=61)return s(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===o(e.audio)){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===o(e.video)){var l=e.video.facingMode;l=l&&("object"===(void 0===l?"undefined":o(l))?l:{ideal:l});var c=r.version<66;if(l&&("user"===l.exact||"environment"===l.exact||"user"===l.ideal||"environment"===l.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||c)){delete e.video.facingMode;var d=void 0;if("environment"===l.exact||"environment"===l.ideal?d=["back","rear"]:"user"!==l.exact&&"user"!==l.ideal||(d=["front"]),d)return t.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return d.some(function(t){return e.label.toLowerCase().includes(t)})});return!r&&t.length&&d.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=l.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),i("chrome: "+JSON.stringify(e)),s(e)})}e.video=n(e.video)}return i("chrome: "+JSON.stringify(e)),s(e)},l=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=(function(e,r,o){a(e,function(e){t.webkitGetUserMedia(e,r,function(e){o&&o(l(e))})})}).bind(t),t.mediaDevices.getUserMedia){var c=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return a(e,function(e){return c(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(l(e))})})}}}};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js")),i=s.log},{"../utils.js":15}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=function(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),s=i.default.parseCandidate(e.candidate),n=Object.assign(r,s);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,n.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},r.shimMaxMessageSize=function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=n.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=i.default.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=i.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},o=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r},s=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},a=function(e,r){var o=65536;"firefox"===t.browser&&57===t.version&&(o=65535);var s=i.default.matchPrefix(e.sdp,"a=max-message-size:");return s.length>0?o=parseInt(s[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(o=2147483637),o},l=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r(arguments[0])){var e=o(arguments[0]),t=s(e),i=a(arguments[0],e),n=void 0;n=0===t&&0===i?Number.POSITIVE_INFINITY:0===t||0===i?Math.max(t,i):Math.min(t,i);var c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return n}}),this._sctp=c}return l.apply(this,arguments)}}},r.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},n.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e})}function r(e,t){var r=e.send;e.send=function(){var o=arguments[0];if("open"===e.readyState&&t.sctp&&(o.length||o.size||o.byteLength)>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}},r.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}},r.removeAllowExtmapMixed=function(e){if(e.RTCPeerConnection){var t=n.detectBrowser(e);if(!("chrome"===t.browser&&t.version>=71)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n")),r.apply(this,arguments)}}}};var s,i=(s=e("sdp"))&&s.__esModule?s:{default:s},n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var o=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}});var s=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return s.shimGetDisplayMedia}}),r.shimPeerConnection=function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var o=(0,l.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,a.filterIceServers)(e.iceServers,t.version),n.log("ICE servers after filtering:",e.iceServers)),new o(e)},e.RTCPeerConnection.prototype=o.prototype},r.shimReplaceTrack=function(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var i,n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")),a=e("./filtericeservers"),l=(i=e("rtcpeerconnection-shim"))&&i.__esModule?i:{default:i}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&o.deprecated("RTCIceServer.url","RTCIceServer.urls");var s="string"==typeof t;return s&&(t=[t]),t=t.filter(function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?(r=!0,!0):t&&!r}),delete e.url,e.urls=s?t[0]:t,!!t.length}})};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimOnTrack=function(e){"object"===(void 0===e?"undefined":o(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimPeerConnection=function(e){var t=n.detectBrowser(e);if("object"===(void 0===e?"undefined":o(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,o){return i.apply(this,[e||null]).then(function(e){if(t.version<53&&!r)try{e.forEach(function(e){e.type=s[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:s[t.type]||t.type}))})}return e}).then(r,o)}}},r.shimSenderGetStats=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},r.shimReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},r.shimRemoveStream=function(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)})})},r.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=s.detectBrowser(e),r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,o){s.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,o)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var n=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":o(e))&&"object"===o(e.audio)&&(e=JSON.parse(JSON.stringify(e)),n(e.audio,"autoGainControl","mozAutoGainControl"),n(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},i&&i.prototype.getSettings){var l=i.prototype.getSettings;i.prototype.getSettings=function(){var e=l.apply(this,arguments);return n(e,"mozAutoGainControl","autoGainControl"),n(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":o(e))&&(e=JSON.parse(JSON.stringify(e)),n(e,"autoGainControl","mozAutoGainControl"),n(e,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[e])}}}};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getTracks().forEach(function(o){return t.call(r,o,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var o=e.getTracks();this.getSenders().forEach(function(e){o.includes(e.track)&&t.removeTrack(e)})}})}},r.shimRemoteStreamsAPI=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}},r.shimCallbacksAPI=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,s=t.createAnswer,i=t.setLocalDescription,n=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var o=r.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){var r=s.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return t?(r.then(e,t),Promise.resolve()):r};var l=function(e,t,r){var o=i.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o};t.setLocalDescription=l,t.setRemoteDescription=l=function(e,t,r){var o=n.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o},t.addIceCandidate=l=function(e,t,r){var o=a.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o}}},r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,o=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return o(i(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,r,o){t.mediaDevices.getUserMedia(e).then(r,o)}).bind(t))},r.shimConstraints=i,r.shimRTCIceServerUrls=function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var o=[],i=0;i<e.iceServers.length;i++){var n=e.iceServers[i];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(s.deprecated("RTCIceServer.url","RTCIceServer.urls"),(n=JSON.parse(JSON.stringify(n))).urls=n.url,delete n.url,o.push(n)):o.push(e.iceServers[i])}e.iceServers=o}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},r.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var o=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0!==e.offerToReceiveVideo||o||this.addTransceiver("video")}return t.apply(this,arguments)}};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"));function i(e){return e&&void 0!==e.video?Object.assign({},e,{video:s.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.extractVersion=n,r.wrapPeerConnectionEvent=function(e,t,r){if(e.RTCPeerConnection){var o=e.RTCPeerConnection.prototype,s=o.addEventListener;o.addEventListener=function(e,o){if(e!==t)return s.apply(this,arguments);var i=function(e){var t=r(e);t&&o(t)};return this._eventMap=this._eventMap||{},this._eventMap[o]=i,s.apply(this,[e,i])};var i=o.removeEventListener;o.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return i.apply(this,arguments);var o=this._eventMap[r];return delete this._eventMap[r],i.apply(this,[e,o])},Object.defineProperty(o,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},r.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":o(e))+". Please use a boolean."):(s=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},r.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":o(e))+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},r.log=function(){if("object"===("undefined"==typeof window?"undefined":o(window))){if(s)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},r.deprecated=function(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")},r.detectBrowser=function(e){var t=e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=n(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=n(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=n(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=n(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r},r.compactObject=function e(t){return"object"!==(void 0===t?"undefined":o(t))?t:Object.keys(t).reduce(function(r,s){var i="object"===o(t[s]),n=i?e(t[s]):t[s],a=i&&!Object.keys(n).length;return void 0===n||a?r:Object.assign(r,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},s,n))},{})},r.walkStats=a,r.filterStats=function(e,t,r){var o=r?"outbound-rtp":"inbound-rtp",s=new Map;if(null===t)return s;var i=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)}),i.forEach(function(t){e.forEach(function(r){r.type===o&&r.trackId===t.id&&a(e,r,s)})}),s};var s=!0,i=!0;function n(e,t,r){var o=e.match(t);return o&&o.length>=r&&parseInt(o[r],10)}function a(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(function(o){o.endsWith("Id")?a(e,e.get(t[o]),r):o.endsWith("Ids")&&t[o].forEach(function(t){a(e,e.get(t),r)})}))}},{}],16:[function(e,t,r){"use strict";var o=e("sdp");function s(e,t,r,s,i){var n=o.writeRtpDescription(e.kind,t);if(n+=o.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=o.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),n+="a=mid:"+e.mid+"\r\n",n+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var l="msid:"+(s?s.id:"-")+" "+a+"\r\n";n+="a="+l,n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+l,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+l,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+o.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+o.localCName+"\r\n"),n}function i(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},o=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},s=function(e,t,r,s){var i=o(e.parameters.apt,r),n=o(t.parameters.apt,s);return i&&n&&i.name.toLowerCase()===n.name.toLowerCase()};return e.codecs.forEach(function(o){for(var i=0;i<t.codecs.length;i++){var n=t.codecs[i];if(o.name.toLowerCase()===n.name.toLowerCase()&&o.clockRate===n.clockRate){if("rtx"===o.name.toLowerCase()&&o.parameters&&n.parameters.apt&&!s(o,n,e.codecs,t.codecs))continue;(n=JSON.parse(JSON.stringify(n))).numChannels=Math.min(o.numChannels,n.numChannels),r.codecs.push(n),n.rtcpFeedback=n.rtcpFeedback.filter(function(e){for(var t=0;t<o.rtcpFeedback.length;t++)if(o.rtcpFeedback[t].type===e.type&&o.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var o=0;o<t.headerExtensions.length;o++){var s=t.headerExtensions[o];if(e.uri===s.uri){r.headerExtensions.push(s);break}}}),r}function n(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function a(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function l(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}t.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function c(t,r,o,s){var i=new Event("track");i.track=r,i.receiver=o,i.transceiver={receiver:o},i.streams=s,e.setTimeout(function(){t._dispatchEvent("track",i)})}var d=function(r){var s=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){s[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw l("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var o=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var s="string"==typeof o;return s&&(o=[o]),o=o.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)}),delete e.url,e.urls=s?o[0]:o,!!o.length}})}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var n=r.iceCandidatePoolSize;n>0;n--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=o.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(d.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(d.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),d.prototype.onicecandidate=null,d.prototype.onaddstream=null,d.prototype.ontrack=null,d.prototype.onremovestream=null,d.prototype.onsignalingstatechange=null,d.prototype.oniceconnectionstatechange=null,d.prototype.onconnectionstatechange=null,d.prototype.onicegatheringstatechange=null,d.prototype.onnegotiationneeded=null,d.prototype.ondatachannel=null,d.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},d.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},d.prototype.getConfiguration=function(){return this._config},d.prototype.getLocalStreams=function(){return this.localStreams},d.prototype.getRemoteStreams=function(){return this.remoteStreams},d.prototype._createTransceiver=function(e,t){var r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&this.transceivers.length>0)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var o=this._createIceAndDtlsTransports();r.iceTransport=o.iceTransport,r.dtlsTransport=o.dtlsTransport}return t||this.transceivers.push(r),r},d.prototype.addTrack=function(t,r){if(this._isClosed)throw l("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var o;if(this.transceivers.find(function(e){return e.track===t}))throw l("InvalidAccessError","Track already exists.");for(var s=0;s<this.transceivers.length;s++)this.transceivers[s].track||this.transceivers[s].kind!==t.kind||(o=this.transceivers[s]);return o||(o=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),o.track=t,o.stream=r,o.rtpSender=new e.RTCRtpSender(t,o.dtlsTransport),o.rtpSender},d.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var o=e.clone();e.getTracks().forEach(function(e,t){var r=o.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),o.getTracks().forEach(function(e){r.addTrack(e,o)})}},d.prototype.removeTrack=function(t){if(this._isClosed)throw l("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw l("InvalidAccessError","Sender was not created by this connection.");var o=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(o)&&this.localStreams.indexOf(o)>-1&&this.localStreams.splice(this.localStreams.indexOf(o),1),this._maybeFireNegotiationNeeded()},d.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},d.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},d.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},d.prototype._createIceGatherer=function(t,r){var o=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var s=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(s,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;s.state=r?"completed":"gathering",null!==o.transceivers[t].bufferedCandidateEvents&&o.transceivers[t].bufferedCandidateEvents.push(e)},s.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),s},d.prototype._gather=function(t,r){var s=this,i=this.transceivers[r].iceGatherer;if(!i.onlocalcandidate){var n=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),i.onlocalcandidate=function(e){if(!(s.usingBundle&&r>0)){var n=new Event("icecandidate");n.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,l=!a||0===Object.keys(a).length;if(l)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),a.component=1,a.ufrag=i.getLocalParameters().usernameFragment;var c=o.writeCandidate(a);n.candidate=Object.assign(n.candidate,o.parseCandidate(c)),n.candidate.candidate=c,n.candidate.toJSON=function(){return{candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex,usernameFragment:n.candidate.usernameFragment}}}var d=o.getMediaSections(s._localDescription.sdp);d[n.candidate.sdpMLineIndex]+=l?"a=end-of-candidates\r\n":"a="+n.candidate.candidate+"\r\n",s._localDescription.sdp=o.getDescription(s._localDescription.sdp)+d.join("");var u=s.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==s.iceGatheringState&&(s.iceGatheringState="gathering",s._emitGatheringStateChange()),l||s._dispatchEvent("icecandidate",n),u&&(s._dispatchEvent("icecandidate",new Event("icecandidate")),s.iceGatheringState="complete",s._emitGatheringStateChange())}},e.setTimeout(function(){n.forEach(function(e){i.onlocalcandidate(e)})},0)}},d.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var o=new e.RTCDtlsTransport(r);return o.ondtlsstatechange=function(){t._updateConnectionState()},o.onerror=function(){Object.defineProperty(o,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:o}},d.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var o=this.transceivers[e].dtlsTransport;o&&(delete o.ondtlsstatechange,delete o.onerror,delete this.transceivers[e].dtlsTransport)},d.prototype._transceive=function(e,r,s){var n=i(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(n.encodings=e.sendEncodingParameters,n.rtcp={cname:o.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(n.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(n)),s&&e.rtpReceiver&&n.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),n.encodings=e.recvEncodingParameters.length?e.recvEncodingParameters:[{}],n.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(n.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(n.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(n))},d.prototype.setLocalDescription=function(e){var t,r,s=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(l("TypeError",'Unsupported type "'+e.type+'"'));if(!n("setLocalDescription",e.type,s.signalingState)||s._isClosed)return Promise.reject(l("InvalidStateError","Can not set local "+e.type+" in state "+s.signalingState));if("offer"===e.type)t=o.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=o.parseRtpParameters(e);s.transceivers[t].localCapabilities=r}),s.transceivers.forEach(function(e,t){s._gather(e.mid,t)});else if("answer"===e.type){t=o.splitSections(s._remoteDescription.sdp),r=t.shift();var a=o.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var n=s.transceivers[t],l=n.iceGatherer,c=n.iceTransport,d=n.dtlsTransport,u=n.localCapabilities,h=n.remoteCapabilities;if(!(o.isRejected(e)&&0===o.matchPrefix(e,"a=bundle-only").length||n.rejected)){var p=o.getIceParameters(e,r),g=o.getDtlsParameters(e,r);a&&(g.role="server"),s.usingBundle&&0!==t||(s._gather(n.mid,t),"new"===c.state&&c.start(l,p,a?"controlling":"controlled"),"new"===d.state&&d.start(g));var m=i(u,h);s._transceive(n,m.codecs.length>0,!1)}})}return s._localDescription={type:e.type,sdp:e.sdp},s._updateSignalingState("offer"===e.type?"have-local-offer":"stable"),Promise.resolve()},d.prototype.setRemoteDescription=function(s){var d=this;if(-1===["offer","answer"].indexOf(s.type))return Promise.reject(l("TypeError",'Unsupported type "'+s.type+'"'));if(!n("setRemoteDescription",s.type,d.signalingState)||d._isClosed)return Promise.reject(l("InvalidStateError","Can not set remote "+s.type+" in state "+d.signalingState));var u={};d.remoteStreams.forEach(function(e){u[e.id]=e});var h=[],p=o.splitSections(s.sdp),g=p.shift(),m=o.matchPrefix(g,"a=ice-lite").length>0,_=o.matchPrefix(g,"a=group:BUNDLE ").length>0;d.usingBundle=_;var f=o.matchPrefix(g,"a=ice-options:")[0];return d.canTrickleIceCandidates=!!f&&f.substr(14).split(" ").indexOf("trickle")>=0,p.forEach(function(n,l){var c=o.splitLines(n),p=o.getKind(n),f=o.isRejected(n)&&0===o.matchPrefix(n,"a=bundle-only").length,E=c[0].substr(2).split(" ")[2],T=o.getDirection(n,g),v=o.parseMsid(n),S=o.getMid(n)||o.generateIdentifier();if(f||"application"===p&&("DTLS/SCTP"===E||"UDP/DTLS/SCTP"===E))d.transceivers[l]={mid:S,kind:p,protocol:E,rejected:!0};else{var R,C,y,I,L,O,b,M,N;!f&&d.transceivers[l]&&d.transceivers[l].rejected&&(d.transceivers[l]=d._createTransceiver(p,!0));var A,k,P=o.parseRtpParameters(n);f||(A=o.getIceParameters(n,g),(k=o.getDtlsParameters(n,g)).role="client"),b=o.parseRtpEncodingParameters(n);var U=o.parseRtcpParameters(n),D=o.matchPrefix(n,"a=end-of-candidates",g).length>0,w=o.matchPrefix(n,"a=candidate:").map(function(e){return o.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===s.type||"answer"===s.type)&&!f&&_&&l>0&&d.transceivers[l]&&(d._disposeIceAndDtlsTransports(l),d.transceivers[l].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[l].iceTransport=d.transceivers[0].iceTransport,d.transceivers[l].dtlsTransport=d.transceivers[0].dtlsTransport,d.transceivers[l].rtpSender&&d.transceivers[l].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[l].rtpReceiver&&d.transceivers[l].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport)),"offer"!==s.type||f)"answer"!==s.type||f||(C=(R=d.transceivers[l]).iceGatherer,y=R.iceTransport,I=R.dtlsTransport,L=R.rtpReceiver,O=R.sendEncodingParameters,M=R.localCapabilities,d.transceivers[l].recvEncodingParameters=b,d.transceivers[l].remoteCapabilities=P,d.transceivers[l].rtcpParameters=U,w.length&&"new"===y.state&&(!m&&!D||_&&0!==l?w.forEach(function(e){a(R.iceTransport,e)}):y.setRemoteCandidates(w)),_&&0!==l||("new"===y.state&&y.start(C,A,"controlling"),"new"===I.state&&I.start(k)),!i(R.localCapabilities,R.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&R.sendEncodingParameters[0].rtx&&delete R.sendEncodingParameters[0].rtx,d._transceive(R,"sendrecv"===T||"recvonly"===T,"sendrecv"===T||"sendonly"===T),!L||"sendrecv"!==T&&"sendonly"!==T?delete R.rtpReceiver:(N=L.track,v?(u[v.stream]||(u[v.stream]=new e.MediaStream),r(N,u[v.stream]),h.push([N,L,u[v.stream]])):(u.default||(u.default=new e.MediaStream),r(N,u.default),h.push([N,L,u.default]))));else{(R=d.transceivers[l]||d._createTransceiver(p)).mid=S,R.iceGatherer||(R.iceGatherer=d._createIceGatherer(l,_)),w.length&&"new"===R.iceTransport.state&&(!D||_&&0!==l?w.forEach(function(e){a(R.iceTransport,e)}):R.iceTransport.setRemoteCandidates(w)),M=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(M.codecs=M.codecs.filter(function(e){return"rtx"!==e.name})),O=R.sendEncodingParameters||[{ssrc:1001*(2*l+2)}];var Z,x=!1;"sendrecv"===T||"sendonly"===T?(x=!R.rtpReceiver,L=R.rtpReceiver||new e.RTCRtpReceiver(R.dtlsTransport,p),x&&(N=L.track,v&&"-"===v.stream||(v?(u[v.stream]||(u[v.stream]=new e.MediaStream,Object.defineProperty(u[v.stream],"id",{get:function(){return v.stream}})),Object.defineProperty(N,"id",{get:function(){return v.track}}),Z=u[v.stream]):(u.default||(u.default=new e.MediaStream),Z=u.default)),Z&&(r(N,Z),R.associatedRemoteMediaStreams.push(Z)),h.push([N,L,Z]))):R.rtpReceiver&&R.rtpReceiver.track&&(R.associatedRemoteMediaStreams.forEach(function(t){var r=t.getTracks().find(function(e){return e.id===R.rtpReceiver.track.id});r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)}),R.associatedRemoteMediaStreams=[]),R.localCapabilities=M,R.remoteCapabilities=P,R.rtpReceiver=L,R.rtcpParameters=U,R.sendEncodingParameters=O,R.recvEncodingParameters=b,d._transceive(d.transceivers[l],!1,x)}}}),void 0===d._dtlsRole&&(d._dtlsRole="offer"===s.type?"active":"passive"),d._remoteDescription={type:s.type,sdp:s.sdp},d._updateSignalingState("offer"===s.type?"have-remote-offer":"stable"),Object.keys(u).forEach(function(t){var r=u[t];if(r.getTracks().length){if(-1===d.remoteStreams.indexOf(r)){d.remoteStreams.push(r);var o=new Event("addstream");o.stream=r,e.setTimeout(function(){d._dispatchEvent("addstream",o)})}h.forEach(function(e){r.id===e[2].id&&c(d,e[0],e[1],[r])})}}),h.forEach(function(e){e[2]||c(d,e[0],e[1],[])}),e.setTimeout(function(){d&&d.transceivers&&d.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},d.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},d.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},d.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},d.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},d.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},d.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(l("InvalidStateError","Can not call createOffer after close"));var i=r.transceivers.filter(function(e){return"audio"===e.kind}).length,n=r.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(i=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(n=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--i<0&&(e.wantReceive=!1):"video"===e.kind&&--n<0&&(e.wantReceive=!1)});i>0||n>0;)i>0&&(r._createTransceiver("audio"),i--),n>0&&(r._createTransceiver("video"),n--);var c=o.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(s,i){var n=s.track,a=s.kind,l=s.mid||o.generateIdentifier();s.mid=l,s.iceGatherer||(s.iceGatherer=r._createIceGatherer(i,r.usingBundle));var c=e.RTCRtpSender.getCapabilities(a);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),s.remoteCapabilities&&s.remoteCapabilities.codecs&&s.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),c.headerExtensions.forEach(function(e){(s.remoteCapabilities&&s.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=s.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];n&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),s.wantReceive&&(s.rtpReceiver=new e.RTCRtpReceiver(s.dtlsTransport,a)),s.localCapabilities=c,s.sendEncodingParameters=d}),"max-compat"!==r._config.bundlePolicy&&(c+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),c+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){c+=s(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),c+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,c+="a="+o.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(c+="a=end-of-candidates\r\n"))});var d=new e.RTCSessionDescription({type:"offer",sdp:c});return Promise.resolve(d)},d.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(l("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(l("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var n=o.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(n+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),n+="a=ice-options:trickle\r\n";var a=o.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,o){if(!(o+1>a)){if(e.rejected)return"application"===e.kind?n+="DTLS/SCTP"===e.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?n+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(n+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(n+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var l;e.stream&&("audio"===e.kind?l=e.stream.getAudioTracks()[0]:"video"===e.kind&&(l=e.stream.getVideoTracks()[0]),l&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var c=i(e.localCapabilities,e.remoteCapabilities);!c.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,n+=s(e,c,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n")}});var c=new e.RTCSessionDescription({type:"answer",sdp:n});return Promise.resolve(c)},d.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(s,i){if(!r._remoteDescription)return i(l("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var n=e.sdpMLineIndex;if(e.sdpMid)for(var c=0;c<r.transceivers.length;c++)if(r.transceivers[c].mid===e.sdpMid){n=c;break}var d=r.transceivers[n];if(!d)return i(l("OperationError","Can not add ICE candidate"));if(d.rejected)return s();var u=Object.keys(e.candidate).length>0?o.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return s();if(u.component&&1!==u.component)return s();if((0===n||n>0&&d.iceTransport!==r.transceivers[0].iceTransport)&&!a(d.iceTransport,u))return i(l("OperationError","Can not add ICE candidate"));var h=e.candidate.trim();0===h.indexOf("a=")&&(h=h.substr(2)),(t=o.getMediaSections(r._remoteDescription.sdp))[n]+="a="+(u.type?h:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=o.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var p=0;p<r.transceivers.length&&(r.transceivers[p].rejected||(r.transceivers[p].iceTransport.addRemoteCandidate({}),(t=o.getMediaSections(r._remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=o.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));p++);s()})},d.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw l("InvalidAccessError","Invalid selector.");return r.getStats()}var o=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&o.push(e[t].getStats())})}),Promise.all(o).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var o=r.prototype.getStats;r.prototype.getStats=function(){return o.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){var o;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(o=e[r]).type]||o.type,t.set(r,e[r])}),t})}}});var u=["createOffer","createAnswer"];return u.forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(u=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),d}},{sdp:17}],17:[function(e,t,r){"use strict";var o={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};o.localCName=o.generateIdentifier(),o.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},o.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},o.getDescription=function(e){var t=o.splitSections(e);return t&&t[0]},o.getMediaSections=function(e){var t=o.splitSections(e);return t.shift(),t},o.matchPrefix=function(e,t){return o.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},o.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},o=8;o<t.length;o+=2)switch(t[o]){case"raddr":r.relatedAddress=t[o+1];break;case"rport":r.relatedPort=parseInt(t[o+1],10);break;case"tcptype":r.tcpType=t[o+1];break;case"ufrag":r.ufrag=t[o+1],r.usernameFragment=t[o+1];break;default:r[t[o]]=t[o+1]}return r},o.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},o.parseIceOptions=function(e){return e.substr(14).split(" ")},o.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},o.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},o.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},o.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},o.parseFmtp=function(e){for(var t,r={},o=e.substr(e.indexOf(" ")+1).split(";"),s=0;s<o.length;s++)r[(t=o[s].trim().split("="))[0].trim()]=t[1];return r},o.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var o=[];Object.keys(e.parameters).forEach(function(t){o.push(e.parameters[t]?t+"="+e.parameters[t]:t)}),t+="a=fmtp:"+r+" "+o.join(";")+"\r\n"}return t},o.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},o.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},o.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},o=e.indexOf(":",t);return o>-1?(r.attribute=e.substr(t+1,o-t-1),r.value=e.substr(o+1)):r.attribute=e.substr(t+1),r},o.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},o.getMid=function(e){var t=o.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},o.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},o.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:o.matchPrefix(e+t,"a=fingerprint:").map(o.parseFingerprint)}},o.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},o.getIceParameters=function(e,t){var r=o.splitLines(e);return{usernameFragment:(r=r.concat(o.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},o.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},o.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=o.splitLines(e)[0].split(" "),s=3;s<r.length;s++){var i=r[s],n=o.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(n){var a=o.parseRtpMap(n),l=o.matchPrefix(e,"a=fmtp:"+i+" ");switch(a.parameters=l.length?o.parseFmtp(l[0]):{},a.rtcpFeedback=o.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(o.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return o.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(o.parseExtmap(e))}),t},o.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=o.writeRtpMap(e),r+=o.writeFmtp(e),r+=o.writeRtcpFb(e)});var s=0;return t.codecs.forEach(function(e){e.maxptime>s&&(s=e.maxptime)}),s>0&&(r+="a=maxptime:"+s+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=o.writeExtmap(e)}),r},o.parseRtpEncodingParameters=function(e){var t,r=[],s=o.parseRtpParameters(e),i=-1!==s.fecMechanisms.indexOf("RED"),n=-1!==s.fecMechanisms.indexOf("ULPFEC"),a=o.matchPrefix(e,"a=ssrc:").map(function(e){return o.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),l=a.length>0&&a[0].ssrc,c=o.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});c.length>0&&c[0].length>1&&c[0][0]===l&&(t=c[0][1]),s.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var o={ssrc:l,codecPayloadType:parseInt(e.parameters.apt,10)};l&&t&&(o.rtx={ssrc:t}),r.push(o),i&&((o=JSON.parse(JSON.stringify(o))).fec={ssrc:l,mechanism:n?"red+ulpfec":"red"},r.push(o))}}),0===r.length&&l&&r.push({ssrc:l});var d=o.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=d})),r},o.parseRtcpParameters=function(e){var t={},r=o.matchPrefix(e,"a=ssrc:").map(function(e){return o.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var s=o.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=s.length>0,t.compound=0===s.length;var i=o.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},o.parseMsid=function(e){var t,r=o.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var s=o.matchPrefix(e,"a=ssrc:").map(function(e){return o.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return s.length>0?{stream:(t=s[0].value.split(" "))[0],track:t[1]}:void 0},o.generateSessionId=function(){return Math.random().toString().substr(2,21)},o.writeSessionBoilerplate=function(e,t,r){var s=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||o.generateSessionId())+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},o.writeMediaSection=function(e,t,r,s){var i=o.writeRtpDescription(e.kind,t);if(i+=o.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=o.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",i+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var n="msid:"+s.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+n,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+n,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+n,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+o.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+o.localCName+"\r\n"),i},o.getDirection=function(e,t){for(var r=o.splitLines(e),s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substr(2)}return t?o.getDirection(t):"sendrecv"},o.getKind=function(e){return o.splitLines(e)[0].split(" ")[0].substr(2)},o.isRejected=function(e){return"0"===e.split(" ",2)[1]},o.parseMLine=function(e){var t=o.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},o.parseOLine=function(e){var t=o.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},o.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=o.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=o)},{}]},{},[1])(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryHandler=void 0;var o=function(){function e(){this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return e.prototype.init=function(e,t,r,o){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof o&&(this.RETRY_MAX_TIME_INTERVAL=o)},e.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},e}();t.RetryHandler=o},function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTMEngine=t.ClientUtil=t.ZegoExpressEngine=void 0;var i=r(6),n=r(0);Object.defineProperty(t,"ZegoExpressWebRTMEngine",{enumerable:!0,get:function(){return n.ZegoExpressWebRTMEngine}});var a=r(3);Object.defineProperty(t,"ClientUtil",{enumerable:!0,get:function(){return a.ClientUtil}});var l=function(e){function t(t,r){var o=this;return n.ZegoExpressWebRTMEngine.version="2.8.1",(o=e.call(this,t,r)||this).zegoWebRTC=new i.ZegoWebRTC(o.logger,o.dataReport,o.zegoWebRTM),o}return s(t,e),t.prototype.createStream=function(e){return this.zegoWebRTC.createStream(e)},t.prototype.mutePlayStreamAudio=function(e,t){return this.zegoWebRTC.mutePlayStreamAudio(e,t)},t.prototype.mutePlayStreamVideo=function(e,t){return this.zegoWebRTC.mutePlayStreamVideo(e,t)},t.prototype.replaceTrack=function(e,t){return this.zegoWebRTC.replaceTrack(e,t)},t.prototype.setAudioConfig=function(e,t){return this.zegoWebRTC.setAudioConfig(e,t)},t.prototype.setCaptureVolume=function(e,t){return this.zegoWebRTC.setCaptureVolume(e,t)},t.prototype.setSoundLevelDelegate=function(e,t){return this.zegoWebRTC.setSoundLevelDelegate(e,t)},t.prototype.setVideoConfig=function(e,t){return this.zegoWebRTC.setVideoConfig(e,t)},t.prototype.startMixingAudio=function(e,t){return this.zegoWebRTC.startMixingAudio(e,t)},t.prototype.startPlayingStream=function(e,t){return this.zegoWebRTC.startPlayingStream(e,t)},t.prototype.stopPlayingStream=function(e){return this.zegoWebRTC.stopPlayingStream(e)},t.prototype.useAudioDevice=function(e,t){return this.zegoWebRTC.useAudioDevice(e,t)},t.prototype.destroyStream=function(e){return this.zegoWebRTC.destroyStream(e)},t.prototype.setMixingAudioVolume=function(e,t,r){return this.zegoWebRTC.setMixingAudioVolume(e,t,r)},t.prototype.stopMixingAudio=function(e,t){return this.zegoWebRTC.stopMixingAudio(e,t)},t.prototype.checkSystemRequirements=function(e,t){return void 0===t&&(t=0),this.zegoWebRTC.checkSystemRequirements(t,e)},t.prototype.setMixerTaskConfig=function(e){return this.zegoWebRTC.setMixerTaskConfig(e)},t.prototype.startPublishingStream=function(e,t,r){return this.zegoWebRTC.startPublishingStream(e,t,r)},t.prototype.enumDevices=function(){return this.zegoWebRTC.enumDevices()},t.prototype.startMixerTask=function(e){return this.zegoWebRTC.startMixerTask(e)},t.prototype.stopPublishingStream=function(e){return this.zegoWebRTC.stopPublishingStream(e)},t.prototype.addPublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWebRTC.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWebRTC.addPublishCdnUrl(e,t)},t.prototype.off=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.off(e,t):!!this.zegoWebRTC.stateCenter.listenerList[e]&&this.zegoWebRTC.off(e,t)},t.prototype.stopMixerTask=function(e){return this.zegoWebRTC.stopMixerTask(e)},t.prototype.on=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.on(e,t):!!this.zegoWebRTC.stateCenter.listenerList[e]&&this.zegoWebRTC.on(e,t)},t.prototype.removePublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWebRTC.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWebRTC.removePublishCdnUrl(e,t)},t.prototype.setStreamExtraInfo=function(e,t){return this.zegoWebRTC.setStreamExtraInfo(e,t)},t.prototype.mutePublishStreamVideo=function(e,t,r){return this.zegoWebRTC.mutePublishStreamVideo(e,t,r)},t.prototype.mutePublishStreamAudio=function(e,t){return this.zegoWebRTC.mutePublishStreamAudio(e,t)},t.prototype.muteMicrophone=function(e){return this.zegoWebRTC.muteMicrophone(e)},t.prototype.isMicrophoneMuted=function(){return this.zegoWebRTC.isMicrophoneMuted()},t.prototype.useVideoDevice=function(e,t){return this.zegoWebRTC.useVideoDevice(e,t)},t}(n.ZegoExpressWebRTMEngine);t.ZegoExpressEngine=l},function(e,t){e.exports=o},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(s,i){function n(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(n,a)}l((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,o,s,i,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,o=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!((s=(s=n.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){n=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){n.label=i[1];break}if(6===i[0]&&n.label<s[1]){n.label=s[1],s=i;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(i);break}s[2]&&n.ops.pop(),n.trys.pop();continue}i=t.call(e,n)}catch(e){i=[6,e],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CheckModule=void 0;var i=r(5),n=function(){function e(){var e=this;this.iceconnectionstatechangeTimes=0,this.isCheckAll=!1;var t=document.createElement("canvas");t.getContext("2d").fillStyle="rgba(255, 255, 255, 0)";try{this.localStream=t.captureStream()}catch(e){console.error("canvas captureStream error",e)}this.timer=setTimeout(function(){e.resolve("Detection timeout"),e.hangup()},5e3)}return e.prototype.checkSupportByType=function(e){return o(this,void 0,void 0,function(){var t,r,o=this;return s(this,function(s){switch(s.label){case 0:return this.checkType=e,t={},this.localPc=new RTCPeerConnection(t),this.remotePc=new RTCPeerConnection(t),r=new Promise(function(e){return o.resolve=e}),this.localPc.addEventListener("icecandidate",function(e){return o.onIceCandidate(o.localPc,e)}),this.remotePc.addEventListener("icecandidate",function(e){return o.onIceCandidate(o.remotePc,e)}),this.remotePc.addEventListener("iceconnectionstatechange",function(t){"connected"===o.remotePc.iceConnectionState&&(o.iceconnectionstatechangeResult=!0),2==++o.iceconnectionstatechangeTimes&&o.iceCandidate&&(clearTimeout(o.timer),o.resolve("connected"===o.remotePc.iceConnectionState||"The browser does not support "+e+" format"),o.hangup())}),this.localStream.getTracks().forEach(function(e){return o.localPc.addTrack(e,o.localStream)}),[4,this.check(e)];case 1:return s.sent(),[4,r];case 2:return[2,s.sent()]}})})},e.prototype.check=function(e){return o(this,void 0,void 0,function(){var t,r;return s(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.localPc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})];case 1:return(t=o.sent()).sdp=i.SdpUtil.getSDPByVideDecodeType(t.sdp,e),this.onCreateOfferSuccess(t),[3,3];case 2:return r=o.sent(),this.onCreateSessionDescriptionError(r),[3,3];case 3:return[2]}})})},e.prototype.onCreateOfferSuccess=function(e){return o(this,void 0,void 0,function(){var t,r,o,i;return s(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.localPc.setLocalDescription(e)];case 1:return s.sent(),[3,3];case 2:return t=s.sent(),this.onSetSessionDescriptionError(t),[2];case 3:return s.trys.push([3,5,,6]),[4,this.remotePc.setRemoteDescription(e)];case 4:return s.sent(),[3,6];case 5:return r=s.sent(),this.onSetSessionDescriptionError(r),[2];case 6:return s.trys.push([6,9,,10]),[4,this.remotePc.createAnswer()];case 7:return o=s.sent(),[4,this.onCreateAnswerSuccess(o)];case 8:return s.sent(),[3,10];case 9:return i=s.sent(),this.onCreateSessionDescriptionError(i),[2];case 10:return[2]}})})},e.prototype.onCreateAnswerSuccess=function(e){return o(this,void 0,void 0,function(){var t,r;return s(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.remotePc.setLocalDescription(e)];case 1:return o.sent(),[3,3];case 2:return t=o.sent(),this.onSetSessionDescriptionError(t),[2];case 3:return o.trys.push([3,5,,6]),[4,this.localPc.setRemoteDescription(e)];case 4:return o.sent(),[3,6];case 5:return r=o.sent(),this.onSetSessionDescriptionError(r),[2];case 6:return[2]}})})},e.prototype.onIceCandidate=function(e,t){return o(this,void 0,void 0,function(){var r;return s(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.getOtherPc(e).addIceCandidate(t.candidate)];case 1:return o.sent(),[3,3];case 2:return r=o.sent(),console.error(this.checkType,this.getPcName(e)+" addIceCandidate error",r),clearTimeout(this.timer),this.hangup(),this.resolve(r),[3,3];case 3:return"remotePc"===this.getPcName(e)&&t.candidate&&(this.iceCandidate=!0),this.iceconnectionstatechangeResult&&"localPc"===this.getPcName(e)&&(clearTimeout(this.timer),this.hangup(),this.resolve(!0)),[2]}})})},e.prototype.getOtherPc=function(e){return e===this.localPc?this.remotePc:this.localPc},e.prototype.getPcName=function(e){return e===this.localPc?"localPc":"remotePc"},e.prototype.onCreateSessionDescriptionError=function(e){console.error("Failed to create session description: "+e.toString()),clearTimeout(this.timer),this.hangup(),this.resolve(e)},e.prototype.onSetSessionDescriptionError=function(e){console.error("Failed to set session description: "+e.toString()),clearTimeout(this.timer),this.hangup(),this.resolve(e)},e.prototype.hangup=function(){this.localPc.close(),this.remotePc.close(),this.iceconnectionstatechangeTimes=0,this.localStream.getTracks().forEach(function(e){return e.stop()})},e}();t.CheckModule=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0;var o=r(0),s=r(2),i=r(0),n=r(1),a=function(){function e(e,t){this.logger=e,this.dataReport=t,this.debug=!1,this.testEnvironment=!1,this.pullLimited=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.callbackList={},this.publishStreamList={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.turnOverTcpOnly=!1,this.customSetTcpOrUdp=!1,this.supportUdp=!1,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.listenerList={roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],capturedSoundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[],_deviceError:[],_remoteCameraStatusUpdate:[],_remoteMicStatusUpdate:[],_streamUpdated:[]},this.reportList={},this.reportSeqList={startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.mixStreamAdvance={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.networkState=i.ENUM_NETWORK_STATE.offline,this.streamRetryTime=300,this.checkList=[],this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.streamConnectTime=0,this.clientIP="",this.type="PUBLIC",this.roomList=[],this.isMultiRoom=!1}return e.prototype.getRequestId=function(){return this.idName+"-"+i.getSeq()},e.prototype.getSignalCmdContent=function(e,t,r,o){var s={request_id:t,room_id:e,from_userid:this.idName,from_username:this.nickName,to_userid:r};return null!=o&&(s.result=o),JSON.stringify(s)},e.prototype.actionListener=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];if(!["playQualityUpdate","publishQualityUpdate","soundLevelUpdate","capturedSoundLevelUpdate"].includes(e)&&this.listenerList[e]){var a=o.getReportSeq();this.dataReport.newReport(a,n.ZegoRTCLogEvent.kZegoListener.event),this.dataReport.addMsgInfo(a,{listener:e,params:r}),this.dataReport.uploadReport(a)}this.listenerList[e]&&this.listenerList[e].forEach(function(o){try{setTimeout(function(){o.apply(void 0,r)},0)}catch(r){t.logger.error(s.ZEGO_WEBRTC_ACTION.STATECENTER_ACTION_LISTENER+" "+e+" "+r)}})},e.prototype.getRoomByRoomID=function(e){return this.roomList.find(function(t){return t.roomID==e})},e.prototype.getPlayRoom=function(e){return this.roomList.find(function(t){return!!t.streamList.find(function(t){return t.stream_id==e})})},e}();t.StateCenter=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaUtil=void 0;var o=r(3),s=function(){function e(e,t){var r=this,o=t.type,s=t.channels,i=void 0===s?1:s,n=t.bufferSize,a=void 0===n?0:n,l=t.sampleBit,c=void 0===l?16:l,d=t.sampleRate,u=void 0===d?44100:d;this.instant=0,this.slow=0,this.clip=0,this.context=e,this.type=o,this.channels=i,this.bufferSize=a,this.sampleBit=c,this.sampleRate=u,this.script=e.createScriptProcessor(a,i,i),(new Date).getTime(),this.script.addEventListener("audioprocess",function(e){var t,s=e.inputBuffer.getChannelData(0),i=0,n=0;for(t=0;t<s.length;++t)i+=s[t]*s[t],Math.abs(s[t])>.99&&(n+=1);if(r.instant=Math.sqrt(i/s.length),r.slow=.95*r.slow+.05*r.instant,r.clip=n/s.length,"pcm"===o||"wav"===o){for(var a=[],l=0;l<r.channels;l++)a.push(e.inputBuffer.getChannelData(l));r.recorderBuffer(a)}}),"pcm"!==o&&"wav"!==o||this.initRecorderBuffer(o)}return e.prototype.connectToSource=function(e,t){try{this.mic=this.context.createMediaStreamSource(e),this.mic.connect(this.script),this.script.connect(this.context.destination),void 0!==t&&t(null)}catch(e){console.error(e),void 0!==t&&t(e)}return this},e.prototype.recorderBuffer=function(e){this.worker.postMessage({command:"record",val:e})},e.prototype.initRecorderBuffer=function(e){var t=this,r=this;this.worker=o.ClientUtil.inlineWorker(function(){var e,r,o,s,i,n,a=[],l=t;function c(e,t,r){for(var o=0;o<r.length;o++,t+=2){var s=Math.max(-1,Math.min(1,r[o]));e.setInt16(t,s<0?32768*s:32767*s,!0)}}function d(e,t,r){for(var o=0;o<r.length;o++,t++){var s=Math.max(-1,Math.min(1,r[o])),i=s<0?128*s:127*s;e.setInt8(t,i+=128)}}function u(e,t,r){for(var o=0;o<r.length;o++)e.setUint8(t+o,r.charCodeAt(o))}function h(e,t){for(var r=new Float32Array(t.length/e),o=0,s=0;o<r.length;)r[o]=t[s],s+=e,o++;return r}function p(e,t,r){for(var o=new Float32Array(t*e.length),s=0,i=0;i<r[0].length;i++)o.set(r[0][i],s),s+=r[0][i].length;return o}function g(e,t){for(var r=new Float32Array(e.length+t.length),o=0;o<e.length+t.length;o+=2)r[o]=e[o/2>>0],r[o+1]=t[o/2>>0];return r}function m(t){var r,o;if(1==e)r=p(a[0],i,a),1!=t&&(o=h(t,r));else if(2==e){var s=p(a[0],i,a),n=p(a[1],i,a);1!=t?o=g(h(t,s),h(t,n)):r=g(s,n)}return 1!=t?o:r}function _(e){var t=function(e,t){var o;8==t?o=e.length:16==t&&(o=e.length,o*=2);var s=new ArrayBuffer(o),i=new DataView(s);return 8==t?d(i,0,e):16==r&&c(i,0,e),i}(m(e),r);l.postMessage({command:"exportPcmLive",val:t})}function f(t){var s=function(t,s){var i;8==s?i=t.length:16==r&&(i=t.length,i*=2);var n=new ArrayBuffer(i+44),a=new DataView(n),l=o,h=r,p=e;return u(a,0,"RIFF"),a.setUint32(4,36+i,!0),u(a,8,"WAVE"),u(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,p,!0),a.setUint32(24,l,!0),a.setUint32(28,l*p*(h/8),!0),a.setUint16(32,p*(h/8),!0),a.setUint16(34,h,!0),u(a,36,"data"),a.setUint32(40,i,!0),8==r?d(a,44,t):16==r&&c(a,44,t),a}(m(t),r);l.postMessage({command:"exportWav",val:s})}t.onmessage=function(t){switch(t.data.command){case"init":e=(l=t.data.val).sampleChannel,r=l.sampleBit,o=l.sampleRate,s=l.oldSampleRate,i=l.bufferSize,n=l.type;break;case"record":!function(t){for(var r=0;r<e;r++)a[r]||(a[r]=[]),a[r].push(t[r]);var i=Math.round(s/o);"pcm"===n?_(i):"wav"===n&&f(i),a=[]}(t.data.val)}var l}}),this.worker.postMessage({command:"init",val:{sampleChannel:this.channels,sampleBit:this.sampleBit,sampleRate:this.sampleRate,oldSampleRate:this.context.sampleRate,bufferSize:this.bufferSize,type:e}}),this.worker.onmessage=function(e){switch(e.data.command){case"exportPcmLive":r.onReceiveBuffer(e.data.val);break;case"exportWav":r.onReceiveWav(e.data.val)}}},e.prototype.onReceiveBuffer=function(e){},e.prototype.onReceiveWav=function(e){},e.prototype.writeString=function(e,t,r){for(var o=0;o<r.length;o++)e.setUint8(t+o,r.charCodeAt(o))},e.prototype.writeBuffer=function(e,t,r){for(var o=0;o<r.byteLength;o++)e.setUint8(t+o,r[o])},e.prototype.concatenation=function(e){for(var t=0,r=0;r<e.length;++r)t+=e[r].buffer.byteLength;var o=new Uint8Array(t),s=0;for(r=0;r<e.length;++r)o.set(new Uint8Array(e[r].buffer),s),s+=e[r].buffer.byteLength;return o},e.prototype.encodeWave=function(e){var t=this.concatenation(e),r=t.byteLength,o=new ArrayBuffer(r+44),s=new DataView(o),i=this.sampleRate,n=this.sampleBit,a=this.channels;return this.writeString(s,0,"RIFF"),s.setUint32(4,36+r,!0),this.writeString(s,8,"WAVE"),this.writeString(s,12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,a,!0),s.setUint32(24,i,!0),s.setUint32(28,i*a*(n/8),!0),s.setUint16(32,a*(n/8),!0),s.setUint16(34,n,!0),this.writeString(s,36,"data"),s.setUint32(40,r,!0),this.writeBuffer(s,44,t),s},e.prototype.stop=function(){this.mic.disconnect(),this.script.disconnect()},e}();t.MediaUtil=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCModules=void 0;var o=r(0),s=r(1),i=r(3),n=r(16),a=r(17),l=r(18),c=r(19),d=r(20),u=r(2),h=function(){function e(e,t,r,o,s,i){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=s,this.ac=i,this.mediaEleSources=[],this.publishModule=new a.PublishModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.playModule=new l.PlayModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.advancedModule=new d.AdvancedModule(this.logger,this.dataReport,this.streamCenter,this.stateCenter),this.audioMixModule=new c.AudioMixModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.ac),this.init()}return e.prototype.init=function(){this.bindWindowListener(),this.bindRTMListener(),this.bindStreamCenterHandler()},e.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),r=i.ClientUtil.getBrowser();window.addEventListener(t?"pagehide":"Firefox"===r?"beforeunload":"unload",function(){for(var t in window.event&&(window.event.cancelBubble=!0),e.streamCenter.publisherList)e.publishModule.stopPublishingStream(t);for(var t in e.streamCenter.playerList)e.playModule.stopPlayingStream(t)}),window.addEventListener("message",function(t){var r=t.data,o=r.type;"SS_DIALOG_SUCCESS"===o&&e.screenStreamFrom(r.streamId,r.canRequestAudioTrack,i.ClientUtil.actionSuccessCallback("screenShare",e.stateCenter.callbackList)),"SS_DIALOG_CANCEL"===o&&i.ClientUtil.actionSuccessCallback("screenShare",e.stateCenter.callbackList)(!1,null,o)}),window.addEventListener("offline",function(){for(var t in e.logger.info("zc.off.0 newtwork is broken"),e.stateCenter.networkState=o.ENUM_NETWORK_STATE.offline,e.streamCenter.publisherList)(r=e.streamCenter.publisherList[t].retryStreamHandler).startMaxTime(),r.invalid();for(var t in e.streamCenter.playerList){var r;(r=e.streamCenter.playerList[t].retryStreamHandler).startMaxTime(),r.invalid()}}),window.addEventListener("online",function(t){for(var r in e.logger.info("zc.on.0 network is online"),e.stateCenter.networkState=o.ENUM_NETWORK_STATE.online,e.streamCenter.publisherList){var i=e.streamCenter.publisherList[r].publisher,n=e.streamCenter.publisherList[r].retryStreamHandler;i.state==o.ENUM_PUBLISH_STATE.stop||i.stateNego!==o.ENUM_PUBLISH_STATE_NEGO.iceConnected?!n.isOverTime&&n.publishStateHandle(o.ENUM_PUBLISH_STATE_UPDATE.error,r,s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNetworkBrokenError):i.state==o.ENUM_PUBLISH_STATE.publishing&&n.stopMaxTime()}for(var r in e.streamCenter.playerList){var a=e.streamCenter.playerList[r].player;n=e.streamCenter.playerList[r].retryStreamHandler,a.state==o.ENUM_PLAY_STATE.stop||a.stateNego!==o.ENUM_PLAY_STATE_NEGO.iceConnected?!n.isOverTime&&n.playStateHandle(o.ENUM_PLAY_STATE_UPDATE.error,r,s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNetworkBrokenError):a.state==o.ENUM_PLAY_STATE.playing&&n.stopMaxTime()}}),window.addEventListener("visibilitychange",function(t){if(Object.keys(e.streamCenter.publisherList).length>0||Object.keys(e.streamCenter.playerList).length>0){var r=o.getReportSeq();e.dataReport.newReport(r,s.ZegoRTCLogEvent.kZegoVisibilityChange.event),e.dataReport.uploadReport(r)}})},e.prototype.bindRTMListener=function(){var e,t,r=this;this.rtm._on("roomLoginResponse",function(e){r.logger.info("zc.rlr call "+JSON.stringify(e));var t=e.header.room_id;r.stateCenter.appid=r.rtm.getAppID(),r.stateCenter.idName=r.rtm.getUserID(),r.stateCenter.testEnvironment=r.rtm.isTestEnvironment(),r.stateCenter.isMultiRoom=r.rtm.getMultiRoom(),r.streamCenter.setSessionInfo(r.stateCenter.appid,r.stateCenter.idName,r.stateCenter.testEnvironment);var o=r.rtm.getToken(t),s=r.rtm.getSessionId(t),i=r.rtm.getRoomSessionID(t),a=r.stateCenter.getRoomByRoomID(t);if(!a){var l=new n.StreamHandler(r.logger,r.stateCenter,r.rtm,r.dataReport,r.streamCenter,t);r.bindStreamHandler(l),r.stateCenter.roomList.push(a={roomID:t,streamHandler:l,sessionID:s,roomSessionID:i,token:o,isResetRoom:!1,streamList:[],streamInfoList:[]}),l.handleStreamStart(e,a)}a.sessionID=s,a.roomSessionID=i,a.token=a.token,r.logger.info("zc.rlr end "+t)}),this.rtm._on("HBResponse",function(e){var t,o=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,s=r.stateCenter.getRoomByRoomID(o);"PUBLIC"===r.stateCenter.type&&(null==s||s.streamHandler.patchStreamList(e))}),this.rtm._on("_roomStateUpdate",function(e,t,o,s){if("DISCONNECTED"==t){r.logger.info("zc.rsu "+e+" disconnected "+(o?o+" ":"")+(s||""));var i=r.stateCenter.getRoomByRoomID(e);if(i){var n=r.stateCenter.roomList.findIndex(function(t){return t.roomID==e});i.isResetRoom=!0,i.streamHandler.reset(),r.streamCenter.reset(e),r.stateCenter.roomList.splice(n,1)}}else r.logger.info("zc.rsu "+e+" state: "+t)}),this.rtm._on("_tokenRenewed",function(e,t){r.logger.info("zc.tr roomID:"+t+" "+e);var o=r.stateCenter.getRoomByRoomID(t);o&&(o.token=e)}),this.rtm.service.on("stream",function(e){var t,o=(null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id)||"",s=r.stateCenter.getRoomByRoomID(o);s?s.streamHandler.handleStreamUpdateRsp(e):r.logger.error(u.ZEGO_WEBRTC_ACTION.ON_STREAM+" room no found")}),null===(e=this.rtm.service)||void 0===e||e.on("push_stream_update",function(e){var t,o=(null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id)||"",s=r.stateCenter.getRoomByRoomID(o);s?s.streamHandler.handlePushStreamUpdateMsg(e):r.logger.error(u.ZEGO_WEBRTC_ACTION.ON_PUSH_STREAM_UPDATE+" room no found")}),null===(t=this.rtm.service)||void 0===t||t.on("zegochat_js.push_room_stream_update_req",function(e){var t,o=(null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id)||"",s=r.stateCenter.getRoomByRoomID(o);s?s.streamHandler.handlePriPushStreamUpdateMsg(e):r.logger.error(u.ZEGO_WEBRTC_ACTION.ON_STREAM+" room no found")})},e.prototype.bindStreamCenterHandler=function(){var e=this;this.streamCenter.onPlayStateUpdate=function(t,r,s){var n=e.stateCenter.reportSeqList.startPlay[r],a=e.streamCenter.playerList[r];if(1==t&&a&&i.ClientUtil.isReDispatch(s)){var l=a.player,c=a.retryDispatchHandler,d=a.playOption;return 0!=l.sessionId&&l.signal&&l.shouldSendCloseSession()&&(l.signal.sendCloseSession(o.getSeq(),l.sessionId,1),l.signal.removeSession(l.sessionId),l.closeSessionSignal=!0),l.resetPlay(),c.stopMaxTime(),c.invalid(),c.initStream(r,d,!1),void(e.rtm.isLogin()?(c.startMaxTime(),c.active(0)):e.streamCenter.playerList[r].isReDispatch=!0)}a&&a.player&&(0==t||1==t)&&n&&(e.dataReport.eventEndWithMsgInfo(n,"PlayState",{type:t}),1==t&&s&&e.dataReport.addMsgInfo(n,s),e.dataReport.uploadReport(n),delete e.stateCenter.reportSeqList.startPlay[r]),1===t&&e.streamCenter.playErrorCallBackList[r]&&(e.streamCenter.playErrorCallBackList[r]({errorCode:s&&s.code,extendedData:s&&s.message}),delete e.streamCenter.playErrorCallBackList[r],e.logger.info("zc.opsu.1 stop play called by sdk"),e.playModule.stopPlayingStream(r)),e.stateCenter.actionListener("playerStateUpdate",{state:i.ClientUtil.getPlayerStateType(t),streamID:r,errorCode:s&&s.code,extendedData:s&&s.message})},this.streamCenter.onPublishStateUpdate=function(t,r,o){e.onPublishStateUpdateHandle(t,r,o)},this.streamCenter.onPublishQualityUpdate=function(t,r){e.stateCenter.actionListener("publishQualityUpdate",t,r)},this.streamCenter.onPlayQualityUpdate=function(t,r){e.stateCenter.actionListener("playQualityUpdate",t,r)},this.streamCenter.onRemoteCameraStatusUpdate=function(t,r,i){var n=o.getReportSeq();e.dataReport.newReport(n,s.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.event),e.dataReport.addMsgInfo(n,{stream:s.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.stream(t),status:s.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.status(r)}),e.dataReport.uploadReport(n),e.stateCenter.actionListener("remoteCameraStatusUpdate",t,r),e.stateCenter.actionListener("_remoteCameraStatusUpdate",t,i)},this.streamCenter.onRemoteMicStatusUpdate=function(t,r,i){var n=o.getReportSeq();e.dataReport.newReport(n,s.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.event),e.dataReport.addMsgInfo(n,{stream:s.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.stream(t),status:s.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.status(r)}),e.dataReport.uploadReport(n),e.stateCenter.actionListener("remoteMicStatusUpdate",t,r),e.stateCenter.actionListener("_remoteMicStatusUpdate",t,i)},this.streamCenter.onSoundLevelUpdate=function(t){e.stateCenter.actionListener("soundLevelUpdate",t)},this.streamCenter.onMicSoundLevelUpdate=function(t){e.stateCenter.actionListener("capturedSoundLevelUpdate",t)}},e.prototype.bindStreamHandler=function(e){var t=this;e.onStreamUpdated=function(e,r,n){var a;a=n.map("PRIVATE"===t.stateCenter.type?function(e){return{streamID:e.stream_id,user:{userID:e.user_id,userName:e.user_name},extraInfo:e.extra_info,title:e.title,streamVer:e.stream_ver}}:function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo,urlsFLV:e.urlFlv,urlsRTMP:e.urlRtmp,urlsHLS:e.urlHls,urlsHttpsFLV:e.urlHttpsFlv,urlsHttpsHLS:e.urlHttpsHls}});var l={};if(0===r){var c=n.map(function(e){return{stream_id:e.streamID,code:o.STREAM_DELETE_REASON[e.closeType]&&o.STREAM_DELETE_REASON[e.closeType].code||0,description:o.STREAM_DELETE_REASON[e.closeType]&&o.STREAM_DELETE_REASON[e.closeType].description||"unknown"}});l.stream_delete_reason=c}var d=o.getReportSeq();if(t.dataReport.newReport(d,s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.event),t.dataReport.addMsgInfo(d,{stream_update_type:s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.stream_update_type(1===r?"added":"deleted"),update_stream:s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.update_stream(a)}),t.dataReport.uploadReport(d),t.stateCenter.actionListener("roomStreamUpdate",e,i.ClientUtil.getSteamUpdateType(r),a,Object.keys(l).length>0?JSON.stringify(l):""),t.stateCenter.actionListener("_streamUpdated",r,n),1===r){var u=[];a.forEach(function(e){e.extraInfo&&u.push({streamID:e.streamID,user:e.user,extraInfo:e.extraInfo})}),u.length>0&&t.stateCenter.actionListener("streamExtraInfoUpdate",e,u)}},e.onPublishStateUpdate=function(e,r,o){t.logger.info("zb.opsu ",r);var s=t.stateCenter.reportSeqList.startPublish[r],n=t.streamCenter.publisherList[r];n&&n.publisher&&(0==e||1==e)&&s&&(t.dataReport.eventEndWithMsgInfo(s,"PublishState",{type:e}),1==e&&t.dataReport.addMsgInfo(s,o),t.dataReport.uploadReport(s),delete t.stateCenter.reportSeqList.startPublish[r]),t.stateCenter.actionListener("publisherStateUpdate",{state:i.ClientUtil.getPublisherStateType(e),streamID:r,errorCode:o.code,extendedData:o.message})},e.onStreamExtraInfoUpdated=function(e,r){var i;i=r.map("PUBLIC"===t.stateCenter.type?function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}}:function(e){return{streamID:e.stream_id,user:{userID:e.user_id,userName:e.user_name},extraInfo:e.extra_info,title:e.title,streamVer:e.stream_ver}});var n=o.getReportSeq();t.dataReport.newReport(n,s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.event),t.dataReport.addMsgInfo(n,{update_stream:s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.update_stream(i)}),t.dataReport.uploadReport(n),t.stateCenter.actionListener("streamExtraInfoUpdate",e,i)}},e.prototype.screenStreamFrom=function(e,t,r){var o={};o.audio={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}},o.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:window.screen.width,maxHeight:window.screen.height}},!t&&(o.audio=!1),navigator.mediaDevices.getUserMedia(o).then(function(e){r(!0,e)}).catch(function(e){r(!1,null,e)})},e.prototype.onPublishStateUpdateHandle=function(e,t,r){var s=this;this.logger.info("zc.opsuh.0 call");var n=this.streamCenter.publisherList[t],a=n.room;if(a)if(0==e)this.stateCenter.publishStreamList[t]&&([o.ENUM_PUBLISH_STREAM_STATE.tryPublish,o.ENUM_PUBLISH_STREAM_STATE.retryPublish].includes(this.stateCenter.publishStreamList[t].state)&&!a.streamList.find(function(e){return e.stream_id==t})?(this.stateCenter.publishStreamList[t].state=o.ENUM_PUBLISH_STREAM_STATE.update_info,a.streamHandler.updateStreamInfo(t,"PUBLIC"===this.stateCenter.type?o.ENUM_STREAM_SUB_CMD.liveBegin:o.ENUM_STREAM_CMD_PRI.liveBegin,this.stateCenter.publishStreamList[t].extra_info,function(e){"PRIVATE"===s.stateCenter.type&&s.stateCenter.publishStreamList[t]&&s.stateCenter.publishStreamList[t].state==o.ENUM_PUBLISH_STREAM_STATE.update_info&&(s.stateCenter.publishStreamList[t].state=o.ENUM_PUBLISH_STREAM_STATE.stop,a.streamHandler.onPublishStateUpdate(1,t,e),s.publishModule.stopPublishingStream(t))})):(this.stateCenter.publishStreamList[t].state=o.ENUM_PUBLISH_STREAM_STATE.publishing,this.WebrtcOnPublishStateUpdateHandle(e,t,r)));else{if(1==e&&n&&i.ClientUtil.isReDispatch(r)){var l=n.publisher,c=n.retryDispatchHandler,d=n.publishOption;return 0!=l.sessionId&&l.signal&&l.shouldSendCloseSession()&&(l.signal.sendCloseSession(o.getSeq(),l.sessionId,1),l.signal.removeSession(l.sessionId),l.closeSessionSignal=!0),l.resetPublish(),c.stopMaxTime(),c.invalid(),c.initStream(t,d,!0),void(this.rtm.isLogin()?(c.startMaxTime(),c.active(0)):this.streamCenter.publisherList[t].isReDispatch=!0)}a.streamHandler.onPublishStateUpdate(e,t,r),1==e&&(this.logger.info("zc.opsuh.0 stop publish called by sdk"),this.publishModule.stopPublishingStream(t))}else this.logger.error("zc.opsuh.0 room not exist")},e.prototype.WebrtcOnPublishStateUpdateHandle=function(e,t,r){if(this.stateCenter.publishStreamList[t].state==o.ENUM_PUBLISH_STREAM_STATE.publishing){var s=this.streamCenter.getRoomByStreamID(t);s&&s.streamHandler.onPublishStateUpdate(e,t,r)}},e.prototype.bindListener=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error("zc.o.0 listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error("zc.o.0 event "+e+" no found"),!1)},e.prototype.deleteListener=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error("zc.o.1 listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e}();t.RTCModules=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamHandler=void 0;var o=r(0),s=r(3),i=r(0),n=r(1),a=r(4),l=r(2),c=function(){function e(e,t,r,o,s,i){this.logger=e,this.stateCenter=t,this.rtm=r,this.dataReport=o,this.streamCenter=s,this.roomID=i,this.minStreamSeq=0,this.streamSeq=0,this.streamQuerying=!1,this.streamSeqMergeMap=null,this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3}return e.prototype.setCDNInfo=function(e,t){e.urlFlv=t.urls_flv instanceof Array?t.urls_flv[0]:"string"==typeof t.urls_flv?t.urls_flv:"",e.urlHls=t.urls_m3u8 instanceof Array?t.urls_m3u8[0]:"string"==typeof t.urls_m3u8?t.urls_m3u8:"",e.urlHttpsFlv=t.urls_https_flv instanceof Array?t.urls_https_flv[0]:"string"==typeof t.urls_https_flv?t.urls_https_flv:"",e.urlHttpsHls=t.urls_https_m3u8 instanceof Array?t.urls_https_m3u8[0]:"string"==typeof t.urls_https_m3u8?t.urls_https_m3u8:"",e.urlRtmp=t.urls_rtmp instanceof Array?t.urls_rtmp[0]:"string"==typeof t.urls_rtmp?t.urls_rtmp:""},e.prototype.onStreamUpdated=function(e,t,r){},e.prototype.onStreamExtraInfoUpdated=function(e,t){},e.prototype.handleStreamStart=function(e,t){this.logger.info("zb.sh.hss call stream update"),this.room=t,e.body?(this.streamListHBMergeInterval=e.body.stream_list_hb_wait_merge_time||2e3,this.streamListMergeInterval=e.body.stream_list_push_merge_timeout||5e3,this.streamQuerying=!1,this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info||[]),this.handleReconnectStream(e.body.stream_info),this.logger.info("zb.sh.hss call end")):this.logger.error("zb.sh.hss server response wrong")},e.prototype.onPublishStateUpdate=function(e,t,r){},e.prototype.updateStreamInfo=function(e,t,r,i){var n,l,c,d=this;if(void 0===r&&(r=""),this.logger.info("zb.sh.usi call"),"PUBLIC"===this.stateCenter.type){var u=JSON.stringify({stream_id:e,extra_info:r});l={sub_cmd:t,stream_msg:u,third_token:null===(n=this.room)||void 0===n?void 0:n.token},c="stream"}else l={room_header:{room_id:this.roomID,room_sid:this.rtm.getRoomSid()||"0",room_user_session_id:this.rtm.getRoomSessionID()||"0"},stream_id:e,extra_info:r,title:"",stream_sid:this.stateCenter.publishStreamList[e].sid},c=t;var h=this.room;this.room.streamInfoList[e]={},this.room.streamInfoList[e].seq=this.rtm.service.sendMessage(c,l,function(e,t){d.handleStreamUpdateRsp(e)},function(n,l){var c=d.room;if(c&&!c.isResetRoom&&!d.rtm.service.isDisConnect()&&n.code&&n.code==a.errorCodeList.TIMEOUT.code&&c.streamInfoList[e].seq==l)2001==t&&d.stateCenter.publishStreamList[e]&&d.stateCenter.publishStreamList[e].state==o.ENUM_PUBLISH_STREAM_STATE.update_info||2002==t?setTimeout(function(){d.updateStreamInfo(e,t,r,i)},0):i&&i(a.errorCodeList.TIMEOUT);else if(n.body&&n.body.err_code){var u=s.ClientUtil.getServerError(n.body.err_code);i&&i(u,l),t===o.ENUM_STREAM_SUB_CMD.liveBegin&&d.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.error,e,u)}},void 0,{sessionID:null==h?void 0:h.sessionID,roomID:null==h?void 0:h.roomID,roomSessionID:null==h?void 0:h.roomSessionID}),this.logger.info("zb.sh.usi call success cmd "+t)},e.prototype.handleStreamUpdateRsp=function(e){if(this.rtm.service.isDisConnect())this.logger.error("zb.sh.hsur not login");else if(0==e.body.err_code){this.logger.info("zb.sh.hsur stream seq "+this.streamSeq+" server seq "+e.body.stream_seq),"PUBLIC"===this.stateCenter.type?this.streamSeq=e.body.stream_seq:this.streamSeq++;var t=this.room;if(t)if("PUBLIC"===this.stateCenter.type)for(var r=function(r){var i=e.body.stream_info[r].stream_id,n=s.stateCenter.publishStreamList[i];if(!n)return s.logger.info("hsur.0 stream is not exist"),{value:void 0};n.state==o.ENUM_PUBLISH_STREAM_STATE.update_info&&(n.state=o.ENUM_PUBLISH_STREAM_STATE.publishing,t.streamList.find(function(e){return e.stream_id==i})||t.streamList.push(e.body.stream_info[r]),s.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.start,i,{code:0,message:""})),delete t.streamInfoList[i]},s=this,i=0;i<e.body.stream_info.length;i++){var n=r(i);if("object"==typeof n)return n.value}else{var a=e.body.stream_id;this.stateCenter.publishStreamList[a]&&this.stateCenter.publishStreamList[a].state==o.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.stateCenter.publishStreamList[a].state=o.ENUM_PUBLISH_STREAM_STATE.publishing,this.stateCenter.publishStreamList[a].sid=e.body.stream_sid,this.stateCenter.publishStreamList[a].ver=e.body.stream_ver,t.streamList.find(function(e){return e.stream_id==a})||t.streamList.push({stream_id:e.body.stream_id,stream_seq:e.body.stream_seq,stream_sid:e.body.stream_sid,stream_ver:e.body.stream_ver,user_id:"",user_name:""}),this.onPublishStateUpdate(0,a,{code:0,message:""})),delete t.streamInfoList[a]}else this.logger.info("hsur.0 room no found")}else this.logger.error("zb.sh.hsur stream update error "+e.body.err_code)},e.prototype.handleFetchStreamListRsp=function(e){this.logger.info("zb.sh.hfslr call"),this.streamQuerying=!1,0===e.body.err_code?this.streamSeq!==e.body.stream_seq?(this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info),this.logger.info("zb.sh.hfslr call success")):this.logger.info("zb.sh.hfslr same seq"):this.logger.info("zb.sh.hfslr server error=",e.body.err_code)},e.prototype.handleFullUpdateStream=function(e,t){var r=this;this.logger.info("zb.sh.hfus call"),this.streamSeq=e,this.logger.debug("zb.sh.hfus server seq "+this.streamSeq),s.ClientUtil.mergeStreamList(this.stateCenter.idName,this.room.streamList,t,function(e,t,s){0!==e.length&&(r.logger.debug("zb.sh.hfus callback addstream"),r.onStreamUpdated(r.roomID,o.ENUM_STREAM_UPDATE_TYPE.added,r.makeCallbackStreamList(e))),0!==t.length&&(r.logger.debug("zb.sh.hfus callback delstream"),r.onStreamUpdated(r.roomID,o.ENUM_STREAM_UPDATE_TYPE.deleted,r.makeCallbackStreamList(t))),0!==s.length&&(r.logger.debug("zb.sh.hfus callback updatestream"),r.onStreamExtraInfoUpdated(r.roomID,r.makeCallbackStreamList(s)))}),this.logger.info("zb.sh.hfus call success")},e.prototype.handlePushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.stream_info&&0!==e.body.stream_info.length){if(e.body.stream_info.length+this.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.fetchStreamList();switch(this.streamSeq=e.body.stream_seq,e.body.stream_cmd){case o.ENUM_STREAM_UPDATE_CMD.added:this.handleAddedStreamList(e.body.stream_info);break;case o.ENUM_STREAM_UPDATE_CMD.deleted:this.handleDeletedStreamList(e.body.stream_info);break;case o.ENUM_STREAM_UPDATE_CMD.updated:this.handleUpdatedStreamList(e.body.stream_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handlePriPushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.streams_info&&0!==e.body.streams_info.length){if(e.body.streams_info.length+this.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.mergeStreamByStreamSeq(e.body.stream_cmd,e.body.stream_seq,e.body.streams_info);switch(this.streamSeq=e.body.stream_seq,e.body.stream_cmd){case o.ENUM_STREAM_UPDATE_CMD_PRI.added:this.handleAddedStreamList(e.body.streams_info);break;case o.ENUM_STREAM_UPDATE_CMD_PRI.deleted:this.handleDeletedStreamList(e.body.streams_info);break;case o.ENUM_STREAM_UPDATE_CMD_PRI.updated:this.handleUpdatedStreamList(e.body.streams_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handleAddedStreamList=function(e){this.logger.debug("zb.sh.hasl call");for(var t,r=[],s=0;s<e.length;s++)if(e[s].anchor_id_name!=this.stateCenter.idName&&e[s].user_id!==this.stateCenter.idName){t=!1;for(var i=0;i<this.room.streamList.length;i++)if(e[s].stream_id===this.room.streamList[i].stream_id){t=!0;break}t||r.push(e[s])}else this.logger.debug("hdsl.0 have self stream added");if(0!==r.length){this.logger.debug("zb.sh.hasl callback addstream");for(var n=0;n<r.length;n++)this.room.streamList.push(r[n]);this.onStreamUpdated(this.roomID,o.ENUM_STREAM_UPDATE_TYPE.added,this.makeCallbackStreamList(r))}this.logger.info("zb.sh.hasl call success")},e.prototype.handleDeletedStreamList=function(e){this.logger.debug("zb.sh.hdsl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName&&e[r].user_id!==this.stateCenter.idName){for(var s=this.room.streamList.length-1;s>=0;s--)if(e[r].stream_id===this.room.streamList[s].stream_id){this.room.streamList.splice(s--,1),t.push(e[r]);break}}else this.logger.debug("zb.sh.hdsl have self stream deleted");0!==t.length&&(this.logger.debug("zb.sh.hdsl callback delstream"),this.onStreamUpdated(this.roomID,o.ENUM_STREAM_UPDATE_TYPE.deleted,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.hdsl call")},e.prototype.handleUpdatedStreamList=function(e){this.logger.debug("zb.sh.husl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName&&e[r].user_id!==this.stateCenter.idName){for(var o=0;o<this.room.streamList.length;o++)if(e[r].stream_id===this.room.streamList[o].stream_id){e[r].extra_info!==this.room.streamList[o].extra_info&&(this.room.streamList[o]=e[r],t.push(e[r]));break}}else this.logger.debug("hsul.0 have self stream updated");0!==t.length&&(this.logger.debug("zb.sh.husl callback updatestream"),this.onStreamExtraInfoUpdated(this.roomID,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.husl call success")},e.prototype.fetchStreamList=function(){if(this.logger.info("zb.sh.fsl call"),this.rtm.service.isDisConnect())this.logger.info("zb.sh.fsl state error");else if(this.streamQuerying)this.logger.info("zb.sh.fsl already doing");else if(this.streamQuerying=!0,this.logger.debug("zb.sh.fsl send fetch request"),"PUBLIC"===this.stateCenter.type){var e={reserve:0},t=this.room;this.rtm.service.sendMessage("stream_info",e,this.handleFetchStreamListRsp.bind(this),function(e,t){},void 0,{roomID:null==t?void 0:t.roomID,sessionID:null==t?void 0:t.sessionID,roomSessionID:null==t?void 0:t.roomSessionID}),this.logger.info("zb.sh.fsl call success")}else{if(!this.rtm.isLogin(this.roomID))return void this.logger.info("zb.sh.fsl room state error");e={room_header:{room_id:this.roomID,room_sid:this.rtm.getRoomSid()||"0",room_user_session_id:this.rtm.getRoomSessionID()||"0"}},this.rtm.service.sendMessage("zegochat_js.room_info_req",e,this.handleFetchStreamListRsp.bind(this),function(e,t){})}},e.prototype.handleReconnectStream=function(e){this.logger.info("zb.sh.hrs call");var t=this.streamCenter.publisherList,r=this.streamCenter.playerList,s=function(r){if(t[r].roomID!==i.roomID)return"continue";if(t[r].publisher.state!=o.ENUM_PUBLISH_STATE.publishing||e.find(function(e){return e.stream_id==r})){if(t[r].publisher.state==o.ENUM_PUBLISH_STATE.stop&&e.find(function(e){return e.stream_id==r})){i.updateStreamInfo(r,"PUBLIC"===i.stateCenter.type?o.ENUM_STREAM_SUB_CMD.liveEnd:o.ENUM_STREAM_CMD_PRI.liveEnd);for(var s=0;s<i.room.streamList.length;s++)if(i.room.streamList[s].stream_id==r){i.room.streamList.splice(s--,1);break}}}else i.updateStreamInfo(r,"PUBLIC"===i.stateCenter.type?o.ENUM_STREAM_SUB_CMD.liveBegin:o.ENUM_STREAM_CMD_PRI.liveBegin,i.stateCenter.publishStreamList[r].extra_info)},i=this;for(var n in t)s(n);for(var n in t)t[n].roomID===this.roomID&&t[n].isReDispatch&&(this.logger.info("zb.sh.hrs "+n+"retry dispatch"),(a=t[n].retryDispatchHandler).stopMaxTime(),a.invalid(),a.initStream(n,t[n].publishOption,!0),a.active(0),t[n].isReDispatch=!1);for(var n in r){var a;r[n].roomID===this.roomID&&r[n].isReDispatch&&(this.logger.info("zb.sh.hrs "+n+"retry dispatch"),(a=r[n].retryDispatchHandler).stopMaxTime(),a.invalid(),a.initStream(n,r[n].playOption,!1),a.active(0),r[n].isReDispatch=!1)}this.logger.info("zb.sh.hrs end")},e.prototype.makeCallbackStreamList=function(e){var t=[];if("PUBLIC"===this.stateCenter.type){if(e&&e.length>0)for(var r=0;r<e.length;r++){var o={user:{userID:e[r].anchor_id_name,userName:e[r].anchor_nick_name},extraInfo:e[r].extra_info,streamID:e[r].stream_id,roomID:"",urlFlv:"",urlRtmp:"",urlHls:"",urlHttpsFlv:"",urlHttpsHls:"",streamGID:e[r].stream_gid,closeType:e[r].close_type};this.setCDNInfo(o,e[r]),t.push(o)}}else if(e&&e.length>0)for(r=0;r<e.length;r++)t.push(o={user_id:e[r].user_id,user_name:e[r].user_name,stream_id:e[r].stream_id,stream_sid:e[r].stream_sid,extra_info:e[r].extra_info,title:e[r].title,stream_ver:e[r].stream_ver});return t},e.prototype.updateMixStream=function(e,t,r){var l,c=this;if(this.logger.info("zb.sh.ums call"),!e.noTaskID&&!e.taskID)return this.logger.error("zb.sh.ums no taskId found"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.message}),!1;if(!e.noTaskID&&"string"!=typeof e.taskID)return this.logger.error("zb.rh.lg taskId must be string"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.noTaskID&&e.taskID.length>o.MAX_MIX_TASK_ID_LENGTH)return this.logger.error("zb.sh.ums taskId is too long"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.message}),!1;if(!e.noTaskID&&!s.ClientUtil.checkIllegalCharacters(e.taskID))return this.logger.error("zb.sh.ums task ID contains illegal characters"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.message}),!1;if(!e.inputList||0==e.inputList.length)return this.logger.error("zb.sh.ums input list wrong"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.message}),!1;e.inputList.forEach(function(e){"AUDIO"===e.contentType&&(!e.layout&&(e.layout={top:0,left:0,bottom:0,right:0}),e.layout.top=0,e.layout.left=0,e.layout.bottom=1,e.layout.right=1)});for(var d=e.inputList.every(function(e){return"AUDIO"===e.contentType}),u=0;u<e.inputList.length;u++){var h=e.inputList[u];if("object"!=typeof h.layout)return this.logger.error("zb.sh.ums input layout must be object"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!(s.ClientUtil.checkInteger(h.layout.top,!1)&&s.ClientUtil.checkInteger(h.layout.bottom,!1)&&s.ClientUtil.checkInteger(h.layout.left,!1)&&s.ClientUtil.checkInteger(h.layout.right,!1)))return this.logger.error("zb.sh.ums top\u3001left\u3001bottom\u3001right must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1}if(!e.outputList||0==e.outputList.length)return this.logger.error("zb.sh.ums no output list found"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.message}),!1;if(e.outputList.some(function(e){return"string"==typeof e&&!s.ClientUtil.isUrl(e)&&!s.ClientUtil.checkIllegalCharacters(e)||"object"==typeof e&&e.target&&!s.ClientUtil.isUrl(e.target)&&!s.ClientUtil.checkIllegalCharacters(e.target)}))return this.logger.error("zb.sh.ums stream output target is incorrect"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;if(!(d||e.outputConfig&&"object"==typeof e.outputConfig))return this.logger.error("zb.sh.ums no output config found"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.message}),!1;if(d&&(void 0===e.outputConfig&&(e.outputConfig={outputBitrate:0,outputFPS:0,outputWidth:0,outputHeight:0}),e.outputConfig.outputBitrate=.001,e.outputConfig.outputFPS=1,e.outputConfig.outputWidth=1,e.outputConfig.outputHeight=1),!(d||e.outputConfig.outputBitrate&&s.ClientUtil.checkInteger(e.outputConfig.outputBitrate)))return this.logger.error("zb.sh.ums bitrate param is required and must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputFPS||!s.ClientUtil.checkInteger(e.outputConfig.outputFPS))return this.logger.error("zb.sh.ums fps param is required and must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputWidth||!s.ClientUtil.checkInteger(e.outputConfig.outputWidth))return this.logger.error("zb.sh.ums width param is required and must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputHeight||!s.ClientUtil.checkInteger(e.outputConfig.outputHeight))return this.logger.error("zb.sh.ums height param is required and must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioCodecID&&!s.ClientUtil.checkInteger(e.outputConfig.outputAudioCodecID,!1))return this.logger.error("zb.sh.ums AudioCodecID param must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioBitrate&&!s.ClientUtil.checkInteger(e.outputConfig.outputAudioBitrate))return this.logger.error("zb.sh.ums AudioBitrate param must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioChannels&&!s.ClientUtil.checkInteger(e.outputConfig.outputAudioChannels,!1))return this.logger.error("zb.sh.ums AudioChannels param must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;var p=0;e.outputConfig.singleStreamPassThrough&&"boolean"==typeof e.outputConfig.singleStreamPassThrough&&(p=e.outputConfig.singleStreamPassThrough?1:0);var g={task_id:e.taskID,id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:o.PROTO_VERSION,bypass:p},m=this.stateCenter.mixStreamAdvance;m&&(m.videoCodec&&(g.extra_params=[{key:"video_encode",value:m.videoCodec}]),m.backgroundColor&&(g.output_bg_color=m.backgroundColor),m.backgroundImage&&(g.output_bg_image=m.backgroundImage),m.waterMark&&(g.watermark=m.waterMark),m.extraParams&&(!g.extra_params&&(g.extra_params=[]),(l=g.extra_params).push.apply(l,m.extraParams)));var _=[];for(u=0;u<e.inputList.length;u++){var f=e.inputList[u],E=f.streamID;this.stateCenter.testEnvironment&&(E="zegotest-"+this.stateCenter.appid+"-"+f.streamID),_.push({stream_id:E,content_control:"AUDIO"===f.contentType?1:0,rect:{layer:u,top:f.layout.top,left:f.layout.left,bottom:f.layout.bottom,right:f.layout.right}})}g.MixInput=_,s.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{mix_stream_id:n.ZegoRTCLogEvent.kZegoTaskMixStart.mix_stream_id(e.taskID),stream_cnt:n.ZegoRTCLogEvent.kZegoTaskMixStart.stream_cnt(_.length),input_stream_list:n.ZegoRTCLogEvent.kZegoTaskMixStart.input_stream_list(_)});var T=[];e.outputList.forEach(function(t){var o={},s="";if("string"==typeof t)s=t;else{if("object"!=typeof t||!t.target)return c.logger.error("zb.sh.ums output target required"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;s=t.target}s.startsWith("rtmp://")||s.startsWith("https://")&&s.endsWith(".flv")||s.startsWith("https://")&&s.endsWith(".m3u8")?o.mixurl=s:o.stream_id=c.stateCenter.testEnvironment?"zegotest-"+c.stateCenter.appid+"-"+s:s,o.bitrate=1e3*e.outputConfig.outputBitrate,o.fps=e.outputConfig.outputFPS,o.width=e.outputConfig.outputWidth,o.height=e.outputConfig.outputHeight,e.outputConfig.outputAudioCodecID&&(o.audio_enc_id=e.outputConfig.outputAudioCodecID),"vp8"===m.videoCodec?o.audio_enc_id=3:"h264"===m.videoCodec&&(o.audio_enc_id=0),e.outputConfig.outputAudioBitrate&&(o.audio_bitrate=1e3*e.outputConfig.outputAudioBitrate),e.outputConfig.outputAudioChannels&&(o.audio_channel_cnt=e.outputConfig.outputAudioChannels),o.testenv=c.stateCenter.testEnvironment?1:0,T.push(o)}),g.MixOutput=T,s.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{output_target_list:n.ZegoRTCLogEvent.kZegoTaskMixStart.output_target_list(T)});var v={channel:"zeus",cmd:"start_mix",req_body:JSON.stringify(g)};return this.logger.debug("zb.sh.ums send command"),this.sendBizChannelRequest(v,function(e,i,n){c.logger.debug("zb.sh.ums receive message");var a="zegotest-"+c.stateCenter.appid+"-";if(0!=n.length){for(var l=JSON.parse(n),d=[],u=0;u<l.play.length;u++){var h={rtmpURL:"",hlsURL:"",flvURL:""},p=l.play[u].stream_alias||"";c.stateCenter.testEnvironment&&p&&p.startsWith(a)&&(p=p.slice(a.length)),h.streamID=p,l.play[u].rtmp_url&&l.play[u].rtmp_url.length>0&&(h.rtmpURL=l.play[u].rtmp_url),l.play[u].hls_url&&l.play[u].hls_url.length>0&&(h.hlsURL=l.play[u].hls_url),l.play[u].hdl_url&&l.play[u].hdl_url.length>0&&(h.flvURL=l.play[u].hdl_url),d.push(h)}t&&t({errorCode:0,extendedData:JSON.stringify({mixerOutputList:d})})}else r&&r({errorCode:s.ClientUtil.getServerError(o.MIXSTREAM_ERROR_CODE+1).code,extendedData:""})},function(e,t,o){if("number"==typeof e){c.logger.debug("zb.sh.ums error: "+e);var i=[];if(1000000150==e&&0!=o.length)for(var l=JSON.parse(o),d="zegotest-"+c.stateCenter.appid+"-",u=0;u<l.non_exist_streams.length;u++){var h=l.non_exist_streams[u];c.stateCenter.testEnvironment&&h.startsWith(d)?i.push(h.slice(d.length)):i.push(h)}r&&r({errorCode:s.ClientUtil.getServerError(e).code,extendedData:""})}else{var p;c.logger.debug("zb.sh.ums error code "+e.code),p=e==a.errorCodeList.TIMEOUT?n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,r&&r({errorCode:p.code,extendedData:p.message})}}),!0},e.prototype.sendBizChannelRequest=function(e,t,r,o){var s=this;void 0===o&&(o=!1),e=Object.assign(e,{is_retry_req:o?1:0});var i=this.room;this.rtm.service.sendMessage("biz_channel",e,function(e,r){t(e.header.seq,e.body.cmd,e.body.rsp_body)},function(o,i){var n=o.body.err_code;"number"!=typeof n||2002!==n?r(n,i,o.body.rsp_body):s.sendBizChannelRequest(e,t,r,!0)},void 0,{roomID:null==i?void 0:i.roomID,sessionID:null==i?void 0:i.sessionID,roomSessionID:null==i?void 0:i.roomSessionID})},e.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise(function(r,o){var a,l={},c={};if(e&&e.videoCodec){var d=e.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(d))return t.logger.error("zb.sh.ums param videoCode error"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.message}),!1;l.videoCodec=d,c.video_codec=d}if(e.backgroundColor){if(!s.ClientUtil.checkInteger(e.backgroundColor))return t.logger.error("zb.sh.ums param backgroundColor must be integer number"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;l.backgroundColor=e.backgroundColor,c.background_color=e.backgroundColor}if(e.backgroundImage){if("string"!=typeof e.backgroundImage)return t.logger.error("zb.sh.ums param outputBgImage error"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;if(!e.backgroundImage.startsWith("preset-id://")||!e.backgroundImage.endsWith(".jpg")&&!e.backgroundImage.endsWith(".png"))return t.logger.error("zb.sh.ums illegal input background image URL"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.message}),!1;l.backgroundImage=e.backgroundImage,c.background_image=e.backgroundImage}e.waterMark&&(l.waterMark=e.waterMark,c.water_mark=e.waterMark),e.extraParams&&(l.extraParams||(l.extraParams=[]),(a=l.extraParams).push.apply(a,e.extraParams)),t.stateCenter.mixStreamAdvance=l,s.ClientUtil.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{config:n.ZegoRTCLogEvent.kZegoTaskMixConfig.config(c)}),r({errorCode:0,extendedData:""})})},e.prototype.stopMixStream=function(e,t,r,i,l){var c=this;this.logger.info("zb.sh.sms call");var d={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:o.PROTO_VERSION};"string"==typeof e&&(d.task_id=e),null!=i?d.stream_id=this.stateCenter.testEnvironment?"zegotest-"+this.stateCenter.appid+"-"+i:i:null!=l&&(d.mixurl=l);var u={channel:"zeus",cmd:"stop_mix",req_body:JSON.stringify(d)};return this.sendBizChannelRequest(u,function(){t&&t({errorCode:0})},function(e){var t;"number"==typeof e?r&&r({errorCode:s.ClientUtil.getServerError(o.MIXSTREAM_ERROR_CODE+e).code,extendedData:""}):(c.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(e)),t=e==a.errorCodeList.TIMEOUT?n.ZegoRTCLogEvent.kZegoTaskMixStop.error.kRequestError:n.ZegoRTCLogEvent.kZegoTaskMixStop.error.kInternalError,r&&r({errorCode:t.code,extendedData:t.message}))}),!0},e.prototype.updateStreamExtraInfo=function(e,t,r,s){var i;this.logger.info("zb.sh.usei call"),i="PUBLIC"===this.stateCenter.type?o.ENUM_STREAM_SUB_CMD.liveUpdate:o.ENUM_STREAM_CMD_PRI.liveUpdate,this.stateCenter.publishStreamList[e]&&this.stateCenter.publishStreamList[e].state>=o.ENUM_PUBLISH_STREAM_STATE.update_info?(this.stateCenter.publishStreamList[e].extra_info=t,this.updateStreamInfo(e,i,t),r({errorCode:0})):s(n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kUpdateStreamInfoFailError)},e.prototype.setStreamExtraInfo=function(e,t,r,o){this.updateStreamExtraInfo(e,t,r,o)},e.prototype._publishTarget=function(e,t,r){var s=this;this.logger.info("zb.sh.ptcall");var i=Math.ceil((new Date).getTime()/1e3),l=e.streamID;this.stateCenter.testEnvironment&&(l="zegotest-"+this.stateCenter.appid+"-"+e.streamID);var c={appid:this.stateCenter.appid,biz_type:0,timestamp:i,seq:this.stateCenter.cdnSeq++,version:1*o.PROTO_VERSION,stream_id:l,pushurl:e.pushUrl},d={channel:"media",cmd:e.type,req_body:JSON.stringify(c)};this.logger.debug("zb.sh.pt send command"),this.sendBizChannelRequest(d,function(o,i,l){if(s.logger.info("zb.sh.pt receive message"),0!=l.length){var c=JSON.parse(l),d=c.code,u=c.message;d&&0!=d?(s.logger.error("zb.sh.pt "+e.type+" error code: "+d+" "+u),r(a.errorCodeList.UNKNOWN_SERVER_ERROR," cmd: "+e.type+" "+d+" "+u)):(s.logger.info("zb.sh.pt "+e.type+" success"),t&&t({errorCode:0,extendedData:""}))}else r(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoResponseError)},function(t,o,i){s.logger.info("zb.sh.pt error: "+t);var a=n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError;2001==t||2002==t&&(a=n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kBizChannelError),s.logger.error("zb.sh.pt "),r(a," cmd: "+e.type+" "+t+"   ")})},e.prototype.patchStreamList=function(e){var t=this;e.body.stream_seq===this.streamSeq||this.streamSeqMergeMap||(this.logger.info(l.ZEGO_WEBRTC_ACTION.STREAMHANDLER_PATCH_STREAM_LIST+" call update stream "+this.streamSeq+" server "+e.body.stream_seq),this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout(function(){t.handleMergeTimeout()},this.streamListHBMergeInterval)),this.minStreamSeq=e.body.stream_seq},e.prototype.mergeStreamByStreamSeq=function(e,t,r){var o=this;this.streamSeqMergeMap||(this.logger.warn(l.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ+" new merge stream list "+this.streamSeq+" server "+t),this.streamSeqMergeMap={},this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout(function(){o.handleMergeTimeout()},this.streamListMergeInterval)),this.logger.info(l.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ+" "+this.streamSeqMergeMap+" "+e+" "+t+" "+r),this.streamSeqMergeMap[t]={cmd:e,streamList:r}},e.prototype.handleMergeTimeout=function(){if(this.streamSeqMergeMap){var e=Object.keys(this.streamSeqMergeMap).map(function(e){return+e}).sort(function(e,t){return e-t});e[e.length-1]-e[0]+1===e.length||e[e.length-1]>=this.minStreamSeq?this.mergeStream(e):(this.streamSeqMergeMap=null,this.fetchStreamList())}},e.prototype.mergeStream=function(e){var t=this;this.logger.info(l.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM+" merge streamList "+this.streamSeq+" streamSeqList "+e.join(","));var r=e[e.length-1],s=[];e.forEach(function(e){if(t.streamSeqMergeMap&&t.streamSeqMergeMap[e])switch(t.streamSeqMergeMap[e].cmd){case o.ENUM_STREAM_UPDATE_CMD.added:t.streamSeqMergeMap[e].streamList.forEach(function(e){var t=s.findIndex(function(t){return t.stream_id==e.stream_id});-1!==t&&s.splice(t),s.push(e)});break;case o.ENUM_STREAM_UPDATE_CMD.deleted:t.streamSeqMergeMap[e].streamList.forEach(function(e){var t=s.findIndex(function(t){return t.stream_id==e.stream_id});-1!==t&&s.splice(t)});break;case o.ENUM_STREAM_UPDATE_CMD.updated:t.streamSeqMergeMap[e].streamList.forEach(function(e){var t=s.findIndex(function(t){return t.stream_id==e.stream_id});-1!==t&&s.splice(t),s.push(e)})}}),this.streamSeqMergeMap=null,this.logger.info(l.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM+" "+s),this.handleFullUpdateStream(r,s)},e.prototype.reset=function(){this.minStreamSeq=0,this.streamSeqMergeMap=null,this.streamSeqMergeTimer&&(clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=void 0),this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3},e.prototype.getRoomInfo=function(){var e=this;return new Promise(function(t,r){if(e.rtm.isLogin(e.roomID)){var o=function(e,o){if(0!==e.body.code)r({errorCode:e.body.code,extendData:e.body.message});else{var s=e.body.streams_info.map(function(e){return{streamID:e.stream_id,user:{userID:e.user_id,userName:e.user_name},extraInfo:e.extra_info}});t({streamList:s})}},s={room_header:{room_id:e.roomID,room_sid:e.rtm.getRoomSid()||"0",room_user_session_id:e.rtm.getRoomSessionID()||"0"}};e.rtm.service.sendMessage("zegochat_js.room_info_req",s,o,o)}else e.logger.error("zn.rh.gri no enter room")})},e}();t.StreamHandler=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PublishModule=void 0;var o=r(2),s=r(0),i=r(1),n=r(3),a=r(4),l=r(7),c=r(6),d=function(){function e(e,t,r,o,s){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=s}return e.prototype.createStream=function(e){var t=this;return this.logger.info(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" call"),e&&e.camera&&e.camera.audioBitRate&&(e.camera.audioBitrate=e.camera.audioBitRate),e&&e.camera&&e.camera.bitrate&&(e.camera.bitRate=e.camera.bitrate),e&&e.screen&&"object"==typeof e.screen&&e.screen.bitrate&&(e.screen.bitRate=e.screen.bitrate),e&&e.custom&&e.custom.bitrate&&(e.custom.bitRate=e.custom.bitrate),new Promise(function(r,a){var l=void 0,d=s.getReportSeq();t.dataReport.newReport(d,i.ZegoRTCLogEvent.kZegoTaskCreateStream.event);var u=function(e){if(0==e.getAudioTracks().length){var o=t.streamCenter.ac.createMediaStreamDestination(),s=o?o.stream:null,i=s?s.getAudioTracks()[0]:null;i&&e.addTrack(i)}t.dataReport.uploadReport(d),!t.stateCenter.deviceInfos&&t.recordDevices(),r(e)},h=function(e,r){void 0===r&&(r=""),t.dataReport.addMsgInfo(d,{error:e.code,message:e.message+r}),t.dataReport.uploadReport(d),a({code:e.code,msg:e.message+r})};if("https:"!==window.location.protocol&&"file:"!==window.location.protocol&&-1==window.location.hostname.indexOf("127.0.0.1")&&-1==window.location.hostname.indexOf("localhost"))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" https or localhost required "),void h({code:i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError.code,message:i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError.message+" https or localhost required"});if(e&&e.screen){if(l="screen",!n.ClientUtil.checkScreenParams(e.screen,h))return;var p=n.ClientUtil.getBrowser(),g=t.streamCenter.getScreenConstrains(e.screen);t.dataReport.addMsgInfo(d,{stream_type:i.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("screen"),screen:i.ZegoRTCLogEvent.kZegoTaskCreateStream.screen(g)});var m=function(e){t.streamCenter.createScreenPreviewer(e,g)&&u(e),e.getVideoTracks()[0].onended=function(){var r=s.getReportSeq();t.dataReport.newReport(r),t.dataReport.uploadReport(r,i.ZegoRTCLogEvent.kZegoTaskScreenSharingEnded),e&&t.stopPreview(e),t.stateCenter.actionListener("screenSharingEnded",e)}};"Firefox"==p||"object"==typeof e.screen&&"firefox"==e.screen.type?t.startScreenShotFirFox("screen",g,function(e,t,r){e?t&&m(t):r&&h(r)}):"Chrome"==p&&c.ZegoWebRTC.screenShotReady||"object"==typeof e.screen&&"shot"==e.screen.type?t.startScreenShotChrome(function(r,s,n){r?(t.logger.info(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" using extension"),s&&m(s)):(n&&t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" extension "+n),"SS_DIALOG_CANCEL"===n||"object"==typeof e.screen&&"shot"==e.screen.type?n&&h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenCancelError):t.startScreenSharing(g,function(e,r,s){e?r&&m(r):(t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" "+s),s&&h(s))}))}):t.startScreenSharing(g,function(e,t,r){e?t&&m(t):r&&h(r)})}else{if(e&&"object"==typeof e.camera&&void 0!==e.camera.videoQuality&&!n.ClientUtil.checkInteger(e.camera.videoQuality))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" videoQuality must be integer number"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," videoQuality must be integer number");if(e&&e.camera&&e.camera.audioBitrate){if(!n.ClientUtil.checkInteger(e.camera.audioBitrate))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate must be integer number"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate must be integer number");if(e.camera.audioBitrate<6)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate cannot less 6 kbps"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot less 6 kbps");if(e.camera.audioBitrate>510)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate cannot greater than 510 kbps"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot greater than 510 kbps");t.stateCenter.audioBitRate=1e3*e.camera.audioBitrate}if(e&&e.camera&&e.camera.bitRate){if("number"!=typeof e.camera.bitRate)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate must be integer number"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number");if(e.camera.bitRate>10240)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate cannot greater than 10 Mbps"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps")}if(e&&e.camera&&void 0!==e.camera.channelCount&&!n.ClientUtil.checkInteger(e.camera.channelCount))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" channelCount must be integer number"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," channelCount must be integer number");if(e&&e.camera&&4===e.camera.videoQuality&&!n.ClientUtil.checkCameraParams(e.camera,h))return;if(e&&e.custom&&e.custom.bitRate){if(!n.ClientUtil.checkInteger(e.custom.bitRate))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate must be integer number"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number");if(e.custom.bitRate>10240)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate cannot greater than 10 Mbps"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps")}if(e&&e.custom&&e.custom.audioBitrate){if(!n.ClientUtil.checkInteger(e.custom.audioBitrate))return t.logger.error("ze.cs.0 audioBitrate must be integer number"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate must be integer number");if(e.custom.audioBitrate<6)return t.logger.error("ze.cs.0 audioBitrate cannot less 6 kbps"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot less 6 kbps");if(e.custom.audioBitrate>510)return t.logger.error("ze.cs.0 audioBitrate cannot greater than 510 kbps"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot greater than 510 kbps")}if(e&&e.custom&&void 0!==e.custom.channelCount&&1!==e.custom.channelCount&&2!==e.custom.channelCount)return t.logger.error("ze.cs.0 channelCount must number 1 or 2"),void h(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," channelCount must number 1 or 2");var _={};e&&e.camera?(l="camera",_=e.camera,t.dataReport.addMsgInfo(d,{stream_type:i.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("camera"),camera:i.ZegoRTCLogEvent.kZegoTaskCreateStream.camera(e.camera)}),"boolean"!=typeof _.video&&(_.video=!0),"boolean"!=typeof _.audio&&(_.audio=!0)):e&&e.custom&&(l="custom",_=e.custom,t.dataReport.addMsgInfo(d,{stream_type:i.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("custom"),custom:i.ZegoRTCLogEvent.kZegoTaskCreateStream.custom(e.custom)})),t.startPreview(_,l,u,h)}})},e.prototype.destroyStream=function(e){this.logger.info(o.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" call");var t=s.getReportSeq();if(this.dataReport.newReport(t),!(e instanceof MediaStream))return this.logger.error(o.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" localStream is not mediaStream or tracks is null"),this.dataReport.addMsgInfo(t,i.ZegoRTCLogEvent.kZegoTaskDestroyStream.error.kLocalStreamError),void this.dataReport.uploadReport(t,i.ZegoRTCLogEvent.kZegoTaskDestroyStream.event);e instanceof MediaStream&&0==e.getTracks().length&&this.logger.info(o.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" tracks is null"),this.stopPreview(e),this.dataReport.uploadReport(t,i.ZegoRTCLogEvent.kZegoTaskDestroyStream.event)},e.prototype.startPublishingStream=function(e,t,r){this.logger.info(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" call ",e);var a,l=!0,c="",d=s.getReportSeq();if(this.stateCenter.reportSeqList.startPublish[e]=d,this.dataReport.newReport(d,i.ZegoRTCLogEvent.kZegoTaskPublishStart.event),l&&void 0===e&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+(c="stream id required")),l=!1,a=i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),!l||e&&"string"==typeof e||(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+(c="stream id type wrong")),l=!1,a=i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),l&&e.length>s.MAX_STREAM_ID_LENGTH&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+(c="stream id length limit")),l=!1,a=i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),l&&!n.ClientUtil.checkIllegalCharacters(e)&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+(c="stream ID contains illegal characters")),l=!1,a=i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),l&&(!t||t instanceof MediaStream&&0==t.getTracks().length)&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+(c="localStream wrong")),l=!1,a=i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),l&&!this.streamCenter.checkPreview(t)&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+(c="stream is not from zego")),l=!1,a=i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNoPreviewError),l&&void 0!==r&&"object"!=typeof r&&(l=!1,a=i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,c="publishOption must be object"),l&&void 0!==r&&void 0!==r.streamParams&&"string"!=typeof r.streamParams&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption streamParams must be string"),l=!1,a=i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,c=" publishOption streamParams must be string"),l&&void 0!==r&&void 0!==r.extraInfo&&"string"!=typeof r.extraInfo&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption extraInfo must be string"),l=!1,a=i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,c=" publishOption extraInfo must be string"),l&&void 0!==r&&void 0!==r.videoCodec&&"string"!=typeof r.videoCodec&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption videoCodec must be string"),l=!1,a=i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,c=" publishOption videoCodec must be string"),!l||!this.stateCenter.isMultiRoom||r&&"string"==typeof r.roomID&&""!=r.roomID||(l=!1,a=i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,c=" roomID is need if set multi room"),r&&r.videoCodec&&(r.videoCodec=r.videoCodec.toUpperCase()),l&&this.rtm.service.isDisConnect()&&(this.logger.error("zc.p.sps.1 not login"),l=!1,a=i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNoLoginError),!l)return this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+c),this.dataReport.uploadReport(d,void 0,a,c),delete this.stateCenter.reportSeqList.startPublish[e],!1;r||(r={}),this.dataReport.addMsgInfo(d,{stream:i.ZegoRTCLogEvent.kZegoTaskPublishStart.stream(e),publishOption:i.ZegoRTCLogEvent.kZegoTaskPublishStart.publishOption(r)}),r.audioBitRate=this.stateCenter.audioBitRate;var u=r.roomID?r.roomID:this.stateCenter.roomList[0]?this.stateCenter.roomList[0].roomID:"",h=this.stateCenter.getRoomByRoomID(u);if(!h)return this.logger.error("zc.p.sps.1 room no found"),!1;if(this.dataReport.addMsgInfo(d,{publish_room_id:u,isMulti:this.stateCenter.isMultiRoom}),this.stateCenter.customUrl&&0!=this.stateCenter.customUrl.length)return this.stateCenter.publishStreamList[e]={state:s.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:r.extraInfo?r.extraInfo:null},this.streamCenter.setPublishStateStart(h,e,t,r)?(h.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.publisherList[e].serverUrls=this.stateCenter.customUrl,this.streamCenter.startPublishingStream(e)):(this.logger.info("zc.p.sps.1 cannot start publish"),!1);if(!this.streamCenter.setPublishStateStart(h,e,t,r))return this.logger.error("zc.p.sps.1 cannot start publish"),!1;this.stateCenter.publishStreamList[e]={state:s.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:r.extraInfo?r.extraInfo:null},this.logger.info("zc.p.sps.1 start publish"),h.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""});var p=this.streamCenter.publisherList[e].retryDispatchHandler;return p.stopMaxTime(),p.invalid(),p.initStream(e,r,!0),p.startMaxTime(),p.active(0)},e.prototype.activateSEIInsert=function(e,t,r){void 0===r&&(r=0);var s=this.streamCenter.checkPreview(e);if(!s)return this.logger.error(o.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" stream is not created"),!1;if(0!==t&&1!==t)return this.logger.error(o.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" value of \u201caction\u201d should be 0 or 1"),!1;s.activeteSEIConfig={action:t,infoType:r};var i=this.streamCenter.checkPublish(e);return i&&(null==i||i.publisher.activateSEIInsert(t,r)),!0},e.prototype.stopPublishingStream=function(e){this.logger.info(o.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" call ",e);var t=s.getReportSeq();if(this.stateCenter.reportSeqList.stopPublish[e]=t,this.dataReport.newReport(t,i.ZegoRTCLogEvent.kZegoTaskPublishStop.event),this.dataReport.addMsgInfo(t,{streamID:i.ZegoRTCLogEvent.kZegoTaskPublishStop.stream(e)}),"string"!=typeof e||""==e)return this.logger.error(o.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" streamID must be string and not empty"),this.dataReport.uploadReport(t,void 0,i.ZegoRTCLogEvent.kZegoTaskPublishStop.error.kParamError,"stream id type error"),delete this.stateCenter.reportSeqList.stopPublish[e],!1;var r=this.streamCenter.publisherList[e],n=this.streamCenter.getRoomByStreamID(e),a=r&&r.publisher&&r.publisher.state!==s.ENUM_PUBLISH_STATE.stop;if(this.streamCenter.stopPublishingStream(e),this.stateCenter.publishStreamList[e]){if(this.stateCenter.publishStreamList[e].state>=s.ENUM_PUBLISH_STREAM_STATE.update_info&&n){n.streamHandler.updateStreamInfo(e,"PUBLIC"===this.stateCenter.type?s.ENUM_STREAM_SUB_CMD.liveEnd:s.ENUM_STREAM_CMD_PRI.liveEnd);for(var l=0;l<n.streamList.length;l++)if(n.streamList[l].stream_id==e){n.streamList.splice(l--,1);break}}delete this.stateCenter.publishStreamList[e]}return this.dataReport.uploadReport(t),n&&a&&n.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e,{code:0,message:""}),!0},e.prototype.setCaptureVolume=function(e,t){var r=this;return new Promise(function(s){var n;r.logger.info(o.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" call");var a=function(e){r.logger.error(o.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" "+e),s({errorCode:i.ZegoRTCLogEvent.kZegoSetCaptureVolume.error.kParamError.code,extendedData:JSON.stringify({fail_reason:i.ZegoRTCLogEvent.kZegoSetCaptureVolume.error.kParamError.message+" "+e})})},l=r.streamCenter.ac,c=r.streamCenter.checkPreview(e);if(e instanceof MediaStream&&c)if(0!=e.getAudioTracks().length)if("number"!=typeof t||t<0||t>100)a(" volume must be number between 0 to 100");else{if(c.gainNode)c.gainNode.gain.value=t/100;else{var d=l.createMediaStreamSource(e),u=l.createGain(),h=l.createMediaStreamDestination();d.connect(u),u.connect(h);var p=h.stream.getAudioTracks()[0];for(var g in r.streamCenter.publisherList){var m=r.streamCenter.publisherList[g];if(m.localStream==e){var _=null===(n=m.publisher.peerConnection)||void 0===n?void 0:n.getSenders().find(function(e){return e.track&&"audio"===e.track.kind});_&&(_.replaceTrack(p),m.localStream.removeTrack(m.publisher.localStream.getAudioTracks()[0]),m.localStream.addTrack(p));break}}e.removeTrack(e.getAudioTracks()[0]),e.addTrack(p),c.gainNode=u,c.gainNode.gain.value=t/100}l.resume(),s({errorCode:0,extendedData:""}),r.logger.info(o.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" call success")}else a(" stream audioTrack no found");else a(" stream must be created by zego")})},e.prototype.startScreenShotChrome=function(e){if(c.ZegoWebRTC.screenShotReady)window.postMessage({type:"SS_UI_REQUEST",text:"start"},"*"),n.ClientUtil.registerCallback("screenShare",{success:e},this.stateCenter.callbackList);else{var t='zc.b.ss Please install the extension:1. Go to chrome://extensions  2. Check: "Enable Developer mode   3. Click: "Load the unpacked extension... 4. Choose "extension" folder from the repository 5. Reload this page';this.logger.error(t),e(!1,null,{code:i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+t})}},e.prototype.startScreenSharing=function(e,t){var r=this;"getDisplayMedia"in navigator.mediaDevices?navigator.mediaDevices.getDisplayMedia({audio:e.audio,video:{frameRate:e.frameRate,width:e.width,height:e.height}}).then(function(e){t(!0,e)}).catch(function(e){r.logger.error("zc.b.sss "+e),e.message&&"permission denied"==e.message.toLowerCase()?t(!1,null,i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenCancelError):t(!1,null,{code:i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+e})}):(this.logger.error("zc.b.sss brower does not support getDisplayMedia"),t(!1,null,i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError))},e.prototype.startScreenShotFirFox=function(e,t,r){var o=this,s={video:{frameRate:t.frameRate,bitRate:t.bitRate,width:t.width,height:t.height},audio:t.audio};s.video.mediaSource=e,navigator.mediaDevices.getUserMedia(s).then(function(e){r(!0,e)}).catch(function(e){o.logger.error("ze.ssf.1 "+e),r(!1,null,{code:i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+e})})},e.prototype.startPreview=function(e,t,r,o){var s=this,i=null;return i=new l.ZegoPreview(this.logger,this.streamCenter.ac,this.streamCenter,t),this.streamCenter.previewStreamList.push(i),i.startPreview(e,function(e){s.streamCenter.soundLevelDelegate&&(null==i||i.startSoundLevel()),"camera"===t&&(null==i?void 0:i.micTrack)&&(i.micTrack.enabled=s.streamCenter.isMicEnabled),s.logger.debug("zsc.sp.0 call success"),!s.stateCenter.deviceInfos&&s.recordDevices(),r&&r(e)},function(e){s.streamCenter.previewStreamList=s.streamCenter.previewStreamList.filter(function(e){return e!==i}),o&&o(e)}),!0},e.prototype.stopPreview=function(e){if(!e)return this.logger.warn("zsc.sp.0 localStream null"),!1;for(var t in this.streamCenter.publisherList)this.streamCenter.publisherList[t].localStream===e&&(this.streamCenter.publisherList[t].localStream=null);var r=this.streamCenter.checkPreview(e);return r?(r.previewSuc&&(r.stopPreview(),this.streamCenter.removePreview(r)),!0):(this.logger.warn("zsc.sp.0 no preview"),!1)},e.prototype.recordDevices=function(){var e=this;this.logger.info("zsc.rd.0 call"),n.ClientUtil.getDevices(function(t){e.stateCenter.deviceInfos={microphones:t.microphones,speakers:t.speakers,cameras:t.cameras}},function(t){e.logger.warn("zsc.rd.0 getDevices err:",t)}),void 0!==navigator.mediaDevices.ondevicechange&&(navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=function(t){e.logger.info("zsc.rd.0 devicechange"),e.stateCenter.deviceChangeTimer&&(clearTimeout(e.stateCenter.deviceChangeTimer),e.stateCenter.deviceChangeTimer=null),e.stateCenter.deviceChangeTimer=setTimeout(function(){n.ClientUtil.getDevices(function(t){for(var r=[],o=function(o){var s=e.stateCenter.deviceInfos.cameras[o];t.cameras.find(function(e){return e.deviceID===s.deviceID})||r.push(s)},n=0;n<e.stateCenter.deviceInfos.cameras.length;n++)o(n);e.stateCenter.deviceStateOut=!1;var l=!1;r.length>0&&(l=!0),r.forEach(function(t){for(var r in e.streamCenter.publisherList){var o=e.streamCenter.publisherList[r],n=o.publisher;o.localStream&&o.cameraLabel===t.deviceName&&(l=!1,n.signal.sendStreamStatus(s.getSeq(),n.sessionId,-6,o.localStream.getAudioTracks()[0]&&1==o.localStream.getAudioTracks()[0].enabled?0:2,n.streamId),e.stateCenter.actionListener("deviceError",a.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,t.deviceName),e.stateCenter.actionListener("_deviceError",a.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,t.deviceName,"camera"));var c=s.getReportSeq();e.dataReport.newReport(c,i.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),e.dataReport.addMsgInfo(c,{interrupt:0}),e.dataReport.uploadReport(c),e.stateCenter.actionListener("videoDeviceStateChanged","DELETE",t),o.localStream&&0===o.localStream.getAudioTracks().length&&(l=!1)}}),l&&(e.stateCenter.deviceStateOut=!0),e.stateCenter.deviceInfos.microphones.filter(function(e){return!t.microphones.find(function(t){return t.deviceID===e.deviceID})}).forEach(function(t){for(var r in e.streamCenter.publisherList){var o=e.streamCenter.publisherList[r],n=o.publisher;o.localStream&&(o.microLabel===t.deviceName||o.microLabel.includes(t.deviceName))&&(n.signal.sendStreamStatus(s.getSeq(),n.sessionId,o.localStream.getVideoTracks()[0]&&1==o.localStream.getVideoTracks()[0].enabled?0:2,-6,n.streamId),e.stateCenter.actionListener("deviceError",a.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,e.streamCenter.publisherList[r].microLabel),e.stateCenter.actionListener("_deviceError",a.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,e.streamCenter.publisherList[r].microLabel,"micro"));var l=s.getReportSeq();e.dataReport.newReport(l,i.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),e.dataReport.addMsgInfo(l,{interrupt:0}),e.dataReport.uploadReport(l),e.stateCenter.actionListener("audioDeviceStateChanged","DELETE","Input",t)}});var c=e.stateCenter.deviceInfos.speakers.filter(function(e){return!t.speakers.find(function(t){return t.deviceID===e.deviceID})}),d=t.cameras.filter(function(t){return!e.stateCenter.deviceInfos.cameras.find(function(e){return e.deviceID===t.deviceID})}),u=t.microphones.filter(function(t){return!e.stateCenter.deviceInfos.microphones.find(function(e){return e.deviceID===t.deviceID})}),h=t.speakers.filter(function(t){return!e.stateCenter.deviceInfos.speakers.find(function(e){return e.deviceID===t.deviceID})});c.forEach(function(t){var r=s.getReportSeq();e.dataReport.newReport(r,i.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.event),e.dataReport.addMsgInfo(r,{reason:i.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.reason("delete"),device:i.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.device(t)}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("audioDeviceStateChanged","DELETE","Output",t)}),d.forEach(function(t){var r=s.getReportSeq();e.dataReport.newReport(r,i.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),e.dataReport.addMsgInfo(r,{interrupt:1}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("videoDeviceStateChanged","ADD",t)}),u.forEach(function(t){var r=s.getReportSeq();e.dataReport.newReport(r,i.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),e.dataReport.addMsgInfo(r,{interrupt:1}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("audioDeviceStateChanged","ADD","Input",t)}),h.forEach(function(t){var r=s.getReportSeq();e.dataReport.newReport(r,i.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.event),e.dataReport.addMsgInfo(r,{reason:i.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.reason("add"),device:i.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.device(t)}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("audioDeviceStateChanged","ADD","Output",t)}),e.stateCenter.deviceInfos={microphones:t.microphones,speakers:t.speakers,cameras:t.cameras}},function(t){e.logger.warn("zsc.rd.0 getDevices err:",t)})},500)})},e}();t.PublishModule=d},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayModule=void 0;var s=r(2),i=r(0),n=r(1),a=r(3),l=function(){function e(e,t,r,o,s){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=s}return e.prototype.startPlayingStream=function(e,t){var r=this;return this.logger.info(s.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" call ",e),new Promise(function(o,s){return r._handlePlayStream(e,t,o,s)})},e.prototype._handlePlayStream=function(e,t,r,l){var c=this,d=i.getReportSeq();this.stateCenter.reportSeqList.startPlay[e]=d,this.dataReport.newReport(d,n.ZegoRTCLogEvent.kZegoTaskPlayStart.event);var u=function(t,r){c.logger.error(s.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" "+(r||t.message)),c.dataReport.uploadReport(d,void 0,t,r),delete c.stateCenter.reportSeqList.startPlay[e],l&&l(o(o({},t),{errorCode:t.code,extendedData:t.message+(r?" "+r:"")}))};if(void 0===e||"string"!=typeof e||""===e)return u(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayParamError,"stream id type error"),!1;if(e.length>i.MAX_STREAM_ID_LENGTH)return u(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDToLongError,"stream id length limit "+i.MAX_STREAM_ID_LENGTH),!1;if(!a.ClientUtil.checkIllegalCharacters(e))return u(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDInvalidCharacterError),!1;if(void 0!==t&&"object"!=typeof t)return u(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayParamError,"playOption must be object"),!1;if(this.stateCenter.customUrl&&this.stateCenter.customUrl.length>0)return this.streamCenter.setPlayStateStart(e,t)?(this.streamCenter.onPlayStateUpdate(i.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.playerList[e].serverUrls=this.stateCenter.customUrl,this.streamCenter.startPlayingStream(e,function(e){r&&r(e)})):(u(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRepeatedPullError,"cannot start play"),!1);if(this.dataReport.addMsgInfo(d,{stream:n.ZegoRTCLogEvent.kZegoTaskPlayStart.stream(e),playOption:n.ZegoRTCLogEvent.kZegoTaskPlayStart.playOption(t)}),this.rtm.service.isDisConnect())return u(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError),!1;if(this.stateCenter.pullLimited||(e=NaN+e),t&&t.videoCodec&&(t.videoCodec=t.videoCodec.toUpperCase()),!this.streamCenter.setPlayStateStart(e,t))return u(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRepeatedPullError,"cannot start play"),!1;this.streamCenter.onPlayStateUpdate(i.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.playSuccessCallBackList[e]=function(e){r&&r(e)},l&&(this.streamCenter.playErrorCallBackList[e]=l);var h=this.streamCenter.playerList[e].retryDispatchHandler;return h.stopMaxTime(),h.invalid(),h.initStream(e,t,!1),h.startMaxTime(),h.active(0)},e.prototype.stopPlayingStream=function(e){this.logger.info(s.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call",e);var t=i.getReportSeq();if(this.stateCenter.reportSeqList.stopPlay[e]=t,this.dataReport.newReport(t,n.ZegoRTCLogEvent.kZegoTaskPlayStop.event),this.dataReport.addMsgInfo(t,{stream:n.ZegoRTCLogEvent.kZegoTaskPlayStop.stream(e)}),"string"!=typeof e||""===e)return this.logger.error(s.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" streamid must be string and not empty"),this.dataReport.uploadReport(t,void 0,n.ZegoRTCLogEvent.kZegoTaskPlayStop.error.kParamError,"stream id type error"),void delete this.stateCenter.reportSeqList.stopPlay[e];var r=this.streamCenter.playerList[e],o=r&&r.player&&r.player.state!==i.ENUM_PLAY_STATE.stop;for(var a in this.streamCenter.stopPlayingStream(e),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[a]===e){delete this.stateCenter.streamUrlMap[a];break}this.dataReport.uploadReport(t),o&&this.streamCenter.onPlayStateUpdate(i.ENUM_PLAY_STATE_UPDATE.error,e,{code:0,message:""}),this.logger.debug(s.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call success")},e.prototype.mutePlayStream=function(e,t,r){var o=this;return this.logger.info("zsc.mps.0 call "+t+" "+r),new Promise(function(s,a){if("string"!=typeof e||""==e)return o.logger.error("zsc.mps.0 streamID must be string and not empty"),void a(!1);if("boolean"!=typeof r)return o.logger.error("zsc.mps.0 mute must be boolean"),void a(!1);var l=o.streamCenter.playerList[e];if(!l)return o.logger.error("zsc.mps.0 player not found"),void a(!1);if("video"===t){if(l.playOption&&!1===l.playOption.video||l.player&&0!==l.player.cameraStatus)return o.logger.error("zsc.mps.0 stream no contain video"),void a(!1);l.player.signal.ActivatePlayVideoStream(i.getSeq(),l.player.sessionId,r,function(){o.logger.info("zsc.mps.0 suc");var e=i.getReportSeq();o.dataReport.newReport(e,n.ZegoRTCLogEvent.kZegoPlayContentChanged.event),o.dataReport.addMsgInfo(e,{session_id:n.ZegoRTCLogEvent.kZegoPlayContentChanged.session_id(l.player.sessionId),video_activate:n.ZegoRTCLogEvent.kZegoPlayContentChanged.video_activate(r?0:1),audio_activate:n.ZegoRTCLogEvent.kZegoPlayContentChanged.audio_activate(1==l.player.playOption.audio?1:0==l.player.playOption.audio?0:1)}),o.dataReport.uploadReport(e),s(!0)},function(){o.logger.error("zsc.mps.0 fail"),a(!1)})}else{if(l.playOption&&!1===l.playOption.audio||l.player&&0!==l.player.micStatus)return o.logger.error("zsc.mps.0 stream no contain audio"),void a(!1);l.player.signal.ActivatePlayAudioStream(i.getSeq(),l.player.sessionId,r,function(){o.logger.info("zsc.mps.0 suc");var e=i.getReportSeq();o.dataReport.newReport(e,n.ZegoRTCLogEvent.kZegoPlayContentChanged.event),o.dataReport.addMsgInfo(e,{session_id:n.ZegoRTCLogEvent.kZegoPlayContentChanged.session_id(l.player.sessionId),video_activate:n.ZegoRTCLogEvent.kZegoPlayContentChanged.video_activate(1==l.player.playOption.video?1:0==l.player.playOption.video?0:1),audio_activate:n.ZegoRTCLogEvent.kZegoPlayContentChanged.audio_activate(r?0:1)}),o.dataReport.uploadReport(e),s(!0)},function(){o.logger.error("zsc.mps.0 fail"),a(!1)})}})},e.prototype.setStreamAudioOutput=function(e,t){var r=this;return!(null==t||0==t.length||!e||(this.logger.debug("zsc.ssao.0 device "+t),e?"undefined"!==e.sinkId?(e.setSinkId(t).then(function(){r.logger.info("zsc.ssao.0 success device: "+t)}).catch(function(e){r.logger.info("zsc.ssao.0 "+e.name)}),0):(this.logger.error("zsc.ssao.0 browser does not suppport"),1):(this.logger.error("zsc.ssao.0 no localVideo"),1)))},e}();t.PlayModule=l},function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioMixModule=void 0;var n=r(2),a=r(0),l=r(1),c=i(r(8)),d=function(){function e(e,t,r,o,s){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.ac=s,this.buffer=null,this.blank=null,"safari"==c.browserDetails.browser&&null==this.blank&&null==this.buffer&&(this.ac.resume(),this.buffer=this.ac.createBuffer(1,1,this.ac.sampleRate),this.blank=this.ac.createBufferSource(),this.blank.buffer=this.buffer,this.blank.connect(this.ac.destination),this.blank.start())}return e.prototype.preloadEffect=function(e,t,r){e&&"string"==typeof e&&t&&"string"==typeof t?this.stateCenter.audioEffectBuffer[e]?this.logger.error(n.ZEGO_WEBRTC_ACTION.PRELOAD_EFFECT+" audio buffer already exists"):(this.logger.info(n.ZEGO_WEBRTC_ACTION.PRELOAD_EFFECT+" start preload effect"),this._preloadEffect(this.ac,e,t,r)):this.logger.error(n.ZEGO_WEBRTC_ACTION.PRELOAD_EFFECT+" params error")},e.prototype.playEffect=function(e,t,r){e.streamID&&"string"==typeof e.streamID&&e.effectID&&"string"==typeof e.effectID?this.stateCenter.audioEffectBuffer[e.effectID]?this._playEffect(e,t,r):this.logger.error(n.ZEGO_WEBRTC_ACTION.PLAY_EFFECT+" audio buffer doesn't exists"):this.logger.error(n.ZEGO_WEBRTC_ACTION.PLAY_EFFECT+" params error")},e.prototype.pauseEffect=function(e,t){return e&&"string"==typeof e?(t&&"string"!=typeof t&&this.logger.error(n.ZEGO_WEBRTC_ACTION.PAUSE_EFFECT+" effect "),this._pauseEffect(e,t)):(this.logger.error(n.ZEGO_WEBRTC_ACTION.PAUSE_EFFECT+" streamID format error"),!1)},e.prototype.resumeEffect=function(e,t){return e&&"string"==typeof e?(t&&"string"!=typeof t&&this.logger.error(n.ZEGO_WEBRTC_ACTION.RESUME_EFFECT+" effect "),this._resumeEffect(e,t)):(this.logger.error(n.ZEGO_WEBRTC_ACTION.RESUME_EFFECT+" streamID format error"),!1)},e.prototype.stopEffect=function(e,t){return e&&"string"==typeof e?(t&&"string"!=typeof t&&this.logger.error(n.ZEGO_WEBRTC_ACTION.STOP_EFFECT+" effect "),this._stopEffect(e,t)):(this.logger.error(n.ZEGO_WEBRTC_ACTION.STOP_EFFECT+" streamID format error"),!1)},e.prototype.unloadEffect=function(e){return e&&"string"==typeof e?(delete this.stateCenter.audioEffectBuffer[e],!0):(this.logger.error(n.ZEGO_WEBRTC_ACTION.UNLOAD_EFFECT+" params error"),!1)},e.prototype.setEffectVolume=function(e,t,r){if(!e||"string"!=typeof e)return this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_EFFECT_VOLUME+" streamID format error"),!1;r&&"string"!=typeof r&&this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_EFFECT_VOLUME+" effect ");var o=this.streamCenter.getPublisher(e);return o?o.setEffectVolume(t/100,r):(this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_EFFECT_VOLUME+" publisher doesn't exist"),!1)},e.prototype.startMixingAudio=function(e,t){return this.logger.info(n.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" call "+e),e&&"string"==typeof e?t?(this.logger.info(n.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" end "+e),Array.isArray(t)&&0!==t.length?this._startMixingAudio(e,t):(this.logger.error(n.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" audio param type error"),!1)):(this.logger.error(n.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" no audio"),!1):(this.logger.error(n.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" stream id type error"),!1)},e.prototype.stopMixingAudio=function(e,t){return e&&"string"==typeof e?Array.isArray(t)&&0!==t.length||void 0===t?this._stopMixingAudio(e,t):(this.logger.error(n.ZEGO_WEBRTC_ACTION.STOP_MIXING_AUDIO+" audio param type error"),!1):(this.logger.error(n.ZEGO_WEBRTC_ACTION.STOP_MIXING_AUDIO+" param streamID format error"),!1)},e.prototype.mixingBuffer=function(e,t,r,o){this.logger.info(n.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" call streamID: "+e+" sourceID:"+t),e&&"string"==typeof e?t&&"string"==typeof t?(this._mixingBuffer(e,t,r,o),this.logger.info(n.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" end")):this.logger.error(n.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" param source id format error"):this.logger.error(n.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" param streamid format error")},e.prototype.stopMixingBuffer=function(e,t){return this.logger.info(n.ZEGO_WEBRTC_ACTION.STOP_MIXING_BUFFER+" call streamID: "+e+" sourceID:"+t),e&&"string"==typeof e?t&&"string"==typeof t?this._stopMixingBuffer(e,t):(this.logger.error(n.ZEGO_WEBRTC_ACTION.STOP_MIXING_BUFFER+" param source id format error"),!1):(this.logger.error(n.ZEGO_WEBRTC_ACTION.STOP_MIXING_BUFFER+" param streamid format error"),!1)},e.prototype.setMixingAudioVolume=function(e,t,r){return this.logger.info(n.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" call"),"string"!=typeof e||""==e?(this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" stream ID must be string and not empty"),!1):"number"!=typeof t||t<0||t>100?(this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" volume must be a number between 0 and 100"),!1):r&&r instanceof HTMLMediaElement?this._setMixingAudioVolume(e,t,r):(this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" no audio"),!1)},e.prototype.getSoundLevel=function(e,t,r){this.logger.info("zc.gsl call");var o=a.getReportSeq();this.dataReport.newReport(o,l.ZegoRTCLogEvent.kZegoTaskGetSoundLevel.event);try{this.ac.resume();var s=this.ac.createMediaStreamSource(e),i=this.ac.createScriptProcessor(4096,1,1);this.stateCenter.audioStreamList[e.id]={mic:s,script:i},s.connect(i),i.connect(this.ac.destination),i.onaudioprocess=function(e){for(var r=e.inputBuffer.getChannelData(0),o=0,s=0;s<r.length;s++)o<r[s]&&(o=r[s]);t(o)},this.dataReport.uploadReport(o)}catch(e){r(e),this.dataReport.addMsgInfo(o,l.ZegoRTCLogEvent.kZegoTaskGetSoundLevel.error.kGetSoundLevelError),this.dataReport.uploadReport(o)}this.logger.info("zc.gsl call success")},e.prototype._preloadEffect=function(e,t,r,o){var s=this,i=new XMLHttpRequest;i.open("GET",r,!0),i.responseType="arraybuffer",i.onload=function(){if(200==i.status||304==i.status)e.decodeAudioData(i.response,function(e){s.logger.info("zc.pe.0 effect preload success"),s.stateCenter.audioEffectBuffer[t]=e,o&&o()},function(e){s.logger.error("zc.pe.0 effect preload fail "+e),o&&o(e)});else{var r=i.statusText;s.logger.error("zc.pe.0 effect preload fail "+r),o&&o(r)}},i.send()},e.prototype._playEffect=function(e,t,r){var o=this.stateCenter.audioEffectBuffer[e.effectID],s=this.streamCenter.getPublisher(e.streamID);s?o?s.playEffect(e,o,t,r):this.logger.error("zc.pe.1 no audio buffer found"):this.logger.error("zc.pe.1 publisher doesn't exist")},e.prototype._pauseEffect=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.pauseEffect(t):(this.logger.error("zc.pe.2 publisher doesn't exist"),!1)},e.prototype._resumeEffect=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.resumeEffect(t):(this.logger.error("zc.re.0 publisher doesn't exist"),!1)},e.prototype._stopEffect=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.stopEffect(t):(this.logger.error("zc.re.0 publisher doesn't exist"),!1)},e.prototype._setMixingAudioVolume=function(e,t,r){var o=this.streamCenter.getPublisher(e);return o?o.setMixingAudioVolume(t/100,r):(this.logger.error("zc.sma.2 publisher doesn't exist"),!1)},e.prototype._startMixingAudio=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.startMixingAudio(t):(this.logger.error("zc.sma.0 publisher doesn't exist"),!1)},e.prototype._stopMixingAudio=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.stopMixingAudio(t):(this.logger.error("zc.sma.1 publisher doesn't exist"),!1)},e.prototype._mixingBuffer=function(e,t,r,o){var s=this.streamCenter.getPublisher(e);s?r instanceof ArrayBuffer?s.mixingBuffer(t,r,o):this.logger.error("zc.mb.0 array buffer not found"):this.logger.error("zc.mb.0 publisher doesn't exist")},e.prototype._stopMixingBuffer=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.stopMixingBuffer(t):(this.logger.error("zc.sma.1 publisher doesn't exist"),!1)},e}();t.AudioMixModule=d},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.AdvancedModule=void 0;var s=r(2),i=r(0),n=r(1),a=r(3),l=r(4),c=function(){function e(e,t,r,o){this.logger=e,this.dataReport=t,this.streamCenter=r,this.stateCenter=o,this.screenShotReady=!1}return e.prototype.setVideoConfig=function(e,t){var r=this;return this.logger.info(s.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" call"),new Promise(function(o,l){var c=i.getReportSeq();return r.dataReport.newReport(c,n.ZegoRTCLogEvent.kZegoSetVideoConfig.event),e instanceof MediaStream?t&&"object"==typeof t&&0!=Object.keys(t).length?t.width&&!a.ClientUtil.checkValidNumber(t.width)?(r.logger.error(s.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints width integer number, range[1, 10000]"),r.dataReport.addMsgInfo(c,{error:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,message:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints width integer number, range[1, 10000]"}),r.dataReport.uploadReport(c),void l({errorCode:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):t.height&&!a.ClientUtil.checkValidNumber(t.height)?(r.logger.error(s.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints height integer number, range[1, 10000]"),r.dataReport.addMsgInfo(c,{error:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,message:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints height integer number, range[1, 10000]"}),r.dataReport.uploadReport(c),void l({errorCode:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):void r.setPublishStreamConstraints(e,t,function(e){r.dataReport.uploadReport(c),o(e)}):(r.logger.error(s.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints wrong"),r.dataReport.addMsgInfo(c,n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError),r.dataReport.uploadReport(c),void l({errorCode:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):(r.logger.error(s.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" localStream not found"),r.dataReport.addMsgInfo(c,n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kLocalStreamError),r.dataReport.uploadReport(c),void l({errorCode:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" localStream no found"}))})},e.prototype.setAudioConfig=function(e,t){var r=this;return this.logger.info(s.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" call"),new Promise(function(o){var a=i.getReportSeq();return r.dataReport.newReport(a,n.ZegoRTCLogEvent.kZegoSetAudioConfig.event),e instanceof MediaStream?!t||"object"!=typeof t||0==Object.keys(t).length||void 0!==t.AEC&&"boolean"!=typeof t.AEC||void 0!==t.AGC&&"boolean"!=typeof t.AGC||void 0!==t.ANS&&"boolean"!=typeof t.ANS?(r.logger.error(s.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" constraints wrong"),r.dataReport.addMsgInfo(a,n.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError),r.dataReport.uploadReport(a),void o({errorCode:n.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.message+" constraints wrong"})):void r.setPublishStreamConstraints(e,t,function(e){r.dataReport.uploadReport(a),o(e)}):(r.logger.error(s.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" localStream not found"),r.dataReport.addMsgInfo(a,n.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError),r.dataReport.uploadReport(a),void o({errorCode:n.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.message+" localStream no found"}))})},e.prototype.enableStream=function(e,t){if(this.logger.info(s.ZEGO_WEBRTC_ACTION.ENABLE_STREAM+" call"),"boolean"!=typeof t.video&&"boolean"!=typeof t.audio)return this.logger.error(s.ZEGO_WEBRTC_ACTION.ENABLE_STREAM+" option error"),!1;var r=!0,o=!0;return"boolean"==typeof t.video&&(r=this.enableCamera(e,t.video,t.retain)),"boolean"==typeof t.audio&&(o=this.enableMicrophone(e,t.audio)),r&&o},e.prototype.enableMicrophoneOnly=function(e){if(this.logger.info(s.ZEGO_WEBRTC_ACTION.ENABLE_MIC_ONLY+" call"),"boolean"!=typeof e)return!1;for(var t=0;t<this.streamCenter.previewStreamList.length;t++){var r=this.streamCenter.previewStreamList[t];if(r.micTrack&&!r.enableMicrophoneOnly(e))return this.logger.error("zsc.emo.0 previewer "+t+" change mic mute state failed"),!1}return this.streamCenter.isMicEnabled=e,!0},e.prototype.replaceTrack=function(e,t){var r=this;return new Promise(function(o){var a=i.getReportSeq();return r.dataReport.newReport(a,n.ZegoRTCLogEvent.kZegoReplaceTrack.event),e instanceof MediaStream?t&&t instanceof MediaStreamTrack?void r._replaceTrack(e,t,function(e){r.dataReport.uploadReport(a),o(e)}):(r.logger.error(s.ZEGO_WEBRTC_ACTION.REPLACE_TRACK+" mediastream track no found"),r.dataReport.uploadReport(a,void 0,n.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError),void o({errorCode:n.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.message+" mediastream track no found"})):(r.logger.error(s.ZEGO_WEBRTC_ACTION.REPLACE_TRACK+" localStream not found"),r.dataReport.uploadReport(a,void 0,n.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError),void o({errorCode:n.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.message+" localStream no found"}))})},e.prototype.setPublishStreamConstraints=function(e,t,r){var o=this,s=null;for(var i in this.logger.info("zsc.spsc.0 constraints",JSON.stringify(t)),this.streamCenter.publisherList)this.streamCenter.publisherList[i].localStream==e&&(s=this.streamCenter.publisherList[i]);if(!s)return this.logger.error("zsc.spsc.0 publisher not found"),void(r&&r({errorCode:l.errorCodeList.PUBLISH_NOT_PUBLISH.code,extendedData:l.errorCodeList.PUBLISH_NOT_PUBLISH.message}));this.logger.info("zsc.spsc.0 streamId ",s.streamID);var n=this.streamCenter.checkPreview(e);if(!n)return this.logger.error("zsc.spsc.0 preview no found"),void(r&&r({errorCode:l.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:l.errorCodeList.PUBLISH_NO_PREVIEW.message}));var a=!1,c=!1;(t.width||t.height||t.frameRate)&&(n.mediaStreamConfig.videoQuality=4,a=!0),void 0===t.ANS&&void 0===t.AGC&&void 0===t.AEC||(c=!0);var d=n.localStream,u=d.getVideoTracks()[0],h=d.getAudioTracks()[0];a&&!u?(this.logger.error("zsc.spsc.0 video track not found"),r&&r({errorCode:l.errorCodeList.TRACK_NOT_FOUND.code,extendedData:l.errorCodeList.TRACK_NOT_FOUND.message})):t.video=!0,c&&!h?(this.logger.error("zsc.spsc.0 audio track not found"),r&&r({errorCode:l.errorCodeList.TRACK_NOT_FOUND.code,extendedData:l.errorCodeList.TRACK_NOT_FOUND.message})):t.audio=!0;var p=JSON.parse(JSON.stringify(n.mediaStreamConfig)),g=Object.assign(n.mediaStreamConfig,t),m=n.getMediaStreamConstraints(g,!0);this.logger.info("zsc.spsc.0 applyConstraints ",JSON.stringify(m));var _=[];if(a&&_.push(u.applyConstraints(m.video)),c&&(h.stop(),_.push(navigator.mediaDevices.getUserMedia({video:!1,audio:m.audio}))),t.maxBitrate){var f=s.publisher.peerConnection.getSenders().find(function(e){return e.track&&"video"===e.track.kind}),E=f.getParameters();f?(E.encodings||(E.encodings=[{}]),E.encodings[0].maxBitrate=1e3*t.maxBitrate,_.push(f.setParameters(E))):this.logger.error("zsc.spsc.0 video sender no found")}if(_.length>0)Promise.all(_).then(function(e){if(o.logger.info("zsc.spsc.0 set constraints success",e[1]),c){var i=(a?e[1]:e[0]).getAudioTracks()[0],n=s.publisher.peerConnection.getSenders().find(function(e){return"audio"===e.track.kind});if(n&&(n.replaceTrack(i),d)){var l=d.getAudioTracks()[0];d.removeTrack(l),d.addTrack(i);var u=o.streamCenter.checkPreview(d);u&&(u.gainNode=null)}}t.maxBitrate&&s.publisher&&(s.publisher.videoInfo.bitRate=t.maxBitrate),r&&r({errorCode:0,extendedData:""})}).catch(function(e){o.logger.error("zsc.spsc.0 fail reason ",e.name,JSON.stringify(e)),r&&r({errorCode:l.errorCodeList.PUBLISHER_CONSTRAINTS_ERROR.code,extendedData:e.name+" "+(e.constraint?"constraint:"+e.constraint:"")})});else{if(this.logger.warn("zsc.spsc.0 constaints is no changes"),c){var T=n.getMediaStreamConstraints(p);this.logger.info("zsc.spsc.0 oldMediaStreamConstraints ",JSON.stringify(T)),navigator.mediaDevices.getUserMedia({video:!1,audio:T.audio}).then(function(e){e.getTracks().forEach(function(e){var t=d.getTracks().find(function(t){return t.kind===e.kind}),r=s.publisher.peerConnection.getSenders().find(function(t){return null!==t.track&&t.track.kind===e.kind});r&&(r.replaceTrack(e),t&&d.removeTrack(t),d.addTrack(e))}),o.logger.info("zsc.spsc.0.1 setbackup suc ")}).catch(function(e){o.logger.error("zsc.spsc.0.1 setbackup fail "+e.name)})}r&&r({errorCode:l.errorCodeList.PUBLISHER_CONSTRAINTS_ERROR.code,extendedData:"constraints is no changes"})}},e.prototype.useVideoDevice=function(e,t){var r=this;return this.logger.info("zc.uvd.0 call"),new Promise(function(o){var s=i.getReportSeq();if(r.dataReport.newReport(s,n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.event),r.dataReport.addMsgInfo(s,{device:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.device(t)}),!(e instanceof MediaStream))return r.logger.error("zc.uvd.0 localStream not found"),r.dataReport.addMsgInfo(s,n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kLocalStreamError),r.dataReport.uploadReport(s),void o({errorCode:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message});if("string"!=typeof t)return r.logger.error("zc.uvd.0 deviceID must be string"),r.dataReport.addMsgInfo(s,{error:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,message:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message+" deviceID must be string"}),r.dataReport.uploadReport(s),void o({errorCode:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message});var l=function(e){r.dataReport.uploadReport(s),o(e)};a.ClientUtil.getDevices(function(s){if(!s.cameras.find(function(e){return e.deviceID==t}))return r.logger.error("zc.uvd.0 device is not found"),void o({errorCode:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kDevicesNoFoundError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kDevicesNoFoundError.message});r.switchDevice("video",e,t,l)},function(o){r.logger.warn("zc.uvd.0 getDevices err:",o),r.switchDevice("video",e,t,l)})})},e.prototype.useAudioDevice=function(e,t){var r=this;return this.logger.info("zc.uad.1 call"),new Promise(function(o){var s=i.getReportSeq();r.dataReport.newReport(s,n.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.event),r.dataReport.addMsgInfo(s,{device:n.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.device(t)});var l=function(e,t){r.logger.error("zc.uad.1 "+t);var i=e;i.message=i.message+(t?" "+t:""),r.dataReport.addMsgInfo(s,i),r.dataReport.uploadReport(s),o({errorCode:i.code,extendedData:i.message})},c=function(e){r.dataReport.uploadReport(s),o(e)};e instanceof MediaStream?"string"==typeof t?a.ClientUtil.getDevices(function(s){if(!s.microphones.find(function(e){return e.deviceID==t}))return r.logger.error("zc.uad.1 device is not found"),void o({errorCode:n.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kDevicesNoFoundError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kDevicesNoFoundError.message});r.switchDevice("audio",e,t,c)},function(o){r.logger.warn("zc.uad.1 getDevices err:",o),r.switchDevice("audio",e,t,c)}):l(n.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kParamError,"deviceID must be string"):l(n.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kLocalStreamError,"localStream not found")})},e.prototype.publishTarget=function(e){var t=this,r=i.getReportSeq();switch(e.type){case"addpush":this.dataReport.newReport(r,n.ZegoRTCLogEvent.kZegoTaskAddPublishCdnUrl.event);break;case"delpush":case"clearpush":this.dataReport.newReport(r,n.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.event)}return this.dataReport.addMsgInfo(r,{stream:n.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.stream(e.streamID),target_url:n.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.target_url(e.pushUrl)}),new Promise(function(o,s){var i=function(e,o){t.logger.error("zb.pt"+(o||e.message)),t.dataReport.addMsgInfo(r,{error:e.code,message:e.message+(o||"")}),t.dataReport.uploadReport(r),s({errorCode:e.code,extendedData:e.message+(o?" "+o:"")})};if(-1==["addpush","delpush","clearpush"].indexOf(e.type))return t.logger.error("zb.sh.pt cdn push type error"),void i(l.errorCodeList.PUBLISHER_CDN_PUSH_ERROR,"type error");if(e.streamID&&"string"==typeof e.streamID)if(e.pushUrl&&"string"==typeof e.pushUrl)if(t.stateCenter.publishStreamList[e.streamID]){var a=t.streamCenter.getRoomByStreamID(e.streamID);a?a.streamHandler._publishTarget(e,o,i):i(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoLoginError)}else i(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kPublishStreamNoFoundError);else i(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"push url error");else i(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"stream id type error")})},e.prototype.switchDevice=function(e,t,r,s){var i=this,n=this.streamCenter.checkPreview(t);if(!n)return this.logger.error("zsc.sd.0 preview no found"),void(s&&s({errorCode:l.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:l.errorCodeList.PUBLISH_NO_PREVIEW.message}));if("video"===e&&0==n.mediaStreamConfig.video)return this.logger.error("zsc.sd.0 camera can not be changed when video is false"),void(s&&s({errorCode:l.errorCodeList.VIDEO_DEVICE_FALSE.code,extendedData:l.errorCodeList.VIDEO_DEVICE_FALSE.message}));if("audio"===e&&0==n.mediaStreamConfig.audio)return this.logger.error("zsc.sd.0 microphone can not be changed when audio is false"),void(s&&s({errorCode:l.errorCodeList.AUDIO_DEVICE_FALSE.code,extendedData:l.errorCodeList.AUDIO_DEVICE_FALSE.message}));n.mediaStreamConfig.videoInput!==r&&delete n.mediaStreamConfig.facingMode;var c,d={};"video"===e?(d.videoInput=r,c=t.getVideoTracks()[0]):(d.audioInput=r,c=t.getAudioTracks()[0]);var u=a.ClientUtil.getBrowser();this.logger.info("zsc.sd.0 browser "+u),"Firefox"===u&&c.stop();var h=o(o({},n.mediaStreamConfig),d),p=n.getMediaStreamConstraints(h),g=function(r,o){o.getTracks().forEach(function(o){var s,a=r.getTracks().find(function(e){return e.kind===o.kind});if(a){for(var l in i.streamCenter.publisherList)if(i.streamCenter.publisherList[l].localStream==t){var c=null===(s=i.streamCenter.publisherList[l].publisher.peerConnection)||void 0===s?void 0:s.getSenders().find(function(e){return null!==e.track&&e.track.kind===o.kind});c&&a.kind===e?(c.replaceTrack(o),n.gainNode=null):i.logger.warn("zsc.sd.0 no sender found, only swithcing device on localMediaElement")}a&&(a.kind===e?(o.enabled=a.enabled,r.removeTrack(a),a.stop(),r.addTrack(o)):o.stop()),"audio"===o.kind&&(n.audioTrack=o)}}),n.restartSoundLevel()};navigator.mediaDevices.getUserMedia(p).then(function(r){Object.assign(n.mediaStreamConfig,d),g(t,r),i.logger.info("zsc.sd.0 swtich "+e+" device success"),s&&s({errorCode:0,extendedData:""})},function(r){var o,a;null===(o=t.getVideoTracks()[0])||void 0===o||o.stop(),null===(a=t.getAudioTracks()[0])||void 0===a||a.stop(),i.logger.warn("zsc.sd.0 swtich "+e+" device failed, stop last device and retry. ",r+""),navigator.mediaDevices.getUserMedia(p).then(function(r){Object.assign(n.mediaStreamConfig,d),g(t,r),i.logger.info("zsc.sd.0 swtich "+e+" device success"),s&&s({errorCode:0,extendedData:""})},function(r){i.logger.warn("zsc.sd.0 swtich "+e+" device failed and recover last device. ",r+"");var o=n.getMediaStreamConstraints(n.mediaStreamConfig),a=l.errorCodeList.VIDEO_DEVICE_FALSE;"audio"===e&&(a=l.errorCodeList.AUDIO_DEVICE_FALSE),navigator.mediaDevices.getUserMedia(o).then(function(o){g(t,o),i.logger.info("zsc.sd.0 recover last "+e+" device success"),s&&s({errorCode:a.code,extendedData:a.message+" "+JSON.stringify(r)})},function(t){i.logger.error("zsc.sd.0 swtich "+e+" device and recover failed, please recreate stream. ",t+""),s&&s({errorCode:a.code,extendedData:a.message+" "+JSON.stringify(t)})})})})},e.prototype._replaceTrack=function(e,t,r){var o,s=this.streamCenter.checkPreview(e),n=this.streamCenter.checkPublish(e);if(/Safari/.test(navigator.userAgent)&&/Chrome/.test(navigator.userAgent),n){var a=n.publisher.localStream;if(!(null===(o=n.publisher.peerConnection)||void 0===o?void 0:o.getSenders)||!n.publisher.peerConnection.getSenders()[0].replaceTrack)return this.logger.error("zc.rt.0 replack track is not supported"),void(r&&r({errorCode:l.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT.code,extendedData:l.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT.message+" replack track is not supported"}));p=a.getTracks().find(function(e){return e.kind===t.kind});var c=n.publisher.peerConnection.getSenders().find(function(e){return e.track.kind===t.kind});if(p&&c){var d=0,u=0,h=t.enabled!==p.enabled;"video"===t.kind?(d=!0===t.enabled?0:2,u=a.getAudioTracks()[0]&&1==a.getAudioTracks()[0].enabled?0:2):"audio"===t.kind&&(u=!0===t.enabled?0:2,d=a.getVideoTracks()[0]&&1==a.getVideoTracks()[0].enabled?0:2),c.replaceTrack(t),a.removeTrack(p),a.addTrack(t),h&&n.publisher.signal&&n.publisher.signal.sendStreamStatus(i.getSeq(),n.publisher.sessionId,d,u,n.publisher.streamId),r&&r({errorCode:0,extendedData:""})}else this.logger.error("zc.rt.0 publisher track no found"),r&&r({errorCode:l.errorCodeList.TRACK_NOT_FOUND.code,extendedData:l.errorCodeList.TRACK_NOT_FOUND.message})}else{if(!s)return this.logger.error("zc.rt.0 preview no found"),void(r&&r({errorCode:l.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:l.errorCodeList.PUBLISH_NO_PREVIEW.message}));var p,g=s.localStream;(p=g.getTracks().find(function(e){return e.kind===t.kind}))?(g.removeTrack(p),g.addTrack(t),r&&r({errorCode:0,extendedData:""})):(this.logger.error("zc.rt.0 track no found"),r&&r({errorCode:l.errorCodeList.TRACK_NOT_FOUND.code,extendedData:l.errorCodeList.TRACK_NOT_FOUND.message}))}},e.prototype.enableMicrophone=function(e,t){var r=this.streamCenter.checkPreview(e);return r?r.enableMicrophone(t,this.streamCenter):(this.logger.error("zsc.em.0 no preview"),!1)},e.prototype.enableCamera=function(e,t,r){var o=this.streamCenter.checkPreview(e);return o?o.enableCamera(t,this.streamCenter,r):(this.logger.error("zsc.ec.0 no preview"),!1)},e}();t.AdvancedModule=c},function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStreamCenterWeb=void 0;var i=r(0),n=r(7),a=r(22),l=r(24),c=r(0),d=r(25),u=r(26),h=r(27),p=r(28),g=r(4),m=r(1),_=function(e){function t(t,r,o,s,i,n){var a=e.call(this)||this;return a.testEnvironment=!1,a.heartbeatTimer=null,a.heartbeatInterval=1e4,a.qualityTimerInterval=3e3,a.previewStreamList=[],a.signalList={},a.chargeInfos={itemtype:"ChargeInfos",timestamp_begin:0,timestamp_end:0,timestamp_diff_flag:0,timestamp_diff:0,infos:[]},a.chargeInfosTimer=null,a.chargeInfosInterval=6e4,a.chargeInfoSeq=0,a.soundLevelDelegate=!1,a.soundLevelInterval=1e3,a.isPeer=!0,a.probeList={},a.isMicEnabled=!0,a.playerList={},a.publisherList={},a.playSuccessCallBackList={},a.playErrorCallBackList={},a.tryCountConnectInterval=3e3,a.checkMessageTimeout=function(){for(var e in a.signalList)a.signalList[e].signal&&a.signalList[e].signal.checkMessageTimeout()},a.getAllInUseUrl=function(){var e=[];for(var t in a.signalList)e.push(t);return e},a.onDisconnectHandle=function(e){if(a.logger.info("zsc.od.0 call"),a.signalList[e]){for(var t=a.signalList[e],r=0;r<t.publishConnectedList.length;r++){var o=a.publisherList[t.publishConnectedList[r]];o&&o.publisher&&o.publisher.onDisconnect()}for(r=0;r<t.playConnectedList.length;r++){var s=a.playerList[t.playConnectedList[r]];s&&s.player&&s.player.onDisconnect()}delete a.signalList[e],a.stopSignalHeartbeat(),a.stopChargeInfosUpload(),a.stopSoundLevel()}},a.logger=t,a.stateCenter=r,a.dataReport=o,a.rtm=s,a.ac=i,a.mediaEleSources=n,"PRIVATE"==a.stateCenter.type&&(a.isPeer=!1),a}return s(t,e),Object.defineProperty(t.prototype,"cameraPreviewStream",{get:function(){return this.previewStreamList.find(function(e){return"camera"===e.previewType})},enumerable:!1,configurable:!0}),t.prototype.onSignalDisconnected=function(e){},t.prototype.setQualityMonitorCycle=function(e){var t=this;return this.logger.debug("zsc.qmc.0 timeInterval "+e),0==Object.keys(this.publisherList).length?this.qualityTimerInterval=e:Object.keys(this.publisherList).forEach(function(r){t.publisherList[r].publisher.qualityTimeInterval=e,t.publisherList[r].publisher.setPublishQualityTimer()}),!0},t.prototype.setSessionInfo=function(e,t,r){this.logger.debug("zsc.ssi.0 called"),this.appid=e,this.userid=t,this.testEnvironment=r},t.prototype.onPlayStateUpdate=function(e,t,r){},t.prototype.onPlayQualityUpdate=function(e,t){},t.prototype.onPublishStateUpdate=function(e,t,r){},t.prototype.onPublishQualityUpdate=function(e,t){},t.prototype.onUpdateHeartBeatIntervalHandle=function(e){e!=this.heartbeatInterval&&(this.logger.debug("zsc.uhb.0 update "+e),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatInterval=e,this.startSignalHeartbeat())},t.prototype.setPublishStateStart=function(e,t,r,o){var s=this;if(this.logger.info("zsc.pss.0 call "+t),this.stateCenter.networkState==i.ENUM_NETWORK_STATE.offline)return this.logger.error("zsc.pss.0 network offline"),!1;var n=this.publisherList[t],l=this.stateCenter.reportSeqList.startPublish[t];if(this.dataReport.eventStart(l,"setPublishState"),n)return this.logger.error("zsc.pss.0 publisher already exist"),this.dataReport.eventEndWithMsgInfo(l,"setPublishState",{message:"publisher already exist"}),this.dataReport.uploadReport(l,void 0,m.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kIsPublishing),delete this.stateCenter.reportSeqList.startPublish[t],!1;var d=new a.ZegoPublish(this.logger,this.dataReport,this.qualityTimerInterval,this,this.ac,this.mediaEleSources,this.stateCenter);d.state=c.ENUM_PUBLISH_STATE.start,d.isPeer=this.isPeer,d.reportSeq=this.stateCenter.reportSeqList.startPublish[t];var u=r.getVideoTracks()[0]&&r.getVideoTracks()[0].label,g=r.getAudioTracks()[0]&&r.getAudioTracks()[0].label,_=r.getVideoTracks()[0]&&r.getVideoTracks()[0].getSettings().deviceId,f=r.getAudioTracks()[0]&&r.getAudioTracks()[0].getSettings().deviceId,E=new h.RetryStreamHandler(this.logger,this.stateCenter,this,!0);return this.publisherList[t]={seq:0,room:e,localStream:r,publisher:d,serverUrls:[],ttl:0,isCenterNode:!1,streamID:t,publishOption:o,cameraLabel:u||"",microLabel:g||"",cameraDeviceId:_||"",microDeviceId:f||"",deviceStateCount:0,retryStreamHandler:E,retryDispatchHandler:new p.RetryDispatchHandler(this.logger,this.stateCenter,this.rtm,this)},d.onPublishStateUpdate=function(e,r,o,i){var n=s.publisherList[r];n?E.publishStateHandle(e,n.streamID,o,i):s.logger.error("zsc.psuh.0 cannot find publish "+t)},d.onPublishQualityUpdate=function(e,r){var o=s.publisherList[e];o?(s.stateCenter.deviceStateOut&&0===r.audio.audioBitrate?(o.deviceStateCount++,o.deviceStateCount>=2&&(o.deviceStateCount=0,s.stateCenter.deviceStateOut=!1,s.logger.warn("zsc.pss.0 publish audio error by device"))):o.deviceStateCount=0,s.onPublishQualityUpdate(o.streamID,r)):s.logger.error("zsc.psuh.0 cannot find publish "+t)},this.dataReport.eventStart(d.reportSeq,"GetSignalUrl"),this.dataReport.eventStart(d.streamReportSeq,"GetSignalUrl"),!0},t.prototype.startPublishingStream=function(e){this.logger.info("zsc.sps.0 call");var t=this.publisherList[e];if(!t)return this.logger.error("zsc.sps.0 publisher don't exist"),!1;var r=t.publisher;if(this.dataReport.eventEndWithMsg(r.reportSeq,"GetSignalUrl",{urls:t.serverUrls,is_center:t.isCenterNode}),this.dataReport.eventEndWithMsg(r.streamReportSeq,"GetSignalUrl",{urls:t.serverUrls,is_center:t.isCenterNode}),!t.serverUrls||0===t.serverUrls.length)return t.retryStreamHandler.publishStateHandle(c.ENUM_PUBLISH_STATE_UPDATE.error,e,g.errorCodeList.DISPATCH_ERROR),this.logger.info("zsc.sps.0 server don't have signal url"),!1;var o=t.serverUrls.indexOf(this.server);-1!==o&&(t.serverUrls.splice(o,1),t.serverUrls.unshift(this.server));var s=t.retryStreamHandler;return s.invalid(),s.init(this.stateCenter.streamRetryTime),s.initStream(e,t.serverUrls),s.activePublish(0)},t.prototype.updateWaitingList=function(e,t,r,o,s){t?e.publishWaitingList.push({streamID:r,success:o,error:s}):e.playWaitingList.push({streamID:r,success:o,error:s})},t.prototype.publishStream=function(e){var t=this.publisherList[e].publisher;if(t){var r=null,o=null,s=this.publisherList[e].publishOption,i=this.checkPreview(this.publisherList[e].localStream);i?(r=i.localStream,o=i.videoInfo,this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.startPublish[e],{cap_w:m.ZegoRTCLogEvent.kZegoTaskPublishStart.cap_w(i.videoInfo.width),cap_h:m.ZegoRTCLogEvent.kZegoTaskPublishStart.cap_h(i.videoInfo.height),w:m.ZegoRTCLogEvent.kZegoTaskPublishStart.w(i.videoInfo.width),h:m.ZegoRTCLogEvent.kZegoTaskPublishStart.h(i.videoInfo.height),video_en_fps:m.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_fps(i.videoInfo.frameRate),video_en_bps:m.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_bps(i.videoInfo.bitRate)}),r?(this.logger.info("zsc.ps.0 call success"),t.gwNodeTTL<(new Date).getTime()&&(t.gwNode="",t.gwNodeList=[],t.gwNodeTTL=0),t.startPublish(e,r,o,i.mediaStreamConfig,s)):this.logger.error("zsc.ps.0 no localStream found")):this.logger.error("zsc.ps.0 no preview found")}else this.logger.info("zsc.ps.0 publisher don't exist")},t.prototype.connectPublishServer=function(e,t){var r=this,o=this.publisherList[e];return o?(this.dataReport.eventStart(o.publisher.reportSeq,"ConnectServer"),this.dataReport.eventStart(o.publisher.streamReportSeq,"ConnectServer"),this.connectWithReuseSignalServer(e,!0,t,function(e,t,o){var s=r.publisherList[e];if(s){var i=s.publisher;if(i){r.dataReport.eventEndWithMsg(i.reportSeq,"ConnectServer",{result:0,server:o}),r.dataReport.eventEndWithMsg(i.streamReportSeq,"ConnectServer",{result:0,server:o});var n=t.tokenInfo;r.logger.info("zsc.cps.0 update token success"),n&&n.report&&(i.qualityUpload=n.report,i.qualityUploadInterval=n.report_interval),i.signal=t.signal,r.server=o,r.publishStream(e),r.getTokenSuccess()}else r.logger.info("zsc.cps.1 check publisher don't exist")}else r.logger.info("zsc.cps.0 after connect publisher don't exist")},function(e,t){r.logger.error("zsc.cps.0 "+e+" connect fail "+t);var o=r.publisherList[e];if(o){var s=o.publisher;if(s){r.dataReport.eventEndWithMsg(s.reportSeq,"ConnectServer",{result:t}),r.dataReport.uploadReport(s.reportSeq),delete r.stateCenter.reportSeqList.startPublish[e];var i=g.errorCodeList.CONNECT_FAILED;i.message=i.message+" "+t,o.retryStreamHandler.publishStateHandle(c.ENUM_PUBLISH_STATE_UPDATE.error,e,i,1008==t)}else r.logger.info("zsc.cps.1 check publisher don't exist")}else r.logger.info("zsc.cps.0 after connect publisher don't exist")}),!0):(this.logger.error("zsc.cps.0 publisher don't exist"),!1)},t.prototype.getTokenSuccess=function(){this.logger.debug("zsc.gts.0 call")},t.prototype.stopPublishingStream=function(e){var t=this.publisherList[e];if(t){var r=t.retryStreamHandler;for(var o in r&&(r.stopMaxTime(),r.invalid()),this.signalList)this.signalList[o].publishWaitingList=this.signalList[o].publishWaitingList.filter(function(t){return t.streamID!==e});delete this.publisherList[e],t.publisher&&(t.publisher.stopPublish(),delete t.publisher),this.removeStreamFromSignal(!0,e),this.stopSignalHeartbeat(),this.stopChargeInfosUpload(),this.stopSoundLevel(),this.logger.debug("zsc.sps.0.1 call success")}else this.logger.warn("zsc.sps.0.1 publisher don't exist")},t.prototype.connectWithReuseSignalServer=function(e,t,r,o,s){var i=this;this.logger.info("zsc.crss.0 begin "+r);var n=null;if(this.signalList[r])(n=this.signalList[r]).state==c.ENUM_SIGNAL_STATE.connected?(this.logger.info("zsc.crss.0 already connected "+r+" streamId: "+e),t?n.publishConnectedList.push(e):n.playConnectedList.push(e),o(e,n,r)):n.state==c.ENUM_SIGNAL_STATE.connecting&&(this.logger.info("zsc.crss.0 signal is connecting "+r+" streamId: "+e),this.updateWaitingList(n,t,e,o,s));else{this.logger.info("zsc.crss.0 new signal "+r+" streamId: "+e);var a=new d.ZegoSignal(this.logger,this.stateCenter);a.setSessionInfo(this.appid,this.userid),a.onUpdateHeartBeatInterval=this.onUpdateHeartBeatIntervalHandle.bind(this),a.onDisconnect=this.onDisconnectHandle;var l=this.publisherList[e]?this.publisherList[e].retryStreamHandler:this.playerList[e]?this.playerList[e].retryStreamHandler:null;if(this.stateCenter.streamConnectTime)a.tryConnectInterval=this.stateCenter.streamConnectTime;else if(l&&l.retryActiveCount){var u=l.retryActiveCount*(l.retryActiveCount-1)/2+2;a.tryConnectInterval=1e3*(u=u>c.MAX_RETRY_CONNECT_INTERVAL?c.MAX_RETRY_CONNECT_INTERVAL:u)}this.signalList[r]={signal:a,state:c.ENUM_SIGNAL_STATE.connecting,publishWaitingList:[],playWaitingList:[],publishConnectedList:[],playConnectedList:[],tokenInfo:null},this.updateWaitingList(this.signalList[r],t,e,o,s),a.connectServer(this.stateCenter.roomList[0].token,r,function(e,t,o){n=i.signalList[r];var s,a,l=0;if(0!=e){for(i.logger.info("zsc.crss.0 connect failed "+t),l=0;l<n.publishWaitingList.length;l++)(s=n.publishWaitingList[l]).error&&s.error(s.streamID,e);for(l=0;l<n.playWaitingList.length;l++)(a=n.playWaitingList[l]).error&&a.error(a.streamID,e);delete i.signalList[r]}else{for(i.logger.debug("zsc.crss.0 connected success "+t),n.state=c.ENUM_SIGNAL_STATE.connected,n.tokenInfo=o,l=0;l<n.publishWaitingList.length;l++)(s=n.publishWaitingList[l]).success&&s.success(s.streamID,n,t),n.publishConnectedList.push(s.streamID);for(l=0;l<n.playWaitingList.length;l++)(a=n.playWaitingList[l]).success&&a.success(a.streamID,n,t),n.playConnectedList.push(a.streamID);n.publishWaitingList=[],n.playWaitingList=[],null==i.heartbeatTimer&&i.startSignalHeartbeat(),null==i.chargeInfosTimer&&i.startChargeInfosUpload(),null==i.soundLevelTimer&&i.soundLevelDelegate&&i.startSoundLevel()}})}},t.prototype.setPlayStateStart=function(e,t){var r=this;if(this.logger.info("zsc.pss.1 call "+e),this.stateCenter.networkState==i.ENUM_NETWORK_STATE.offline)return this.logger.error("zsc.pss.1 network offline"),!1;var o=this.playerList[e],s=this.stateCenter.reportSeqList.startPlay[e];if(this.dataReport.eventStart(s,"setPlayState"),o)return this.logger.error("zsc.pss.1 player already exist"),this.dataReport.eventEndWithMsgInfo(s,"setPlayState",{message:"player already exist"}),this.dataReport.uploadReport(s,void 0,m.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kIsPlaying),delete this.stateCenter.reportSeqList.startPlay[e],!1;var n=this.getPlayRoom(e)||this.stateCenter.roomList[0];if(!n)return this.logger.error("zsc.pss.1 not login room"),this.dataReport.eventEndWithMsgInfo(s,"setPlayState",{message:"not login room"}),this.dataReport.uploadReport(s,void 0,m.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError),!1;var a=new u.ZegoPlayWeb(this.logger,null,this.dataReport,this.qualityTimerInterval,this,this.ac,this.stateCenter);t&&[0,2,3].includes(t.resourceMode)&&(a.resourceMode=t.resourceMode),this.dataReport.addMsgInfo(s,{resourceMode:a.resourceMode,play_room_id:n.roomID,isMulti:this.stateCenter.isMultiRoom}),a.state=c.ENUM_PLAY_STATE.start,a.isPeer=this.isPeer,a.reportSeq=this.stateCenter.reportSeqList.startPlay[e],a.beginTime=(new Date).getTime();var l=new h.RetryStreamHandler(this.logger,this.stateCenter,this,!1);return this.playerList[e]={seq:0,room:n,player:a,signal:null,serverUrls:[],ttl:0,isCenterNode:!1,streamID:e,playOption:t,retryStreamHandler:l,retryDispatchHandler:new p.RetryDispatchHandler(this.logger,this.stateCenter,this.rtm,this)},a.onPlayStateUpdate=function(e,t,o,s){var i=r.playerList[t];i?l.playStateHandle(e,i.streamID,o,s):r.logger.error("zsc.pss.1 cannot find play "+t)},a.onPlayQualityUpdate=function(e,t){var o=r.playerList[e];o?r.onPlayQualityUpdate(o.streamID,t):r.logger.error("zsc.pss.1 cannot find play "+e)},a.onRemoteCameraStatusUpdate=function(e,t,o){var s=r.playerList[e];s?r.onRemoteCameraStatusUpdate(s.streamID,t,o):r.logger.error("zsc.pss.1 cannot find play "+e)},a.onRemoteMicStatusUpdate=function(e,t,o){var s=r.playerList[e];s?r.onRemoteMicStatusUpdate(s.streamID,t,o):r.logger.error("zsc.pss.1 cannot find play "+e)},this.dataReport.eventStart(a.reportSeq,"GetSignalUrl"),this.dataReport.eventStart(a.streamReportSeq,"GetSignalUrl"),!0},t.prototype.onRemoteMicStatusUpdate=function(e,t,r){},t.prototype.onRemoteCameraStatusUpdate=function(e,t,r){},t.prototype.startPlayingStream=function(e,t){this.logger.info("zsc.sps.1 start play called");var r=this.playerList[e];if(!r)return this.logger.error("zsc.sps.1 player don't exist"),!1;var o=r.player;if(this.dataReport.eventEndWithMsg(o.reportSeq,"GetSignalUrl",{urls:r.serverUrls}),this.dataReport.eventEndWithMsg(o.streamReportSeq,"GetSignalUrl",{urls:r.serverUrls}),0==r.serverUrls.length)return r.retryStreamHandler.playStateHandle(c.ENUM_PLAY_STATE_UPDATE.error,e,g.errorCodeList.DISPATCH_ERROR),this.logger.info("zsc.sps.1 server don't have signal url"),!1;var s=r.serverUrls.indexOf(this.server);-1!==s&&(r.serverUrls.splice(s,1),r.serverUrls.unshift(this.server));var i=r.retryStreamHandler;return i.invalid(),i.init(this.stateCenter.streamRetryTime),i.initStream(e,r.serverUrls),i.activePull(0,t)},t.prototype.connectPlayServer=function(e,t,r){var o=this,s=this.playerList[e];return s?(this.dataReport.eventStart(s.player.reportSeq,"ConnectServer"),this.dataReport.eventStart(s.player.streamReportSeq,"ConnectServer"),this.connectWithReuseSignalServer(e,!1,r,function(e,r,s){var i=o.playerList[e];if(i){var n=i.player;if(n){o.dataReport.eventEndWithMsg(n.reportSeq,"ConnectServer",{result:0,server:s}),o.dataReport.eventEndWithMsg(n.streamReportSeq,"ConnectServer",{result:0,server:s});var a=r.tokenInfo;o.logger.info("zsc.cps.1 update token success"),a&&a.report&&(n.qualityUpload=a.report,n.qualityUploadInterval=a.report_interval),n.signal=r.signal,o.server=s,o.playStream(e,t),o.getTokenSuccess()}else o.logger.error("zsc.cps.1 checkplayer don't exist")}else o.logger.error("zsc.cps.1 after connect player don't exist")},function(t,r){var s=o.playerList[t];if(s){o.dataReport.eventEndWithMsg(s.player.reportSeq,"ConnectServer",{result:r}),o.dataReport.uploadReport(s.player.reportSeq),delete o.stateCenter.reportSeqList.startPlay[e];var i=g.errorCodeList.CONNECT_FAILED;i.message=i.message+" "+r,s.retryStreamHandler.playStateHandle(c.ENUM_PLAY_STATE_UPDATE.error,t,i,1008==r)}else o.logger.error("zsc.cps.1 after connect player don't exist")}),!0):(this.logger.error("zsc.cps.1 player don't exist"),!1)},t.prototype.playStream=function(e,t){var r=this.playerList[e].player;r?(this.logger.info("zsc.ps.1 call success"),r.gwNodeTTL<(new Date).getTime()&&(r.gwNode="",r.gwNodeList=[],r.gwNodeTTL=0),r.startPlay(e,t,this.playerList[e].playOption)):this.logger.warn("zsc.ps.1 player don't exist")},t.prototype.stopSignalHeartbeat=function(){this.logger.debug("zsc.ssh.1 call");var e=0;for(var t in this.signalList)e+=1;this.heartbeatTimer&&0==e&&(this.logger.info("zsc.ssh.1 stop"),clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},t.prototype.removeStreamFromSignal=function(e,t){var r=[];for(var o in this.signalList){var s=this.signalList[o];if(e){for(var i=0;i<s.publishConnectedList.length;i++)if(s.publishConnectedList[i]===t){this.logger.debug("zsc.rsfs.0 found from publish"),s.publishConnectedList.splice(i,1);break}for(i=0;i<s.publishWaitingList.length;i++)if(s.publishWaitingList[i].streamID===t){this.logger.debug("zsc.rsfs.0 found from publish"),s.publishWaitingList.splice(i,1);break}}else{for(var n=0;n<s.playConnectedList.length;n++)if(s.playConnectedList[n]===t){this.logger.debug("zsc.rsfs.0 found from play"),s.playConnectedList.splice(n,1);break}for(n=0;n<s.playWaitingList.length;n++)if(s.playWaitingList[n].streamID===t){this.logger.debug("zsc.rsfs.0 found from play"),s.playWaitingList.splice(n,1);break}}0==s.publishConnectedList.length&&0==s.playConnectedList.length&&0==s.publishWaitingList.length&&0==s.playWaitingList.length&&(s.signal.disconnectServer(),r.push(o))}for(var a=0;a<r.length;a++)delete this.signalList[r[a]],this.server==r[a]&&(this.server="")},t.prototype.stopPlayingStream=function(e){var t=this.playerList[e];if(t){var r=t.retryStreamHandler;for(var o in r&&(r.stopMaxTime(),r.invalid()),this.signalList)this.signalList[o].playWaitingList=this.signalList[o].playWaitingList.filter(function(t){return t.streamID!==e});delete this.playerList[e],t.player&&(t.player.stopPlay(),delete t.player),this.removeStreamFromSignal(!1,e),this.stopSignalHeartbeat(),this.stopChargeInfosUpload(),this.stopSoundLevel(),delete this.playSuccessCallBackList[e],delete this.playErrorCallBackList[e],this.logger.debug("zsc.sps.1.1 call success")}else this.logger.info("zsc.sps.1.1 player don't exist")},t.prototype.reset=function(e){for(var t in this.publisherList)(this.publisherList[t].room.roomID==e||!e)&&this.stopPublishingStream(t);var r=function(t){var r=o.playerList[t].room;if(r.roomID!=e||!r.streamList.find(function(e){return e.stream_id==t})&&1!=o.stateCenter.roomList.length){if(r.roomID==e&&o.stateCenter.roomList.length>1){var s=o.stateCenter.roomList.find(function(t){return t.roomID!==e});s?o.playerList[t].room=s:o.stopPlayingStream(t)}}else o.stopPlayingStream(t)},o=this;for(var s in this.playerList)r(s);0==Object.keys(this.publisherList).length&&0==Object.keys(this.playerList).length&&(this.probeList={})},t.prototype.startSignalHeartbeat=function(){var e=this;this.logger.debug("zsc.ssh.0 call"),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatTimer=setTimeout(function(){e.checkSignalHeartbeat()},this.heartbeatInterval)},t.prototype.startChargeInfosUpload=function(){var e=this;this.logger.debug("zsc.sciu.0 call"),this.chargeInfosTimer&&(clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null),this.chargeInfosTimer=setTimeout(function(){e.checkChargeInfos()},this.chargeInfosInterval)},t.prototype.checkChargeInfos=function(){this.logger.debug("zsc.cci.0 call");var e={is_publishing:0,play_max_audio_bitrate:0,play_stream_resolution_infos:[]};for(var t in this.chargeInfos.timestamp_begin=(new Date).getTime(),this.publisherList){this.publisherList[t].publisher.state===c.ENUM_PUBLISH_STATE.publishing&&(e.is_publishing=1);break}e.play_max_audio_bitrate=0;var r=function(t){var r=o.playerList[t].player.playStream,s=r&&0!==r.getVideoTracks().length?r.getVideoTracks()[0].getSettings():void 0,i={video_width:s&&s.width?s.width:0,video_height:s&&s.height?s.height:0,count:1};if(!e.play_stream_resolution_infos.find(function(e){return e.video_width==i.video_width&&e.video_height==i.video_height&&(e.count++,!0)})&&e.play_stream_resolution_infos.push(i),0==i.video_width&&0==i.video_height){var n=1e3*o.playerList[t].player.lastPlayStats.audioBitrate;n>e.play_max_audio_bitrate&&(e.play_max_audio_bitrate=n)}},o=this;for(var s in this.playerList)r(s);0!==this.chargeInfos.timestamp_end?(this.chargeInfos.timestamp_diff=this.chargeInfos.timestamp_begin-this.chargeInfos.timestamp_end,this.chargeInfos.timestamp_diff_flag=1):(this.chargeInfos.timestamp_diff=0,this.chargeInfos.timestamp_diff_flag=0),this.chargeInfos.timestamp_end=(new Date).getTime(),this.chargeInfos.infos=[e],0!==e.play_stream_resolution_infos.length&&this.logger.report(this.chargeInfos),this.chargeInfosTimer&&this.startChargeInfosUpload()},t.prototype.checkSignalHeartbeat=function(){for(var e in this.logger.debug("zsc.csh.0 call"),this.signalList)this.signalList[e].signal&&this.signalList[e].signal.sendHeartbeat();this.heartbeatTimer&&this.startSignalHeartbeat()},t.prototype.stopChargeInfosUpload=function(){this.logger.debug("zsc.sciu.0 call");var e=0;for(var t in this.signalList)e+=1;this.chargeInfosTimer&&0==e&&(this.logger.info("zsc.sciu.0 stop"),clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null)},t.prototype.getPublisher=function(e){var t=null;return this.publisherList[e]&&this.publisherList[e].publisher&&(t=this.publisherList[e].publisher),t},t.prototype.checkPreview=function(e){for(var t=0;t<this.previewStreamList.length;t++)if(this.previewStreamList[t].localStream===e)return this.previewStreamList[t];return null},t.prototype.checkPublish=function(e){for(var t in this.publisherList)if(this.publisherList[t].localStream==e)return this.publisherList[t];return null},t.prototype.removePreview=function(e){for(var t=0;t<this.previewStreamList.length;t++)if(this.previewStreamList[t]===e){this.previewStreamList.splice(t,1);break}},t.prototype.onPlayerStreamUrlUpdate=function(e,t,r){},t.prototype.getScreenConstrains=function(e){var t={};if("boolean"==typeof e&&e)t={audio:!1,frameRate:c.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate,bitRate:c.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate};else if("object"==typeof e){switch(e.videoQuality){case 1:t={frameRate:c.ENUM_SCREEM_RESOLUTION_TYPE.LOW.frameRate,bitRate:c.ENUM_SCREEM_RESOLUTION_TYPE.LOW.bitRate};break;case 3:t={frameRate:c.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.frameRate,bitRate:c.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.bitRate};break;case 4:t={frameRate:e.frameRate,bitRate:e.bitRate,width:e.width,height:e.height};break;case 2:default:t={frameRate:c.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate,bitRate:c.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate}}t.audio="boolean"==typeof e.audio&&e.audio,t.startBitrate=e.startBitrate}return t},t.prototype.createScreenPreviewer=function(e,t){var r=new n.ZegoPreview(this.logger,this.ac,this,"screen"),o=e.getVideoTracks()[0].getSettings();return this.previewStreamList.push(r),r.mediaStreamConfig=t,e.getAudioTracks().length>0&&(r.audioTrack=e.getAudioTracks()[0]),r.localStream=e,r.videoInfo={width:o.width,height:o.height,frameRate:o.frameRate||15,bitRate:(null==t?void 0:t.bitRate)||1e3,startBitrate:null==t?void 0:t.startBitrate},r.previewSuc=!0,r.previewType="screen",r},t.prototype.setSoundLevelDelegate=function(e,t){for(var r in this.logger.info("zsc.ssd.0 call"),t&&(this.soundLevelInterval=t),this.soundLevelDelegate=e,this.previewStreamList){var o=this.previewStreamList[r];e?o.startSoundLevel():o.stopSoundLevel()}for(var r in this.playerList){var s=this.playerList[r].player;e?s.startSoundLevel():s.stopSoundLevel()}e?(this.logger.info("zsc.ssd.0 start getting sound"),null==this.soundLevelTimer&&this.startSoundLevel()):(this.logger.info("zsc.ssd.0 stop getting sound"),this.soundLevelTimer&&clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null,this.soundLevelInterval=1e3)},Object.defineProperty(t.prototype,"hasRemoteStream",{get:function(){return Object.keys(this.signalList).length>0},enumerable:!1,configurable:!0}),t.prototype.startSoundLevel=function(){var e=this;this.soundLevelTimer&&(clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null),this.soundLevelTimer=setTimeout(function(){e.hasRemoteStream&&e.checkSoundLevel(),e.checkMicSoundLevel(),e.soundLevelDelegate&&e.startSoundLevel()},this.soundLevelInterval)},t.prototype.checkSoundLevel=function(){this.logger.debug("zsc.csl.0 call");var e=[];for(var t in this.publisherList){var r=0,o=this.publisherList[t].publisher,s=o.previewer;s&&(r=s.soundLevel),e.push({streamID:this.getBackStreamId(o.streamId),soundLevel:r,type:"push"})}for(var t in this.playerList){var i=this.playerList[t].player;e.push({streamID:this.getBackStreamId(i.streamId),soundLevel:i.soundLevel,type:"pull"})}this.soundLevelDelegate&&e.length>0&&this.onSoundLevelUpdate(e)},t.prototype.checkMicSoundLevel=function(){this.cameraPreviewStream&&this.soundLevelDelegate&&this.onMicSoundLevelUpdate(this.cameraPreviewStream.soundLevel)},t.prototype.getBackStreamId=function(e){return this.testEnvironment&&e?e.replace("zegotest-"+this.appid+"-",""):e},t.prototype.onSoundLevelUpdate=function(e){},t.prototype.onMicSoundLevelUpdate=function(e){},t.prototype.stopSoundLevel=function(){var e=0;for(var t in this.signalList)e+=1;this.soundLevelTimer&&0==e&&(this.logger.info("zsc.ssl.0 stop"),clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null,this.soundLevelInterval=1e3)},t.prototype.startNetProbe=function(e,t,r){var o=this,s=i.getReportSeq();if(this.dataReport.newReport(s,m.ZegoRTCLogEvent.kZegoNetProbe.event),this.isPeer){var n=!0;0==r.length&&(n=!1,r=e?this.publisherList[t.streamId].serverUrls:this.playerList[t.streamId].serverUrls),r.forEach(function(r){if(!(o.probeList[r]&&o.probeList[r].timeStamp+9e5<(new Date).getTime()||t.probeState==c.ENUM_PROBE_STATE.probed)){var s="zegoprobe-"+(new Date).getTime();o.setPlayStateStart(s);var i=o.playerList[s]?o.playerList[s].player:null;i&&(i.isProbe=!0,n?(i.gwNode=r,i.signal=t.signal,i.startPlay(s,function(){})):o.connectPlayServer(s,function(){},r),i.onCalNetQualityResult=function(n,a){o.logger.info("zc.ocnqr.0 "+i.gwNode+" "+n+" "+a),o.probeList[r]={result:n,netQuality:a,timeStamp:(new Date).getTime()},t.gwNode==r||t.signal.server==r?t.netQuality=a:o.handleCalNetQualityResult(e,n,a,t,r),o.stopPlayingStream(s)})}}),this.dataReport.addMsgInfo(s,{netQuality:t.netQuality,nodeList:r}),this.dataReport.uploadReport(s)}else this.dataReport.uploadReport(s,void 0,{code:-1,message:"not support peer"})},t.prototype.handleCalNetQualityResult=function(e,t,r,o,s){if(this.logger.info("zc.hcqr.0 "+o.netQuality+" probe "+r+" "+s),0===t){var n=i.getReportSeq();this.dataReport.newReport(n,m.ZegoRTCLogEvent.kZegoNetProbeResult.event);var a=!1;if(r>Math.max(75,o.netQuality+20)&&o.probeState==c.ENUM_PROBE_STATE.tryProbe)if(a=!0,e){var l=o,d=l.streamId,u=l.localStream,h=l.videoInfo,p=l.mediaStreamConfig,g=l.publishOption;0!=l.sessionId&&l.signal&&l.shouldSendCloseSession()&&(l.signal.sendCloseSession(c.getSeq(),l.sessionId,1),l.signal.removeSession(l.sessionId),l.closeSessionSignal=!0),l.resetPublish(),this.publisherList[d].isCenterNode?(l.gwNode=s,l.startPublish(d,u,h,p,g)):this.connectPublishServer(d,s)}else{var _=o,f=(d=_.streamId,_.getRemoteStreamSuc),E=_.playOption;0!=_.sessionId&&_.signal&&_.shouldSendCloseSession()&&(_.signal.sendCloseSession(c.getSeq(),_.sessionId,1),_.signal.removeSession(_.sessionId),_.closeSessionSignal=!0),_.resetPlay(),this.playerList[d].isCenterNode?(_.gwNode=s,_.startPlay(d,f,E)):this.connectPlayServer(d,f,s)}else a=!1,this.logger.warn("zc.hcqr.0 "+o.netQuality+" probe "+r+" "+s);this.dataReport.addMsgInfo(n,{isSwitch:a,isPublish:e,streamID:o.streamId,result:t,node:s,netQuality:o.netQuality,probeNetQuality:r}),this.dataReport.uploadReport(n),o.probeState=c.ENUM_PROBE_STATE.probed}},t.prototype.getRoomByStreamID=function(e){return this.publisherList[e]?this.publisherList[e].room:this.playerList[e]?this.playerList[e].room:void 0},t.prototype.getPlayRoom=function(e){return this.stateCenter.roomList.find(function(t){return!!t.streamList.find(function(t){return t.stream_id==e})})},t}(l.ZegoStreamCenter);t.ZegoStreamCenterWeb=_},function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPublish=void 0;var n=r(0),a=i(r(8)),l=r(23),c=r(5),d=r(3),u=r(1),h=r(2),p=function(){function e(e,t,r,o,s,i,a){this.state=n.ENUM_PUBLISH_STATE.stop,this.sessionId=0,this.sessionToken="",this.candidateInfo=[],this.qualityTimer=null,this.publishQualityList=[],this.maxQualityListCount=10,this.lastPublishStats={},this.reportSeq=NaN,this.streamReportSeq=n.getSeq(),this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.qualitySeq=0,this.videoInfo={width:0,height:0,frameRate:0,bitRate:0,channelCount:1,audioBitrate:48e3},this.mediaStreamConfig=null,this.offerSeq=0,this.audioMixList=[],this.arrayBufferMap={},this.effectList=[],this.peerConnection=null,this.qualityCount=0,this.closeSessionSignal=!1,this.channelCount=1,this.localSdpRevert=!1,this.remoteSdpRevert=!1,this.videoCodec="H264",this.stateNego=n.ENUM_PUBLISH_STATE_NEGO.stop,this.negoInterval=25e3,this.publishEvent=!1,this.cameraState="on",this.microState="on",this.gwNode="",this.gwNodeList=[],this.gwNodeTTL=0,this.needIncMax=!1,this.probeCount=0,this.gotMax=!1,this.initFitCnt=0,this.targetRate=0,this.totalBitrateArray=[],this.totalTargetRateArray=[],this.totalRetransRateArray=[],this.isPeer=!1,this.peerFailCount=0,this.peerID=0,this.netQuality=0,this.probeTime=0,this.probeInterval=6e4,this.probeState=n.ENUM_PROBE_STATE.probed,this.logger=e,this.dataReport=t,this.qualityTimeInterval=r,this.ac=s,this.mediaEleSources=i,this.streamCenter=o,this.stateCenter=a,this.dataReport.newReport(this.streamReportSeq)}return Object.defineProperty(e.prototype,"previewer",{get:function(){return this.streamCenter.checkPreview(this.localStream)},enumerable:!1,configurable:!0}),e.prototype.publishStateUpdateError=function(e,t){this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STATE_ERROR+"  call ",this.streamId,JSON.stringify(e)),this.streamId&&this.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.error,this.streamId,e,t),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STATE_ERROR+"  ended")},e.prototype.resetPublish=function(){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_RESET_PUBLISH+"   "+this.streamId+" call"),this.state=n.ENUM_PUBLISH_STATE.stop,this.publishEvent=!1,null==this.peerConnection&&null==this.peerConnection||(this.peerConnection.close(),this.peerConnection=null),null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.clearPublishQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId),this.signal.unregisterPushCallback("SessionResetPush",this.sessionId),this.signal.unregisterPushCallback("PublishEventPush",this.sessionId),this.signal.unregisterPushCallback("ClientInfoPush",this.sessionId)),this.sessionSeq=0,this.offerSeq=0,this.candidateInfo=[],this.publishQualityList=[],this.qualityUploadLastTime=0,this.resetEncBitrate()},e.prototype.clearPublishQualityTimer=function(){null!=this.qualityTimer&&(clearInterval(this.qualityTimer),this.qualityTimer=null),this.lastPublishStats={},this.qualityCount=0},e.prototype.shouldSendCloseSession=function(){return this.state!=n.ENUM_PUBLISH_STATE.stop&&this.state!=n.ENUM_PUBLISH_STATE.waitingSessionRsp},e.prototype.startPublish=function(e,t,r,o,s){var i=this;this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+e+" called"),this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),e?(this.streamId=e,this.localStream=t,this.mediaStreamConfig=o,this.channelCount=o.channelCount,this.publishOption=s||{},navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&o&&(o.externalCapture||o.externalMediaStream)&&(this.localStream.onaddtrack=function(){var e,t;i.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+i.streamId+" Track added");var r=i.localStream.getVideoTracks(),o=i.localStream.getAudioTracks();if(r.length>1)null==(s=null===(e=i.peerConnection)||void 0===e?void 0:e.getSenders().find(function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.kind)===r[1].kind}))||s.replaceTrack(r[1]),i.localStream.removeTrack(r[0]);else if(o.length>1){var s;null==(s=null===(t=i.peerConnection)||void 0===t?void 0:t.getSenders().find(function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.kind)===o[1].kind}))||s.replaceTrack(o[1]),i.localStream.removeTrack(o[0])}}),r&&(this.videoInfo=r),s&&s.videoCodec&&(this.videoCodec=s.videoCodec),this.dataReport.addMsgInfo(this.reportSeq,{video_en_codec_id:u.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_codec_id("VP8"==this.videoCodec?2:0),audio_c_channel_count:u.ZegoRTCLogEvent.kZegoTaskPublishStart.audio_c_channel_count(2==this.channelCount?2:1),audio_en_bps:u.ZegoRTCLogEvent.kZegoTaskPublishStart.audio_en_bps(this.videoInfo.audioBitrate),aec_level:u.ZegoRTCLogEvent.kZegoTaskPublishStart.aec_level(1==o.AEC?2:0==o.AEC?0:2),ans_level:u.ZegoRTCLogEvent.kZegoTaskPublishStart.ans_level(1==o.ANS?2:0==o.ANS?0:2),agc:u.ZegoRTCLogEvent.kZegoTaskPublishStart.agc(1==o.AGC?2:0==o.AGC?0:2),traffic_control_min_video_bitrate:u.ZegoRTCLogEvent.kZegoTaskPublishStart.traffic_control_min_video_bitrate(this.videoInfo.bitRate)}),this.isPeer?this.createOffer():this.createSession(),this.negoTimer=setTimeout(function(){i.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" waiting timeout"),i.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNegoTimeoutError)},this.negoInterval)):this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+e+" streamId is null")},e.prototype.activateSEIInsert=function(e,t){var r=this;return new Promise(function(o,s){return r.signal?(r.signal&&r.signal.activateSEIInsert(n.getSeq(),r.sessionId,r.peerID,e,t,function(e,t,s){var i=!1;0===s.result?(r.logger.info(h.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" called success"),i=!0):1===s.result?(r.logger.error(h.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" "+s.peer_id+" invalid param."),i=!1):2===s.result&&(r.logger.error(h.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" peer not exist"),i=!1),o(i)},function(e){n.SEND_MSG_TIMEOUT===e&&r.logger.error(h.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" request timeout")}),!1):o(!1)})},e.prototype.createSession=function(e){var t=this;this.sessionSeq=n.getSeq();var r=this.streamId;1==this.streamCenter.testEnvironment&&(r="zegotest-"+this.streamCenter.appid+"-"+this.streamId),this.isPeer?(this.dataReport.eventStart(this.reportSeq,"CreateSessionWithSdp"),this.dataReport.eventStart(this.streamReportSeq,"CreateSessionWithSdp"),this.signal.createSessionWithSdp({seq:this.sessionSeq,type:0,mode:0,streamId:r,videoInfo:this.videoInfo,strAuthParam:this.publishOption&&this.publishOption.streamParams||"",sdp:e.sdp,serverHost:this.gwNode},function(e,r,o){t.handleCreateSessionWithSdpResp(e,r,o)},function(r,o){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:r}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:r}),r==n.SEND_MSG_TIMEOUT&&t.peerFailCount<2?(t.peerFailCount++,t.createSession(e)):r==n.SEND_MSG_TIMEOUT&&t.peerFailCount>=2?(t.isPeer=!1,t.streamCenter.isPeer=!1,t.createSession()):t.publishStateUpdateError(r==n.SEND_MSG_TIMEOUT?u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError:u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)})):(this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.dataReport.eventStart(this.streamReportSeq,"CreateSession"),this.signal.createSession(this.sessionSeq,0,0,r,this.publishOption&&this.publishOption.streamParams,this.gwNode,function(e,r,o){t.handleCreateSessionResp(e,r,o)},function(e,r){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:e}),t.publishStateUpdateError(e==n.SEND_MSG_TIMEOUT?u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError:u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)})),this.state=n.ENUM_PUBLISH_STATE.waitingSessionRsp,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" called success"),this.stateNego=n.ENUM_PUBLISH_STATE_NEGO.start},e.prototype.handleCreateSessionResp=function(e,t,r){var o=r.turn_server,s=o.split("?")[0]&&o.split("?")[0].slice(5),i=this.streamCenter.server.split("?"),n=i[1]&&i[1].slice(2);this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+s+"/"+n+"/"+this.streamId}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+s+"/"+n+"/"+this.streamId}),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" sessionId:"+r.session_id),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,0!==r.result?(this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" create session failed "+r.result),this.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)):(this.sessionId=r.session_id,this.sessionToken=r.session_token,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" create session success "+this.sessionId),this.dataReport.addMsgInfo(this.reportSeq,{session_id:u.ZegoRTCLogEvent.kZegoTaskPublishStart.session_id(this.sessionId)}),this.onCreatePublishSessionSuccess(r))):this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" seq is not match.")},e.prototype.handleCreateSessionWithSdpResp=function(e,t,r){var o=this;this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" sessionId:"+t),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSessionWithSdp",{sessionId:t}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSessionWithSdp",{sessionId:t}),0!==r.result?(this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" create session failed "+r.result),this.publishStateUpdateError({code:u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError.code,message:u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError.message+" result:"+r.result})):(this.sessionId=t,this.sessionToken=r.session_token,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" get remote session success "+this.streamId),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,function(e,t,r){o.onRecvCloseSession(e,t,r)}),this.signal.registerPushCallback("SessionResetPush",this.sessionId,function(e,t,r){o.onRecvResetSession(e,t,r)}),this.signal.registerPushCallback("PublishEventPush",this.sessionId,function(e,t,r){o.onRecvPublishEvent(e,t,r)}),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,function(e,t,r){o.onRecvClientInfo(e,t,r)}),this.onGetRemoteOfferSuccess(r.sdp))):this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" seq is not match.")},e.prototype.onCreatePublishSessionSuccess=function(e){var t=this;this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" called");var r=[];if(e.turn_server){var o=e.turn_server;this.stateCenter.turnOverTcpOnly&&(o=o.replace("udp","tcp")),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" over tcp "+o),r.push(o)}e.stun_server&&r.push(e.stun_server);var s={iceTransportPolicy:"relay",iceServers:[{urls:r,username:e.turn_username,credential:e.turn_auth_key}]};this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" username: "+e.turn_username),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" credential: "+e.turn_auth_key),this.createOffer(s),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,function(e,r,o){t.onRecvCandidateInfo(e,r,o)}),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,function(e,r,o){t.onRecvCloseSession(e,r,o)}),this.signal.registerPushCallback("MediaDescPush",this.sessionId,function(e,r,o){t.onRecvMediaDescription(e,r,o)}),this.signal.registerPushCallback("SessionResetPush",this.sessionId,function(e,r,o){t.onRecvResetSession(e,r,o)}),this.signal.registerPushCallback("PublishEventPush",this.sessionId,function(e,r,o){t.onRecvPublishEvent(e,r,o)}),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,function(e,r,o){t.onRecvClientInfo(e,r,o)}),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" call success")},e.prototype.createOffer=function(e){var t=this;this.peerConnection=new RTCPeerConnection(e),this.peerConnection.onicecandidate=function(e){t.onIceCandidate(e)},this.peerConnection.onsignalingstatechange=function(e){t.onConnectionStateChange(e)},this.peerConnection.oniceconnectionstatechange=function(e){t.onIceConnectionStateChange(e)};var r=[],o=[];this.localStream&&(this.localStream.getTracks().forEach(function(e){var r;null===(r=t.peerConnection)||void 0===r||r.addTrack(e,t.localStream)}),r=this.localStream.getVideoTracks(),o=this.localStream.getAudioTracks(),r.length>0&&this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" video device: "+r[0].label),o.length>0&&this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" audio device: "+o[0].label));var s={offerToReceiveAudio:o.length>0?1:0,offerToReceiveVideo:r.length>0?1:0};this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" createOffer: "+JSON.stringify(s)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.dataReport.eventStart(this.streamReportSeq,"CreateOffer"),this.peerConnection.createOffer(s).then(function(e){t.dataReport.eventEnd(t.reportSeq,"CreateOffer"),t.dataReport.eventEnd(t.streamReportSeq,"CreateOffer"),t.onCreateOfferSuccess(e)},function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateOffer",{error:e.toString()}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateOffer",{error:e.toString()}),t.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+t.streamId+" create offer error "+e.toString()),t.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCreateOfferError,!0)})},e.prototype.onCreateOfferSuccess=function(e){var t,r=this;0!=this.videoInfo.bitRate&&(e.sdp=this.updateBandwidthRestriction(e.sdp,this.videoInfo.bitRate)),e.sdp=e.sdp.replace(/sendrecv/g,"sendonly"),e.sdp=e.sdp.replace(/useinbandfec=\d+/,(this.videoInfo.audioBitrate?"maxaveragebitrate="+this.videoInfo.audioBitrate:"")+(2===this.videoInfo.channelCount?";stereo=1":"")),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" local sdp revert "+this.localSdpRevert),/m=video[\s\S]*m=audio/.test(e.sdp)&&(this.localSdpRevert=!0),e.sdp=c.SdpUtil.getSDPByVideDecodeType(e.sdp,this.videoCodec),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp1 "+e.sdp.substr(0,e.sdp.length/2)),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp2 "+e.sdp.substr(e.sdp.length/2)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetLocalDescription"),null===(t=this.peerConnection)||void 0===t||t.setLocalDescription(e).then(function(){r.dataReport.eventEnd(r.reportSeq,"SetLocalDescription"),r.dataReport.eventEnd(r.streamReportSeq,"SetLocalDescription"),r.onSetLocalDescriptionSuccess(e)},function(e){r.dataReport.eventEndWithMsg(r.reportSeq,"SetLocalDescription",{error:e.toString()}),r.dataReport.eventEndWithMsg(r.streamReportSeq,"SetLocalDescription",{error:e.toString()}),r.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+r.streamId+" error "+e.toString()),r.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSetLocalDescError,!0)})},e.prototype.updateBandwidthRestriction=function(e,t){var r="AS";return"firefox"===a.browserDetails.browser&&(t=1e3*(t>>>0),r="TIAS"),-1===e.indexOf("b="+r+":")?(e=e.replace(/c=IN (.*)\r\n/g,"c=IN $1\r\nb="+r+":"+t+"\r\n")).replace("b="+r+":"+t+"\r\n",""):(e=e.replace(new RegExp("b="+r+":.*\r\n","g"),"b="+r+":"+t+"\r\n")).replace("b="+r+":"+t+"\r\n","")},e.prototype.onSetLocalDescriptionSuccess=function(e){var t=this;if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" success"),this.isPeer)this.createSession(e);else{var r={sdp:e.sdp,width:this.videoInfo.width,height:this.videoInfo.height,frameRate:this.videoInfo.frameRate,video_min_kpbs:this.videoInfo.bitRate,video_max_kpbs:this.videoInfo.bitRate,audio_kpbs:48,keyframe_intv:2};this.offerSeq=n.getSeq(),this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.offerSeq,this.sessionId,0,r,function(e,o,s){t.offerSeq==e&&t.sessionId==o?(t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" send success"),t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{mediaDescription:{width:r.width,height:r.height,frameRate:r.frameRate,video_min_kpbs:r.video_min_kpbs,video_max_kpbs:r.video_max_kpbs,audio_kpbs:r.audio_kpbs,keyframe_intv:r.keyframe_intv}}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{mediaDescription:{width:r.width,height:r.height,frameRate:r.frameRate,video_min_kpbs:r.video_min_kpbs,video_max_kpbs:r.video_max_kpbs,audio_kpbs:r.audio_kpbs,keyframe_intv:r.keyframe_intv}}),t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" send success stateNego:waiterAnswer"),t.stateNego=n.ENUM_PUBLISH_STATE_NEGO.waiterAnswer,t.state=n.ENUM_PUBLISH_STATE.waitingServerAnswer):t.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" seq or sessionId is not equal")},function(e,r){t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{error:e}),t.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaDescError)}),this.state=n.ENUM_PUBLISH_STATE.waitingOffserRsp,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" call success")}},e.prototype.onRecvMediaDescription=function(e,t,r){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received"),this.state==n.ENUM_PUBLISH_STATE.waitingServerAnswer?(this.stateNego=n.ENUM_PUBLISH_STATE_NEGO.waitingCandidate,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received stateNego:waitingCandidate"),this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(e,this.sessionId,0),1==r.type?this.onGetRemoteOfferSuccess(r.sdp):this.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaDescError)):this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onGetRemoteOfferSuccess=function(e){var t,r,o,s,i,l=this;if(this.videoInfo.audioBitrate&&48e3!==this.videoInfo.audioBitrate&&(e=e.replace(/maxaveragebitrate=(\d+)/,"maxaveragebitrate="+this.videoInfo.audioBitrate)),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+NaN+this.localSdpRevert),/m=video[\s\S]*m=audio/.test(e)&&(this.remoteSdpRevert=!0),this.stateCenter.turnOverTcpOnly&&(null===(o=e.match(/candidate.*/g))||void 0===o||o.forEach(function(t){var r=t.replace(/udp/,"tcp");e=e.replace(t,r)})),this.logger.info("zp.oro.0 "+this.streamId+" sdp revert "+this.localSdpRevert+" "+this.remoteSdpRevert),this.localSdpRevert!==this.remoteSdpRevert){var c=void 0,d=void 0,p=void 0;if(this.remoteSdpRevert){d=(t=[/[\s\S]*m=audio/.exec(e)[0].replace("m=video",""),/m=video[\s\S]*m=audio/.exec(e)[0].replace("m=video",""),/m=audio[\s\S]*/.exec(e)[0]])[1],p=t[2];var g=/a=group:BUNDLE\s+(\w+)\s+(\w+)/.exec(c=t[0]);c=c.replace(/a=group:BUNDLE\s+(\w+)\s+(\w+)/,"a=group:BUNDLE "+g[2]+" "+g[1]),e=c+p+d}else d=(r=[/[\s\S]*m=audio/.exec(e)[0].replace("m=audio",""),/m=video[\s\S]*/.exec(e)[0],/m=audio[\s\S]*m=video/.exec(e)[0].replace("m=video","")])[1],p=r[2],g=/a=group:BUNDLE\s+(\w+)\s+(\w+)/.exec(c=r[0]),c=c.replace(/a=group:BUNDLE\s+(\w+)\s+(\w+)/,"a=group:BUNDLE "+g[2]+" "+g[1]),e=c+d+p;this.localSdpRevert=!1,this.remoteSdpRevert=!1}var m=e.match(/m=video(.|\r|\n)*a=rtpmap(.|\r|\n)*(a=fmtp:(102|96|97).*)/);if("chrome"==a.browserDetails.browser){var _=0;if(this.videoInfo.bitRate&&"target"===this.videoInfo.startBitrate&&(_=this.videoInfo.bitRate),null!==m&&_){var f=m[3];e=-1!==f.indexOf("apt=")?e.replace(f,"a=fmtp:96 x-google-start-bitrate="+_+"\n"+f):e.replace(f,f+";x-google-start-bitrate="+_)}}if(this.videoInfo.bitRate>0){var E=/b=AS.*(\r\n|\n)/.test(e);e=E?e.replace(/AS:(\d+)/,"AS:"+this.videoInfo.bitRate):e.replace(/m=video.*(\r\n|\n)c=.*(\r\n|\n)/,"$&b=AS:"+this.videoInfo.bitRate+"\n");var T=null===(s=this.peerConnection)||void 0===s?void 0:s.getSenders().find(function(e){return e.track&&"video"===e.track.kind});if(T&&T.getParameters&&T.setParameters){var v=T.getParameters();v.encodings||(v.encodings=[{}]),v.encodings[0].maxBitrate=1e3*this.videoInfo.bitRate,T.setParameters(v)}}this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+" remoteSdp:",e);var S={type:"answer",sdp:e,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetRemoteDescription"),null===(i=this.peerConnection)||void 0===i||i.setRemoteDescription(new RTCSessionDescription(S)).then(function(){l.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+l.streamId+" set success"),l.dataReport.eventEnd(l.reportSeq,"SetRemoteDescription"),l.dataReport.eventEnd(l.streamReportSeq,"SetRemoteDescription")},function(e){l.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+l.streamId+" failed: "+e.toString()),l.dataReport.eventEndWithMsg(l.reportSeq,"SetRemoteDescription",{error:e.toString()}),l.dataReport.eventEndWithMsg(l.streamReportSeq,"SetRemoteDescription",{error:e.toString()}),l.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSetRemoteDescError,!0)}),this.state=n.ENUM_PUBLISH_STATE.waitingServerICE,this.logger.debug(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+" call success")},e.prototype.onIceConnectionStateChange=function(e){var t=this;this.state!=n.ENUM_PUBLISH_STATE.stop&&null!=this.peerConnection&&(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateChanged "+this.peerConnection.iceConnectionState),"connected"===this.peerConnection.iceConnectionState?(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" connected state "+this.state),this.dataReport.eventEnd(this.reportSeq,"IceConnected"),this.dataReport.eventEnd(this.streamReportSeq,"IceConnected"),this.stateNego=n.ENUM_PUBLISH_STATE_NEGO.iceConnected,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateNego:iceConnected"),this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.publishEvent?this.publishSuccess():(this.firstGetStatsTimer&&clearTimeout(this.firstGetStatsTimer),this.firstGetStatsTimer=null,this.firstGetStatsTimer=setTimeout(function(){var e;t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" get first stats state "+t.state),t.state!==n.ENUM_PUBLISH_STATE.publishing&&(null===(e=t.peerConnection)||void 0===e||e.getStats().then(function(e){t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" get first stats suc"),e.size>0&&t.publishSuccess()}))},1e3))):"closed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):"failed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):"disconnected"===this.peerConnection.iceConnectionState&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.stateNego=n.ENUM_PUBLISH_STATE_NEGO.iceDisconnected,this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)))},e.prototype.onIceCandidate=function(e){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate"+e.candidate),e.candidate&&(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate"+e.candidate.candidate),this.state<n.ENUM_PUBLISH_STATE.connecting||this.state==n.ENUM_PUBLISH_STATE.stop?this.candidateInfo.push({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex}):this.sendCandidateInfo([{candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex}]))},e.prototype.sendCandidateInfo=function(e){var t=this;this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" called"),!(e=e.filter(function(e){return e.candidate.indexOf("relay")>0}))||e.length<1?this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.dataReport.eventStart(this.streamReportSeq,"SendIceCandidate"),this.stateNego!==n.ENUM_PUBLISH_STATE_NEGO.iceConnected&&(this.stateNego=n.ENUM_PUBLISH_STATE_NEGO.sendCandidate),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" stateNego:sendCandidate"),this.signal.sendCandidateInfo(n.getSeq(),this.sessionId,e,function(e,r,o){t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+t.streamId+" send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate"),t.dataReport.eventEnd(t.streamReportSeq,"SendIceCandidate")},function(e,r){t.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+t.streamId+" failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendIceCandidate",{error:e}),t.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCandidateError)}))},e.prototype.onConnectionStateChange=function(e){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CONNECTION_STATE_CHANGE+" "+this.streamId+" called "+e.target.signalingState)},e.prototype.onRecvCandidateInfo=function(e,t,r){var o,s=this;if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" received "+JSON.stringify(r.infos)),this.state==n.ENUM_PUBLISH_STATE.waitingServerICE){this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.dataReport.addEvent(this.streamReportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(e,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var i=0;i<r.infos.length;i++){var a={sdpMid:r.infos[i].sdpMid,sdpMLineIndex:r.infos[i].sdpMLineIndex,candidate:r.infos[i].candidate};this.logger.debug(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+""+this.streamId+" candidate "+a.candidate),null===(o=this.peerConnection)||void 0===o||o.addIceCandidate(new RTCIceCandidate(a)).then(function(){s.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+s.streamId+" add success")},function(e){s.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+s.streamId+" add error "+e.toString()),s.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCandidateError,!0)})}this.state=n.ENUM_PUBLISH_STATE.connecting,this.dataReport.eventStart(this.reportSeq,"IceConnected"),this.dataReport.eventStart(this.streamReportSeq,"IceConnected")}else this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onRecvCloseSession=function(e,t,r){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CLOSE_SESSION+""+this.streamId+" "+JSON.stringify(r)),this.dataReport.addEvent(this.reportSeq,"RecvCloseSession"),this.signal.sendCloseSessionAck(e,this.sessionId,0);var o=r.err_info?JSON.parse(r.err_info.toLowerCase()):{},s=o.action?o.action:null,i=1*r.reason,n=JSON.parse(JSON.stringify(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError));n.message+=" reason:"+i+" "+(s?" action:"+s:""),1011===o.err&&(n=u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaServerForbidError),this.negoTimer&&clearTimeout(this.negoTimer);var a=![4,8,10,11,12,14,26,27].includes(i)&&![2,5,6].includes(s);this.publishStateUpdateError(n,a)},e.prototype.onRecvResetSession=function(e,t,r){if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_RESET_SESSION+" "+this.streamId+" received "),t==this.sessionId){this.signal.sendCloseSessionAck(e,this.sessionId,0);var o=u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError;this.negoTimer&&clearTimeout(this.negoTimer),this.publishStateUpdateError(o)}else this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_RESET_SESSION+" "+this.streamId+" cannot find session")},e.prototype.onRecvPublishEvent=function(e,t,r){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_PUBLISH_EVENT+" "+this.streamId+" received"),this.publishEvent=!0,this.firstGetStatsTimer&&(clearTimeout(this.firstGetStatsTimer),this.firstGetStatsTimer=null),this.stateNego===n.ENUM_PUBLISH_STATE_NEGO.iceConnected&&0==r.event&&this.publishSuccess()},e.prototype.onRecvClientInfo=function(e,t,r){this.stateCenter.clientIP!==r.clientip&&this.logger.warn(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CLIENT_INFO+" client ip changed "+this.stateCenter.clientIP+" "+r.clientip),this.stateCenter.clientIP=r.clientip,this.peerID=r.peer_id;var o=this.previewer;if(o&&null!==o.activeteSEIConfig){var s=null==o?void 0:o.activeteSEIConfig;this.activateSEIInsert(s.action,s.infoType)}},e.prototype.checkPublishConnectionFailedState=function(e){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" streamID "+this.streamId," state "+this.state+" connectionState "+e),this.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaConnectionError)},e.prototype.setPublishQualityTimer=function(){var e=this;null==this.qualityTimer&&(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_PLAYER_QUALITY_TIMER+" "+this.streamId+" called"),this.clearPublishQualityTimer(),this.qualityTimer=setInterval(function(){e.peerConnectionGetStats()},this.qualityTimeInterval),this.lastPublishStats={audioPacketsLost:0,videoPacketsLost:0,videoPacketsSent:0,audioPacketsSent:0,audioRetransmittedPacketsSent:0,videoTime:(new Date).getTime(),audioTime:(new Date).getTime(),time:0,audioBytesSent:0,videoBytesSent:0,framesEncoded:0,framesSent:0,videoRetransmittedPacketsSent:0},this.qualitySeq=n.getSeq(),this.qualityCount=0)},e.prototype.peerConnectionGetStats=function(e){var t=this;if(this.peerConnection){var r=[this.peerConnection.getStats(null)];"Chrome"==d.ClientUtil.getBrowser()&&r.push(new Promise(function(e,r){var o;null===(o=t.peerConnection)||void 0===o||o.getStats(function(t){return e(t)},function(e){return r(e)})})),Promise.all(r).then(function(r){var o=t.getPublishStats(r[0],r[1]);e&&e(o,r[0],r[1])}).catch(function(e){t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_PLAYER_QUALITY_TIMER+" "+t.streamId+" getStats error "+e.toString())})}},e.prototype.getPublishStats=function(e,t){var r=this;if(e){for(var o,s=document.querySelectorAll("video, audio"),i=0;i<s.length;i++)s[i].srcObject===this.localStream&&(o=s[i]);var l={audioCodec:"opus",audioTargetBitrate:this.videoInfo.audioBitrate/1e3||0,audioBitrate:0,videoTargetBitrate:this.videoInfo.bitRate||0,videoTargetFPS:this.videoInfo.frameRate||0,videoBitrate:0,audioFPS:0,audioLevel:0,audioInputLevel:0,audioPacketsLost:0,audioPacketsLostRate:0,sendLevel:0,samplingRate:0,videoFPS:0,nackCount:0,pliCount:0,audioQuality:0,videoQuality:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoPacketsLost:0,videoPacketsLostRate:0,totalRoundTripTime:0,currentRoundTripTime:0,googBandwidthLimitedResolution:void 0,videoCodecName:"",audioCodecName:"",googCpuLimitedResolution:void 0,googAvailableSendBandwidth:0,googActualEncBitrate:0,googTargetEncBitrate:0,googFrameWidthInput:0,googFrameHeightInput:0,googFrameRateInput:0,codecImplementationName:"",videoMuteState:this.localStream.getVideoTracks().length>0&&this.localStream.getVideoTracks()[0].enabled?"0":"1",audioMuteState:this.localStream.getAudioTracks().length>0&&this.localStream.getAudioTracks()[0].enabled?"0":"1",muted:o?o.muted:void 0,paused:o?o.paused:void 0,volume:o?o.volume:void 0,sinkId:o?o.sinkId:void 0},c=this.lastPublishStats.time,p=0,g=0,m=0,_=0,f=0,E=0;e.forEach(function(e){if(("outbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesSent)&&"audio"==e.mediaType)0!=c&&(l.audioBitrate=8*(e.bytesSent-r.lastPublishStats.audioBytesSent)/(e.timestamp-c),l.audioFPS=(e.packetsSent-(e.retransmittedPacketsSent-r.lastPublishStats.audioRetransmittedPacketsSent)-r.lastPublishStats.audioPacketsSent)/(e.timestamp-c)*1e3,m=(e.retransmittedPacketsSent-r.lastPublishStats.audioRetransmittedPacketsSent)/(e.packetsSent-r.lastPublishStats.audioPacketsSent)),l.audioBitrate<0&&(l.audioBitrate=0),r.lastPublishStats.audioBytesSent=e.bytesSent,r.lastPublishStats.time=e.timestamp,r.lastPublishStats.audioPacketsSentTimeStamp=e.packetsSent-r.lastPublishStats.audioPacketsSent,r.lastPublishStats.audioPacketsSent=e.packetsSent,r.lastPublishStats.audioRetransmittedPacketsSent=e.retransmittedPacketsSent;else if(("outbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesSent)&&"video"==e.mediaType)0!=c&&(l.videoBitrate=8*(e.bytesSent-r.lastPublishStats.videoBytesSent)/(e.timestamp-c),l.videoFPS=1e3*(e.framesEncoded-r.lastPublishStats.framesEncoded)/(e.timestamp-c),_=(e.retransmittedPacketsSent-r.lastPublishStats.videoRetransmittedPacketsSent)/(e.packetsSent-r.lastPublishStats.videoPacketsSent)),l.videoBitrate<0&&(l.videoBitrate=0),l.videoFPS<0&&(l.videoFPS=0),l.nackCount=e.nackCount,l.pliCount=e.pliCount,r.lastPublishStats.videoBytesSent=e.bytesSent,r.lastPublishStats.framesEncoded=e.framesEncoded,r.lastPublishStats.time=e.timestamp,r.lastPublishStats.videoPacketsSentTimeStamp=e.packetsSent-r.lastPublishStats.videoPacketsSent,r.lastPublishStats.videoPacketsSent=e.packetsSent,r.lastPublishStats.videoRetransmittedPacketsSent=e.retransmittedPacketsSent;else if("remote-inbound-rtp"==e.type&&"video"==e.kind){e.packetsLost>0&&(l.videoPacketsLost=e.packetsLost);var t=e.packetsLost-r.lastPublishStats.videoPacketsLost;l.videoPacketsLostRate=t>0?t/r.lastPublishStats.videoPacketsSentTimeStamp:0,e.packetsLost>0&&(r.lastPublishStats.videoPacketsLost=e.packetsLost),r.lastPublishStats.videoTime=e.timestamp,g=1e3*e.roundTripTime,E=e.jitter}else if("remote-inbound-rtp"==e.type&&"audio"==e.kind){e.packetsLost>0&&(l.audioPacketsLost=e.packetsLost);var o=e.packetsLost-r.lastPublishStats.audioPacketsLost;l.audioPacketsLostRate=o>0?o/r.lastPublishStats.audioPacketsSentTimeStamp:0,e.packetsLost>0&&(r.lastPublishStats.audioPacketsLost=e.packetsLost),r.lastPublishStats.audioTime=e.timestamp,p=1e3*e.roundTripTime,f=e.jitter}else if("media-source"==e.type&&("audio"==e.kind||e.id.toLowerCase().indexOf("audio")>=0))l.audioLevel=e.audioLevel,l.sendLevel=e.totalAudioEnergy,l.audioInputLevel=32767*e.totalAudioEnergy,l.samplingRate=e.totalSamplesDuration;else if("track"==e.type&&("video"==e.kind||e.id.indexOf("video")>=0||e.frameWidth)){if(l.frameHeight=e.frameHeight,l.frameWidth=e.frameWidth,0===c||r.lastPublishStats.frameHeight===e.frameHeight&&r.lastPublishStats.frameWidth===e.frameWidth)0===c&&(r.lastPublishStats.frameHeight=e.frameHeight,r.lastPublishStats.frameWidth=e.frameWidth);else{var s=n.getReportSeq();r.dataReport.newReport(s,u.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.event),r.dataReport.addMsgInfo(s,{session_id:u.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.session_id(r.sessionId),w:u.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.w(e.frameWidth),h:u.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.h(e.frameHeight)}),r.dataReport.uploadReport(s),r.lastPublishStats.frameHeight=e.frameHeight,r.lastPublishStats.frameWidth=e.frameWidth}0!=c&&(l.videoTransferFPS=1e3*(e.framesSent-r.lastPublishStats.framesSent)/(e.timestamp-c)),l.videoTransferFPS<0&&(l.videoTransferFPS=0),r.lastPublishStats.framesSent=e.framesSent}else"candidate-pair"==e.type&&(null!=e.totalRoundTripTime&&(l.totalRoundTripTime=e.totalRoundTripTime),null!=e.currentRoundTripTime&&(l.currentRoundTripTime=e.currentRoundTripTime))}),t&&t.result().forEach(function(e){"ssrc"==e.type&&e.names().indexOf("googBandwidthLimitedResolution")>=0&&(l.googBandwidthLimitedResolution=e.stat("googBandwidthLimitedResolution")),"ssrc"==e.type&&"video"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(l.videoCodecName=e.stat("googCodecName")),"ssrc"==e.type&&"audio"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(l.audioCodecName=e.stat("googCodecName")),"ssrc"==e.type&&e.names().indexOf("googCpuLimitedResolution")>=0&&(l.googCpuLimitedResolution=e.stat("googCpuLimitedResolution")),"ssrc"==e.type&&e.names().indexOf("googFrameWidthInput")>=0&&(l.googFrameWidthInput=e.stat("googFrameWidthInput")),"ssrc"==e.type&&e.names().indexOf("googFrameHeightInput")>=0&&(l.googFrameHeightInput=e.stat("googFrameHeightInput")),"ssrc"==e.type&&e.names().indexOf("googFrameRateInput")>=0&&(l.googFrameRateInput=e.stat("googFrameRateInput")),"ssrc"==e.type&&e.names().indexOf("codecImplementationName")>=0&&(l.codecImplementationName=e.stat("codecImplementationName")),"VideoBwe"==e.type&&e.names().indexOf("googAvailableSendBandwidth")>=0&&(l.googAvailableSendBandwidth=e.stat("googAvailableSendBandwidth")),"VideoBwe"==e.type&&e.names().indexOf("googActualEncBitrate")>=0&&(l.googActualEncBitrate=e.stat("googActualEncBitrate")),"VideoBwe"==e.type&&e.names().indexOf("googTargetEncBitrate")>=0&&(l.googTargetEncBitrate=e.stat("googTargetEncBitrate")),"VideoBwe"==e.type&&e.names().indexOf("googRetransmitBitrate")>=0&&(l.googRetransmitBitrate=e.stat("googRetransmitBitrate"))}),"chrome"===a.browserDetails.browser&&this.handleEncBitrate(Number.parseInt(l.googTargetEncBitrate),Number.parseInt(l.googActualEncBitrate),Number.parseInt(l.googRetransmitBitrate)),g=isNaN(g)||g<0?0:g,_=isNaN(_)||_<0?0:_,E=isNaN(E)||E<0?0:E,p=isNaN(p)||p<0?0:p,m=isNaN(m)||m<0?0:m,f=isNaN(f)||f<0?0:f;var T=d.ClientUtil.getNetQuality(g,_,E),v=d.ClientUtil.getNetQuality(p,m,f);l.videoQuality=c>0?d.ClientUtil.quality2QualityGrade(T):0,l.audioQuality=c>0?d.ClientUtil.quality2QualityGrade(v):0;var S=Math.min(T,v);this.netQuality=S,c>0&&S<=n.QUALITY_CONSTANT.MiddleMinQuality&&(new Date).getTime()>this.probeTime+this.probeInterval&&(this.logger.info(h.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" netQuality "+S+" start net probe"),this.probeState=n.ENUM_PROBE_STATE.tryProbe,this.streamCenter.startNetProbe(!0,this,this.gwNodeList),this.probeTime=(new Date).getTime()),0!==c&&this.uploadPublishQuality(l);var R={video:{videoBitrate:l.videoBitrate,videoFPS:l.videoFPS,videoTransferFPS:l.videoTransferFPS,frameHeight:l.frameHeight,frameWidth:l.frameWidth,muteState:l.videoMuteState,videoQuality:l.videoQuality,videoPacketsLost:l.videoPacketsLost,videoPacketsLostRate:l.videoPacketsLostRate},audio:{audioBitrate:l.audioBitrate,audioCodec:l.audioCodec,muteState:l.audioMuteState,audioQuality:l.audioQuality,audioPacketsLost:l.audioPacketsLost,audioPacketsLostRate:l.audioPacketsLostRate,audioFPS:l.audioFPS},nackCount:l.nackCount,pliCount:l.pliCount,totalRoundTripTime:l.totalRoundTripTime,currentRoundTripTime:l.currentRoundTripTime};return void 0!==l.videoPacketsLost&&(R.video.videoPacketsLost=l.videoPacketsLost,R.video.videoPacketsLostRate=l.videoPacketsLostRate,R.audio.audioPacketsLost=l.audioPacketsLost,R.audio.audioPacketsLostRate=l.audioPacketsLostRate),void 0!==l.muted&&(R.muted=l.muted,R.paused=l.paused,R.volume=l.volume,R.sinkId=l.sinkId),void 0!==l.googBandwidthLimitedResolution&&(R.googBandwidthLimitedResolution=l.googBandwidthLimitedResolution,R.video.googCodecName=l.videoCodecName,R.audio.googCodecName=l.audioCodecName,R.googCpuLimitedResolution=l.googCpuLimitedResolution,R.googFrameWidthInput=l.googFrameWidthInput,R.googFrameHeightInput=l.googFrameHeightInput,R.googFrameRateInput=l.googFrameRateInput,R.codecImplementationName=l.codecImplementationName,R.googAvailableSendBandwidth=l.googAvailableSendBandwidth,R.googActualEncBitrate=l.googActualEncBitrate,R.googTargetEncBitrate=l.googTargetEncBitrate),0!==c&&this.onPublishQualityUpdate(this.streamId,R,e,t),R}},e.prototype.uploadPublishQuality=function(e){var t=this;if(this.qualityUpload){var r=Date.parse(new Date+"");(0==this.qualityUploadLastTime||r-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(e.stream_type="publish",e.stream_id=this.streamId,e.timeStamp=r/1e3,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_UPLOAD_PUBLISH_QUALITY+" "+this.streamId+" upload"+JSON.stringify(e)),this.signal.QualityReport(n.getSeq(),this.sessionId,e,function(e,r,o){void 0!==o.report&&(t.qualityUpload=o.report,t.qualityUploadInterval=o.report_interval_ms)},function(e,r){t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_UPLOAD_PUBLISH_QUALITY+" "+t.streamId+" upload failed "+e)}),this.qualityUploadLastTime=r)}},e.prototype.stopPublish=function(){if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_PUBLISH+"  .1 "+this.streamId+" called"),Object.keys(this.streamCenter.publisherList).length=1)for(var e in this.streamCenter.playerList){var t=this.streamCenter.playerList[e].player;t.state==n.ENUM_PLAY_STATE.playing&&t.broadcasterStatus==n.ENUM_BROADCASTER_STATUS.start&&(this.signal&&this.signal.sendBroadcasterStatus(n.getSeq(),t.sessionId,0),t.broadcasterStatus=n.ENUM_BROADCASTER_STATUS.stop)}this.stopMixingAudio(),this.stopMixingBuffer(),this.stopEffect(),this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(n.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.streamReportSeq,"PublishState",{state:this.state+""}),this.dataReport.addEvent(this.streamReportSeq,"StopPublish"),this.dataReport.addMsgExt(this.streamReportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.dataReport.addMsgInfo(this.streamReportSeq,{itemtype:"RTCPublishStream"}),this.dataReport.uploadReport(this.streamReportSeq,"RTCPublishStream"),this.resetPublish()},e.prototype.onPublishStateUpdate=function(e,t,r,o){},e.prototype.onPublishQualityUpdate=function(e,t,r,o){},e.prototype.onDisconnect=function(){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_DISCONNECT+" "+this.streamId+" call"),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_DISCONNECT+" "+this.streamId+" websocket disconnect"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),this.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kWebsocketDisconnectedError)},e.prototype.playEffect=function(e,t,r,o){if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PLAY_EFFECT+""+this.streamId+" call"),this.effectList.find(function(r){return r.effectID==e.effectID&&r.audioBuffer==t}))this.logger.warn(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PLAY_EFFECT+""+this.streamId+" effect alreadly exist ");else{this.streamCenter.soundLevelDelegate&&this.stopSoundLevel();var s=new l.AudioMix(this.logger,this.ac,this.mediaEleSources);s.localStream=this.localStream,s.peerConnection=this.peerConnection,s.audioBuffer=t,this.effectList.push({audioMix:s,effectID:e.effectID,audioBuffer:t}),s.playEffect(e.playTime,e.loop,!1,r,o),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PLAY_EFFECT+""+this.streamId+" play effect "+e.effectID+" success")}},e.prototype.pauseEffect=function(e){var t=this.effectList.find(function(t){return t.effectID==e});if(t)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),t.audioMix.pauseEffect(),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PAUSE_EFFECT+" "+this.streamId+" pause "+e+" success");else{if(void 0!==e)return this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PAUSE_EFFECT+" "+this.streamId+" no effect ID found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach(function(e){return e.audioMix.pauseEffect()}),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!0},e.prototype.resumeEffect=function(e){var t=this.effectList.find(function(t){return t.effectID==e});if(t)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),t.audioMix.resumeEffect(),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_RESUME_EFFECT+" "+this.streamId+" resume"+e+" success");else{if(void 0!==e)return this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_RESUME_EFFECT+" "+this.streamId+" no effect ID found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach(function(e){return e.audioMix.resumeEffect()}),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!1},e.prototype.stopEffect=function(e){var t=this.effectList.find(function(t){return t.effectID==e});if(t)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),t.audioMix.stopMixingAudio(),this.effectList.splice(this.effectList.indexOf(t),1),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_EFFECT+" "+this.streamId+" pause "+e+" success");else{if(void 0!==e)return this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_EFFECT+" "+this.streamId+" no effect ID found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach(function(e){return e.audioMix.stopMixingAudio()}),this.effectList=[],this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!0},e.prototype.setEffectVolume=function(e,t){var r=this.effectList.find(function(e){return e.effectID==t});if(r)r.audioMix.setMixingAudioVolume(e),this.logger.info("zp.sev.0 "+this.streamId+" set volume "+t+" success");else{if(void 0!==t)return this.logger.error("zp.sev.0 "+this.streamId+" no effect ID found"),!1;this.effectList.forEach(function(t){return t.audioMix.setMixingAudioVolume(e)})}return!0},e.prototype.startMixingAudio=function(e){var t=this;return this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_MIXING_AUDIO+" "+this.streamId+" call"),this.localStream?(this.micTrack||(this.micTrack=this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks()[0]:null),e.forEach(function(e){if(t.audioMixList.find(function(t){return t.media==e}))t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_MIXING_AUDIO+" "+t.streamId+" mix audio already exist");else{t.streamCenter.soundLevelDelegate&&t.stopSoundLevel();var r=new l.AudioMix(t.logger,t.ac,t.mediaEleSources);r.localStream=t.localStream,r.peerConnection=t.peerConnection,t.audioMixList.push({audioMix:r,media:e}),r.startMixingAudio(e),t.streamCenter.soundLevelDelegate&&t.startSoundLevel()}}),!0):(this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_MIXING_AUDIO+" localStream not found"),!1)},e.prototype.stopMixingAudio=function(e){var t=this;return this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_MIXING_AUDIO+" "+this.streamId+" call"),e?e.forEach(function(e){for(var r=0;r<t.audioMixList.length;r++)if(t.audioMixList[r].media==e){t.audioMixList[r].audioMix.stopMixingAudio()&&t.audioMixList.splice(r--,1);break}}):(this.audioMixList.forEach(function(e){return e.audioMix.stopMixingAudio()}),this.audioMixList=[]),!0},e.prototype.mixingBuffer=function(e,t,r){var o=this;if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_MIXING_BUFFER+" "+this.streamId+" call"),this.micTrack||(this.micTrack=this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks()[0]:null),this.arrayBufferMap[e])this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap[e].mixingBuffer(t,function(){o.streamCenter.soundLevelDelegate&&o.startSoundLevel(),r&&r()});else{this.streamCenter.soundLevelDelegate&&this.stopSoundLevel();var s=new l.AudioMix(this.logger,this.ac,this.mediaEleSources);s.localStream=this.localStream,s.peerConnection=this.peerConnection,this.arrayBufferMap[e]=s,s.mixingBuffer(t,function(){o.streamCenter.soundLevelDelegate&&o.startSoundLevel(),r&&r()})}},e.prototype.stopMixingBuffer=function(e){if(e&&this.arrayBufferMap[e])return this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap[e].stopMingBuffer(),delete this.arrayBufferMap[e],this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),!0;if(void 0===e){for(var t in this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap)this.arrayBufferMap[t].stopMingBuffer();return this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),!0}return this.logger.warn(h.ZEGO_WEBRTC_ACTION.PUBLISHER_MIXING_BUFFER+" "+this.streamId+" arrayBuffer no found"),!1},e.prototype.setMixingAudioVolume=function(e,t){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_MIXING_AUDIO_VOLUME+" "+this.streamId+" call");var r=this.audioMixList.find(function(e){return e.media===t});return r?(r.audioMix.setMixingAudioVolume(e),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_MIXING_AUDIO_VOLUME+" "+this.streamId+" call success"),!0):(this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_MIXING_AUDIO_VOLUME+" "+this.streamId+" audio is not mixing"),!1)},e.prototype.publishSuccess=function(){for(var e in this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PUBLISH_SUCCESS+" call"),this.state!=n.ENUM_PUBLISH_STATE.publishing&&this.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.start,this.streamId,{code:0,message:""},!0),this.isPeer&&(this.peerFailCount=0),this.state=n.ENUM_PUBLISH_STATE.publishing,this.dataReport.eventStart(this.reportSeq,"PublishState"),this.dataReport.eventStart(this.streamReportSeq,"PublishState"),this.streamCenter.playerList){var t=this.streamCenter.playerList[e].player;t.state==n.ENUM_PLAY_STATE.playing&&t.broadcasterStatus==n.ENUM_BROADCASTER_STATUS.stop&&(this.signal&&this.signal.sendBroadcasterStatus(n.getSeq(),t.sessionId,1),t.broadcasterStatus=n.ENUM_BROADCASTER_STATUS.start)}this.setPublishQualityTimer();var r=2,o=2;0!==this.localStream.getVideoTracks().length&&1==this.localStream.getVideoTracks()[0].enabled&&(r=0),0!==this.localStream.getAudioTracks().length&&1==this.localStream.getAudioTracks()[0].enabled&&(o=0),this.signal.sendStreamStatus(n.getSeq(),this.sessionId,r,o,this.streamId),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PUBLISH_SUCCESS+" call success")},e.prototype.startSoundLevel=function(){var e;if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" call streamID: "+this.streamId),this.localStream&&0!=this.localStream.getAudioTracks().length)try{null===(e=this.previewer)||void 0===e||e.startSoundLevel()}catch(e){this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" "+this.streamId+" get sound level failed "+e)}else this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" "+this.streamId+" local stream no found")},e.prototype.stopSoundLevel=function(){var e;this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_SOUND_LEVEL+" call streamID: "+this.streamId),null===(e=this.previewer)||void 0===e||e.stopSoundLevel()},e.prototype.rebackMic=function(){var e,t=this;if(this.peerConnection&&this.micTrack instanceof MediaStreamTrack&&0==this.audioMixList.length&&0==Object.keys(this.arrayBufferMap).length&&0==this.effectList.length){var r=null===(e=this.peerConnection)||void 0===e?void 0:e.getSenders().find(function(e){var r,o;return(null===(r=e.track)||void 0===r?void 0:r.kind)===(null===(o=t.micTrack)||void 0===o?void 0:o.kind)});r&&(r.replaceTrack(this.micTrack),this.localStream.removeTrack(this.localStream.getAudioTracks()[0]),this.localStream.addTrack(this.micTrack))}},e.prototype.handleEncBitrate=function(e,t,r){var o,s=this,i=1e3*this.videoInfo.bitRate,n=0;if(t>0){this.needIncMax||this.gotMax||(this.probeCount++,t>=.75*e?(this.probeCount>=10&&this.initFitCnt>=.6*this.probeCount&&(this.gotMax=!0,this.targetRate=i),this.initFitCnt++):this.probeCount>=10&&this.initFitCnt/this.probeCount<.3&&(this.needIncMax=!0));var a=d.ClientUtil.arrAvg(this.totalBitrateArray,t,10);this.needIncMax&&(a>=1.05*i?this.targetRate>i&&(this.targetRate-=a>e?a-e:a-i,this.targetRate=Math.max(this.targetRate,i),this.targetRate=Math.min(this.targetRate,2*i),n=this.targetRate):a<.8*i&&(0===this.targetRate&&(this.targetRate=e),this.targetRate=this.targetRate>=i?this.targetRate+.08*i:1.05*this.targetRate,this.targetRate=Math.min(this.targetRate,2*i),n=this.targetRate))}if(r>0&&r<i){var l=d.ClientUtil.arrAvg(this.totalRetransRateArray,r,5);this.needIncMax?l+t>1.05*i&&(this.targetRate-=l+t-i,this.targetRate=Math.max(this.targetRate,i-l),n=this.targetRate):n=this.targetRate-l}else this.targetRate<i&&(this.targetRate=i,n=this.targetRate);if(n>0){n=d.ClientUtil.arrAvg(this.totalTargetRateArray,n,5);var c=null===(o=this.peerConnection)||void 0===o?void 0:o.getSenders().find(function(e){return e.track&&"video"===e.track.kind});if(!c)return;var u=c.getParameters();u.encodings||(u.encodings=[{}]),u.encodings[0].maxBitrate=n,c.setParameters(u).catch(function(e){s.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_HANDLE_ENC_BITRATE+" "+e)})}},e.prototype.resetEncBitrate=function(){this.needIncMax=!1,this.probeCount=0,this.gotMax=!1,this.initFitCnt=0,this.targetRate=0,this.totalBitrateArray=[],this.totalTargetRateArray=[],this.totalRetransRateArray=[]},e}();t.ZegoPublish=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AudioMix=void 0;var o=r(3),s=r(4),i=function(){function e(e,t,r){this.audioBufferList=[],this.loop=!1,this.replace=!1,this.effectEndedCallBack=null,this.effectEndedListener=null,this.startTimes=0,this.startOffset=0,this.pauseTimes=0,this.resumeOffset=0,this.paused=!1,this.isMixAudio=!1,this.isMixingBuffer=!1,this.audioCurrentTimer=null,this.logger=e,this.ac=t,this.mediaEleSources=r}return e.prototype.preloadEffect=function(e,t){var r=this;this.logger.info("amu.pe.0 start preload effect");var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){if(200==o.status||304==o.status){var e=o.response;r.ac.resume(),r.ac.decodeAudioData(e,function(e){r.logger.info("amu.pe.0 effect preload success"),t("",e)},function(e){t(e)})}else t(o.statusText)},o.send()},e.prototype.playEffect=function(e,t,r,o,s){var i=this;!0!==this.isMixAudio?this.audioBuffer?(this.startOffset=e||0,this.loop=t||!1,this.replace=r||!1,this.effectEndedCallBack=s,this.mixEffect(this.audioBuffer,function(){i.buffSource.loop=!!t,e?i.buffSource.start(0,e/1e3):i.buffSource.start(0),i.startTimes=Date.now(),i.effectEndedListener=i.effectEndedHandler.bind(i),i.buffSource.addEventListener("ended",i.effectEndedListener),o&&o()})):this.logger.error("amu.pe.1 no audio buffer found"):this.logger.error("amu.pe.1 audio is mixing")},e.prototype.mixingBuffer=function(e,t){var r=this;!0!==this.isMixAudio||0!=this.audioBufferList.length||0!=this.isMixingBuffer?(this.ac.resume(),this.ac.decodeAudioData(e,function(e){r.audioBufferList.push(e),1==r.audioBufferList.length&&r.playRealTimeEffect(r.audioBufferList[0]),r.isMixingBuffer=!0,t&&t()},function(e){r.logger.error("amu.mb.0 "+e),t&&t({code:s.errorCodeList.PUBLISHER_DECODE_AUDIO_FAIL.code,message:s.errorCodeList.PUBLISHER_DECODE_AUDIO_FAIL.message+" "+e})})):this.logger.error("amu.mb.0 audio is mixing")},e.prototype.stopMingBuffer=function(){return this.isMixingBuffer=!1,this.stopMixingAudio()},e.prototype.playRealTimeEffect=function(e){var t=this;this.mixEffect(e,function(){t.buffSource&&t.buffSource.start(0),t.buffSource&&t.buffSource.addEventListener("ended",function(){t.audioBufferList.shift(),t.audioBufferList.length>0&&t.isMixAudio&&t.playRealTimeEffect(t.audioBufferList[0])})})},e.prototype.pauseEffect=function(){this.audioBufferList.length>0?this.logger.error("amu.pe.0 real time buffer can not be paused"):(this.stopMixingAudio(),this.resumeOffset=(this.pauseTimes-this.startTimes+this.startOffset)%(1e3*this.audioBuffer.duration),this.paused=!0)},e.prototype.resumeEffect=function(){this.audioBufferList.length>0?this.logger.error("amu.pe.0 real time buffer can not be resume"):(this.playEffect(this.resumeOffset,this.loop,this.replace,void 0,this.effectEndedCallBack),this.startOffset=this.resumeOffset,this.paused=!1)},e.prototype.mixEffect=function(e,t){this.localStream?(this.ac.resume(),this.gainNode=this.ac.createGain(),this.buffSource=this.ac.createBufferSource(),this.buffSource.buffer=e,this.buffSource.connect(this.gainNode),this.gainNode.connect(this.ac.destination),this.replaceTrack()&&t()):this.logger.error("amu.me.0 localStream can not be found")},e.prototype.startMixingAudio=function(e,t){if(this.replace=t||!1,this.isMixAudio)return this.logger.error("amu.sma.0 audio is mixing"),!1;if(!this.localStream)return this.logger.error("amu.sma.0 localStream can not be found"),!1;if(e.captureStream=e.captureStream||e.mozCaptureStream||e.webkitCaptureStream,this.ac.resume(),this.gainNode=this.ac.createGain(),"Safari"===o.ClientUtil.getBrowser()){var r=this.mediaEleSources.find(function(t){return t.audio===e});if(r)this.mixAudio=r.node;else{var s=this.ac.createMediaElementSource(e);this.mixAudio=s,this.mediaEleSources.push({audio:e,node:s})}e.currentTime=e.currentTime,this.audioCurrentTimer=setInterval(function(){e.currentTime=e.currentTime+.45},6e3)}else this.mixAudio=this.ac.createMediaStreamSource(e.captureStream());return this.mixAudio.connect(this.gainNode),this.replaceTrack()},e.prototype.replaceTrack=function(){this.streamSource=this.ac.createMediaStreamSource(this.localStream),this.destination=this.ac.createMediaStreamDestination(),!this.replace&&this.streamSource.connect(this.destination),this.gainNode.connect(this.destination);var e=this.destination.stream.getAudioTracks()[0],t=this.peerConnection.getSenders().find(function(t){return t.track.kind===e.kind});return t?(this.micTrack=this.localStream.getAudioTracks()[0],t.replaceTrack(e),this.localStream.removeTrack(this.micTrack),this.localStream.addTrack(e),this.isMixAudio=!0,!0):(this.logger.error("amu.rt.0 no sender"),!1)},e.prototype.stopMixingAudio=function(){var e=this;return this.paused?(this.logger.info("amu.sma.1 audioEffect paused"),!0):this.isMixAudio?this.localStream?(this.peerConnection.getSenders().find(function(t){return t.track.kind===e.micTrack.kind}),this.mixAudio?(this.mixAudio.disconnect(this.gainNode),this.mixAudio=null,this.audioCurrentTimer&&(clearInterval(this.audioCurrentTimer),this.audioCurrentTimer=null)):this.buffSource&&(this.buffSource.removeEventListener("ended",this.effectEndedListener),this.buffSource.stop(),this.pauseTimes=Date.now(),this.buffSource.disconnect(this.gainNode),this.buffSource=null),this.gainNode.disconnect(this.destination),this.isMixAudio=!1,this.audioBufferList=[],!0):(this.logger.error("amu.sma.1 localStream can not be found"),!1):(this.logger.warn("amu.sma.1 no mixing audio found"),!0)},e.prototype.setMixingAudioVolume=function(e){return this.gainNode?(this.gainNode.gain.value=e,!0):(this.logger.error("amu.sma.2 no mixing audio found"),!1)},e.prototype.effectEndedHandler=function(){this.stopMixingAudio(),this.effectEndedCallBack&&this.effectEndedCallBack()},e}();t.AudioMix=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStreamCenter=void 0,t.ZegoStreamCenter=function(){this.publisherList={},this.playerList={}}},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSignal=void 0;var s=r(0),i=r(2),n=function(){function e(e,t){this.sendDataMap={},this.sendDataList=new s.LinkedList,this.sendDataCheckOnceCount=100,this.signalSeq=0,this.pushCallback={},this.sessionInfos={},this.tryHeartbeatCount=0,this.heartbeatInterval=1e4,this.sendDataTimeout=5e3,this.sendDataDropTimeout=1e4,this.sendDataCheckTimer=null,this.sendDataCheckInterval=2e3,this.checkMessageList=["ActivateVideoPlayStreamReq","ActivateAudioPlayStreamReq","CreateSessionReq","CreateSessionWithSdpReq","ActivateSEIInsertReq"],this.tryConnectCount=1,this.tryConnectTimer=null,this.tryConnectInterval=3e3,this.state=s.ENUM_CONNECT_STATE.disconnect,this.tokenType=0,this.browser=this.getBrowserAndVersion(),this.platform=navigator.platform,this.negoInterval=25e3,this.negoTryCount=1,this.negoTryMaxCount=2,this.logger=e,this.stateCenter=t,this.stateCenter.streamConnectTime&&(this.tryConnectInterval=this.stateCenter.streamConnectTime)}return e.prototype.getBrowserAndVersion=function(){var e,t=navigator.userAgent,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(r[1])?{name:"IE",version:(e=/\brv[ :]+([\d\.]+)/g.exec(t)||[])[1]||""}:"Chrome"===r[1]&&null!=(e=t.match(/\bOPR|Edge\/([\d\.]+)/))?{name:"Opera",version:e[1]}:(r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/([\d+\.]+)/i))&&r.splice(1,1,e[1]),{name:r[0],version:r[1]})},e.prototype.setSessionInfo=function(e,t){this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_SET_SESSION_INFO+" call"),this.appid=e+"",this.userid=t},e.prototype.onDisconnect=function(e){},e.prototype.onUpdateHeartBeatInterval=function(e){},e.prototype.resetConnectTimer=function(){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_RESET_CONNECT_TIMER+" call"),clearTimeout(this.tryConnectTimer),this.tryConnectTimer=null,this.tryConnectCount=0},e.prototype.bindWebSocketHandle=function(){var e=this;this.tryHeartbeatCount=0,this.tryConnectInterval=this.stateCenter.streamConnectTime?this.stateCenter.streamConnectTime:3e3,this.websocket.onmessage=function(t){var r=JSON.parse(t.data);e.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" signmsg= ",r.header.cmd),e.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" signmsg= "+JSON.stringify(r)),r.header.appid==e.appid&&r.header.user_id===e.userid?e.handleServerPush(r):e.logger.warn(i.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" check header failed")},this.websocket.onclose=function(t){e.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" close msg = "+JSON.stringify(t.code?t.code:t)),e.state!=s.ENUM_CONNECT_STATE.disconnect&&(e.resetConnectTimer(),e.startConnectTimer(),e.resetCheckMessage())},this.websocket.onerror=function(t){e.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" msg = "+JSON.stringify(t))}},e.prototype.resetCheckMessage=function(){this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_RESET_CHECK_MESSAGE+" call"),clearTimeout(this.sendDataCheckTimer),this.sendDataCheckTimer=null;for(var e=this.sendDataList.getFirst();null!=e;)this.sendDataList.remove(e),e._data.error&&e._data.error(s.SEND_MSG_RESET,e._data.seq),e=this.sendDataList.getFirst();this.sendDataMap={}},e.prototype.handleServerPush=function(e){switch(e.header.cmd){case"LoginRsp":this.handleRespondData("LoginReq",e);break;case"CreateSessionRsp":this.handleRespondData("CreateSessionReq",e),0===e.body.result&&this.addSession(e.header.session_id,e.body.session_token);break;case"CreateSessionWithSdpRsp":this.handleRespondData("CreateSessionWithSdpReq",e),0===e.body.result&&this.addSession(e.header.session_id,e.body.session_token);break;case"MediaDescRsp":this.handleRespondData("MediaDescReq",e);break;case"CandidateInfoRsp":this.handleRespondData("CandidateInfoReq",e);break;case"CloseSessionRsp":this.handleRespondData("CloseSessionReq",e),this.removeSession(e.header.session_id);break;case"ClientHBRsp":this.handleRespondData("ClientHBReq",e);break;case"MediaDescPush":case"CandidateInfoPush":this.handlePushData(e);break;case"CloseSessionPush":this.handlePushData(e),this.removeSession(e.header.session_id);break;case"QualityReportRsp":this.handleRespondData("QualityReportReq",e);break;case"SessionResetPush":this.handlePushResetSessionData(e);break;case"StreamStatusNotifyPush":case"PublishEventPush":case"PlayEventPush":case"ClientInfoPush":this.handlePushData(e);break;case"ActivateVideoPlayStreamRsp":this.handleRespondData("ActivateVideoPlayStreamReq",e);break;case"ActivateAudioPlayStreamRsp":this.handleRespondData("ActivateAudioPlayStreamReq",e);break;case"NetQualityProbeRsp":this.handleRespondData("NetQualityProbeReq",e);break;case"NetQualityInfoPush":this.handlePushData(e);break;case"ActivateSEIInsertRsp":this.handleRespondData("ActivateSEIInsertReq",e)}},e.prototype.disconnectCallback=function(){this.connectCallback&&(this.connectCallback(-1,this.server,void 0),this.connectCallback=null);var e=this.server;this.disconnectServer(),this.onDisconnect(e)},e.prototype.updateToken=function(){var e=this;this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_UPDATE_TOKEN+" call");var t={token:this.token,tokenType:this.tokenType,roomid:this.stateCenter.roomList[0].roomID,anchorname:this.stateCenter.anchor_info.anchor_id,sdkversion:s.PROTO_VERSION,osinfo:navigator.appVersion};if(0!=Object.keys(this.sessionInfos).length){var r=[];for(var o in this.sessionInfos){var n=parseInt(o);r.push({session_id:n,session_token:this.sessionInfos[n].token})}t.sessions=r}this.sendMessageWithCallback("LoginReq",s.getSeq(),0,t,function(t,r,o){if(0==o.result){e.token=o.token,e.tokenType=o.tokenType;var s={report:o.report,report_interval:o.report_interval_ms};o.negoInterval&&(e.negoInterval=o.negoInterval),o.negoTryCount&&(e.negoTryCount=o.negoTryCount),o.negoTryMaxCount&&(e.negoTryMaxCount=o.negoTryMaxCount),null!=e.connectCallback&&(e.connectCallback(0,e.server,s),e.connectCallback=null),e.checkMessageTimeout()}else null!=e.connectCallback&&(e.connectCallback(o.result,e.server,{error:o.strError}),e.connectCallback=null)},function(){null!=e.connectCallback&&(e.connectCallback(-1,e.server,void 0),e.connectCallback=null)})},e.prototype.sendMessageWithCallback=function(e,t,r,o,n,a){if(this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" call "+e),!this.websocket||1!==this.websocket.readyState)return this.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" connect not establish"),void(a&&a(s.SEND_MSG_TIMEOUT,t));var l={header:this.getHeader(e,t,r),body:o};null==n&&(n=null),null==a&&(a=null);var c={seq:t,deleted:!1,cmd:e,time:Date.parse(new Date+""),success:n,error:a},d=this.sendDataList.push(c);this.sendDataMap[c.seq]=d;var u=JSON.stringify(l);this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" "+u),this.websocket.send(u),this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" success")},e.prototype.getHeader=function(e,t,r){return this.globalHeader={version:"1.0.1",cmd:e,appid:this.appid+"",seq:t,user_id:this.userid,session_id:r},this.globalHeader},e.prototype.connectServer=function(e,t,r){var o=this;if(this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" "+t),this.token=e,this.server=t,this.state=s.ENUM_CONNECT_STATE.connecting,this.connectCallback=r,this.websocket&&1===this.websocket.readyState)this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket is connected"),this.resetConnectTimer(),this.state=s.ENUM_CONNECT_STATE.connected;else{this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" need new websocket");try{this.websocket&&(this.logger.warn(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" close error websocket"),this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.websocket=new WebSocket(this.server),this.websocket.onopen=function(){o.resetConnectTimer(),o.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket open call"),o.bindWebSocketHandle(),o.updateToken(),o.state=s.ENUM_CONNECT_STATE.connected},this.websocket.onclose=function(e){o.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket close call  "+JSON.stringify(e))},this.websocket.onerror=function(e){o.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket onerror call  "+JSON.stringify(e))}}catch(e){this.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket error "+e)}}this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" "+this.tryConnectInterval),this.tryConnectTimer=setTimeout(function(){o.startConnectTimer(r)},this.tryConnectInterval)},e.prototype.startConnectTimer=function(e){if(this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" call"),this.tryConnectCount>=s.MAX_TRY_CONNECT_COUNT)return this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" beyond "+this.server+"max limit"),void this.disconnectCallback();this.websocket&&1===this.websocket.readyState?(this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" websocket is connected"),this.resetConnectTimer()):(this.tryConnectCount+=1,this.connectServer(this.token,this.server,e))},e.prototype.disconnectServer=function(){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_DISCONNECT_SERVER+" call"),this.connectCallback=null,this.resetCheckMessage(),this.resetConnectTimer(),this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.token="",this.sessionInfos={},this.tokenType=0,this.tryHeartbeatCount=0,this.tryConnectCount=0,this.state=s.ENUM_CONNECT_STATE.disconnect},e.prototype.isServerConnected=function(){return!(!this.websocket||1!==this.websocket.readyState)},e.prototype.createSession=function(e,t,r,o,n,a,l,c){void 0===n&&(n=""),void 0===a&&(a=""),this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CREATE_SESSION+" call: "+o);var d="";s.PROTO_VERSION.split(".").forEach(function(e,t){return d+=1==e.length&&1==t?"0"+e:e}),this.sendMessageWithCallback("CreateSessionReq",e,0,{type:t,stream_id:o,platform:this.platform,browser:this.browser.name,version:this.browser.version,app_id:this.appid,negotiate_mode:r,strAuthParam:n,sdk_version:1*d,turn_server_host:"string"==typeof a?a:""},l,c)},e.prototype.createSessionWithSdp=function(e,t,r){var o=e.seq,n=e.type,a=e.streamId,l=e.strAuthParam,c=e.sdp,d=e.serverHost,u=e.playBufLevel;this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CREATE_SESSION+" call: "+a);var h="";s.PROTO_VERSION.split(".").forEach(function(e,t){return h+=1==e.length&&1==t?"0"+e:e});var p={type:n,app_id:this.appid,stream_id:a,sdp:c,user_id:this.userid,platform:this.platform,browser:this.browser.name,sdk_vers:parseInt(h),clientIp:"",media_server_host:"string"==typeof d?d:"",strAuthParam:l};u&&(p.min_play_buf_level_ms=u),this.sendMessageWithCallback("CreateSessionWithSdpReq",o,0,p,t,r)},e.prototype.removeSession=function(e){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_REMOVE_SESSION+" call"+e),this.sessionInfos[e]&&delete this.sessionInfos[e]},e.prototype.sendCloseSession=function(e,t,r,o,s){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_REMOVE_SESSION+" call: "+t);var n={reason:r};this.removeSession(t),this.sendMessageWithCallback("CloseSessionReq",e,t,n,o,s)},e.prototype.sendMessage=function(e,t,r,o){if(this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" call "+e),this.websocket&&1===this.websocket.readyState){var s={header:this.getHeader(e,t,r),body:o},n=JSON.stringify(s);this.websocket.send(n),this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" success")}else this.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" connect not establish")},e.prototype.handleRespondData=function(e,t){this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" call");var r=this.sendDataMap[t.header.seq];if(null!=r){var o=r._data;o.cmd!==e?this.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" command is not match"):o.success&&o.success(t.header.seq,t.header.session_id,t.body),delete this.sendDataMap[t.header.seq],this.sendDataList.remove(r)}else{if("CloseSessionRsp"==t.header.cmd)return;this.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" cannot find data "+e)}},e.prototype.addSession=function(e,t){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_ADD_SESSION+" call"+e),this.sessionInfos[e]={token:t}},e.prototype.handlePushData=function(e){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_DATA+" call "+e.header.cmd+" session "+e.header.session_id);var t=this.pushCallback[e.header.cmd+e.header.session_id];t?t.callback&&t.callback(e.header.seq,e.header.session_id,e.body):this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_DATA+" no callbackData "+e.header.cmd+" session: "+e.header.session_id)},e.prototype.handlePushResetSessionData=function(e){this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" call ");var t=[];if(0==e.body.cResetType)t=Object.keys(this.sessionInfos);else if(1==e.body.cResetType)for(var r=0;r<e.body.session_ids.length;r++)t.push(e.body.session_ids[r]);if(this.sendResetSessionAck(e.header.seq,0,0),0!=t.length)for(var o=0;o<t.length;o++){var s=this.pushCallback[e.header.cmd+t[o]];null==s?this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" no callbackData "+t[o]):s.callback&&s.callback(e.header.seq,t[o],e.body)}else this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" no session to callback")},e.prototype.sendMediaDesc=function(e,t,r,o,s,n){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MEDIA_DESC+" call: "+t);var a={type:r,sdp:o.sdp};null!=o.width&&(a.width=o.width),null!=o.height&&(a.height=o.height),null!=o.frameRate&&(a.framerate=o.frameRate),null!=o.video_min_kpbs&&(a.video_min_kpbs=o.video_min_kpbs),null!=o.video_max_kpbs&&(a.video_max_kpbs=o.video_max_kpbs),null!=o.audio_kpbs&&(a.audio_kpbs=o.audio_kpbs),null!=o.keyframe_intv&&(a.keyframe_intv=o.keyframe_intv),null!=o.min_play_buf_level_ms&&(a.min_play_buf_level_ms=o.min_play_buf_level_ms),this.sendMessageWithCallback("MediaDescReq",e,t,a,s,n)},e.prototype.sendCandidateInfo=function(e,t,r,o,s){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CANDIDATE_INFO+" call: "+t);for(var n=[],a=0;a<r.length;a++)n.push({candidate:r[a].candidate,sdpMid:r[a].sdpMid,sdpMLineIndex:r[a].sdpMLineIndex});this.sendMessageWithCallback("CandidateInfoReq",e,t,{infos:n},o,s)},e.prototype.sendMediaDescAck=function(e,t,r){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MEDIA_DESC_ACK+" call: "+t),this.sendMessage("MediaDescAck",e,t,{result:r})},e.prototype.sendCandidateInfoAck=function(e,t,r){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CANDIDATE_INFO_ACK+" call: "+t),this.sendMessage("CandidateInfoAck",e,t,{result:r})},e.prototype.sendCloseSessionAck=function(e,t,r){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CLOSE_SESSION_ACK+" call: "+t),this.sendMessage("CloseSessionAck",e,t,{result:r})},e.prototype.sendResetSessionAck=function(e,t,r){this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_RESET_SESSION_ACK+" call: "+t),this.sendMessage("SessionResetAck",e,t,{result:r})},e.prototype.registerPushCallback=function(e,t,r){r&&"function"==typeof r&&(this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_REGISTER_PUSH_CALLBACK+" set callback "+t),this.pushCallback[e+t]={callback:r})},e.prototype.unregisterPushCallback=function(e,t){delete this.pushCallback[e+t]},e.prototype.checkMessageTimeout=function(){for(var e=this,t=this.sendDataList.getFirst(),r=Date.parse(new Date+""),o=0,n=0,a=0;null!=t&&!(t._data.time+this.sendDataTimeout>r);)if(delete this.sendDataMap[t._data.seq],this.sendDataList.remove(t),++n,-1!=this.checkMessageList.indexOf(t._data.cmd)){if(null==t._data.error||this.sendDataDropTimeout>0&&t._data.time+this.sendDataDropTimeout<r?++a:(this.logger.warn(i.ZEGO_WEBRTC_ACTION.SIGNAL_CHECK_MESSAGE_TIMEOUT+" error cmd = "+t._data.cmd),t._data.error&&t._data.error(s.SEND_MSG_TIMEOUT,t._data.seq)),++o>=this.sendDataCheckOnceCount)break;t=this.sendDataList.getFirst()}else t=this.sendDataList.getFirst();this.sendDataCheckTimer=setTimeout(function(){e.checkMessageTimeout()},this.sendDataCheckInterval),0==n&&0==a||this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CHECK_MESSAGE_TIMEOUT+" call success, state: timeout="+n+" drop="+a)},e.prototype.sendHeartbeat=function(){var e=this;if(this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+"call tryHeartbeatCount:"+this.tryHeartbeatCount),0!=Object.keys(this.sessionInfos).length)if(this.state===s.ENUM_CONNECT_STATE.connected){if(++this.tryHeartbeatCount>s.MAX_TRY_HEARTBEAT_COUNT)return this.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" heartbeat try limit"),void this.disconnectCallback();var t=[];for(var r in this.sessionInfos)t.push(parseInt(r));var o={session_ids:t};this.sendMessageWithCallback("ClientHBReq",s.getSeq(),0,o,function(t,r,o){e.heartbeatInterval!=o.hb_interval&&(e.heartbeatInterval=o.hb_interval,e.onUpdateHeartBeatInterval(o.hb_interval)),e.tryHeartbeatCount=0},function(e,t){})}else this.logger.warn(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" state error");else this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" no need to heartbeat")},e.prototype.QualityReport=function(e,t,r,s,n){this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_QUALITY_REPORT+" call");var a={streams:[o(o({},r),{aid:t})]};this.sendMessageWithCallback("QualityReportReq",e,t,a,s,n)},e.prototype.sendStreamStatus=function(e,t,r,o,s){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_STREAM_STATUS+" call "+t);var n={mic_status:o,camera_status:r};this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_STREAM_STATUS+" stream "+(s||"")+" status "+JSON.stringify(n)),this.sendMessage("StreamStatusNotify",e,t,n)},e.prototype.ActivatePlayVideoStream=function(e,t,r,o,s){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM+" call");var n={active:r?0:1,layer:0};this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM+" activate video "+JSON.stringify(n)),this.sendMessageWithCallback("ActivateVideoPlayStreamReq",e,t,n,o,s)},e.prototype.ActivatePlayAudioStream=function(e,t,r,o,s){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM+" call");var n={active:r?0:1,layer:0};this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM+" activate audio "+JSON.stringify(n)),this.sendMessageWithCallback("ActivateAudioPlayStreamReq",e,t,n,o,s)},e.prototype.sendBroadcasterStatus=function(e,t,r){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_BROADCAST_STATUS+" call "+t),this.sendMessage("BroadcasterStatusNotify",e,t,{status:r})},e.prototype.sendNetProbe=function(e,t,r,o,s){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_NET_PROBE+" call "+t),this.sendMessageWithCallback("NetQualityProbeReq",e,t,{peer_id:r,action:1},o,s)},e.prototype.sendNetQualityInfoPushAck=function(e,t,r,o){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_NET_PROBE+" call "+t),this.sendMessage("NetQualityInfoAck",e,t,{peer_id:r,result:o})},e.prototype.activateSEIInsert=function(e,t,r,o,s,n,a){this.logger.info(i.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" call "+t),this.sendMessageWithCallback("ActivateSEIInsertReq",e,t,{peer_id:r,action:o,info_type:s},n,a)},e}();t.ZegoSignal=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPlayWeb=void 0;var o=r(0),s=r(5),i=r(3),n=r(1),a=r(2),l=function(){function e(e,t,r,s,i,n,a){this.state=o.ENUM_PLAY_STATE.stop,this.candidateInfo=[],this.qualityTimer=null,this.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.stop,this.playQualityList=[],this.maxQualityListCount=10,this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,audioPacketsReceived:0,videoPacketsReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0},this.reportSeq=NaN,this.streamReportSeq=o.getSeq(),this.videoSizeCallback=!1,this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.remoteStream=null,this.playStream=null,this.playOption={},this.closeSessionSignal=!1,this.stateNego=o.ENUM_PLAY_STATE_NEGO.stop,this.negoTimer=null,this.negoInterval=25e3,this.playEvent=!1,this.gotStreamStatus=!1,this.soundLevel=0,this.mic=null,this.script=null,this.beginTime=0,this.firstFrameTime=0,this.resourceMode=0,this.gwNode="",this.gwNodeList=[],this.gwNodeTTL=0,this.isPeer=!1,this.peerFailCount=0,this.isProbe=!1,this.peerID=0,this.netQuality=0,this.probeTime=0,this.probeInterval=6e4,this.probeState=o.ENUM_PROBE_STATE.probed,this.isRecvClientInfo=!1,this.probeTimer=null,this.probeTimeoutInterval=3e4,this.audioMuteState="0",this.videoMuteState="0",this.logger=e,this.signal=t,this.dataReport=r,this.qualityTimeInterval=s,this.streamCenter=i,this.ac=n,this.stateCenter=a,this.dataReport.newReport(this.streamReportSeq),this.dataReport.addMsgInfo(this.streamReportSeq,{abs_time:Date.now()})}return e.prototype.startPlay=function(e,t,r){var o=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" called ",e),this.playEvent=!1,this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),e?(this.streamId=e,this.getRemoteStreamSuc=t,this.playOption=r||{},r&&r.videoCodec&&(this.playOption.videoCodec=r.videoCodec),this.dataReport.addMsgInfo(this.reportSeq,{audio_activate:n.ZegoRTCLogEvent.kZegoTaskPlayStart.audio_activate(1==this.playOption.audio?1:0==this.playOption.audio?0:1),video_activate:n.ZegoRTCLogEvent.kZegoTaskPlayStart.video_activate(1==this.playOption.video?1:0==this.playOption.video?0:1)}),this.isPeer?this.createOffer():this.createSession(),this.negoTimer=setTimeout(function(){o.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" waiting timeout"),o.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNegoTimeoutError)},this.negoInterval),this.isProbe&&(this.probeTimer=setTimeout(function(){o.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" probe timeout"),o.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kProbeTimeOutError)},this.probeTimeoutInterval))):this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" streamId is null")},e.prototype.onCreatePlaySessionSuccess=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" success");var r=[];if(e.turn_server){var o=e.turn_server;this.stateCenter.turnOverTcpOnly&&(o=o.replace("udp","tcp")),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" turn over tcp "+o),r.push(o)}e.stun_server&&r.push(e.stun_server);var s={iceTransportPolicy:"relay",iceServers:[{urls:r,username:e.turn_username,credential:e.turn_auth_key}]};this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" username: "+e.turn_username),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" credential: "+e.turn_auth_key),this.createOffer(s),this.signal.registerPushCallback("MediaDescPush",this.sessionId,function(e,r,o){t.onRecvMediaDesc(e,r,o)}),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,function(e,r,o){t.onRecvCandidateInfo(e,r,o)}),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,function(e,r,o){t.onRecvCloseSession(e,r,o)}),this.signal.registerPushCallback("SessionResetPush",this.sessionId,function(e,r,o){t.onRecvResetSession(e,r,o)}),this.signal.registerPushCallback("StreamStatusNotifyPush",this.sessionId,function(e,r,o){t.gotStreamStatus=!0,t.streamStatus=o,t.playStream&&t.onRecvStreamStatus(o)}),this.signal.registerPushCallback("PlayEventPush",this.sessionId,function(e,r,o){t.onRecvPlayEvent(e,r,o)}),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,function(e,r,o){t.onRecvClientInfo(e,r,o)}),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" call success")},e.prototype.createOffer=function(e){var t=this;this.peerConnection=new RTCPeerConnection(e),this.peerConnection.onicecandidate=function(e){t.onIceCandidate(e)},this.peerConnection.onsignalingstatechange=function(e){t.onConnectionStateChange(e)},this.peerConnection.oniceconnectionstatechange=function(e){t.onIceConnectionStateChange(e)},this.peerConnection.ontrack=function(e){t.onGotRemoteStream(e.streams[0])};var r={offerToReceiveAudio:1,offerToReceiveVideo:1};this.playOption&&!1===this.playOption.video&&(r.offerToReceiveVideo=0),this.playOption&&!1===this.playOption.audio&&(r.offerToReceiveAudio=0),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" createOffer: "+JSON.stringify(r)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.dataReport.eventStart(this.streamReportSeq,"CreateOffer"),this.peerConnection.createOffer(r).then(function(e){t.dataReport.eventEnd(t.reportSeq,"CreateOffer"),t.dataReport.eventEnd(t.streamReportSeq,"CreateOffer"),t.onCreateOfferSuccess(e)},function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateOffer",{error:e.toString()}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateOffer",{error:e.toString()}),t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+t.streamId+" create offer error "+e.toString()),t.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCreateOfferError,!0)})},e.prototype.createSession=function(e){var t=this;this.sessionSeq=o.getSeq();var r=this.streamId;1==this.streamCenter.testEnvironment&&(r="zegotest-"+this.streamCenter.appid+"-"+this.streamId),this.isPeer?(this.dataReport.eventStart(this.reportSeq,"CreateSessionWithSdp"),this.dataReport.eventStart(this.streamReportSeq,"CreateSessionWithSdp"),this.signal.createSessionWithSdp({seq:this.sessionSeq,type:this.isProbe?2:1,mode:0,streamId:r,strAuthParam:this.playOption&&this.playOption.streamParams||"",sdp:e.sdp,serverHost:this.gwNode,playBufLevel:2==this.resourceMode?500:void 0},function(e,r,o){t.handleCreateSessionWithSdpResp(e,r,o)},function(r,s){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:r}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:r}),!t.isProbe&&r==o.SEND_MSG_TIMEOUT&&t.peerFailCount<2?(t.peerFailCount++,t.createSession(e)):!t.isProbe&&r==o.SEND_MSG_TIMEOUT&&t.peerFailCount>=2?(t.isPeer=!1,t.streamCenter.isPeer=!1,t.createSession()):t.playStateUpdateError(r==o.SEND_MSG_TIMEOUT?n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError:n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)})):(this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.dataReport.eventStart(this.streamReportSeq,"CreateSession"),this.signal.createSession(this.sessionSeq,1,0,r,this.playOption&&this.playOption.streamParams,this.gwNode,function(e,r,o){t.handleCreateSessionResp(e,r,o)},function(e,r){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:e}),t.playStateUpdateError(e==o.SEND_MSG_TIMEOUT?n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError:n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)})),this.state=o.ENUM_PLAY_STATE.waitingSessionRsp,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" called success"),this.stateNego=o.ENUM_PLAY_STATE_NEGO.start},e.prototype.handleCreateSessionResp=function(e,t,r){var o=r.turn_server,s=o.split("?")[0]&&o.split("?")[0].slice(5),i=this.streamCenter.server.split("?"),l=i[1]&&i[1].slice(2);this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+s+"/"+l+"/"+this.streamId}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+s+"/"+l+"/"+this.streamId}),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" sessionId:"+r.session_id),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,0!==r.result?(this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" create error"),this.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)):(this.sessionId=r.session_id,this.sessionToken=r.session_token,this.dataReport.addMsgInfo(this.reportSeq,{session_id:n.ZegoRTCLogEvent.kZegoTaskPlayStart.session_id(this.sessionId)}),this.onCreatePlaySessionSuccess(r))):this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" seq is not match.")},e.prototype.handleCreateSessionWithSdpResp=function(e,t,r){var o=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" sessionId:"+t),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSessionWithSdp",{sessionId:t}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSessionWithSdp",{sessionId:t}),0!==r.result?(this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" create session failed "+r.result),this.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)):(this.sessionId=t,this.sessionToken=r.session_token,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" create session success ",this.streamId),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,function(e,t,r){o.onRecvCloseSession(e,t,r)}),this.signal.registerPushCallback("SessionResetPush",this.sessionId,function(e,t,r){o.onRecvResetSession(e,t,r)}),this.signal.registerPushCallback("StreamStatusNotifyPush",this.sessionId,function(e,t,r){o.gotStreamStatus=!0,o.streamStatus=r,o.playStream&&o.onRecvStreamStatus(r)}),this.signal.registerPushCallback("PlayEventPush",this.sessionId,function(e,t,r){o.onRecvPlayEvent(e,t,r)}),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,function(e,t,r){o.onRecvClientInfo(e,t,r)}),this.signal.registerPushCallback("NetQualityProbeRsp",this.sessionId,function(e,t,r){o.onRecvPlayEvent(e,t,r)}),this.signal.registerPushCallback("NetQualityInfoPush",this.sessionId,function(e,t,r){o.onRecvNetQualityInfo(e,t,r)}),this.onGetRemoteOfferSuccess(r.sdp))):this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" seq is not match.")},e.prototype.onCreateOfferSuccess=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp1 "+e.sdp.substr(0,e.sdp.length/2)),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp2 "+e.sdp.substr(e.sdp.length/2)),e.sdp=e.sdp.replace(/sendrecv/g,"recvonly"),e.sdp=e.sdp.replace(/useinbandfec=/,"stereo=1;useinbandfec=");var r=e.sdp.match(/m=video(.|\r|\n)*a=rtpmap(.|\r|\n)*(a=fmtp:(102).*)/);if(null!==r){var o=r[3];e.sdp=e.sdp.replace(o,o+";sps-pps-idr-in-keyframe=1")}this.playOption.videoCodec&&(e.sdp=s.SdpUtil.getSDPByVideDecodeType(e.sdp,this.playOption.videoCodec)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetLocalDescription"),this.peerConnection.setLocalDescription(e).then(function(){t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription"),t.dataReport.eventEnd(t.streamReportSeq,"SetLocalDescription"),t.onSetLocalDescriptionSuccess(e)},function(e){t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+t.streamId+" set error "+e.toString()),t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription",{error:e.toString()}),t.dataReport.eventEnd(t.streamReportSeq,"SetLocalDescription",{error:e.toString()}),t.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSetLocalDescError,!0)})},e.prototype.onSetLocalDescriptionSuccess=function(e){var t=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" success"),this.isPeer)this.createSession(e);else{var r={sdp:e.sdp};2==this.resourceMode&&(r.min_play_buf_level_ms=500),this.answerSeq=o.getSeq(),this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.answerSeq,this.sessionId,0,r,function(e,r,s){t.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" sendMediaDesc resp"),t.answerSeq==e&&t.sessionId==r?(t.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" send success stateNego:waiterAnswer"),t.stateNego=o.ENUM_PLAY_STATE_NEGO.waiterAnswer,t.dataReport.eventEnd(t.reportSeq,"SendMediaDesc"),t.dataReport.eventEnd(t.streamReportSeq,"SendMediaDesc"),t.state=o.ENUM_PLAY_STATE.waitingServerAnswer):t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" seq or sessionId is not equal "+t.answerSeq+" "+e,0+t.sessionId+" "+r)},function(e,r){t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" failed to send "+e),t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{error:e}),t.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kMediaDescError)}),this.state=o.ENUM_PLAY_STATE.waitingOffserRsp}},e.prototype.onRecvMediaDesc=function(e,t,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received ",r),this.stateNego=o.ENUM_PLAY_STATE_NEGO.waitingCandidate,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received stateNego:waitingCandidate"),this.state===o.ENUM_PLAY_STATE.waitingServerAnswer?(this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(e,this.sessionId,0),this.onGetRemoteOfferSuccess(r.sdp)):this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onGetRemoteOfferSuccess=function(e){var t,r=this,s={type:"answer",sdp:e,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetRemoteDescription"),this.stateCenter.turnOverTcpOnly&&(null===(t=s.sdp.match(/candidate.*/g))||void 0===t||t.forEach(function(e){var t=e.replace(/udp/,"tcp");s.sdp=s.sdp.replace(e,t)})),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" remoteSdp ",s.sdp),this.peerConnection.setRemoteDescription(new RTCSessionDescription(s)).then(function(){r.dataReport.eventEnd(r.reportSeq,"SetRemoteDescription"),r.dataReport.eventEnd(r.streamReportSeq,"SetRemoteDescription"),r.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+r.streamId+" set success")},function(e){r.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+r.streamId+" set remote error "+e.toString()),r.dataReport.eventEndWithMsg(r.reportSeq,"SetRemoteDescription",{error:e.toString()}),r.dataReport.eventEndWithMsg(r.streamReportSeq,"SetRemoteDescription",{error:e.toString()}),r.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSetRemoteDescError,!0)}),this.state=o.ENUM_PLAY_STATE.waitingServerICE,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" call success")},e.prototype.onRecvCandidateInfo=function(e,t,r){var s=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" received "),this.state==o.ENUM_PLAY_STATE.waitingServerICE){this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.dataReport.addEvent(this.streamReportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(e,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var i=0;i<r.infos.length;i++){var l={sdpMid:r.infos[i].sdpMid,sdpMLineIndex:r.infos[i].sdpMLineIndex,candidate:r.infos[i].candidate};this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" candidate "+l.candidate),this.peerConnection.addIceCandidate(new RTCIceCandidate(l)).then(function(){s.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+s.streamId+" add success")},function(e){s.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+s.streamId+" add error "+e.toString()),s.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCandidateError,!0)})}this.state=o.ENUM_PLAY_STATE.connecting,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" call success")}else this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onRecvPlayEvent=function(e,t,r){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_PLAY_EVENT+" "+this.streamId+" received"),!0===this.playEvent&&0==r.event){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_PLAY_EVENT+" "+this.streamId+" retry: "+this.streamId);var s=this.streamId,i=this.playOption;this.signal.sendCloseSession(o.getSeq(),this.sessionId,1),this.resetPlay(),this.startPlay(s,this.getRemoteStreamSuc,i)}else this.playEvent=!0},e.prototype.onRecvClientInfo=function(e,t,r){this.stateCenter.clientIP!==r.clientip&&this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CLIENT_INFO+" client ip changed "+this.stateCenter.clientIP+" "+r.clientip),this.stateCenter.clientIP=r.clientip,this.peerID=r.peer_id,this.isProbe&&this.stateNego==o.ENUM_PLAY_STATE_NEGO.iceConnected&&this.signal.sendNetProbe(o.getSeq(),this.sessionId,this.peerID,function(){},function(){}),this.isRecvClientInfo=!0},e.prototype.onRecvNetQualityInfo=function(e,t,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_NET_QUALITY_INFO+" call"),this.probeTimer&&(clearTimeout(this.probeTimer),this.probeTimer=null);var s=0,n=r.lossrate,l=r.rtt;this.peerID===r.peer_id&&null!=typeof n&&null!=typeof l||(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_NET_QUALITY_INFO+" local peerID:"+this.peerID+" remote peerID:"+r.peer_id+" lossrate:"+n+" rtt:"+l),s=1),this.signal.sendNetQualityInfoPushAck(o.getSeq(),this.sessionId,this.peerID,s),0==s&&"number"==typeof n&&"number"==typeof l?this.onCalNetQualityResult(0,i.ClientUtil.getNetQuality(l,n)):this.onCalNetQualityResult(1)},e.prototype.onIceCandidate=function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" called"),null!=e.candidate&&(this.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate "+e.candidate.candidate),this.state<o.ENUM_PLAY_STATE.connecting||this.state==o.ENUM_PLAY_STATE.stop?(this.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" cached"),this.candidateInfo.push({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex})):(this.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" send"),this.sendCandidateInfo([{candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex}])))},e.prototype.onConnectionStateChange=function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CONNECTION_STATE_CHANGE+" "+this.streamId+" called "+e.target.signalingState)},e.prototype.onIceConnectionStateChange=function(e){if(this.state!=o.ENUM_PLAY_STATE.stop&&null!=this.peerConnection)if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateChanged "+this.peerConnection.iceConnectionState),"connected"===this.peerConnection.iceConnectionState){if(this.stateNego=o.ENUM_PLAY_STATE_NEGO.iceConnected,this.isProbe&&this.isPeer&&this.isRecvClientInfo)return this.signal.sendNetProbe(o.getSeq(),this.sessionId,this.peerID,function(){},function(){}),void(this.negoTimer&&clearTimeout(this.negoTimer));for(var t in this.negoTimer&&clearTimeout(this.negoTimer),this.dataReport.addEvent(this.reportSeq,"IceConnected"),this.dataReport.addEvent(this.streamReportSeq,"IceConnected"),this.state!=o.ENUM_PLAY_STATE.playing&&this.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.start,this.streamId,{code:0,message:""},!0),this.state=o.ENUM_PLAY_STATE.playing,this.dataReport.eventStart(this.reportSeq,"PlayState"),this.dataReport.eventStart(this.streamReportSeq,"PlayState"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[t].publisher.state==o.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.stop){this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),this.sessionId,1),this.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.start;break}if(!this.isProbe&&this.setPlayQualityTimer(),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateNego:iceConnected"),this.isPeer&&(this.peerFailCount=0),0==this.firstFrameTime){this.firstFrameTime=(new Date).getTime()-this.beginTime;var r=o.getReportSeq();this.dataReport.newReport(r,n.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.event),this.dataReport.addMsgInfo(r,{session_id:n.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.session_id(this.sessionId),fft_consumed:n.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.fft_consumed(this.firstFrameTime)}),this.dataReport.uploadReport(r)}}else"closed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):"failed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):"disconnected"===this.peerConnection.iceConnectionState&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.stateNego=o.ENUM_PLAY_STATE_NEGO.iceDisconnected,this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState))},e.prototype.checkPlayConnectionFailedState=function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+"  state "+this.state+" connectionState "+e),this.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kMediaConnectionError)},e.prototype.clearPlayQualityTimer=function(){null!=this.qualityTimer&&(clearInterval(this.qualityTimer),this.qualityTimer=null),this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,videoPacketsReceived:0,audioPacketsReceived:0,framesDecoded:0,framesDropped:0,framesReceived:0,audioBitrate:0}},e.prototype.resetPlay=function(){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_RESET_PLAY+" "+this.streamId+" call"),this.state=o.ENUM_PLAY_STATE.stop,this.playEvent=!1,this.isRecvClientInfo=!1,null!=this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.probeTimer&&(clearTimeout(this.probeTimer),this.probeTimer=null),this.clearPlayQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId),this.signal.unregisterPushCallback("SessionResetPush",this.sessionId),this.signal.unregisterPushCallback("PublishEventPush",this.sessionId),this.signal.unregisterPushCallback("ClientInfoPush",this.sessionId),this.signal.unregisterPushCallback("NetQualityProbeRsp",this.sessionId),this.signal.unregisterPushCallback("NetQualityInfoPush",this.sessionId)),this.sessionSeq=0,this.answerSeq=0,this.videoSizeCallback=!1,this.stopSoundLevel()},e.prototype.setPlayQualityTimer=function(){var e=this;null==this.qualityTimer&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" "+this.streamId+" startTimer"),this.clearPlayQualityTimer(),this.qualityTimer=setInterval(function(){if(e.peerConnection){var t=[e.peerConnection.getStats(null)];"Chrome"==i.ClientUtil.getBrowser()&&t.push(new Promise(function(t,r){e.peerConnection.getStats(function(e){return t(e)},function(e){return r(e)})})),Promise.all(t).then(function(t){e.getPlayStats(t[0],t[1])}).catch(function(t){e.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" "+e.streamId+" getStats error "+t.toString())})}},this.qualityTimeInterval),this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,videoPacketsReceived:0,audioPacketsReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0})},e.prototype.getPlayStats=function(e,t){var r=this;if(null!=e){for(var s,l=document.querySelectorAll("video, audio"),c=0;c<l.length;c++)l[c].srcObject===this.playStream&&(s=l[c]);var d={audioFractionLost:0,audioPacketsLost:0,audioPacketsLostRate:0,audioBitrate:0,audioLevel:0,audioSendLevel:0,audioSamplingRate:0,audioCodec:"opus",audioQuality:0,audioFPS:0,videoQuality:0,videoPacketsLost:0,videoPacketsLostRate:0,videoBitrate:0,videoFPS:0,playData:0,nackCount:0,pliCount:0,audioJitter:0,videoFractionLost:0,videoFramesDecoded:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoFramesDropped:0,totalRoundTripTime:0,currentRoundTripTime:0,googBandwidthLimitedResolution:void 0,videoCodecName:"",audioCodecName:"",googCpuLimitedResolution:void 0,googAvailableSendBandwidth:0,audioMuteState:this.audioMuteState,videoMuteState:this.videoMuteState,muted:s?s.muted:void 0,paused:s?s.paused:void 0,volume:s?s.volume:void 0,sinkId:s?s.sinkId:void 0},u=this.lastPlayStats.time,h=0,p=0,g=0,m=0,_=0;e.forEach(function(e){if(("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("audio"==e.mediaType||e.id.indexOf("AudioStream")>=0)){0!=u&&(d.audioBitrate=8*(e.bytesReceived-r.lastPlayStats.audioBytesReceived)/(e.timestamp-u),(s=e.packetsLost-r.lastPlayStats.audioPacketsLost)>0&&(p=s/(s+e.packetsReceived-r.lastPlayStats.audioPacketsReceived))),d.audioBitrate<0&&(d.audioBitrate=0),d.audioJitter=e.jitter,e.packetsLost>0&&(d.audioPacketsLost=e.packetsLost),d.audioFractionLost=e.fractionLost;var t=e.packetsLost-r.lastPlayStats.audioPacketsLost;d.audioFPS=(e.packetsReceived-r.lastPlayStats.audioPacketsReceived)/(e.timestamp-u)*1e3,d.audioPacketsLostRate=t>0?t/(e.packetsReceived-r.lastPlayStats.audioPacketsReceived+t):0,r.lastPlayStats.audioBytesReceived=e.bytesReceived,e.packetsLost>0&&(r.lastPlayStats.audioPacketsLost=e.packetsLost),r.lastPlayStats.audioPacketsReceived=e.packetsReceived,r.lastPlayStats.audioTime=e.timestamp,r.lastPlayStats.time=e.timestamp,r.lastPlayStats.audioBitrate=d.audioBitrate,m=e.jitter}else if(("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("video"==e.mediaType||e.id.indexOf("VideoStream")>=0)){var s;0!=u&&(d.videoBitrate=8*(e.bytesReceived-r.lastPlayStats.videoBytesReceived)/(e.timestamp-u),d.videoFPS=1e3*(e.framesDecoded-r.lastPlayStats.framesDecoded)/(e.timestamp-u),(s=e.packetsLost-r.lastPlayStats.videoPacketsLost)>0&&(g=s/(s+e.packetsReceived-r.lastPlayStats.videoPacketsReceived))),d.videoBitrate<0&&(d.videoBitrate=0),d.videoFPS<0&&(d.videoFPS=0),d.nackCount=e.nackCount,d.pliCount=e.pliCount,d.videoFractionLost=e.fractionLost,d.videoFramesDecoded=e.framesDecoded,e.packetsLost>0&&(d.videoPacketsLost=e.packetsLost),d.videoPacketsLostRate=(t=e.packetsLost-r.lastPlayStats.videoPacketsLost)>0?t/(e.packetsReceived-r.lastPlayStats.videoPacketsReceived+t):0,r.lastPlayStats.videoBytesReceived=e.bytesReceived,r.lastPlayStats.framesDecoded=e.framesDecoded,e.packetsLost>0&&(r.lastPlayStats.videoPacketsLost=e.packetsLost),r.lastPlayStats.videoPacketsReceived=e.packetsReceived,r.lastPlayStats.videoTime=e.timestamp,r.lastPlayStats.time=e.timestamp,_=e.jitter}else if("track"==e.type&&("video"==e.kind||e.id.indexOf("video")>=0)||e.frameWidth){if(d.frameHeight=e.frameHeight,d.frameWidth=e.frameWidth,0===u||r.lastPlayStats.frameHeight===e.frameHeight&&r.lastPlayStats.frameWidth===e.frameWidth)0===u&&(r.lastPlayStats.frameHeight=e.frameHeight,r.lastPlayStats.frameWidth=e.frameWidth);else{var i=o.getReportSeq();r.dataReport.newReport(i,n.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.event),r.dataReport.addMsgInfo(i,{session_id:n.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.session_id(r.sessionId),w:n.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.w(e.frameWidth),h:n.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.h(e.frameHeight)}),r.dataReport.uploadReport(i),r.lastPlayStats.frameHeight=e.frameHeight,r.lastPlayStats.frameWidth=e.frameWidth}0!=u&&(d.videoTransferFPS=1e3*(e.framesReceived-r.lastPlayStats.framesReceived)/(e.timestamp-u),d.videoFramesDropped=e.framesDropped-r.lastPlayStats.framesDropped),d.videoTransferFPS<0&&(d.videoTransferFPS=0),d.videoFramesDropped<0&&(d.videoFramesDropped=0),r.lastPlayStats.framesReceived=e.framesReceived,r.lastPlayStats.framesDropped=e.framesDropped}else"track"==e.type&&("audio"==e.kind||e.id.indexOf("audio")>=0)?(d.audioLevel=e.audioLevel,d.audioSendLevel=e.totalAudioEnergy,d.audioSamplingRate=e.totalSamplesDuration):"candidate-pair"==e.type&&(null!=e.totalRoundTripTime&&(d.totalRoundTripTime=e.totalRoundTripTime),null!=e.currentRoundTripTime&&(d.currentRoundTripTime=e.currentRoundTripTime,h=1e3*d.currentRoundTripTime))}),t&&t.result().forEach(function(e){"ssrc"==e.type&&e.names().indexOf("googBandwidthLimitedResolution")>=0&&(d.googBandwidthLimitedResolution=e.stat("googBandwidthLimitedResolution")),"ssrc"==e.type&&e.names().indexOf("codecImplementationName")>=0&&(d.codecImplementationName=e.stat("codecImplementationName")),"ssrc"==e.type&&"video"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(d.videoCodecName=e.stat("googCodecName")),"ssrc"==e.type&&"audio"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(d.audioCodecName=e.stat("googCodecName")),"ssrc"==e.type&&e.names().indexOf("googCpuLimitedResolution")>=0&&(d.googCpuLimitedResolution=e.stat("googCpuLimitedResolution")),"VideoBwe"==e.type&&e.names().indexOf("googAvailableSendBandwidth")>=0&&(d.googAvailableSendBandwidth=e.stat("googAvailableSendBandwidth"))}),g=isNaN(g)||g<0?0:g,_=isNaN(_)||_<0?0:_,p=isNaN(p)||p<0?0:p,m=isNaN(m)||m<0?0:m;var f=i.ClientUtil.getNetQuality(h,g,_),E=i.ClientUtil.getNetQuality(h,p,m);d.audioQuality=u>0?i.ClientUtil.quality2QualityGrade(f):0,d.videoQuality=u>0?i.ClientUtil.quality2QualityGrade(E):0;var T=Math.min(f,E);this.netQuality=T,u>0&&T<=o.QUALITY_CONSTANT.MiddleMinQuality&&(new Date).getTime()>this.probeTime+this.probeInterval&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" netQuality "+T+" start net probe"),this.probeState=o.ENUM_PROBE_STATE.tryProbe,this.streamCenter.startNetProbe(!1,this,this.gwNodeList),this.probeTime=(new Date).getTime()),this.uploadPlayQuality(d);var v={video:{videoBitrate:d.videoBitrate,videoFPS:d.videoFPS,videoTransferFPS:d.videoTransferFPS,videoFramesDecoded:d.videoFramesDecoded,videoFramesDropped:d.videoFramesDropped,videoPacketsLost:d.videoPacketsLost,videoPacketsLostRate:d.videoPacketsLostRate,videoQuality:d.videoQuality,frameHeight:d.frameHeight,frameWidth:d.frameWidth,muteState:d.videoMuteState},audio:{audioBitrate:d.audioBitrate,audioCodec:d.audioCodec,audioJitter:d.audioJitter,audioLevel:d.audioLevel,audioPacketsLost:d.audioPacketsLost,audioPacketsLostRate:d.audioPacketsLostRate,audioQuality:d.audioQuality,audioSamplingRate:d.audioSamplingRate,audioSendLevel:d.audioSendLevel,muteState:d.audioMuteState,audioFPS:d.audioFPS},nackCount:d.nackCount,pliCount:d.pliCount,totalRoundTripTime:d.totalRoundTripTime,playData:d.playData,currentRoundTripTime:d.currentRoundTripTime};void 0!==d.muted&&(v.muted=d.muted,v.paused=d.paused,v.volume=d.volume,v.sinkId=d.sinkId),void 0!==d.videoCodecName&&(v.video.googCodecName=d.videoCodecName,v.audio.googCodecName=d.audioCodecName,v.codecImplementationName=d.codecImplementationName,v.googAvailableSendBandwidth=d.googAvailableSendBandwidth),0!=u&&this.onPlayQualityUpdate(this.streamId,v)}},e.prototype.uploadPlayQuality=function(e){var t=this;if(this.qualityUpload){var r=Date.parse(new Date+"");(0==this.qualityUploadLastTime||r-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(e.stream_type="play",e.stream_id=this.streamId,e.timeStamp=r/1e3,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_UPLOAD_PLAYER_QUALITY+" "+this.streamId+" upload"+JSON.stringify(e)),this.signal.QualityReport(o.getSeq(),this.sessionId,e,function(e,r,o){void 0!==o.report&&(t.qualityUpload=o.report,t.qualityUploadInterval=o.report_interval_ms)},function(e,r){t.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_UPLOAD_PLAYER_QUALITY+" "+t.streamId+" upload failed "+e)}),this.qualityUploadLastTime=r)}},e.prototype.onRecvResetSession=function(e,t,r){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_RESET_SESSION+" "+this.streamId+" received "),t==this.sessionId){this.signal.sendCloseSessionAck(e,this.sessionId,0);var o=JSON.parse(JSON.stringify(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError));this.negoTimer&&clearTimeout(this.negoTimer),this.playStateUpdateError(o)}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_RESET_SESSION+" "+this.streamId+" cannot find session")},e.prototype.onRecvCloseSession=function(e,t,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CLOSE_SESSION+" "+this.streamId+" "+JSON.stringify(r)),this.signal.sendCloseSessionAck(e,this.sessionId,0);var o=r.err_info?JSON.parse(r.err_info.toLowerCase()):{},s=o.action?o.action:null,i=1*r.reason,l=JSON.parse(JSON.stringify(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError));l.message+=" reason:"+i+" "+(s?" action:"+s:""),this.negoTimer&&clearTimeout(this.negoTimer);var c=![4,8,10,11,12,14,24,26,27,28].includes(i)&&![2,5,6].includes(s);this.playStateUpdateError(l,c)},e.prototype.onRecvStreamStatus=function(e){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" call"),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" status camera_status: "+e.camera_status+" mic_status: "+e.mic_status),this.cameraStatus!==e.camera_status&&this.onRemoteCameraStatusUpdate(this.streamId,this.getCameraMicStatus(e.camera_status),e.camera_status),this.micStatus!==e.mic_status&&this.onRemoteMicStatusUpdate(this.streamId,this.getCameraMicStatus(e.mic_status),e.mic_status),this.cameraStatus=e.camera_status,this.micStatus=e.mic_status,"boolean"!=typeof this.playOption.video&&"boolean"!=typeof this.playOption.audio){var t=this.playStream;if(0!==e.camera_status?t.getVideoTracks().forEach(function(e){e.enabled=!1,e.stop(),t.removeTrack(e)}):0===t.getVideoTracks().length&&t.addTrack(this.remoteStream.clone().getVideoTracks()[0]),this.videoMuteState=0!==e.camera_status?"1":"0",this.audioMuteState=0!==e.mic_status?"1":"0","Safari"===i.ClientUtil.getBrowser())for(var r=document.querySelectorAll("video, audio"),o=0;o<r.length;o++)r[o].srcObject===this.playStream&&(r[o].srcObject=this.playStream);this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" call success")}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" has set playType, ignore stream status")},e.prototype.onGotRemoteStream=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_GOT_REMOTE_STREAM+" "+this.streamId+" called "+e),e?(this.playStream?(this.playStream.getTracks().forEach(function(e){return t.playStream.removeTrack(e)}),e.clone().getTracks().forEach(function(e){return t.playStream.addTrack(e)})):this.playStream=e.clone(),this.audioMuteState=this.playStream.getAudioTracks().length>0?"0":"1",this.videoMuteState=this.playStream.getVideoTracks().length>0?"0":"1",this.remoteStream=e,this.getRemoteStreamSuc(this.playStream),this.gotStreamStatus&&this.onRecvStreamStatus(this.streamStatus),this.dataReport.addEvent(this.reportSeq,"GetRemoteStream"),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()):this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_GOT_REMOTE_STREAM+" "+this.streamId+" remote stream is empty")},e.prototype.sendCandidateInfo=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" called"),!(e=e.filter(function(e){return!(e.candidate.indexOf("tcp")>0)&&(!!e.candidate||void 0)}))||e.length<1?this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.dataReport.eventStart(this.streamReportSeq,"SendIceCandidate"),this.stateNego!==o.ENUM_PLAY_STATE_NEGO.iceConnected&&(this.stateNego=o.ENUM_PLAY_STATE_NEGO.sendCandidate),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" stateNego:sendCandidate"),this.signal.sendCandidateInfo(o.getSeq(),this.sessionId,e,function(e,r,o){t.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+t.streamId+" send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate"),t.dataReport.eventEnd(t.streamReportSeq,"SendIceCandidate")},function(e,r){t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+t.streamId+" failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendIceCandidate",{error:e}),t.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCandidateError)}))},e.prototype.shouldSendCloseSession=function(){return this.state!=o.ENUM_PLAY_STATE_UPDATE.stop&&this.state!=o.ENUM_PLAY_STATE.waitingSessionRsp},e.prototype.playStateUpdateError=function(e,t){this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_STATE_ERROR+" call ",this.streamId,JSON.stringify(e)),this.isProbe?this.onCalNetQualityResult(1):this.streamId&&this.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.error,this.streamId,e,t),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_STATE_ERROR+" "+this.streamId+" ended")},e.prototype.getCameraMicStatus=function(e){return 0==e?"OPEN":"MUTE"},e.prototype.onPlayStateUpdate=function(e,t,r,o){},e.prototype.onPlayQualityUpdate=function(e,t){},e.prototype.onRemoteCameraStatusUpdate=function(e,t,r){},e.prototype.onRemoteMicStatusUpdate=function(e,t,r){},e.prototype.stopPlay=function(){for(var e in this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_STOP_PLAY+" "+this.streamId+" called"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[e].publisher.state==o.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.start){this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),this.sessionId,0),this.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.stop;break}this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(o.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.streamReportSeq,"PlayState",{state:this.state+""}),this.dataReport.addEvent(this.streamReportSeq,"StopPlay"),this.dataReport.addMsgExt(this.streamReportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.dataReport.addMsgInfo(this.streamReportSeq,{itemtype:"RTCPlayStream"}),this.dataReport.uploadReport(this.streamReportSeq,"RTCPlayStream"),this.resetPlay()},e.prototype.onDisconnect=function(){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_DISCONNECT+" "+this.streamId+" call"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),this.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kWebsocketDisconnectedError)},e.prototype.startSoundLevel=function(){var e=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" call streamID: "+this.streamId),!this.isProbe)if(this.remoteStream&&0!=this.remoteStream.getAudioTracks().length){this.script&&this.script.disconnect()&&(this.script=null),this.mic&&this.mic.disconnect()&&(this.mic=null);try{this.mic=this.ac.createMediaStreamSource(this.remoteStream),this.script=this.ac.createScriptProcessor(4096,1,1),this.mic.connect(this.script),this.script.connect(this.ac.destination),this.script.onaudioprocess=function(t){for(var r=t.inputBuffer.getChannelData(0),o=0,s=0;s<r.length;s++)o<r[s]&&(o=r[s]);e.soundLevel=100*o},this.ac.resume()}catch(e){this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" get sound level failed "+e)}}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" "+this.streamId+" remote stream no found")},e.prototype.stopSoundLevel=function(){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_STOP_SOUND_LEVEL+" call streamID: "+this.streamId),this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect(),this.script=null,this.mic=null},e.prototype.onCalNetQualityResult=function(e,t){},e}();t.ZegoPlayWeb=l},function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryStreamHandler=void 0;var i=r(0),n=r(9),a=r(1),l=r(2),c=r(3),d=function(e){function t(t,r,o,s){var i=e.call(this)||this;return i.logger=t,i.stateCenter=r,i.streamCenter=o,i.isPublish=s,i.serverUrls=[],i}return s(t,e),t.prototype.initStream=function(e,t){this.streamID=e,this.serverUrls=t},t.prototype.activePublish=function(e){var t=this;if(this.logger.info("zc.tsh.a retry call "+this.streamID),this.stateCenter.networkState==i.ENUM_NETWORK_STATE.offline)return this.logger.info("zc.tsh.a network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info("zc.tsh.a has active, ignore"),!1;if(this.isOverTime)return this.logger.warn("zc.tsh.a retry over time, stop retry"),!1;if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r}var o=this.streamCenter.publisherList[this.streamID].publisher,s=this.serverUrls,n=o.signal?o.signal.server:"";s.forEach(function(e,r){return r<=s.indexOf(n)&&t.serverUrls.push(e)}),s.splice(0,s.indexOf(n)+1);var a=this.serverUrls[this.retryActiveCount%this.serverUrls.length==0?this.serverUrls.length-1:this.retryActiveCount%this.serverUrls.length-1];return this.retryTimer=setTimeout(function(){t.logger.warn("zc.tsh.a stream "+t.streamID+" connect signal server "+a),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++,t.streamCenter.connectPublishServer(t.streamID,a)},"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info("zc.tsh.a call success"),!0},t.prototype.activePull=function(e,t){var r=this;if(this.logger.info("zc.tsh.a retry call "+this.streamID),t&&(this.playStreamSuccess=t),this.stateCenter.networkState==i.ENUM_NETWORK_STATE.offline)return this.logger.info("zc.tsh.a network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info("zc.tsh.a has active, ignore"),!1;if(this.isOverTime)return this.logger.warn("zc.tsh.a retry over time, stop retry"),!1;if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var o=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=o>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:o}var s=this.streamCenter.playerList[this.streamID].player,n=this.serverUrls,a=s.signal?s.signal.server:"";n.forEach(function(e,t){return t<=n.indexOf(a)&&r.serverUrls.push(e)}),n.splice(0,n.indexOf(a)+1);var l=this.serverUrls[this.retryActiveCount%this.serverUrls.length==0?this.serverUrls.length-1:this.retryActiveCount%this.serverUrls.length-1];return this.retryTimer=setTimeout(function(){r.logger.warn("zc.tsh.a stream "+r.streamID+" connect signal server "+l),r.retryTimer&&clearTimeout(r.retryTimer),r.retryTimer=null,r.retryActiveCount++,r.streamCenter.connectPlayServer(r.streamID,r.playStreamSuccess,l)},"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info("zc.tsh.a call success"),!0},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout(function(){if(e.logger.warn(e.streamID+" over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.invalid(),e.isPublish){if(!e.streamCenter.publisherList[e.streamID])return void e.logger.info("zc.tsh.smt streamID "+e.streamID+" publish no found");e.publishStateHandle(i.ENUM_PUBLISH_STATE_UPDATE.error,e.streamID,a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishRetryTimeoutError,!0)}else{if(!e.streamCenter.playerList[e.streamID])return void e.logger.info("zc.tsh.smt streamID "+e.streamID+" play no found");e.playStateHandle(i.ENUM_PLAY_STATE_UPDATE.error,e.streamID,a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRetryTimeoutError,!0)}},1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.retryNextSignal=function(e){if(this.stateCenter.networkState==i.ENUM_NETWORK_STATE.offline)return!0;if(this.isPublish){var t=this.streamCenter.publisherList[this.streamID];if(t.publisher.state==i.ENUM_PUBLISH_STATE.stop&&[a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError.code,a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNegoTimeoutError.code].includes(e.code))return!0;if(t.isCenterNode&&t.publisher.signal&&t.publisher.signal.websocket&&1==t.publisher.signal.websocket.readyState)return!1;if(!t.isCenterNode&&[a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError].includes(e)){var r=(o=e.message.match(/reason:(\d+)/))?o[1]:"";return!["26"].includes(r)}return!0}var o,s=this.streamCenter.playerList[this.streamID];return!((s.player.state!=i.ENUM_PLAY_STATE.stop||![a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError.code,a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNegoTimeoutError.code].includes(e.code))&&(s.isCenterNode&&s.player.signal&&s.player.signal.websocket&&1==s.player.signal.websocket.readyState||!s.isCenterNode&&[a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError].includes(e)&&(r=(o=e.message.match(/reason:(\d+)/))?o[1]:"",["24","26","28"].includes(r))))},t.prototype.publishStateHandle=function(e,t,r,o){this.logger.info(l.ZEGO_WEBRTC_ACTION.PUBLISH_STATE_HANDLE+" call "+t+" "+(r?r.code+"":""));var s=o||this.RETRY_MAX_TIME<3;if(!s&&r&&(c.ClientUtil.isReDispatch(r)||0==this.serverUrls.length))return this.stopMaxTime(),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,void this.streamCenter.onPublishStateUpdate(e,t,r);var n=this.streamCenter.publisherList[t],d=n.publisher;if(!s&&r&&0!==r.code){!this.maxTimer&&!s&&this.startMaxTime(),this.stateCenter.publishStreamList[t].state=i.ENUM_PUBLISH_STREAM_STATE.retryPublish;var u=d.localStream,h=d.videoInfo,p=d.mediaStreamConfig,g=d.publishOption;if(0!=d.sessionId&&d.signal&&d.shouldSendCloseSession()&&(d.signal.sendCloseSession(i.getSeq(),d.sessionId,1),d.signal.removeSession(d.sessionId),d.closeSessionSignal=!0),d.resetPublish(),!s&&!this.retryNextSignal(r)){if(n.isCenterNode&&d.gwNodeTTL<(new Date).getTime()&&0!==d.gwNodeList.length)d.gwNode="",d.gwNodeList=[],d.gwNodeTTL=0;else if(n.isCenterNode){var m=d.gwNodeList.findIndex(function(e){return e==d.gwNode});d.gwNode=d.gwNodeList[++m%d.gwNodeList.length]}return void setTimeout(function(){d.startPublish(t,u,h,p,g)},3e3)}this.streamCenter.removeStreamFromSignal(!0,t)}if(s)return this.stopMaxTime(),this.invalid(),1===e&&d.resetPublish(),void this.streamCenter.onPublishStateUpdate(e,t,r);if(r&&0!==r.code&&this.activePublish(void 0)){var _=i.getReportSeq();this.streamCenter.dataReport.newReport(_),this.streamCenter.dataReport.addMsgInfo(_,{stream:a.ZegoRTCLogEvent.kZegoTaskRePublish.stream(this.streamID)}),this.streamCenter.dataReport.uploadReport(_,a.ZegoRTCLogEvent.kZegoTaskRePublish.event),this.streamCenter.onPublishStateUpdate(2,t,r)}this.logger.info(l.ZEGO_WEBRTC_ACTION.PUBLISH_STATE_HANDLE+" end "+t)},t.prototype.playStateHandle=function(e,t,r,o){this.logger.info(l.ZEGO_WEBRTC_ACTION.PLAY_STATE_HANDLE+" call "+t+" "+(r?r.code+"":""));var s=o||this.RETRY_MAX_TIME<3;if(!s&&r&&(c.ClientUtil.isReDispatch(r)||0==this.serverUrls.length))return this.stopMaxTime(),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,void this.streamCenter.onPlayStateUpdate(e,t,r);if(r&&0!==r.code){!this.maxTimer&&!s&&this.startMaxTime();var n=this.streamCenter.playerList[t],d=n.player,u=d.playOption;if(0!=d.sessionId&&d.signal&&d.shouldSendCloseSession()&&(d.signal.sendCloseSession(i.getSeq(),d.sessionId,1),d.signal.removeSession(d.sessionId),d.closeSessionSignal=!0),d.resetPlay(),!s&&!this.retryNextSignal(r)){if(n.isCenterNode&&d.gwNodeTTL<(new Date).getTime()&&0!==d.gwNodeList.length)d.gwNode="",d.gwNodeList=[],d.gwNodeTTL=0;else if(n.isCenterNode){var h=d.gwNodeList.findIndex(function(e){return e==d.gwNode});d.gwNode=d.gwNodeList[++h%d.gwNodeList.length]}return void setTimeout(function(){d.startPlay(t,d.getRemoteStreamSuc,u)},3e3)}this.streamCenter.removeStreamFromSignal(!1,t)}if(s)return this.stopMaxTime(),this.invalid(),void this.streamCenter.onPlayStateUpdate(e,t,r);if(r&&0!==r.code&&this.activePull(void 0)){var p=i.getReportSeq();this.streamCenter.dataReport.newReport(p),this.streamCenter.dataReport.addMsgInfo(p,{stream:a.ZegoRTCLogEvent.kZegoTaskRePlay.stream(this.streamID)}),this.streamCenter.dataReport.uploadReport(p,a.ZegoRTCLogEvent.kZegoTaskRePlay.event),this.streamCenter.onPlayStateUpdate(2,t,r)}this.logger.info(l.ZEGO_WEBRTC_ACTION.PLAY_STATE_HANDLE+" end "+t)},t}(n.RetryHandler);t.RetryStreamHandler=d},function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryDispatchHandler=void 0;var i=r(9),n=r(0),a=r(2),l=r(1),c=r(4),d=function(e){function t(t,r,o,s){var i=e.call(this)||this;return i.retryActiveCount=1,i.RETRY_MAX_TIME=90,i.logger=t,i.stateCenter=r,i.rtm=o,i.streamCenter=s,i}return s(t,e),t.prototype.initStream=function(e,t,r){this.streamID=e,this.playOption=t,this.isPublish=r},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" retry call "+this.streamID),this.stateCenter.networkState==n.ENUM_NETWORK_STATE.offline)return this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" has active, ignore"),!1;if(this.isOverTime)return this.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" retry over time, stop retry"),!1;this.rtm.isLogin()||(this.stopMaxTime(),this.invalid(),this.isPublish?this.streamCenter.publisherList[this.streamID].isReDispatch=!0:this.streamCenter.playerList[this.streamID].isReDispatch=!0);var r,o=this.retryActiveCount-1;if("PUBLIC"===this.stateCenter.type){var s=this.playOption&&2==this.playOption.resourceMode?1:0;r={stream_id:this.streamID,ptype:this.isPublish?"push":"pull",signals:this.streamCenter.getAllInUseUrl(),header_kvs:[{key:"grpc-metadata-push",value:this.playOption&&this.playOption.cdnUrl||""}],retry:o,center_ability:!0,dispatch_type:s}}else r={stream_id:this.streamID,dispatch_type:this.isPublish?1:2,stream_type:3,an_type:this.rtm.getAnType()};return this.retryTimer=setTimeout(function(){t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++;var e=t.streamCenter.getRoomByStreamID(t.streamID),o=t.rtm.service.sendMessage("webrtc_url",r,function(e,r){t.handleFetchWebRtcUrlRsp(e)},function(e,r){t.handleFetchWebRtcUrlRsp(e)},void 0,{sessionID:null==e?void 0:e.sessionID,roomID:null==e?void 0:e.roomID,roomSessionID:null==e?void 0:e.roomSessionID});t.isPublish&&o?t.streamCenter.publisherList[t.streamID]&&(t.streamCenter.publisherList[t.streamID].seq=o):o&&t.streamCenter.playerList[t.streamID]&&(t.streamCenter.playerList[t.streamID].seq=o)},"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" call success"),!0},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout(function(){e.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_MAX_TIME+" "+e.streamID+" dispatch over max time "+e.RETRY_MAX_TIME+"s stop retry"),e.isOverTime=!0,e.invalid(),e.isPublish?e.streamCenter.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.error,e.streamID,l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError):e.streamCenter.onPlayStateUpdate(n.ENUM_PLAY_STATE_UPDATE.error,e.streamID,l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError)},1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.handleFetchWebRtcUrlRsp=function(e){if(e.code&&[c.errorCodeList.TIMEOUT.code].includes(e.code))this.active();else{if(e.code&&[c.errorCodeList.SOCKET_CLOSE.code].includes(e.code))return this.stopMaxTime(),this.invalid(),void(this.isPublish?this.streamCenter.publisherList[this.streamID].isReDispatch=!0:this.streamCenter.playerList[this.streamID].isReDispatch=!0);var t=e,r=t.body.stream_id,o=!1;if(this.isPublish&&(!this.streamCenter.publisherList[r]||t.header.seq!==this.streamCenter.publisherList[this.streamID].seq))return this.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" seq is not match, ignore "+this.streamID),this.stopMaxTime(),void this.invalid();if(!(this.isPublish||this.streamCenter.playerList[this.streamID]&&t.header.seq===this.streamCenter.playerList[this.streamID].seq))return this.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" seq is not match, ignore "+this.streamID),this.stopMaxTime(),void this.invalid();if("PUBLIC"===this.stateCenter.type){if(this.stateCenter.clientIP=t.body.clientip||"",0!==t.body.err_code&&2==t.body.need_action)return this.retryActiveInterval=t.body.action_delay/1e3||Math.floor(3*Math.random())+3,void this.active();if(0!==t.body.err_code&&1!==t.body.need_action&&![3102].includes(t.body.err_code))return this.retryActiveInterval=Math.floor(3*Math.random())+3,void this.active();if(this.stopMaxTime(),this.invalid(),t.body.urls&&Array.isArray(t.body.urls)&&t.body.urls.length>0?o=!0:this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" signal url is empty"),"push"===t.body.ptype&&this.streamCenter.publisherList[r]){if(!o)return void this.streamCenter.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.error,r,l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError);var s=this.streamCenter.publisherList[r];this.stateCenter.publishStreamList[r]?(s.ttl=t.body.hosts_ttl?(new Date).getTime()+1e3*t.body.hosts_ttl:0,s.isCenterNode="boolean"==typeof t.body.is_center_node&&t.body.is_center_node,s.serverUrls=t.body.urls,this.streamCenter.startPublishingStream(r)):this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" no streamid to publish")}else if("pull"==t.body.ptype&&this.streamCenter.playerList[r]){if(!o){var i=l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError;return 3102===t.body.err_code&&(i=l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayUnsupportedResourceMode),void this.streamCenter.onPlayStateUpdate(n.ENUM_PLAY_STATE_UPDATE.error,r,i)}(g=this.streamCenter.playerList[r]).ttl=t.body.hosts_ttl?(new Date).getTime()+1e3*t.body.hosts_ttl:0,g.isCenterNode="boolean"==typeof t.body.is_center_node&&t.body.is_center_node,g.serverUrls=t.body.urls,this.streamCenter.startPlayingStream(r,this.streamCenter.playSuccessCallBackList[r])}}else{this.stopMaxTime(),this.invalid();var d=[],u=t.body.stream_url_info&&t.body.stream_url_info.stream_url,h=t.body.stream_url_info&&t.body.stream_url_info.ip_infos,p=/^ws(s)?:\/\/(.*?)\//;if(t.body.stream_url_info&&u&&h?o=!0:this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" signal url is empty"),h&&h.forEach(function(e){var t=e.ip_address+":"+e.port;d.push(u.replace(p.exec(u)[2],t))}),this.isPublish&&this.streamCenter.publisherList[r]){if(!o)return void this.streamCenter.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.error,r,l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError);s=this.streamCenter.publisherList[r],this.stateCenter.publishStreamList[r]?(s.serverUrls=d,this.streamCenter.startPublishingStream(r)):this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" no streamid to publish")}else if(!this.isPublish&&this.streamCenter.playerList[r]){if(!o)return void this.streamCenter.onPlayStateUpdate(n.ENUM_PLAY_STATE_UPDATE.error,r,l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError);var g;(g=this.streamCenter.playerList[r]).serverUrls=d,this.streamCenter.startPlayingStream(r,this.streamCenter.playSuccessCallBackList[r])}}}},t}(i.RetryHandler);t.RetryDispatchHandler=d}]))},276:function(e){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(o,s,(function(t){return e[t]}).bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=12)}([function(e,t,r){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.LoggerStateCenter=t.ZegoDataReport=t.ZegoLogger=t.LinkedList=t.ListNode=t.getReportSeq=t.getSeq=t.REPORT_ACTION=t.E_CLIENT_TYPE=t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.MAX_MIX_TASK_ID_LENGTH=t.MAX_MESSAGE_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.PROTO_VERSION="1.8.1",t.ROOMVERSION="V1",function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1200},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=1,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_MIX_TASK_ID_LENGTH=256,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={})),t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.SERVER_ERROR_CODE=1e4,t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallProgram=2]="ClientType_SmallProgram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={})),t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},t.getSeq=(o=1,function(){return o++}),t.getReportSeq=function(){var e=1;return function(){return e++}}();var s=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=s;var i=function(){function e(){this.start=new s,this.end=new s,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new s(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this.insertBefore(this._numNodes>0?this.start.next:this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=i;var n=r(14);Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return n.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return n.ZegoDataReport}}),Object.defineProperty(t,"LoggerStateCenter",{enumerable:!0,get:function(){return n.LoggerStateCenter}}),Object.defineProperty(t,"createZegoWebSocket",{enumerable:!0,get:function(){return n.createZegoWebSocket}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."},TRANS_FREQUENTLY:{code:1102022,msg:"trans send frequently"},IM_CONTENT_NULL:{code:1009001,msg:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,msg:"message content is too long"},IM_SEND_FAILED:{code:1009010,msg:"failed to send message"},FREQ_LIMITED:{code:1109001,msg:"frequency limited."}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_RTM_ACTION=void 0,function(e){e.ZEGOEXPRESSWEBRTM_CONSTRUCTOR="zm.0",e.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER="zm.wl",e.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG="zm.slf",e.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE="zm.sdv",e.ZEGOEXPRESSWEBRTM_LOGIN_ROOM="zm.lg",e.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM="zm.lo",e.ZEGOEXPRESSWEBRTM_SEND_CUSTOM="zm.scc",e.ZEGOEXPRESSWEBRTM_SEND_BCM="zm.sbcm",e.ZEGOEXPRESSWEBRTM_SEND_RLM="zm.srlm",e.ZEGOEXPRESSWEBRTM_SEND_BRM="zm.sbrm",e.ZEGOEXPRESSWEBRTM_SEND_RAM="zm.sram",e.ZEGOEXPRESSWEBRTM_ON="zm.on",e.ZEGOEXPRESSWEBRTM_OFF="zm.off",e.ZEGOEXPRESSWEBRTM_RENEWTOKEN="zm.rntk",e.ZEGOEXPRESSWEBRTM_RESETTOKENTIMER="zm.rstt",e.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM="zm.emr",e.ZEGOEXPRESSWEBRTM_SEND_PB="zm.spb",e.ZEGOEXPRESSWEBRTM_GET_HEADER="zm.gh",e.ROOM_LOGIN_ROOM="zm.rm.lg",e.ROOM_TRY_LOGIN="zm.rm.tl",e.ROOM_OPEN_HANDLER="zm.rm.op",e.ROOM_HANDLE_LOGINRSP="zm.rm.lgr",e.ROOM_CLOSEHANDLER="zm.rm.clh",e.ROOM_LOGOUT="zm.rm.lo",e.ROOM_RESET_ROOM="zm.rm.rr",e.ROOM_DISCONNECT="zm.rm.dcn",e.ROOM_KICK_OUT="zm.rm.kco",e.ROOM_STATUS_CALLBACK="zm.rm.scb",e.ROOM_RESETTOKEN_TIMER="zm.rm.rst",e.HEARTBEAT_START="zm.hb.st",e.HEARTBEAT_HEARTBEAT_RSP="zm.hb.rsp",e.HEARTBEAT_RESET="zm.hb.rst",e.SERVICE_PUSH="zm.sv.ps",e.SERVICE_SEND="zm.sv.sd",e.USER_LOGIN_RSP="zm.us.lgr",e.USER_FETCH_USER="zm.us.ftu",e.USER_FETCH_USER_RSP="zm.us.urp",e.USER_USER_PUSH="zm.us.uph",e.USER_MERGE_SEQ="zm.us.mg",e.USER_MERGE_TIMEOUT="zm.us.mto",e.USER_MERGE="zm.us.mg",e.USER_HB_PATCH="zm.us.pt",e.MESSAGE_SEND_RELIABLE="zm.msg.sdr",e.MESSAGE_FETCH_RELIABLE="zm.msg.frm",e.MESSAGE_RELIABLE_RSP="zm.msg.rlr",e.MESSAGE_RELIABLE_PUSH="zm.msg.rps",e.MESSAGE_SEND_ROOM_MSG="zm.msg.srm",e.MESSAGE_SEND_CUSTOM_MSG="zm.msg.scm",e.MESSAGE_SEND_BIG_MSG="zm.msg.sbm",e.MESSAGE_BIG_MSG_PUSH="zm.msg.bps",e.MESSAGE_SEND_RELAY_MSG="zm.msg.slm",e.LIVE_SEND_SIGNAL="zm.lv.ssg",e.LIVE_RESPOND_JOIN_LIVE="zm.lv.rjl",e.LIVE_PUSH_SIGNAL="zm.lv.pss",e.STATE_ACTION="zm.st.at",e.ZEGOEXPRESSWEBRTM_LOGIN_HALL="zm.lh",e.ZEGOEXPRESSWEBRTM_LOGOUT_HALL="zm.loh",e.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE="zm.scm"}(t.ZEGO_RTM_ACTION||(t.ZEGO_RTM_ACTION={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=void 0;var o=r(15),s=r(0),i=r(1),n=function(){function e(){}return e.checkConfigParam=function(e,t,r){return e&&"number"==typeof e&&this.checkInteger(e)?!(!t||"string"!=typeof t&&!Array.isArray(t)||""==t)||(r.error("ccp.0 server must be string or string array and not empty"),!1):(r.error("ccp.0 appid must be positive integer number and not empty"),!1)},e.checkPriConfigParam=function(e,t,r,o,s){return e&&"number"==typeof e&&this.checkInteger(e)?t&&"string"==typeof t?"object"!=typeof r||"string"!=typeof r.deviceID?(s.error("ccp.0 deviceID must be string and not empty"),!1):1===o||0===o||(s.error("ccp.0 anType must be 0 or 1"),!1):(s.error("ccp.0 dispatchServer must be string and not empty"),!1):(s.error("ccp.0 appid must be positive integer number and not empty"),!1)},e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,r){t.success&&(r[e+"SuccessCallback"]=t.success),t.error&&(r[e+"ErrorCallback"]=t.error)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,r,o,s){e.registerCallback(t,{success:function(t,s){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];e.dataReportEvent(r,o,t,s,i)}},s)},e.proxyRes=function(t,r,o,s){return{interResolve:function(e){t.uploadReport(r),o(e)},interReject:function(o,i){var n;void 0===i&&(i=""),(n=o.code<2e9&&o.code>1e9?e.decodeServerError(o.code,o.msg):{code:o.code,message:o.msg})&&t.addMsgInfo(r,{error:n.code,message:n.message+i}),t.uploadReport(r),s({errorCode:o.code})}}},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:"};if(0===e)return i.errorCodeList.SUCCESS;var r=i.errorCodeList.ROOM_INNER_ERROR;return r.code=e,r.msg=e>1e9?t[1e9]+e:t[e]?t[e]+" code:"+e:"unknown error code:"+e,r},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return r.code=e>1e9?e-1e9+52e6:e+2002e6,t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"ROOM_ERROR_AUTHENTICATION_FAILED",2003:"ROOM_ERROR_LOGIN_TIMEOUT"}[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.getKickoutError=function(e){var t={code:e,message:"kickout reason = "+e};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,r,o,s){switch(r){case"eventStart":e.eventStart(t,o);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,o,s[0]);break;case"addEventMsg":e.addEventMsg(t,o,s[0],s[1]);break;case"addEvent":e.addEvent(t,o);break;case"eventEnd":e.eventEnd(t,o);break;case"addMsgInfo":e.addMsgInfo(t,s[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeUserList=function(e,t,r,o){e.debug("msl.0 call");var s,i=[],n=[];r||(r=[]);for(var a=0;a<r.length;a++){s=!1;for(var l=0;l<t.length;l++)if(r[a].userID===t[l].userID){s=!0;break}s||i.push(r[a])}for(var c=0;c<t.length;c++){s=!1;for(var d=0;d<r.length;d++)if(t[c].userID===r[d].userID){s=!0;break}s||n.push(t[c])}for(t.splice(0),a=0;a<r.length;a++)t.push(t[a]);o(i,n),e.debug("msl.0 call success")},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r},e.generateRandumNumber=function(e){return parseInt(Math.random()*(e+1)+"",10)},e.uuid=function(e,t){var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[];if(t=t||o.length,e)for(r=0;r<e;r++)s[r]=o[0|Math.random()*t];else{var i=void 0;for(s[8]=s[13]=s[18]=s[23]="-",s[14]="4",r=0;r<36;r++)s[r]||(i=0|16*Math.random(),s[r]=o[19==r?3&i|8:i])}return s.join("")},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var o=0;o<r;o++){var s=parseInt(e[o]),i=parseInt(t[o]);if(s>i)return 1;if(s<i)return-1}return 0},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),o=null!=window.opr,s=e.indexOf("Chrome")&&window.chrome,i=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":r?"Firefox":o?"Opera":s?"Chrome":i?"Safari":"Unkown"},e.isTestEnv=function(e){return-1!=e.indexOf("wss://wssliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://test2-wsliveroom-api.zego.im/ws")||-1!=e.indexOf("wss://wsliveroom-test.zegocloud.com/ws")||-1!=e.indexOf("wss://wsliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test-bak.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-hk-test.zegocloud.com/ws")||-1!=e.indexOf("wss://webliveroom-hk-test-bak.zegocloud.com/ws")},e.getLogLevel=function(e){return s.LOG_LEVEL[e]},e.getUint64=function(e,t,r){var o=r.getUint32(e,t),s=r.getUint32(e+4,t),i=t?o+Math.pow(2,32)*s:Math.pow(2,32)*o+s;return Number.isSafeInteger(i)||console.warn(i,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),i},e.decodeTokenExpire=function(t){try{var r,s=Uint8Array.from(o.Base64.base64decode(t),function(e){return e.charCodeAt(0)}),i=new DataView(s.buffer);return r="function"==typeof i.getBigInt64?i.getBigUint64(0):e.getUint64(0,!1,i),Number(r>0?r:i.getBigUint64(0,!0))}catch(e){console.error("token error")}return-1},e}();t.ClientUtil=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRTMLogEvent=void 0;var o=r(1),s=function(e){return e};t.ZegoRTMLogEvent={kZegoTaskInitSetting:{event:"/sdk/init",error:{kInvalidParamError:o.errorCodeList.INPUT_PARAM},system_info:navigator?navigator.appVersion:""},kZegoTaskSetDebug:{event:"/sdk/set_debug",debug:s},kZegoTaskSetLog:{event:"/sdk/set_log_config",error:{kInvalidParamError:o.errorCodeList.INPUT_PARAM},log_level:function(e){return e},remote_log_level:s,log_url:s},kZegoTaskLoginRoom:{event:"/sdk/login",user_update:s,max_member_count:s,message:s,token:s,error:{ROOM_ID_NULL:o.errorCodeList.ROOM_ID_NULL,INPUT_PARAM:o.errorCodeList.INPUT_PARAM,ROOM_ID_TOO_LONG:o.errorCodeList.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:o.errorCodeList.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:o.errorCodeList.USER_ID_NULL,USER_ID_TOO_LONG:o.errorCodeList.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:o.errorCodeList.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:o.errorCodeList.USER_NAME_NULL,USER_NAME_TOO_LONG:o.errorCodeList.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:o.errorCodeList.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:o.errorCodeList.LOGIN_TIMEOUT,INNER_ERROR:o.errorCodeList.ROOM_INNER_ERROR,NETWORK_BROKEN:o.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:s,try_cnt:s},liveroom_login:{event:"liveroom_login",server:s,respond_info:s}}},kZegoTaskReNewToken:{event:"/sdk/reNewToken",error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,NOT_LOGIN:o.errorCodeList.NOT_LOGIN}},kZegoTaskLogoutRoom:{event:"/sdk/logout",error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,ROOM_NOT_EXIST:o.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskReLoginRoom:{event:"/sdk/relogin",error:{ROOM_ID_NULL:o.errorCodeList.ROOM_ID_NULL,ROOM_DISCONNECT:o.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:s,try_cnt:s},liveroom_login:{event:"liveroom_login",server:s,respond_info:s}}},kZegoTaskLoginHall:{event:"/sdk/login_hall",user_update:s,device_id:s,message:s,token:s,device_type:s,an_type:s,room_flag:s,test_environment:s,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,USER_ID_NULL:o.errorCodeList.USER_ID_NULL,USER_ID_TOO_LONG:o.errorCodeList.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:o.errorCodeList.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:o.errorCodeList.USER_NAME_NULL,USER_NAME_TOO_LONG:o.errorCodeList.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:o.errorCodeList.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:o.errorCodeList.LOGIN_TIMEOUT,INNER_ERROR:o.errorCodeList.ROOM_INNER_ERROR,NETWORK_BROKEN:o.errorCodeList.NETWORK_BROKEN},subEvent:{dispatch_connection:{event:"dispatch_connection"},create_socket:{event:"create_socket",server:s,try_cnt:s},liveroom_login:{event:"liveroom_login",server:s,respond_info:s}}},kZegoTaskLogoutHall:{event:"/sdk/logout_hall",error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM}},kZegoTaskEnterRoom:{event:"/sdk/enter",role:s,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,ROOM_ID_NULL:o.errorCodeList.ROOM_ID_NULL,ROOM_ID_TOO_LONG:o.errorCodeList.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:o.errorCodeList.ROOM_ID_INVALID_CHARACTER,NOT_LOGIN:o.errorCodeList.NOT_LOGIN,REPEATEDLY_ENTER_ROOM:o.errorCodeList.REPEATEDLY_ENTER_ROOM}},kZegoTaskLeaveRoom:{event:"/sdk/leave",error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM}},kZegoTaskReLoginHall:{event:"/sdk/relogin",error:{ROOM_ID_NULL:o.errorCodeList.ROOM_ID_NULL,ROOM_DISCONNECT:o.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:s,try_cnt:s},liveroom_login:{event:"liveroom_login",server:s,respond_info:s}}},kZegoTaskKickout:{event:"/sdk/kickout",user_id:s,error:{}},kZegoTaskRoomKickout:{event:"/sdk/room_kickout",user_id:s,room_id:s,message:s},kZegoTaskLiveRoomHB:{event:"/liveroom/hb",room_sid:s,error:{NOT_LOGIN:o.errorCodeList.NOT_LOGIN,HB_TIMEOUT:o.errorCodeList.TIMEOUT}},kZegoTaskLiveSendRoomBigIM:{event:"/liveroom/send_big_room_message",room_sid:s,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:o.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:o.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:o.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendCustomCommand:{event:"/liveroom/send_custom_command",room_sid:s,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:o.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:o.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:o.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendRoomMessage:{event:"/liveroom/send_room_message",room_sid:s,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:o.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:o.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:o.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendReliableMessage:{event:"/liveroom/send_reliable_message",room_sid:s,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,TRANS_FREQUENTLY:o.errorCodeList.TRANS_FREQUENTLY,ROOM_NOT_EXIST:o.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveGetRoomBigIM:{event:"/liveroom/get_big_room_message"},kZegoTaskLiveRoomGetRoomMessage:{event:"/liveroom/get_room_message",room_sid:s},kZegoTaskLiveRoomGetCustomCommand:{event:"/liveroom/get_custom_command"},kZegoTaskLiveRoomGetUserUpdateInfo:{event:"/liveroom/get_user_update_info",user_update_type:s},kZegoListener:{event:"/sdk/listener"},kZegoEnableMultiRoom:{event:"sdk/enable_multi_room",error:{kInvalidParamError:o.errorCodeList.INPUT_PARAM,kAlreadyLoginError:o.errorCodeList.ALREADY_LOGIN}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TryHandler=void 0;var o=function(){function e(e,t){this.logger=e,this.stateCenter=t,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return e.prototype.init=function(e,t,r,o){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof o&&(this.RETRY_MAX_TIME_INTERVAL=o)},e.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},e}();t.TryHandler=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeartBeatHandler=void 0;var o=r(0),s=r(3),i=r(1),n=r(2),a=r(4),l=3,c=function(){function e(e,t,r,o,s){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=s,this.tryHeartbeatCount=0,this.heartbeatTimer=null,this.loginHeartbeatTimer=null,this.initCount=0}return e.prototype.init=function(e){var t,r=this;"PRIVATE"==this.stateCenter.type?l=(e.body.hb_timeout||4e4)/(t=e.body.hb_interval<o.MINIUM_HEARTBEAT_INTERVAL?o.MINIUM_HEARTBEAT_INTERVAL:e.body.hb_interval)+1:t=e.body.hearbeat_interval<o.MINIUM_HEARTBEAT_INTERVAL?o.MINIUM_HEARTBEAT_INTERVAL:e.body.hearbeat_interval,this.tryHeartbeatCount=0,this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.loginHeartbeatTimer=setTimeout(function(){r.start(t)},t),this.initCount++},e.prototype.start=function(e){var t=this;this.logger.info(n.ZEGO_RTM_ACTION.HEARTBEAT_START+" call");var r=o.getReportSeq();if(this.dataReport.newReport(r,a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.event),this.dataReport.addMsgInfo(r,{room_sid:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.room_sid(this.room.sessionID)}),!this.room.isLogin())return this.logger.error(n.ZEGO_RTM_ACTION.HEARTBEAT_START+" state error"),this.dataReport.addMsgInfo(r,{error:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.NOT_LOGIN.code,message:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.NOT_LOGIN.msg}),void this.dataReport.uploadReport(r);if(++this.tryHeartbeatCount>l)return this.logger.error(n.ZEGO_RTM_ACTION.HEARTBEAT_START+" come to try limit"),this.dataReport.addMsgInfo(r,{error:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.code,message:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.msg}),this.dataReport.uploadReport(r),void this.hbLogout(i.errorCodeList.HEARTBEAT_TIMEOUT);var c=function(e){if(0!==("PRIVATE"==t.stateCenter.type?e.body&&e.body.code:e.body&&e.body.err_code)){var o=s.ClientUtil.decodeServerError(e.body.err_code||e.body.code,e.body.err_message||e.body.message);t.dataReport.addMsgInfo(r,{error:o.code,message:o.message+e.body.err_code})}else e.header&&e.body||t.dataReport.addMsgInfo(r,{error:e.code>0?e.code:i.errorCodeList.ROOM_INNER_ERROR.code,message:e.msg?e.msg:i.errorCodeList.ROOM_INNER_ERROR});t.dataReport.uploadReport(r),"PRIVATE"==t.stateCenter.type?t.handlePrivateHeartbeatRsp(e):t.handleHeartbeatRsp(e)};this.service.heartBeat(c,c,this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.heartbeatInterval=e;var d=this.heartbeatInterval;this.initCount>=2?(d=Math.round(Math.random()*(this.heartbeatInterval+1)),this.initCount=1):d=this.heartbeatInterval,this.heartbeatTimer=setTimeout(function(){t.start(t.heartbeatInterval)},d),this.logger.info(n.ZEGO_RTM_ACTION.HEARTBEAT_START+" call success")},e.prototype.handleHeartbeatRsp=function(e){return e.body&&e.body.err_code&&0!==e.body.err_code?(this.logger.error(n.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",e.body.err_code),e.body.err_code==o.ERROR_CODES.ROOM_SESSION_ID_ERR?void this.hbLogout(i.errorCodeList.HEARTBEAT_TIMEOUT):void this.hbLogout(s.ClientUtil.getServerError(e.body.err_code))):e.header&&e.body?(this.tryHeartbeatCount=0,this.heartbeatInterval=e.body.hearbeat_interval,this.heartbeatInterval<o.MINIUM_HEARTBEAT_INTERVAL&&(this.heartbeatInterval=o.MINIUM_HEARTBEAT_INTERVAL),this.heartbeatRspNotiFy(e),void this.logger.info(n.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" call success")):(this.logger.error(n.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, error=",JSON.stringify(e)),void this.hbLogout(e))},e.prototype.handlePrivateHeartbeatRsp=function(e){if(0!==e.body.code)return this.logger.error(n.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",e.body.code),e.body.code==o.ERROR_CODES.ROOM_SESSION_ID_ERR?void this.hbLogout(i.errorCodeList.HEARTBEAT_TIMEOUT):void this.hbLogout(s.ClientUtil.getServerError(e.body.code));this.tryHeartbeatCount=0,this.heartbeatInterval=e.body.hb_interval,this.heartbeatInterval<o.MINIUM_HEARTBEAT_INTERVAL&&(this.heartbeatInterval=o.MINIUM_HEARTBEAT_INTERVAL),this.heartbeatRspNotiFy(e),this.logger.info(n.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" call success")},e.prototype.heartbeatRspNotiFy=function(e){},e.prototype.hbLogout=function(e){},e.prototype.resetHeartbeat=function(){clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null,clearTimeout(this.loginHeartbeatTimer),this.loginHeartbeatTimer=null,this.tryHeartbeatCount=0,this.initCount=0,this.logger.info(n.ZEGO_RTM_ACTION.HEARTBEAT_RESET+" call success")},e}();t.HeartBeatHandler=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveHandler=void 0;var o=r(0),s=r(2),i=r(3),n=r(1),a=function(){function e(e,t,r,o){this.logger=e,this.stateCenter=t,this.service=r,this.room=o,this.joinLiveCallbackMap={},this.joinLiveRequestMap={}}return e.prototype.resetLiveHandler=function(){this.joinLiveCallbackMap={},this.joinLiveRequestMap={}},e.prototype.getSignalCmdContent=function(e,t,r){var o={request_id:e,room_id:this.room.roomID,from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,to_userid:t};return null!=r&&(o.result=r),JSON.stringify(o)},e.prototype.requestJoinLive=function(e,t,r,s){var i=this.stateCenter.getRequestId(),n=this.getSignalCmdContent(i,e);return null!=s&&(this.joinLiveCallbackMap[i]=s,this.sendSignalCmd(o.ENUM_SIGNAL_SUB_CMD.joinLiveRequest,n,e,t,r),!0)},e.prototype.sendSignalCmd=function(e,t,r,o,a){this.room.isLogin()?(this.service.sendSignalCmd({sub_cmd:e,signal_msg:t,dest_id_name:[r]},function(e){o&&o(e.header.seq)},function(e){var t=n.errorCodeList.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(t=e),void(a&&a(t,0));a&&a(i.ClientUtil.getServerError(e.body.err_code),e.header.seq)},this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(s.ZEGO_RTM_ACTION.LIVE_SEND_SIGNAL+" call success"+e)):this.logger.error(s.ZEGO_RTM_ACTION.LIVE_SEND_SIGNAL+" state error")},e.prototype.inviteJoinLive=function(e,t,r,s){var i=this.stateCenter.getRequestId(),n=this.getSignalCmdContent(i,e);return null!=s&&(this.joinLiveCallbackMap[i]=s,this.sendSignalCmd(o.ENUM_SIGNAL_SUB_CMD.joinLiveInvite,n,e,t,r),!0)},e.prototype.endJoinLive=function(e,t,r){var s=this.stateCenter.getRequestId(),i=this.getSignalCmdContent(s,e);return this.sendSignalCmd(o.ENUM_SIGNAL_SUB_CMD.joinLiveStop,i,e,t,r),!0},e.prototype.respondJoinLive=function(e,t,r,i){var n=this.joinLiveRequestMap[e];if(!n)return this.logger.info(s.ZEGO_RTM_ACTION.LIVE_RESPOND_JOIN_LIVE+" no dest id name"),!1;var a=0;!0===t&&(a=1);var l=this.getSignalCmdContent(e,n,a);return this.sendSignalCmd(o.ENUM_SIGNAL_SUB_CMD.joinLiveResult,l,n,r,i),delete this.joinLiveRequestMap[e],!0},e.prototype.handlePushSignalMsg=function(e){var t=JSON.parse(e.body.signal_msg);switch(this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" hpsm= ",t),e.body.sub_cmd){case o.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveRequest:this.handlePushJoinLiveRequestMsg(t);break;case o.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveResult:this.handlePushJoinLiveResultMsg(t);break;case o.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveInvite:this.handlePushJoinLiveInviteMsg(t);break;case o.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveStop:this.handlePushJoinLiveStopMsg(t)}},e.prototype.handlePushJoinLiveRequestMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.from_userid;"string"==typeof r?(this.joinLiveRequestMap[t]=r,this.onRecvJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id),this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvJoinLiveRequest "+r)):this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no from user")}else this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.onRecvJoinLiveRequest=function(e,t,r,o){this.stateCenter.actionListener("recvJoinLiveRequest",e,t,r,o)},e.prototype.handlePushJoinLiveInviteMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.from_userid;"string"==typeof r?(this.joinLiveRequestMap[t]=r,this.onRecvInviteJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id),this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvInviteJoinLiveRequest "+r)):this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no from user")}else this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+"no requestId")},e.prototype.onRecvInviteJoinLiveRequest=function(e,t,r,o){this.stateCenter.actionListener("recvInviteJoinLiveRequest",e,t,r,o)},e.prototype.handlePushJoinLiveResultMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.result;if(null!=r){var o=1==r;if(this.joinLiveCallbackMap[t]){var i=this.joinLiveCallbackMap[t];if(!i)return void this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no callback");this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" joinLiveRequest/invite result "+o),delete this.joinLiveCallbackMap[t],i(o,e.from_userid,e.from_username)}}else this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no result")}else this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.handlePushJoinLiveStopMsg=function(e){var t=e.request_id;"string"==typeof t?(this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvEndJoinLiveCommand "+e.from_userid),this.onRecvEndJoinLiveCommand(t,e.from_userid,e.from_username,e.room_id)):this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.onRecvEndJoinLiveCommand=function(e,t,r,o){this.stateCenter.actionListener("recvEndJoinLiveCommand",e,t,r,o)},e}();t.LiveHandler=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var o=r(0),s=r(3),i=r(1),n=r(2),a=r(4),l=function(){function e(e,t,r,o,s){var i=this;this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=s,this.sendRoomMsgTime=0,this.sendRoomMsgInterval=500,this.bigImCallbackMap={},this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImTimer=null,this.relayTimer=null,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.isReliable=!1,this.transSeqMap={},this.onRecvReliableMessage=function(e){var t=e.map(function(e){return{key:e.trans_type,value:e.trans_data,updateUser:{userID:e.trans_idname,userName:e.trans_nickname},updateTime:e.trans_send_time}});i.stateCenter.actionListener("roomExtraInfoUpdate",i.room.roomID,t),e.forEach(function(e){i.stateCenter.actionListener("recvReliableMessage",e.trans_type,e.trans_seq,e.trans_data)})},this.realyMessageList=[]}return e.prototype.loginRsp=function(e){var t=this;if(null!=e.body.ret_timestamp&&"string"==typeof e.body.ret_timestamp){var r=parseFloat(e.body.ret_timestamp);this.serverTimeOffset=0==r?0:e.body.ret_timestamp-(new Date).getTime()}if(e.body.bigim_time_window&&"number"==typeof e.body.bigim_time_window&&(this.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&"number"==typeof e.body.dati_time_window&&(this.datiTimeWindow=e.body.dati_time_window),e.body.trans_seqs)for(var o=0;o<e.body.trans_seqs.length;o++){var s=e.body.trans_seqs[o].trans_channel,i=e.body.trans_seqs[o].trans_seq_array;(i=i.filter(function(e){var r=e.trans_type;return!t.transSeqMap[r]||t.transSeqMap[r].seq<e.trans_seq})).length>0&&this.fetchReliableMessage(s,i)}},e.prototype.sendReliableMessage=function(e,t,r,o){var l=this;if(this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" call"),this.isReliable)return this.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" send too often"),void o(a.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.TRANS_FREQUENTLY);this.transSeqMap[e]||(this.transSeqMap[e]={seq:0});var c={trans_type:e,trans_data:t,trans_local_seq:this.transSeqMap[e].seq,trans_channel:"clt"};this.isReliable=!0,this.service.sendReliableMessage(c,function(t){l.transSeqMap[e].seq=t.body.trans_seq,l.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" trans "+e+" seq "+t.body.trans_seq),l.isReliable=!1,r({seq:t.header.seq,errorCode:0})},function(e){var t=i.errorCodeList.ROOM_INNER_ERROR;e.body&&e.body.err_code?(t=s.ClientUtil.getServerError(e.body.err_code),l.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+t.msg)):t=e==i.errorCodeList.TIMEOUT?i.errorCodeList.IM_SEND_FAILED:e,l.isReliable=!1,o(t)},this.room.sessionID,this.room.roomID,this.room.roomSessionID)},e.prototype.fetchReliableMessage=function(e,t){var r=this,o=function(e){r.handleFetchTransRsp(e)};this.service.fetchReliableMessage({trans_channel:e,fetch_array:t},o,o,this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_FETCH_RELIABLE+" call success")},e.prototype.handleFetchTransRsp=function(e){if(e.body&&0!=e.body.err_code)this.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" trans send error "+e.body.err_code);else if(e.header&&e.body){var t=e.body.trans_fetch_results,r=[];if(Array.isArray(t)&&t.length>0)for(var s=0;s<t.length;s++){var i=t[s];if(i.err_code!==o.ERROR_CODES.FETCH_TRANS_UNKNOWN_TYPE){var a=i.trans_type,l=i.trans_seq;i.err_code!==o.ERROR_CODES.FETCH_TRANS_WRONG_SEQ?(!this.transSeqMap[a]||this.transSeqMap[a].seq<l?(this.transSeqMap[a]={seq:l},r.push(i)):this.logger.warn(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans seq wrong"),r.length>0&&this.onRecvReliableMessage(r)):(this.logger.warn(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans seq is wrong "+i.err_code),this.transSeqMap[a]={seq:l})}else this.logger.warn(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans unknown type "+i.err_code)}}else this.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" trans send error "+e)},e.prototype.handlePushTransMsg=function(e){var t=e.body.trans_type,r=e.body.trans_seq;!this.transSeqMap[t]||this.transSeqMap[t].seq<r?(this.transSeqMap[t]={seq:r},this.onRecvReliableMessage([e.body])):this.logger.warn(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_PUSH+" trans seq wrong"),this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_PUSH+" trans "+t+" seq "+r)},e.prototype.sendRoomMsg=function(e,t,r,o,a,l){var c=this;if(!this.room.isLogin())return this.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+" state error"),!1;var d=Date.parse(new Date+"");return this.sendRoomMsgTime>0&&this.sendRoomMsgTime+this.sendRoomMsgInterval>d?(this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+" freq error"),l&&l(i.errorCodeList.FREQ_LIMITED,0,e,o),!1):(this.sendRoomMsgTime=d,this.service.sendRoomMsg("PRIVATE"==this.stateCenter.type?{room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},msg_category:e,msg_type:1,msg_content:o}:{msg_category:e,msg_type:1,msg_content:o},function(e){a({seq:e.header.seq,errorCode:0,messageID:e.body.msg_id})},function(e){var t,r,o=i.errorCodeList.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(o=e),void l({seq:0,errorCode:o.code,messageID:0});o=(t=[s.ClientUtil.getServerError("PRIVATE"==c.stateCenter.type?e.body.code:e.body.err_code),e.body.msg_id])[0],r=t[1],c.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+o.msg),c.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+o.msg),o==i.errorCodeList.TIMEOUT&&(o=i.errorCodeList.IM_SEND_FAILED),l({seq:e.header.seq,errorCode:o.code,messageID:r})},this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  call success"),!0)},e.prototype.handlePushRoomMsg=function(e){var t=this,r=o.getReportSeq();this.dataReport.newReport(r),this.dataReport.addMsgInfo(r,{room_sid:a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetRoomMessage.room_sid(e.header.session_id)});var s=[];e.body.chat_data.forEach("PRIVATE"==this.stateCenter.type?function(e){s.push({fromUser:{userID:e.user_id,userName:e.user_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id}),t.dataReport.addMsgInfo(r,{from_msg_id:e.id_name})}:function(e){s.push({fromUser:{userID:e.id_name,userName:e.nick_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id}),t.dataReport.addMsgInfo(r,{from_msg_id:e.id_name})}),this.dataReport.uploadReport(r,a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetRoomMessage.event),this.stateCenter.actionListener("IMRecvBroadcastMessage",this.room.roomID,s),this.stateCenter.actionListener("_recvRoomMsg",e.body.chat_data,e.body.server_msg_id,e.body.ret_msg_id)},e.prototype.sendCustomCommand=function(e,t,r,o){var a=this;if(!this.room.isLogin())return this.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" state error"),!1;var l={from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,request_id:this.stateCenter.getRequestId(),custom_content:t||"",room_id:this.room.roomID},c="PRIVATE"==this.stateCenter.type?{room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},request_id:this.stateCenter.getRequestId(),msg:t,destids:e}:{dest_id_name:e,custom_msg:JSON.stringify(l)};return this.service.sendCustomCommand(c,function(e){r({seq:e.header.seq,errorCode:0})},function(e){var t=s.ClientUtil.getServerError("PRIVATE"==a.stateCenter.type?e.body.code:e.body.err_code);a.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" "+t.msg),o({seq:e.header.seq,errorCode:(t==i.errorCodeList.TIMEOUT?i.errorCodeList.IM_SEND_FAILED:t).code})},this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" call success"),!0},e.prototype.handlePushCustomMsg=function(e){var t,r,s,i,n,l;if("PRIVATE"==this.stateCenter.type)s=(t=[e.body.from_user_id,e.body.from_user_name,this.room.roomID,e.body.msg])[0],i=t[1],n=t[2],l=t[3];else{var c=JSON.parse(e.body.custommsg);s=(r=[c.from_userid,c.from_username,c.room_id,c.custom_content])[0],i=r[1],n=r[2],l=r[3]}var d=o.getReportSeq();this.dataReport.newReport(d),this.dataReport.uploadReport(d,a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetCustomCommand.event),this.stateCenter.actionListener("IMRecvCustomCommand",n,{userID:s,userName:i},l)},e.prototype.sendBigRoomMessage=function(e,t,r,s,i,n){var a=this,l=this.bigimTimeWindow,c=this.serverTimeOffset,d=(new Date).getTime()+c,u=o.getSeq().toString();if(this.bigImCallbackMap[u]={success:i,error:n},0==l)this.sendBigRoomMessageInternal([{msg_category:e,msg_type:1,msg_content:s,bigmsg_client_id:u}],function(e){a.handleBigImMsgRsp(e)},function(e){n&&n(e)});else{var h=Math.floor(d/l);this.bigImLastTimeIndex<h&&0==this.bigIMmessageList.length?(this.bigImLastTimeIndex=h,this.sendBigRoomMessageInternal([{msg_category:e,msg_type:1,msg_content:s,bigmsg_client_id:u}],function(e){a.handleBigImMsgRsp(e)},function(e){n&&n(e)})):(this.bigIMmessageList.push({msg_category:e,msg_type:1,msg_content:s,bigmsg_client_id:u}),1==this.bigIMmessageList.length&&this.setBigImTimer(c,l))}},e.prototype.sendBigRoomMessageInternal=function(e,t,r){this.service.sendBigRoomMessage({msgs:e},function(e){t(e)},function(e){var t=i.errorCodeList.ROOM_INNER_ERROR;e.header&&e.body||(e.code&&e.msg&&(t=e),r(t)),r(t)},this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_BIG_MSG+" sendBigRoomMessage called")},e.prototype.handleBigImMsgRsp=function(e){this.bigimTimeWindow=e.body.bigim_time_window;for(var t=0;t<e.body.msgs.length;t++){var r=e.body.msgs[t].bigmsg_client_id;if(this.bigImCallbackMap[r]){var o=this.bigImCallbackMap[r].success;null!=o&&o({seq:e.header.seq,errorCode:0,messageID:e.body.msgs[t].bigmsg_id}),delete this.bigImCallbackMap[r]}}},e.prototype.setBigImTimer=function(e,t){var r=this,o=t-((new Date).getTime()+e)%t,i=s.ClientUtil.generateRandumNumber(t)+o;this.bigImTimer=setTimeout(function(){r.onBigImTimer()},i)},e.prototype.onBigImTimer=function(){var e=this,t=(new Date).getTime()+this.serverTimeOffset;this.bigImLastTimeIndex=Math.floor(t/this.bigimTimeWindow);for(var r=[],o=[],s=0;s<this.bigIMmessageList.length&&!(s>=20);s++){var i=this.bigIMmessageList[s];r.push({msg_category:i.msg_category,msg_type:i.msg_type,msg_content:i.msg_content,bigmsg_client_id:i.bigmsg_client_id}),o.push(i.bigmsg_client_id)}this.bigIMmessageList.length>20?this.bigIMmessageList.splice(0,20):this.bigIMmessageList=[],this.sendBigRoomMessageInternal(r,function(t){e.handleBigImMsgRsp(t)},function(t,r){for(var s=0;s<o.length;s++){var i=o[s],n=e.bigImCallbackMap[i];n&&(null!=n.error&&n.error(t,r),delete e.bigImCallbackMap[i])}}),this.bigImTimer&&clearTimeout(this.bigImTimer),this.bigImTimer=null,this.bigIMmessageList.length>0&&this.setBigImTimer(this.serverTimeOffset,this.bigimTimeWindow)},e.prototype.handlePushMergeMsg=function(e){for(var t=0;t<e.body.messages.length;t++)14001===e.body.messages[t].sub_cmd&&this.handlePushBigRooMsg(e.body.messages[t].msg_body)},e.prototype.handlePushBigRooMsg=function(e){var t;try{t=JSON.parse(e)}catch(e){return void this.logger.warn(n.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+"parse json error")}if(t){for(var r=t.room_id,o=[],s=0;s<t.msg_data.length;s++){var i=t.msg_data[s];i.id_name!=this.stateCenter.idName?o.push({idName:i.id_name,nickName:i.nick_name,messageId:i.bigmsg_id,category:i.msg_category,type:i.msg_type,content:i.msg_content,time:i.send_time}):this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" self message")}0==o.length?this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" no other pushData except self"):this.onRecvBigRoomMessage(o,r),this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+"call success")}else this.logger.warn(n.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" cann't find message body")},e.prototype.onRecvBigRoomMessage=function(e,t){var r=o.getReportSeq();this.dataReport.newReport(r);var s=[];e.forEach(function(e){s.push({fromUser:{userID:e.idName,userName:e.nickName},message:e.content,sendTime:e.time,messageID:e.messageId})}),this.dataReport.uploadReport(r,a.ZegoRTMLogEvent.kZegoTaskLiveGetRoomBigIM.event),this.stateCenter.actionListener("IMRecvBarrageMessage",t,s),this.stateCenter.actionListener("_recvBigRoomMessage",e,t)},e.prototype.resetMessageInfo=function(){this.transSeqMap={},this.realyMessageList=[],this.relayTimer&&(clearTimeout(this.relayTimer),this.relayTimer=null),this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer&&(clearTimeout(this.bigImTimer),this.bigImTimer=null),this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0},e.prototype.sendRelayMessage=function(e,t,r,o){var s=this.datiTimeWindow,i=this.serverTimeOffset;s>0?(this.realyMessageList.push({type:e,data:t,success:r,error:o}),1==this.realyMessageList.length&&this.setRelayTimer(i,s)):this.sendRelayMessageInternal(e,t,r,o)},e.prototype.sendRelayMessageInternal=function(e,t,r,o){this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+" call");var a=this.room;this.service.sendRelayMessage({relay_type:e,relay_data:t},function(e){r&&r(e.header.seq,e.body.relay_result)},function(e){var t=i.errorCodeList.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(t=e),void(o&&o(t,0));o&&o(s.ClientUtil.getServerError(e.body.err_code),e.header.seq)},a.sessionID,a.roomID,a.roomSessionID)},e.prototype.setRelayTimer=function(e,t){var r=this,o=2*t-((new Date).getTime()+e)%t,i=s.ClientUtil.generateRandumNumber(o);this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+" setTimer "+i),this.relayTimer=setTimeout(function(){r.onRelayTimer()},i)},e.prototype.onRelayTimer=function(){if(0!=this.realyMessageList.length){var e=this.realyMessageList[0];this.sendRelayMessageInternal(e.type,e.data,e.success,e.error),this.relayTimer&&clearTimeout(this.relayTimer),this.relayTimer=null,this.realyMessageList.splice(0,1),this.realyMessageList.length>0&&this.setRelayTimer(this.serverTimeOffset,this.datiTimeWindow)}else this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+"  no relay data")},e.prototype.getRoomChatInfo=function(e,t,r,o){if(this.logger.debug("zb.mh.grc call"),this.room.isLogin()){var s=function(e,t){if(0!==e.body.code)o({errorCode:e.body.code,extendData:e.body.message||""});else{var s=e.body.msg_data.map(function(e){return{fromUser:{userID:e.user_id,userName:e.user_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id}});r({chatData:s})}};this.service.sendMessage("zegochat_js.room_im_chat_fetch",{room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},msg_id:e,msg_count:t},s,s),this.logger.info("zb.mh.grc call success")}else this.logger.error("zb.mh.srm no enter room")},e}();t.MessageHandler=l},function(e,t,r){"use strict";var o=this&&this.__spreadArray||function(e,t){for(var r=0,o=t.length,s=e.length;r<o;r++,s++)e[s]=t[r];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.UserHandler=void 0;var s=r(0),i=r(3),n=r(2),a=r(4),l=function(){function e(e,t,r,o,s){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=s,this.userQuerying=!1,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=[],this.userSeqMergeMap={},this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}return e.prototype.loginRsp=function(e,t){this.anchor_info=e.body.anchor_info||this.anchor_info,this.userListInterval=e.body.userlist_interval||this.userListInterval,this.userListMergeInterval=e.body.userlist_merge_timeout||this.userListMergeInterval,e.body.anchor_info&&(this.stateCenter.actionListener("getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name),this.stateCenter.actionListener("_getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name)),e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count),this.logger.info(n.ZEGO_RTM_ACTION.USER_LOGIN_RSP+"  userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList(t)},e.prototype.patchUserList=function(e){var t=this;e.body.server_user_seq!==this.userSeq&&this.stateCenter.userStateUpdate&&!this.userSeqMergeMap&&(this.logger.info(n.ZEGO_RTM_ACTION.USER_HB_PATCH+" call update user "+this.userSeq+" server "+e.body.server_user_seq),this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout(function(){t.handleMergeTimeout()},this.userListMergeInterval)),this.minUserSeq=e.body.server_user_seq,null!=e.body.online_count&&0!=e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count)},e.prototype.resetUserHandler=function(){this.userQuerying=!1,this.lastUserQueryTime=0,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=void 0,this.userSeqMergeMap={},this.userSeqMergeTimer=void 0,this.userQueryTimer=void 0,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},e.prototype.fetchUserList=function(e){this.userQuerying?this.logger.warn(n.ZEGO_RTM_ACTION.USER_FETCH_USER+" is already querying"):(this.userQuerying=!0,this.userTempList=[],this.fetchUserListWithPage(0,e||0),this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER+" the first time call"))},e.prototype.fetchUserListWithPage=function(e,t){var r=this,o=function(e){"PRIVATE"==r.stateCenter.type?r.handleFetchUserListPrivateRsp(e):r.handleFetchUserListRsp(e,t)};"V1"===s.ROOMVERSION?this.service.fetchUserList({user_index:e,sort_type:0},o,o,this.room.sessionID,this.room.roomID,this.room.roomSessionID):this.service.fetchUserListV2({marker:0===e?"":e+"",mode:0,limit:100},o,o,this.room.sessionID,this.room.roomID,this.room.roomSessionID)},e.prototype.handleFetchUserListRsp=function(e,t){var r=this;if(e.body&&0!=e.body.err_code)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+e.body.err_code);if(!e.header||!e.body)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+e);if(this.stateCenter.userStateUpdate){this.userTempList=o(o([],this.userTempList),e.body.user_baseinfos);var a=e.body.ret_user_index;if(a!=e.body.server_user_index)return this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch another page"),void this.fetchUserListWithPage(a+1,t);this.userSeq=e.body.server_user_seq;for(var l=[],c=[],d=0;d<this.userTempList.length;d++)l.push({userID:this.userTempList[d].id_name,userName:this.userTempList[d].nick_name,role:this.userTempList[d].role}),c.push({idName:this.userTempList[d].id_name,nickName:this.userTempList[d].nick_name,role:this.userTempList[d].role});this.stateCenter.actionListener("_getTotalUserList",this.room.roomID,c),t==s.ENUM_RUN_STATE.login?(this.userList&&i.ClientUtil.mergeUserList(this.logger,this.userList,l,function(e,t){0!==e.length&&r.onUserStateUpdate(r.room.roomID,"ADD",e),0!==t.length&&r.onUserStateUpdate(r.room.roomID,"DELETE",t)}),this.userList=l):(this.userList=l,0!==l.length&&this.onUserStateUpdate(this.room.roomID,"ADD",l)),this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.userTempList=[],this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" call success user_list "+l+" count "+l.length)}},e.prototype.handlePushUserStateUpdateMsg=function(e){if(this.logger.info(n.ZEGO_RTM_ACTION.USER_USER_PUSH+" call"),this.stateCenter.userStateUpdate)if(this.userSeq!==e.body.user_list_seq)if(this.userSeq+e.body.user_actions.length===e.body.user_list_seq){this.userSeq=e.body.user_list_seq;var t,r,o=[];if("PRIVATE"==this.stateCenter.type){t=0,r=1;for(var s=0;s<e.body.user_actions.length;s++){var i={action:e.body.user_actions[s].action,idName:e.body.user_actions[s].user_id,nickName:e.body.user_actions[s].user_name,role:e.body.user_actions[s].role,loginTime:e.body.user_actions[s].login_time};o.push(i)}}else{for(t=1,r=2,s=0;s<e.body.user_actions.length;s++)o.push(i={action:e.body.user_actions[s].Action,idName:e.body.user_actions[s].IdName,nickName:e.body.user_actions[s].NickName,role:e.body.user_actions[s].Role,loginTime:e.body.user_actions[s].LoginTime});this.stateCenter.actionListener("_userStateUpdate",e.body.room_id,o)}var a=[],l=[];o.forEach(function(e){e.action==t?a.push({userID:e.idName,userName:e.nickName,role:e.role}):e.action==r&&l.push({userID:e.idName,userName:e.nickName,role:e.role})}),this.userList&&(this.userList=this.userList.concat(a).filter(function(e){return!l.some(function(t){return t.userID==e.userID})})),0!==a.length&&this.onUserStateUpdate(e.body.room_id||e.body.room_pushheader.room_id,"ADD",a),0!==l.length&&this.onUserStateUpdate(e.body.room_id||e.body.room_pushheader.room_id,"DELETE",l),this.logger.info(n.ZEGO_RTM_ACTION.USER_USER_PUSH+" call success")}else this.mergeUserByUserSeq(e.body.user_list_seq,e.body.user_actions);else this.logger.warn(n.ZEGO_RTM_ACTION.USER_USER_PUSH+" user_list_seq is the same with local seq");else this.logger.info(n.ZEGO_RTM_ACTION.USER_USER_PUSH+" userStateUpdate is false")},e.prototype.onUserStateUpdate=function(e,t,r){var o=this,i=s.getReportSeq();this.dataReport.newReport(i,a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.event);var n=r.filter(function(e){return e.userID!==o.stateCenter.idName});0!=n.length&&("PRIVATE"!==this.stateCenter.type&&(n=n.map(function(e){return{userID:e.userID,userName:e.userName}})),this.stateCenter.actionListener("roomUserUpdate",e,t,n),this.dataReport.addMsgInfo(i,{user_update_type:a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("ADD"==t?"added":"deleted")}),this.dataReport.uploadReport(i))},e.prototype.mergeUserByUserSeq=function(e,t){var r=this;this.userSeqMergeMap||(this.logger.warn(n.ZEGO_RTM_ACTION.USER_MERGE_SEQ+" new merge userlist "+this.userSeq+" server "+e),this.userSeqMergeMap={},this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout(function(){r.handleMergeTimeout()},this.userListMergeInterval)),this.userSeqMergeMap[e]=t,this.logger.warn(n.ZEGO_RTM_ACTION.USER_MERGE_SEQ+"  merge userlist "+this.userSeq+" server "+e+" userlist "+t.length)},e.prototype.mergeUser=function(e){var t=this;this.logger.info(n.ZEGO_RTM_ACTION.USER_MERGE+" merge userlist "+this.userSeq+" userSeqList "+e.join(",")),this.userSeq=e[e.length-1],this.lastUserQueryTime=Date.now()+this.userListInterval;var r={};e.forEach(function(e){t.userSeqMergeMap&&t.userSeqMergeMap[e].forEach(function(e){r[e.IdName]=e})}),this.userSeqMergeMap=null;var o=Object.values(r).map(function(e){return{action:e.Action,idName:e.IdName,nickName:e.NickName,role:e.Role,loginTime:e.LoginTime?String(e.LoginTime):""}});o.sort(function(e,t){return e.loginTime.localeCompare(t.loginTime)});var s=[],i=[];o.forEach(function(e){1==e.action?s.push({userID:e.idName,userName:e.nickName,role:e.role}):2==e.action&&i.push({userID:e.idName,userName:e.nickName,role:e.role})}),this.userList=this.userList&&this.userList.concat(s).filter(function(e){return!i.some(function(t){return t.userID==e.userID})}),0!==s.length&&this.onUserStateUpdate(this.room.roomID,"ADD",s),0!==i.length&&this.onUserStateUpdate(this.room.roomID,"DELETE",i),this.stateCenter.actionListener("_userStateUpdate",this.room.roomID,o)},e.prototype.handleMergeTimeout=function(){var e=this,t=Object.keys(this.userSeqMergeMap).map(function(e){return+e}).sort(function(e,t){return e-t});if(t[t.length-1]-t[0]+1===t.length||t[t.length-1]>=this.minUserSeq)this.mergeUser(t);else{this.userSeqMergeMap=null;var r=this.lastUserQueryTime-Date.now();this.logger.info(n.ZEGO_RTM_ACTION.USER_MERGE_TIMEOUT+"  fetch merge userlist "+this.userSeq+" userSeqList "+t.join(",")+" wait "+r),r>0?(this.userQueryTimer&&clearTimeout(this.userQueryTimer),this.userQueryTimer=setTimeout(function(){e.fetchUserList()},r)):this.fetchUserList()}},e.prototype.loginPrivateRsp=function(e){this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER," userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList()},e.prototype.handleFetchUserListPrivateRsp=function(e){if(this.logger.debug(n.ZEGO_RTM_ACTION.USER_FETCH_USER+" call"),e.body.code&&0!==e.body.code)return this.userQuerying=!1,void this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER+" fetch error "+e.body.code+" "+e.body.message);if(this.stateCenter.userStateUpdate){this.userTempList=o(o([],this.userTempList),e.body.users),this.userSeq=e.body.userlist_seq,this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER+" set user Seq "+this.userSeq);for(var t=[],r=0;r<this.userTempList.length;r++)t.push({userID:this.userTempList[r].user_id,userName:this.userTempList[r].user_name,role:this.userTempList[r].role});this.userQuerying=!1,this.onUserStateUpdate(this.room.roomID,"ADD",t),this.userTempList=[],this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER+" call success user_list "+t+" count "+t.length)}},e}();t.UserHandler=l},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=this&&this.__spreadArray||function(e,t){for(var r=0,o=t.length,s=e.length;r<o;r++,s++)e[s]=t[r];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomService=void 0;var i=r(0),n=r(11),a=r(2),l=r(1),c=function(){function e(e,t){this.stateCenter=e,this.logger=t,this.service=new n.ZegoSocketService(this.stateCenter.ENV),this.cmdSeq=0,this.responseRouters={}}return e.prototype.checkResponse=function(e){return e.header.appid!==this.stateCenter.appid||e.header.user_id!==this.stateCenter.userid},e.prototype.handleSendCommandMsgRsp=function(e){var t=this,r=this.service.sendCommandMap[e.header.seq];if(null!=r){var o=r._data;delete this.service.sendCommandMap[e.header.seq],this.service.sendCommandList.remove(r),0===e.body.err_code?setTimeout(function(){o&&null!=o.success&&o.success(e,t.cmdSeq)},0):setTimeout(function(){o&&null!=o.error&&o.error(e,t.cmdSeq)},0)}},e.prototype.onPush=function(){var e=this;this.service.onMessage=function(t){t instanceof ArrayBuffer?e.stateCenter.actionListener("_protobufResponse",t):t.header?(0!==t.body.err_code?t.body.err_message&&e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", err_code="+t.body.err_code+", err_message="+t.body.err_message+" "):e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", msg="+JSON.stringify(t)+" "),["login","logout"].indexOf(t.header.cmd)>-1?e.handleSendCommandMsgRsp(t):e.checkResponse(t)?e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+"  check session fail."):(e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+",function="+!!e.responseRouters[t.header.cmd]),e.handleSendCommandMsgRsp(t),e.responseRouters[t.header.cmd]&&e.responseRouters[t.header.cmd](t,e.cmdSeq))):e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" msg type error ")}},e.prototype.handlePushKickout=function(e){var t,r,o,i;if((null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.protocol)&&1!=(null===(r=null==e?void 0:e.body)||void 0===r?void 0:r.protocol)){var n=null===(o=null==e?void 0:e.header)||void 0===o?void 0:o.room_id,l=this.stateCenter.roomModulesList.find(function(e){return e.roomID==n});if(!l)return void this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(null===(i=e.header)||void 0===i?void 0:i.room_id));l.roomHandler.handlePushKickout(e)}else s([],this.stateCenter.roomModulesList).forEach(function(t){return t.roomHandler.handlePushKickout(e,!0)})},e.prototype.handlePushCustomMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find(function(e){return e.roomID==r});o?o.messageHandler.handlePushCustomMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushRoomMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find(function(e){return e.roomID==r});o?o.messageHandler.handlePushRoomMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushUserStateUpdateMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find(function(e){return e.roomID==r});o?o.userHandler.handlePushUserStateUpdateMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushMergeMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find(function(e){return e.roomID==r});o?o.messageHandler.handlePushMergeMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushTransMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find(function(e){return e.roomID==r});o?o.messageHandler.handlePushTransMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handleBigImMsgRsp=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find(function(e){return e.roomID==r});o?o.messageHandler.handleBigImMsgRsp(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushSignalMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find(function(e){return e.roomID==r});o?o.liveHandler.handlePushSignalMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.closeHandler=function(e){this.service.closeHandler(e)},e.prototype.openHandler=function(e){this.service.openHandler(e)},e.prototype.errorHandler=function(e){this.service.errorHandler(e)},e.prototype.getHeader=function(e,t,r,o){return{Protocol:"V1"===i.ROOMVERSION?"req":"req_v2",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:t||"",room_id:r||"",room_session_id:o||"",biz_version:this.stateCenter.bizVersion||""}},e.prototype.startCheck=function(){this.service.startCheck()},e.prototype.stopCheck=function(){this.service.stopCheck()},e.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},e.prototype.createSocket=function(e){var t=this;this.service.createSocket(e),this.responseRouters=o(o({},this.responseRouters),{push_kickout:function(e){t.handlePushKickout(e)},push_custommsg:function(e){t.handlePushCustomMsg(e)},push_im_chat:function(e){t.handlePushRoomMsg(e)},push_userlist_update:function(e){t.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){t.handlePushMergeMsg(e)},push_trans:function(e){t.handlePushTransMsg(e)},push_signal:function(e){t.handlePushSignalMsg(e)}})},e.prototype.closeSocket=function(){this.service.closeSocket()},e.prototype.sendMessage=function(e,t,r,o,s,i){var n,c,d;if(this.service.isDisConnect())return this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_SEND+" socket is disconnect"),o(l.errorCodeList.SOCKET_CLOSE),0;var u=(null==i?void 0:i.roomID)?i.roomID:null===(n=this.stateCenter.roomModulesList[0])||void 0===n?void 0:n.roomID,h=(null==i?void 0:i.roomSessionID)?i.roomSessionID:null===(c=this.stateCenter.roomModulesList[0])||void 0===c?void 0:c.roomSessionID,p=(null==i?void 0:i.sessionID)?i.sessionID:null===(d=this.stateCenter.roomModulesList[0])||void 0===d?void 0:d.sessionID,g=s||this.getHeader(e,p,u,h);return this.logger.info(a.ZEGO_RTM_ACTION.SERVICE_SEND+" sendMsg:"+JSON.stringify({header:g,body:t})),this.service.sendMessage(g,t,r,o)},e.prototype.on=function(e,t){this.responseRouters[e]=t},e.prototype.login=function(e,t,r){var o=this.getHeader(e.isMulti?"enter":"login",e.sessionID,e.roomID,e.roomSessionID),s={id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,role:this.stateCenter.role,token:e.token,version:this.stateCenter.sdKVersion,room_name:e.roomID,user_state_flag:this.stateCenter.userStateUpdate?1:0,room_create_flag:this.stateCenter.roomCreateFlag,client_type:0===this.stateCenter.ENV?i.E_CLIENT_TYPE.ClientType_Webrtc:i.E_CLIENT_TYPE.ClientType_SmallProgram,third_token:e.thirdToken,user_count_limit:this.stateCenter.maxMemberCount,relate_service:this.stateCenter.relateService.join()||"",login_logic:this.stateCenter.isMultiRoom?3:1,proto_format:this.stateCenter.protoFormat};return this.sendMessage("",s,t,r,o)},e.prototype.logout=function(e,t,r){var o=e.isMulti?"quit":"logout",s={reserve:0};return"logout"==o&&(s.login_logic=this.stateCenter.isMultiRoom?3:1),this.sendMessage(o,s,t,r,void 0,{sessionID:e.sessionID,roomID:e.roomID,roomSessionID:e.roomSessionID})},e.prototype.heartBeat=function(e,t,r,o,s){return this.sendMessage("hb",{reserve:0},e,t,void 0,{sessionID:r,roomID:o,roomSessionID:s})},e.prototype.fetchUserList=function(e,t,r,o,s,i){return this.sendMessage("user_list",e,t,r,void 0,{sessionID:o,roomID:s,roomSessionID:i})},e.prototype.fetchUserListV2=function(e,t,r,o,s,i){return this.sendMessage("user_list_v2",e,t,r,void 0,{sessionID:o,roomID:s,roomSessionID:i})},e.prototype.fetchReliableMessage=function(e,t,r,o,s,i){return this.sendMessage("trans_fetch",e,t,r,void 0,{sessionID:o,roomID:s,roomSessionID:i})},e.prototype.sendReliableMessage=function(e,t,r,o,s,i){return this.sendMessage("trans",e,t,r,void 0,{sessionID:o,roomID:s,roomSessionID:i})},e.prototype.sendRoomMsg=function(e,t,r,o,s,i){return this.sendMessage("im_chat",e,t,r,void 0,{sessionID:o,roomID:s,roomSessionID:i})},e.prototype.sendCustomCommand=function(e,t,r,o,s,i){return this.sendMessage("custommsg",e,t,r,void 0,{sessionID:o,roomID:s,roomSessionID:i})},e.prototype.sendBigRoomMessage=function(e,t,r,o,s,i){return this.sendMessage("bigim_chat",e,t,r,void 0,{sessionID:o,roomID:s,roomSessionID:i})},e.prototype.sendRelayMessage=function(e,t,r,o,s,i){return this.sendMessage("relay",e,t,r,void 0,{sessionID:o,roomID:s,roomSessionID:i})},e.prototype.sendSignalCmd=function(e,t,r,o,s,i){return this.sendMessage("signal",e,t,r,void 0,{sessionID:o,roomID:s,roomSessionID:i})},e.prototype.sendPB=function(e){return this.service.isDisConnect()?(this.logger.error(a.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_PB+" socket is disconnected"),!1):this.service.sendPB(e)},e}();t.LiveRoomService=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSocketService=void 0;var o=r(0),s=r(1),i=function(){function e(e){this.socket=null,this.sendCommandList=new o.LinkedList,this.sendCommandMap={},this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3,this.ENV=e}return e.prototype.createSocket=function(e){this.socket=o.createZegoWebSocket(e,this.ENV%2)},e.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},e.prototype.isDisConnect=function(){return!this.socket||1!==this.socket.readyState},e.prototype.sendMessage=function(e,t,r,o,s){void 0===r&&(r=null),void 0===o&&(o=null),void 0===s&&(s={timeOut:6e3});var i={header:e,body:t},n={data:i,seq:e.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeOut:s.timeOut,success:r,error:o},a=this.sendCommandList.push(n);return this.sendCommandMap[n.seq]=a,this.socket&&this.socket.send(JSON.stringify(i)),e.seq},e.prototype.sendPB=function(e){return this.socket&&this.socket.send(e),!0},e.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data&&t._data.error&&setTimeout(function(){t&&t._data&&t._data.error&&t._data.error(s.errorCodeList.TIMEOUT,t._data.data.header.seq,t._data.data.body.custom_msg)},0),t=e.getFirst()},e.prototype.checkMessageListTimeout=function(e,t){for(var r=e.getFirst(),o=Date.parse(new Date+""),i=0;!(null==r||r._data&&r._data.sendTime+r._data.timeOut>o||(r._data&&delete t[r._data.data.header.seq],e.remove(r),r._data&&null==r._data.error||r._data&&r._data.sendTime+this.sendDataDropTimeout<o||setTimeout(function(){r&&r._data&&r._data.error&&r._data.error(s.errorCodeList.TIMEOUT,r._data.data.header.seq,r._data.data.body.custom_msg)},0),++i>=this.sendDataCheckOnceCount));)r=e.getFirst()},e.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout(function(){e.startCheck()},this.sendDataCheckInterval)},e.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},e.prototype.openHandler=function(e){var t=this;this.socket&&(this.socket.onopen=function(r){t.socket.binaryType="arraybuffer",t.responseHandler(),e(r)})},e.prototype.responseHandler=function(){var e=this;this.socket&&(this.socket.onmessage=function(t){var r="string"==typeof t.data?JSON.parse(t.data):t.data;e.onMessage(r)})},e.prototype.closeHandler=function(e){this.socket&&(this.socket.onclose=function(t){e(t)})},e.prototype.errorHandler=function(e){this.socket&&(this.socket.onerror=e)},e.prototype.onMessage=function(e){},e}();t.ZegoSocketService=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=t.ZegoDataReport=t.ZegoLogger=t.getSeq=t.getReportSeq=t.ZegoExpressWebRTMEngine=void 0;var o=r(13);Object.defineProperty(t,"ZegoExpressWebRTM",{enumerable:!0,get:function(){return o.ZegoExpressWebRTM}});var s=r(0),i=function(){function e(t,r,i){void 0===i&&(i=0),this.logger=new s.ZegoLogger(i),this.dataReport=new s.ZegoDataReport(this.logger),this.zegoWebRTM=new o.ZegoExpressWebRTM(t,r,this.logger,this.dataReport,e.version,i)}return e.prototype.loginRoom=function(e,t,r,o){return this.zegoWebRTM.loginRoom(e,t,r,o)},e.prototype.logoutRoom=function(e){return this.zegoWebRTM.logoutRoom(e)},e.prototype.renewToken=function(e,t){return this.zegoWebRTM.renewToken(e,t)},e.prototype.sendBarrageMessage=function(e,t){return this.zegoWebRTM.sendBarrageMessage(e,t)},e.prototype.sendBroadcastMessage=function(e,t){return this.zegoWebRTM.sendBroadcastMessage(e,t)},e.prototype.sendCustomCommand=function(e,t,r){return this.zegoWebRTM.sendCustomCommand(e,t,r)},e.prototype.setRoomExtraInfo=function(e,t,r){return this.zegoWebRTM.setRoomExtraInfo(e,t,r)},e.prototype.setLogConfig=function(e){return this.zegoWebRTM.setLogConfig(e)},e.prototype.setDebugVerbose=function(e){return this.zegoWebRTM.setDebugVerbose(e)},e.prototype.on=function(e,t){return this.zegoWebRTM.on(e,t)},e.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},e.prototype.off=function(e,t){return this.zegoWebRTM.off(e,t)},e.prototype.loginHall=function(e,t,r){return this.zegoWebRTM.loginHall(e,t,r)},e.prototype.logoutHall=function(){return this.zegoWebRTM.logoutHall()},e.prototype.enterRoom=function(e,t){return this.zegoWebRTM.enterRoom(e,t)},e.prototype.leaveRoom=function(){return this.zegoWebRTM.leaveRoom()},e.prototype.sendRelayMessage=function(e,t,r,o){this.zegoWebRTM.sendRelayMessage(e,t,r,o)},e.prototype.requestJoinLive=function(e,t,r,o){return this.zegoWebRTM.requestJoinLive(e,t,r,o)},e.prototype.inviteJoinLive=function(e,t,r,o){return this.zegoWebRTM.inviteJoinLive(e,t,r,o)},e.prototype.endJoinLive=function(e,t,r){return this.zegoWebRTM.endJoinLive(e,t,r)},e.prototype.respondJoinLive=function(e,t,r,o){return this.zegoWebRTM.respondJoinLive(e,t,r,o)},e.prototype.enableMultiRoom=function(e){return this.zegoWebRTM.enableMultiRoom(e)},e.version=s.PROTO_VERSION,e}();t.ZegoExpressWebRTMEngine=i;var n=r(0);Object.defineProperty(t,"getReportSeq",{enumerable:!0,get:function(){return n.getReportSeq}}),Object.defineProperty(t,"getSeq",{enumerable:!0,get:function(){return n.getSeq}}),Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return n.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return n.ZegoDataReport}})},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(s,i){function n(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(n,a)}l((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,o,s,i,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,o=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!((s=(s=n.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){n=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){n.label=i[1];break}if(6===i[0]&&n.label<s[1]){n.label=s[1],s=i;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(i);break}s[2]&&n.ops.pop(),n.trys.pop();continue}i=t.call(e,n)}catch(e){i=[6,e],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__spreadArray||function(e,t){for(var r=0,o=t.length,s=e.length;r<o;r++,s++)e[s]=t[r];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=void 0;var n=r(0),a=r(1),l=r(3),c=r(0),d=r(16),u=r(17),h=r(18),p=r(19),g=r(21),m=r(2),_=r(4),f=r(24),E=r(10),T=r(25),v=function(){function e(e,t,r,o,s,i){this.logger=r,this.dataReport=o,this.version=s,this.stateCenter=new h.StateCenter(this.logger,this.dataReport),this.stateCenter.ENV=i;var a=c.getReportSeq();if(this.dataReport.newReport(a),(0==i||1==i)&&this.setDebug(t),l.ClientUtil.checkConfigParam(e,t,this.logger)){if(this.stateCenter.appid=e,this.stateCenter.configOK=!0,this.stateCenter.sdKVersion=this.version,0==i||1==i?("string"==typeof t?(this.stateCenter.server=t,this.stateCenter.serverBak=t):Array.isArray(t)&&t.length>0&&(this.stateCenter.server=t[0],this.stateCenter.serverBak=t[1]||t[0]),this.service=new E.LiveRoomService(this.stateCenter,this.logger)):2!=i&&3!=i||(this.service=new T.LiveRoomPrivateService(this.stateCenter,this.logger),this.module=new g.LiveRoomModules(this.stateCenter,this.logger,this.dataReport,this.service),this.stateCenter.priModules=this.module,this.module.dispatchServer=t,this.stateCenter.type="PRIVATE"),0==i||2==i)this.bindWindowListener(),this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  "+navigator.appVersion),this.stateCenter.networkState=navigator?navigator.onLine?n.ENUM_NETWORK_STATE.online:n.ENUM_NETWORK_STATE.offline:n.ENUM_NETWORK_STATE.online,this.dataReport.addMsgInfo(a,{system_info:_.ZegoRTMLogEvent.kZegoTaskInitSetting.system_info});else if(1==i||3==i){this.bindWxListener();try{var d=wx.getSystemInfoSync();this.dataReport.addMsgInfo(a,{system_info:{brand:d.brand,model:d.model,system:d.system,platform:d.platform,version:d.version,SDKVersion:d.SDKVersion}})}catch(e){this.logger.warn(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" get system info error")}}this.logger.setSessionInfo(this.stateCenter.appid,"","","","",this.version)}else this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" init sdk error"),this.dataReport.addMsgInfo(a,_.ZegoRTMLogEvent.kZegoTaskInitSetting.error.kInvalidParamError);this.dataReport.uploadReport(a,_.ZegoRTMLogEvent.kZegoTaskInitSetting.event)}return Object.defineProperty(e.prototype,"modules",{get:function(){return{service:this.service}},enumerable:!1,configurable:!0}),e.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),r=l.ClientUtil.getBrowser(),o=t?"pagehide":"Firefox"===r?"beforeunload":"unload";window.addEventListener(o,function(){e.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" "+o),"PUBLIC"===e.stateCenter.type?e.logoutRoom():(e.leaveRoom(),e.logoutHall()),e.logoutRoom()}),window.addEventListener("offline",function(){e.netOffLineHandle()}),window.addEventListener("online",function(){e.netOnLineHandle()})},e.prototype.bindWxListener=function(){var e=this;wx.onNetworkStatusChange(function(t){t.isConnected?e.netOnLineHandle():e.netOffLineHandle()})},e.prototype.netOnLineHandle=function(){var e=this;this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+"network is online"),this.stateCenter.networkState=n.ENUM_NETWORK_STATE.online,this.stateCenter.roomModulesList.forEach(function(t){t.roomTryHandler&&e.service.isDisConnect()?t.roomTryHandler.active():t.roomTryHandler&&(t.roomTryHandler.stopMaxTime(),t.roomHandler.roomStateHandle("CONNECTED",{code:0,msg:""}))})},e.prototype.netOffLineHandle=function(){this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" network is broken"),this.stateCenter.networkState=n.ENUM_NETWORK_STATE.offline,this.stateCenter.roomModulesList.forEach(function(e){e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.onactive=function(t,r){e.roomHandler.disconnectedHandle(r)},e.roomTryHandler.startMaxTime(),e.roomHandler.roomStateHandle("CONNECTING",a.errorCodeList.NETWORK_BROKEN))})},e.prototype.setLogConfig=function(e){this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call");var t=c.getReportSeq();if(this.dataReport.newReport(t),e.logLevel&&["debug","info","warn","error","report","disable"].includes(e.logLevel)&&(this.logger.setLogLevel(e.logLevel),this.dataReport.addMsgInfo(t,{log_level:_.ZegoRTMLogEvent.kZegoTaskSetLog.log_level(e.logLevel)})),e.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(e.remoteLogLevel)&&(this.logger.setRemoteLogLevel(e.remoteLogLevel),this.dataReport.addMsgInfo(t,{remote_log_level:_.ZegoRTMLogEvent.kZegoTaskSetLog.remote_log_level(e.remoteLogLevel)})),"string"==typeof e.logURL&&(e.logURL.startsWith("wss://")||e.logURL.startsWith("https://")))this.logger.setLogServer(e.logURL),this.dataReport.addMsgInfo(t,{log_url:_.ZegoRTMLogEvent.kZegoTaskSetLog.log_url(e.logURL)}),this.dataReport.uploadReport(t,_.ZegoRTMLogEvent.kZegoTaskSetLog.event);else if(e.logURL)return this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+"log url must be a wss or https url"),this.dataReport.addMsgInfo(t,_.ZegoRTMLogEvent.kZegoTaskSetLog.error.kInvalidParamError),this.dataReport.uploadReport(t,_.ZegoRTMLogEvent.kZegoTaskSetLog.event),!1;return this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call success"),!0},e.prototype.setDebugVerbose=function(e){var t=c.getReportSeq();this.dataReport.newReport(t),"boolean"==typeof e&&(this.stateCenter.debug=e,this.stateCenter.debugCustom=!0,this.dataReport.addMsgInfo(t,{debug:_.ZegoRTMLogEvent.kZegoTaskSetDebug.debug(e?"true":"false")})),this.dataReport.uploadReport(t,_.ZegoRTMLogEvent.kZegoTaskSetDebug.event),this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE+" call success")},e.prototype.setDebug=function(e){"string"==typeof e&&e.indexOf("wss")>-1?this.stateCenter.debug=l.ClientUtil.isTestEnv(e):Array.isArray(e)&&e.length>0&&e.every(function(e){return"string"==typeof e&&e.indexOf("wss")>-1})?this.stateCenter.debug=l.ClientUtil.isTestEnv(e[0])||l.ClientUtil.isTestEnv(e[1]):this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" server wrong"),this.stateCenter.testEnvironment=this.stateCenter.debug},e.prototype.renewToken=function(e,t){var r,o=c.getReportSeq();if(this.dataReport.newReport(o),void 0!==t&&("string"!=typeof t||""==t))return this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" roomID must be string and no empty"),!1;var s=this.getRoomModules(t)||this.stateCenter.roomModulesList[0];return s?"string"==typeof e&&s.roomTryHandler?(null===(r=s.roomTryHandler)||void 0===r||r.renewToken(e),this.dataReport.uploadReport(o,_.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!0):"string"!=typeof e||s.roomTryHandler?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" token must be string and not empty"),this.dataReport.addMsgInfo(o,{error:_.ZegoRTMLogEvent.kZegoTaskReNewToken.error.INPUT_PARAM.code,message:_.ZegoRTMLogEvent.kZegoTaskReNewToken.error.INPUT_PARAM.msg+" param token error"}),this.dataReport.uploadReport(o,_.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1):(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(o,{error:_.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:_.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(o,_.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1):(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(o,{error:_.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:_.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(o,_.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1)},e.prototype.loginRoom=function(e,t,r,a){var l=this;return new Promise(function(c,h){return o(l,void 0,void 0,function(){var o,l,g,f,E,T=this;return s(this,function(s){switch(s.label){case 0:return 1!==this.stateCenter.ENV?[3,2]:[4,new Promise(function(e){wx.getNetworkType({success:function(t){T.stateCenter.networkState="none"===t.networkType?n.ENUM_NETWORK_STATE.offline:n.ENUM_NETWORK_STATE.online,e()},fail:function(t){T.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" network "+JSON.stringify(t)),T.stateCenter.networkState=n.ENUM_NETWORK_STATE.online,e()}})})];case 1:s.sent(),s.label=2;case 2:return o=this.loginReport(c,h,t,a),l=o.interResolve,g=o.interReject,!(a=a||{}).maxMemberCount&&(a.maxMemberCount=0),(f=u.checkParams({roomID:{order:0,value:e,rules:[{name:u.RULE_PARAM_NAME.NOT_EMPTY,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_NULL},{name:u.RULE_PARAM_NAME.TYPE_STRING,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:"roomID must be string"},{name:u.RULE_PARAM_NAME.MAX_LENGTH_128,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_TOO_LONG},{name:u.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:t,rules:[{name:u.RULE_PARAM_NAME.NOT_EMPTY,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM},{name:u.RULE_PARAM_NAME.TYPE_STRING,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM}]},user:{order:2,value:r,rules:[{name:u.RULE_PARAM_NAME.NOT_EMPTY,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."},{name:u.RULE_PARAM_NAME.TYPE_OBJECT,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:r.userID,rules:[{name:u.RULE_PARAM_NAME.NOT_EMPTY,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_NULL,extMsg:" param user error."},{name:u.RULE_PARAM_NAME.TYPE_STRING,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param userID error."},{name:u.RULE_PARAM_NAME.MAX_LENGTH_100,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_TOO_LONG},{name:u.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:r.userName,rules:[{name:u.RULE_PARAM_NAME.TYPE_STRING,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" userName must be string."},{name:u.RULE_PARAM_NAME.MAX_LENGTH_256,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_NAME_TOO_LONG}]},config:{order:5,value:a,rules:[]},"config.maxMemberCount":{order:6,value:a.maxMemberCount,rules:[{name:u.RULE_PARAM_NAME.TYPE_INTEGER,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM,logger:this.logger}))!==u.RULE_SUCCESS?(g(f.error,f.extMsg),[2]):(E=this.getRoomModules(e))?(g(_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.REPEATEDLY_LOGIN),[2]):(E=new p.LiveRoomModules(e,this.stateCenter,this.logger,this.dataReport,this.service),this.stateCenter.roomModulesList.length>0&&1==this.stateCenter.isMultiRoom?E.isMulti=!0:i([],this.stateCenter.roomModulesList).forEach(function(e){return e.roomHandler.logout()}),this.stateCenter.roomModulesList.push(E),E.roomTryHandler||(E.roomTryHandler=new d.RetryRoomHandler(this.logger,this.stateCenter,E)),E.roomTryHandler.init(this.stateCenter.roomRetryTime),E.roomTryHandler.initRoom(E.roomHandler,e,t,r,this.stateCenter.server,this.stateCenter.serverBak,a),E.roomTryHandler.onactive=function(e,t){e?l(e):g(t)},E.roomTryHandler.active(!0),this.stateCenter.setMultiRoom=!0,[2])}})})})},e.prototype.loginReport=function(e,t,r,o){var s=this;0!==this.stateCenter.reportSeqList.login&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.login),this.stateCenter.reportSeqList.login=0,l.ClientUtil.unregisterCallback(_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.stateCenter.reportList));var i=c.getReportSeq();return this.stateCenter.reportSeqList.login=i,this.dataReport.newReport(i,_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event),"string"==typeof r&&this.dataReport.addMsgInfo(i,{token:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.token(r),isMulti:this.stateCenter.isMultiRoom}),o&&(o.userUpdate&&"boolean"==typeof o.userUpdate&&this.dataReport.addMsgInfo(i,{user_update:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.user_update(o.userUpdate+"")}),o.maxMemberCount&&"number"==typeof o.maxMemberCount&&this.dataReport.addMsgInfo(i,{max_member_count:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.max_member_count(o.maxMemberCount+"")})),l.ClientUtil.logReportCallback(_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.dataReport,i,this.stateCenter.reportList),{interResolve:function(t){s.dataReport.uploadReport(i),s.stateCenter.reportSeqList.login=0,l.ClientUtil.unregisterCallback(_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,s.stateCenter.reportList),e(t)},interReject:function(e,r){var o,n;void 0===r&&(r=""),e.code<2e9&&e.code>1e9||e.code<1e6?(o=l.ClientUtil.decodeServerError(e.code,e.msg),n=l.ClientUtil.getLiveRoomError(e.code)):o={code:e.code,message:e.msg},o&&s.dataReport.addMsgInfo(i,{error:o.code,message:o.message+r}),s.dataReport.uploadReport(i),s.stateCenter.reportSeqList.login=0,l.ClientUtil.unregisterCallback(_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,s.stateCenter.reportList),n&&a.errorCodeList[n]&&(e.code=a.errorCodeList[n].code),t(e.code&&e.msg&&""!==r?{code:e.code,msg:e.msg+r}:e)}}},e.prototype.logoutRoom=function(e){var t=c.getReportSeq();if(this.dataReport.newReport(t),this.dataReport.addMsgInfo(t,{roomid:e,isMulti:this.stateCenter.isMultiRoom}),void 0===e)i([],this.stateCenter.roomModulesList).forEach(function(e){return e.roomHandler.logout(!0)});else{if("string"!=typeof e||""==e)return this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" roomID must be string and not empty"),this.dataReport.addMsgInfo(t,{error:_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.code,message:_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.msg+" param roomID error"}),void this.dataReport.uploadReport(t,_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event);var r=this.getRoomModules(e);r?(r.roomHandler.logout(),this.dataReport.uploadReport(t,_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event)):(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" room not exist"),this.dataReport.addMsgInfo(t,{error:_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.code,message:_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.msg}),this.dataReport.uploadReport(t,_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event))}},e.prototype.loginHall=function(e,t,r){var i=this;return new Promise(function(a,l){return o(i,void 0,void 0,function(){var o,i,c,d,u=this;return s(this,function(s){switch(s.label){case 0:return 3!==this.stateCenter.ENV?[3,2]:[4,new Promise(function(e){wx.getNetworkType({success:function(t){u.stateCenter.networkState="none"===t.networkType?n.ENUM_NETWORK_STATE.offline:n.ENUM_NETWORK_STATE.online,e()},fail:function(t){u.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" network "+JSON.stringify(t)),u.stateCenter.networkState=n.ENUM_NETWORK_STATE.online,e()}})})];case 1:s.sent(),s.label=2;case 2:return o=this.loginHallReport(a,l,e,r),i=o.interResolve,c=o.interReject,r=r||{},"string"!=typeof e||""==e?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" token format error"),c(_.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM,"token format error"),[2]):"object"!=typeof t||"string"!=typeof t.userID||"string"!=typeof t.userName?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" user error"),c(_.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM," user error"),[2]):"object"!=typeof r||"string"!=typeof r.deviceID?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" deviceID error"),c(_.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM," deviceID error"),[2]):"object"!=typeof r||"string"!=typeof r.deviceType?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" deviceType error"),c(_.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM," deviceType error"),[2]):"object"!=typeof r||1!==r.anType&&0!==r.anType?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" anType error"),c(_.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM," anType error"),[2]):((d=this.module).hallToken=e,d.deviceID=r.deviceID,d.deviceType=r.deviceType,d.anType=r.anType,this.stateCenter.idName=t.userID,this.stateCenter.nickName=t.userName||t.userID,this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+JSON.stringify(r)),r&&"boolean"==typeof r.roomFlag&&(d.roomFlag=r.roomFlag?1:0),r&&"boolean"==typeof r.testEnvironment&&(this.stateCenter.testEnvironment=r.testEnvironment),r&&"boolean"==typeof r.userUpdate&&(this.stateCenter.userStateUpdate=r.userUpdate),d.hallRunState!==n.ENUM_RUN_STATE.logout&&(d.hallHandler.resetHall(),d.hallHandler.hallStateHandle("DISCONNECTED",_.ZegoRTMLogEvent.kZegoTaskLoginHall.error.REPEATEDLY_LOGIN),d.setRoomRunState(n.ENUM_RUN_STATE.logout),d.roomPrivateHandler.resetRoom()),this.dispatchServer(function(){d.retryHallHandler||(d.retryHallHandler=new f.RetryHallHandler(u.logger,u.stateCenter,u.module)),d.retryHallHandler.init(u.stateCenter.roomRetryTime),d.retryHallHandler.initRoom(u.module.hallHandler,t,u.stateCenter.server,r),d.retryHallHandler.onactive=function(e,t){e?i(e):c(t)},d.retryHallHandler.active(!0)}),[2])}})})})},e.prototype.loginHallReport=function(e,t,r,o){var s=this;0!==this.stateCenter.reportSeqList.login&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.login),this.stateCenter.reportSeqList.login=0,l.ClientUtil.unregisterCallback(_.ZegoRTMLogEvent.kZegoTaskLoginHall.event,this.stateCenter.reportList));var i=c.getReportSeq();return this.stateCenter.reportSeqList.login=i,this.dataReport.newReport(i,_.ZegoRTMLogEvent.kZegoTaskLoginHall.event),"string"==typeof r&&this.dataReport.addMsgInfo(i,{token:_.ZegoRTMLogEvent.kZegoTaskLoginHall.token(r)}),o&&(o.userUpdate&&"boolean"==typeof o.userUpdate&&this.dataReport.addMsgInfo(i,{user_update:_.ZegoRTMLogEvent.kZegoTaskLoginHall.user_update(o.userUpdate+"")}),o.deviceID&&"string"==typeof o.deviceID&&this.dataReport.addMsgInfo(i,{user_update:_.ZegoRTMLogEvent.kZegoTaskLoginHall.device_id(o.deviceID)}),o.deviceType&&"string"==typeof o.deviceType&&this.dataReport.addMsgInfo(i,{user_update:_.ZegoRTMLogEvent.kZegoTaskLoginHall.device_type(o.deviceType)}),o.anType&&"number"==typeof o.anType&&this.dataReport.addMsgInfo(i,{user_update:_.ZegoRTMLogEvent.kZegoTaskLoginHall.an_type(o.anType+"")}),o.roomFlag&&"boolean"==typeof o.roomFlag&&this.dataReport.addMsgInfo(i,{user_update:_.ZegoRTMLogEvent.kZegoTaskLoginHall.room_flag(o.roomFlag+"")}),o.testEnvironment&&"boolean"==typeof o.testEnvironment&&this.dataReport.addMsgInfo(i,{user_update:_.ZegoRTMLogEvent.kZegoTaskLoginHall.test_environment(o.testEnvironment+"")})),l.ClientUtil.logReportCallback(_.ZegoRTMLogEvent.kZegoTaskLoginHall.event,this.dataReport,i,this.stateCenter.reportList),{interResolve:function(t){s.dataReport.uploadReport(i),s.stateCenter.reportSeqList.login=0,l.ClientUtil.unregisterCallback(_.ZegoRTMLogEvent.kZegoTaskLoginHall.event,s.stateCenter.reportList),e(t)},interReject:function(e,r){void 0===r&&(r=""),s.dataReport.addMsgInfo(i,{error:e.code,message:e.msg+r}),s.dataReport.uploadReport(i),s.stateCenter.reportSeqList.login=0,l.ClientUtil.unregisterCallback(_.ZegoRTMLogEvent.kZegoTaskLoginHall.event,s.stateCenter.reportList),t({code:e.code,msg:e.msg+r})}}},e.prototype.logoutHall=function(){var e=c.getReportSeq();this.dataReport.newReport(e),this.module.hallHandler.logout(),this.module.setRoomRunState(n.ENUM_RUN_STATE.logout),this.module.roomPrivateHandler.resetRoom(),this.dataReport.uploadReport(e,_.ZegoRTMLogEvent.kZegoTaskLogoutHall.event)},e.prototype.enterRoom=function(e,t){var r=this;return new Promise(function(o,s){var i=c.getReportSeq();if(r.dataReport.newReport(i),"string"!=typeof e||""==e||![0,1].includes(t))return r.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+" param error"),void o({errorCode:_.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.INPUT_PARAM.code,extendedData:_.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.INPUT_PARAM.msg});var a=r.module;if(!a.isLogin())return r.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+" no login hall before entering room"),void o({errorCode:_.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.NOT_LOGIN.code,extendedData:_.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.NOT_LOGIN.msg});a.runRoomState!==n.ENUM_RUN_STATE.logout&&(r.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+" reset"),r.module.roomPrivateHandler.resetRoom(),r.module.roomPrivateHandler.roomStateHandle("DISCONNECTED",_.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.REPEATEDLY_ENTER_ROOM)),a.pri_roomID=e,r.stateCenter.role=t,r.dataReport.addMsgInfo(i,{role:_.ZegoRTMLogEvent.kZegoTaskEnterRoom.role(t+"")}),a.setRoomRunState(n.ENUM_RUN_STATE.trylogin),a.roomPrivateHandler.roomStateHandle("CONNECTING",{code:0,msg:""});var l=function(t,l){if(t.body&&0!==t.body.code||1100002==t.code){a.setRoomRunState(n.ENUM_RUN_STATE.logout);var c=t.body&&t.body.code||t.code,d=t.body&&t.body.message||t.msg;a.roomPrivateHandler.roomStateHandle("DISCONNECTED",{code:c,msg:d}),r.dataReport.addMsgInfo(i,{error:c,message:d}),r.dataReport.uploadReport(i,_.ZegoRTMLogEvent.kZegoTaskEnterRoom.event),s({errorCode:c,extendedData:d})}else a.roomID=e,a.timeStamp=t.header.timeStamp,a.roomSid=t.body.room_header.room_sid,a.roomSessionID=t.body.room_header.room_user_session_id,a.userSeq=t.body.userlist_seq,r.dataReport.uploadReport(i,_.ZegoRTMLogEvent.kZegoTaskEnterRoom.event),a.setRoomRunState(n.ENUM_RUN_STATE.login),a.roomPrivateHandler.roomStateHandle("CONNECTED",{code:0,msg:""}),r.module.userHandler.loginPrivateRsp(t),a.roomLoginResponse(t),o({errorCode:0,extendedData:""})};setTimeout(function(){a.roomPrivateHandler.enterRoom(l,l)},20)})},e.prototype.leaveRoom=function(){var e=this;return new Promise(function(t){var r=c.getReportSeq();e.dataReport.newReport(r),e.module.roomPrivateHandler.roomStateHandle("DISCONNECTED",{code:0,msg:""});var o=function(o,s){0!==o.body.code?(e.dataReport.addMsgInfo(r,{error:o.body.code,message:o.body.message}),e.dataReport.uploadReport(r,_.ZegoRTMLogEvent.kZegoTaskLeaveRoom.event),t({errorCode:o.body.code,extendedData:o.body.message})):(e.dataReport.uploadReport(r,_.ZegoRTMLogEvent.kZegoTaskLeaveRoom.event),t({errorCode:0,extendedData:""}))};e.module.roomPrivateHandler.leaveRoom(o,o)})},e.prototype.sendCustomCommand=function(e,t,r){var o=this;return new Promise(function(s,i){o._sendCustomCommand(e,t,r).then(function(e){s({errorCode:e.errorCode,extendedData:e.extendedData})}).catch(function(e){i(e)})})},e.prototype._sendCustomCommand=function(e,t,r){var o=this;return new Promise(function(s,i){var d=c.getReportSeq();o.dataReport.newReport(d,_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.event);var u=l.ClientUtil.proxyRes(o.dataReport,d,s,i),h=u.interResolve,p=u.interReject;if("string"!=typeof e||""==e)return o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" roomid must be string and not empty"),void p(a.errorCodeList.INPUT_PARAM," param roomID error");if(!(r instanceof Array)||r.find(function(e){return"string"!=typeof e}))return o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" dstMembers must be string array"),void p(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param toUserList error");if("PUBLIC"===o.stateCenter.type&&"string"!=typeof t&&"object"!=typeof t)return o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" custom content must be a non empty string or object"),void p(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param command error");if("PRIVATE"===o.stateCenter.type&&"string"!=typeof t)return o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" custom content must be a not empty string"),void p(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param command error");if("string"==typeof t&&t.length>n.MAX_MESSAGE_LENGTH)return o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" command too long"),void p(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.IM_CONTENT_TOO_LONG);var g=o.getRoomModules(e);g?(o.dataReport.addMsgInfo(d,{room_sid:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.room_sid(g.sessionID)}),g.messageHandler.sendCustomCommand(r,t,h,p)):p(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.ROOM_NOT_EXIST)})},e.prototype.sendBroadcastMessage=function(e,t){var r=this;return new Promise(function(o,s){r._sendBroadcastMessage(e,t).then(function(e){o({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})}).catch(function(e){s(e)})})},e.prototype._sendBroadcastMessage=function(e,t,r,o){var s=this;return void 0===r&&(r=1),void 0===o&&(o=1),new Promise(function(i,a){var d=c.getReportSeq();s.dataReport.newReport(d,_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.event);var u=l.ClientUtil.proxyRes(s.dataReport,d,i,a),h=u.interResolve,p=u.interReject;if("string"!=typeof e||""==e)return s.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" roomid must be string and not empty"),void p(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error");if(void 0===t||""==t)return s.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message is empty"),void p(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_NULL);if("string"!=typeof t)return s.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message must be string"),void p(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param message error");if(t.length>n.MAX_MESSAGE_LENGTH)return s.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message too long"),void p(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_TOO_LONG);var g=s.getRoomModules(e);g?(s.dataReport.addMsgInfo(d,{room_sid:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.room_sid(g.sessionID)}),g.messageHandler.sendRoomMsg(r,o,e,t,h,p)):p(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.ROOM_NOT_EXIST)})},e.prototype.setRoomExtraInfo=function(e,t,r){return this._setRoomExtraInfo(e,t,r)},e.prototype._setRoomExtraInfo=function(e,t,r){var o=this;return new Promise(function(s,i){var a=c.getReportSeq();o.dataReport.newReport(a,_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.event);var d=l.ClientUtil.proxyRes(o.dataReport,a,s,i),u=d.interResolve,h=d.interReject;if("string"!=typeof e||""==e)return o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" roomid must be string and not empty"),void h(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error");if(!t||"string"!=typeof t)return o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type must be string"),void h({errorCode:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(t.length>n.MAX_TRANS_TYPE_LENGTH)return o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type is too long"),void h({errorCode:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(!r||"string"!=typeof r)return o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" data must be string"),void h({errorCode:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(r.length>n.MAX_TRANS_DATA_LENGTH)return o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type is too long"),void h({errorCode:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});var p=o.getRoomModules(e);p?(o.dataReport.addMsgInfo(a,{room_sid:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.room_sid(p.sessionID)}),p.messageHandler.sendReliableMessage(t,r,u,h)):h(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.ROOM_NOT_EXIST)})},e.prototype.sendBarrageMessage=function(e,t){var r=this;return new Promise(function(o,s){r._sendBarrageMessage(e,t).then(function(e){o({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})}).catch(function(e){s(e)})})},e.prototype._sendBarrageMessage=function(e,t,r,o){var s=this;return void 0===r&&(r=1),void 0===o&&(o=1),new Promise(function(i,a){var d=c.getReportSeq();s.dataReport.newReport(d,_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.event);var u=l.ClientUtil.proxyRes(s.dataReport,d,i,a),h=u.interResolve,p=u.interReject;if("string"!=typeof e||""==e)return s.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+"roomid must be string and not empty"),void p(_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param roomID error");if(void 0===t||""==t)return s.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message is empty"),void p(_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_NULL);if("string"!=typeof t)return s.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message must be string"),void p(_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param message error");if(t.length>n.MAX_MESSAGE_LENGTH)return s.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message too long"),void p(_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_TOO_LONG);var g=s.getRoomModules(e);g?(s.dataReport.addMsgInfo(d,{room_sid:_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.room_sid(g.sessionID)}),g.messageHandler.sendBigRoomMessage(r,o,e,t,h,p)):p(_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.ROOM_NOT_EXIST)})},e.prototype.sendRelayMessage=function(e,t,r,o,s){var i=this.getRoomModules(s)||this.stateCenter.roomModulesList[0];i?i.messageHandler.sendRelayMessage(e,t,r,o):o&&o(a.errorCodeList.ROOM_NOT_EXIST,0)},e.prototype.requestJoinLive=function(e,t,r,o,s){var i=this.getRoomModules(s)||this.stateCenter.roomModulesList[0];return i?i.liveHandler.requestJoinLive(e,t,r,o):(r&&r(a.errorCodeList.ROOM_NOT_EXIST,0),!1)},e.prototype.inviteJoinLive=function(e,t,r,o,s){var i=this.getRoomModules(s)||this.stateCenter.roomModulesList[0];return i?i.liveHandler.inviteJoinLive(e,t,r,o):(r&&r(a.errorCodeList.ROOM_NOT_EXIST,0),!1)},e.prototype.endJoinLive=function(e,t,r,o){var s=this.getRoomModules(o)||this.stateCenter.roomModulesList[0];return s?s.liveHandler.endJoinLive(e,t,r):(r&&r(a.errorCodeList.ROOM_NOT_EXIST,0),!1)},e.prototype.respondJoinLive=function(e,t,r,o,s){var i=this.getRoomModules(s)||this.stateCenter.roomModulesList[0];return i?i.liveHandler.respondJoinLive(e,t,r,o):(o&&o(a.errorCodeList.ROOM_NOT_EXIST,0),!1)},e.prototype.getVersion=function(){return this.version},e.prototype.setSdkBizVersion=function(e){"string"==typeof e&&""!==e&&(this.stateCenter.bizVersion=e)},e.prototype.setSdkLoginRelateService=function(e){Array.isArray(e)&&e.every(function(e){return"string"==typeof e})&&(this.stateCenter.relateService=e)},e.prototype.on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+e+" no found"),!1)},e.prototype.off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype._on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+e+" no found"),!1)},e.prototype._off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype.isTestEnvironment=function(){return this.stateCenter.testEnvironment},e.prototype.isLogin=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return!!t&&t.isLogin()},e.prototype.getMultiRoom=function(){return this.stateCenter.isMultiRoom},e.prototype.getAppID=function(){return this.stateCenter.appid},e.prototype.getUserID=function(){return this.stateCenter.idName},e.prototype.getToken=function(e){return(this.getRoomModules(e)||this.stateCenter.roomModulesList[0]).token},e.prototype.getAnType=function(){return this.module.anType},e.prototype.getRoomSid=function(){return this.module.roomSid},e.prototype.setRoomCreateFlag=function(e){this.stateCenter.roomCreateFlag=e},e.prototype.setRole=function(e){this.stateCenter.role=e},e.prototype.getSessionId=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return t?t.sessionID:"0"},e.prototype.getRoomSessionID=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return t?t.roomSessionID:"0"},e.prototype.sendPB=function(e){return e instanceof Uint8Array?this.service.sendPB(e):(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_PB+" type error"),!1)},e.prototype.getHeader=function(e){var t=this.stateCenter.roomModulesList[0];if(t&&t.isLogin())return this.service.getHeader(e,t.sessionID,t.roomID,t.roomSessionID);this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_GET_HEADER+" room no found or no login")},e.prototype.enableMultiRoom=function(e){var t=c.getReportSeq();return this.dataReport.newReport(t,_.ZegoRTMLogEvent.kZegoEnableMultiRoom.event),this.dataReport.addMsgInfo(t,{isMulti:e}),"boolean"!=typeof e?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM+" param must be boolean"),this.dataReport.uploadReport(t,void 0,_.ZegoRTMLogEvent.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):this.stateCenter.roomModulesList.length>0||this.stateCenter.setMultiRoom?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM+" multi room can only be set once before first login"),this.dataReport.uploadReport(t,void 0,_.ZegoRTMLogEvent.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):(this.dataReport.uploadReport(t),this.stateCenter.isMultiRoom=e,this.stateCenter.setMultiRoom=!0,!0)},e.prototype.getRoomModules=function(e){return this.stateCenter.roomModulesList.find(function(t){return t.roomID==e})},e.prototype.dispatchServer=function(e){var t=this;this.logger.info("zc.hh.dc call");var r=this.dispatchBodyData(),o=this.module.dispatchServer;if(l.ClientUtil.actionSuccessCallback(_.ZegoRTMLogEvent.kZegoTaskLoginHall.event,this.stateCenter.reportList)&&l.ClientUtil.actionSuccessCallback(_.ZegoRTMLogEvent.kZegoTaskLoginHall.event,this.stateCenter.reportList)(n.REPORT_ACTION.eventStart,_.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.dispatch_connection.event),XMLHttpRequest){var s=new XMLHttpRequest;s.open("POST",o),s.setRequestHeader("Content-type","application/json; charset=utf-8"),s.onreadystatechange=function(){if(200==s.status&&4==s.readyState&&s.responseText&&""!==s.responseText){var r=JSON.parse(s.responseText);r.server_addrs&&0!==r.server_addrs.length&&(t.stateCenter.server=r.server_addrs[0].replace(":443",""),t.module.sessionExpire=r.session_expire+"",l.ClientUtil.actionSuccessCallback(_.ZegoRTMLogEvent.kZegoTaskLoginHall.event,t.stateCenter.reportList)&&l.ClientUtil.actionSuccessCallback(_.ZegoRTMLogEvent.kZegoTaskLoginHall.event,t.stateCenter.reportList)(n.REPORT_ACTION.eventEndWithMsgInfo,_.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.dispatch_connection.event,{server:t.stateCenter.server,session_expire:t.module.sessionExpire}),e&&e())}},s.send(JSON.stringify(r))}else wx.request({url:o,header:{"Content-Type":"application/json"},method:"POST",data:JSON.stringify(r),dataType:"json",success:function(r){r.data.server_addrs&&0!==r.data.server_addrs.length&&(t.stateCenter.server=r.data.server_addrs[0].replace(":443",""),t.module.sessionExpire=r.data.session_expire+"",e&&e())},fail:function(e){console.error("send failed "+e.statusCode)}})},e.prototype.dispatchBodyData=function(){return{seq:1,timestamp:(new Date).getTime,app_id:this.stateCenter.appid,user_id:this.stateCenter.idName,user_name:this.stateCenter.nickName,net_type:2,device_id:this.module.deviceID,login_token:this.module.hallToken,an_type:this.module.anType}},e.prototype.getRoomBroadcastMessages=function(e,t){var r=this;return new Promise(function(o,s){r.module.messageHandler.getRoomChatInfo(e,t,o,s)})},e.prototype.sendCustomMessage=function(e,t,r){var o=this;return new Promise(function(s){if(e&&"string"==typeof e&&0===e.length)if(t&&"string"==typeof t)if(r)if(o.module.isLogin()){var i=function(e){if(e.body.code&&0!==e.body.code)return o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" server error=",e.body.code),void s(e);s(e),o.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" call success.")};o.module.service.sendMessage(e,r,i,i)}else o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" hallState is not login");else o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" rsbodyDatapCmd error");else o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" rspCmd error");else o.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" reqCmd error")})},e.prototype.getQueueSimpleList=function(){var e=this;return new Promise(function(t,r){e.sendCustomMessage("zegochat_js.queue_list_req","zegochat_js.queue_list_rsp",{}).then(function(o){o.body.code&&0!==o.body.code?(e.logger.error("zc.gqs.0 get list error, code = "+o.body.code),r({errorCode:o.body.code,extendData:o.body.message})):t({queues:o.body.queues})})})},e.prototype.setProtoFormat=function(e){if(void 0===e&&(e="json"),!["json","pb"].includes(e))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.stateCenter.protoFormat=e},e}();t.ZegoExpressWebRTM=v},function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(o,s,(function(t){return e[t]}).bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.E_CLIENT_TYPE=t.ENUM_LOG_LEVEL=t.ENUM_REMOTE_TYPE=t.ZEGO_ENV=t.ZEGO_BROWSER_TYPE=void 0,function(e){e[e.IE=0]="IE",e[e.FIREFOX=1]="FIREFOX",e[e.CHROME=2]="CHROME",e[e.SAFARI=3]="SAFARI",e[e.OPERA=4]="OPERA",e[e.WEIXIN=5]="WEIXIN",e[e.WEIXINMINI=6]="WEIXINMINI",e[e.UNKOWN=7]="UNKOWN"}(t.ZEGO_BROWSER_TYPE||(t.ZEGO_BROWSER_TYPE={})),function(e){e[e.BROWSER=0]="BROWSER",e[e.WEIXINMINI=1]="WEIXINMINI"}(t.ZEGO_ENV||(t.ZEGO_ENV={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.WEBSOCKET=1]="WEBSOCKET",e[e.HTTPS=2]="HTTPS"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=void 0;var o=function(){function e(){this._testEnvironment=!0,this._ENV=0,this._debug=!0}return e.getInstance=function(){return e.instance||(e.instance=new e).init(),e.instance},e.prototype.init=function(){},Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._ENV},set:function(e){this._ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e},enumerable:!1,configurable:!0}),e.instance=new e,e}();t.LoggerStateCenter=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.ZegoWeiXinMiniWebSocket=void 0;var o=r(0),s=function(){function e(e,t){this.url=e,this.readyState=3,this._websocket=wx.connectSocket({url:e}),this.init()}return e.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen(function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose(function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onclose&&e.onclose(t)}),e._websocket.onMessage(function(t){"function"==typeof e.onmessage&&e.onmessage(t)}))}),this._websocket.onError(function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onerror&&e.onerror(t)}))},e.prototype.onopen=function(e){},e.prototype.onerror=function(e){},e.prototype.onclose=function(e){},e.prototype.onmessage=function(e){},e.prototype.send=function(e){this._websocket&&this._websocket.send({data:e})},e.prototype.close=function(){this._websocket&&this._websocket.close()},e}();t.ZegoWeiXinMiniWebSocket=s,t.createZegoWebSocket=function(e,t){return t%2===o.ZEGO_ENV.BROWSER?new WebSocket(e):new s(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=t.createZegoWebSocket=t.ZegoDataReport=t.ZegoLogger=void 0;var o=r(1);Object.defineProperty(t,"LoggerStateCenter",{enumerable:!0,get:function(){return o.LoggerStateCenter}});var s=r(2);Object.defineProperty(t,"createZegoWebSocket",{enumerable:!0,get:function(){return s.createZegoWebSocket}});var i=r(4);Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return i.ZegoDataReport}});var n=r(5);Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return n.ZegoLogger}})},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoDataReport=void 0;var s=function(){function e(e){this.dataStatistics={},this.logger=e}return e.prototype.newReport=function(e,t){this.dataStatistics[e]={event_time:Date.now(),time_consumed:0,seq:e,error:0,message:"success",event:t,events:[]}},e.prototype.addMsgExt=function(e,t){this.dataStatistics[e]?this.dataStatistics[e].msg_ext=t:console.warn(e+" not exist")},e.prototype.addMsgInfo=function(e,t){this.dataStatistics[e]?Object.assign(this.dataStatistics[e],t):console.warn(e+" not exist")},e.prototype.eventStart=function(e,t){this.dataStatistics[e]?null!=this.dataStatistics[e].events?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},e.prototype.eventEnd=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o&&0!==o.length){for(var s=o.length-1;s>=0;s--)if(o[s].event==t&&0==o[s].time_consumed){o[s].time_consumed=Date.now()-o[s].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},e.prototype.eventEndWithMsg=function(e,t,r){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(s){for(var i=s.length-1;i>=0;i--)if(s[i].event==t&&0==s[i].time_consumed){s[i].time_consumed=Date.now()-s[i].event_time,null==s[i].msg_ext&&(s[i].msg_ext={}),s[i].msg_ext=o({},r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.eventEndWithMsgInfo=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o){for(var s=o.length-1;s>=0;s--)if(o[s].event==t&&0==o[s].time_consumed){o[s].time_consumed=Date.now()-o[s].event_time,Object.assign(o[s],r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.addEventInfo=function(e,t,r,o){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(null!=s){for(var i=s.length-1;i>=0;i--)if(s[i].event==t&&null!=s[i].time_consumed){null==s[i].msg_ext?s[i].msg_ext={}:s[i].msg_ext&&(s[i].msg_ext[r]=o);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},e.prototype.addEventMsg=function(e,t,r,o){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(null!=s){for(var i=s.length-1;i>=0;i--)if(s[i].event==t){s[i][r]=o;break}}else this.logger.warn("zd.aem.0 no events")}else this.logger.warn("zd.aem.0 no seq match")},e.prototype.addEvent=function(e,t,r){this.dataStatistics[e]?this.dataStatistics[e].events&&this.dataStatistics[e].events.push(r?{event:t,event_time:Date.now(),msg_ext:r}:{event:t,event_time:Date.now()}):this.logger.warn("zd.ae.0 no seq match")},e.prototype.uploadReport=function(e,t,r,o){var s=this.dataStatistics[e];null!=s&&(t&&(s.event=t),s.time_consumed=Date.now()-s.event_time,r&&this.addMsgInfo(e,{error:r.code,message:r.message||r.msg+" "+(o||"")}),this.logger.report(s),delete this.dataStatistics[e])},e}();t.ZegoDataReport=s},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLogger=void 0;var s=r(0),i=r(2),n=r(1),a=r(6),l=function(){function e(e){this.logLevel=s.ENUM_LOG_LEVEL.INFO,this.logRemoteLevel=0,this.websocket=null,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100,this.existUserID=!1,this.stateCenter=n.LoggerStateCenter.getInstance(),this.env=e}return e.prototype.setLogLevel=function(e){var t=s.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logLevel=t,!0)},e.prototype.setRemoteLogLevel=function(e){var t=s.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logRemoteLevel=t,!0)},e.prototype.setSessionInfo=function(e,t,r,o,s,i){this.appid=e,this.roomid=t,this.sessionid=r,this.userid=o,this.userName=s,this.version=i},e.prototype.report=function(e){var t=this.logReportParamList(s.ENUM_LOG_LEVEL.REPORT,e);this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.REPORT&&console.debug(t),this.RemoteLog(s.ENUM_LOG_LEVEL.REPORT,t,!0)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.DEBUG,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.DEBUG&&console.debug(r),this.log(s.ENUM_LOG_LEVEL.DEBUG,r)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.INFO,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.INFO&&console.info(r),this.log(s.ENUM_LOG_LEVEL.INFO,r)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.WARN,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.WARN&&console.warn(r),this.log(s.ENUM_LOG_LEVEL.WARN,r)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.ERROR,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.ERROR&&(console.error(r),window?this.stateCenter.debug&&window.alert(e.join("").substr(e.join("").indexOf(" ")+1,4500)):wx&&this.stateCenter.debug&&wx.showModal({title:"",content:e.join("").substr(e.join("").indexOf(" ")+1,4500)})),this.log(s.ENUM_LOG_LEVEL.ERROR,r)},e.prototype.log=function(e,t){this.logRemoteLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logRemoteLevel<=e&&this.RemoteLog(e,t)},e.prototype.setLogServer=function(e){try{return e.startsWith("wss:")?(this.logType=s.ENUM_REMOTE_TYPE.WEBSOCKET,this.openWebSocketLogServer(e)):e.startsWith("https:")?(this.logType=s.ENUM_REMOTE_TYPE.HTTPS,this.openHttpsLogServer(e)):this.logType=s.ENUM_REMOTE_TYPE.DISABLE,!0}catch(e){return this.error(JSON.stringify(e)),!1}},e.prototype.stopLogServer=function(){this.logType==s.ENUM_REMOTE_TYPE.WEBSOCKET?this.stopWebSocketServer():this.logType==s.ENUM_REMOTE_TYPE.HTTPS&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=s.ENUM_REMOTE_TYPE.DISABLE},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},e.prototype.openHttpsLogServer=function(e){var t=this;this.url=e,e&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval(function(){t.SendHttpsLog()},this.logUploadInterval)))},e.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},e.prototype.RemoteLog=function(e,t,r){if(void 0===r&&(r=!1),""!=this.url)if(this.logType==s.ENUM_REMOTE_TYPE.WEBSOCKET)this.RemoteWebSocketLog(e,t);else if(this.logType==s.ENUM_REMOTE_TYPE.HTTPS)this.RemoteHttpsLog(e,t,r);else if(this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=e)for(this.logCacheSend.push(t);this.logCacheSend.length>this.logCacheMax;)this.logCacheSend.shift()},e.prototype.RemoteWebSocketLog=function(e,t){if("string"==typeof t&&t.length>4e3)console.info("log over maximum, ignore");else if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState){var r=this.url;this.url="",this.setLogServer(r),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)}else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var s="",i=0;i<this.logCacheSend.length;i++){(s+this.logCacheSend[i]).length>4e3&&(this.websocket.send(s),s="");var n=JSON.parse(this.logCacheSend[i]);n=o(o({},n),{userid:n.userid||this.userid,roomid:n.roomid||this.roomid,userName:n.roomid||this.userName}),s=s+JSON.stringify(n)+"\n"}t=s+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else console.warn("wrong socket state:"+this.websocket.readyState),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.RemoteHttpsLog=function(e,t,r){this.logCacheSend.push(t),(this.logCacheSend.length>=this.logCacheMax||!0===r)&&this.SendHttpsLog()},e.prototype.logParamList=function(e,t){var r=a.getCurrentTime(),o=[t.substr(0,t.indexOf(" "))||t,t.substr(t.indexOf(" ")+1,4500)||t];return JSON.stringify({time:r,level:e,action:o[0],content:o[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid})},e.prototype.logReportParamList=function(e,t){var r=a.getCurrentTime();return t=o(o({},t),{time:r,level:e,console:this.env%2===s.ZEGO_ENV.BROWSER?"rtc":"xcx",appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+t.event_time+"_"+t.seq}),JSON.stringify(t)},e.prototype.openWebSocketLogServer=function(e){if(this.url!=e){if(this.url=e,!e)return;this.stopWebSocketServer(),this.websocket=i.createZegoWebSocket(e,this.env),this.websocket.onopen=function(){},this.websocket.onclose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn("onclose   websocket error:",e)},this.websocket.onmessage=function(){},this.websocket.onerror=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn("open log websocket error:",e)}}},e.prototype.SendHttpsLog=function(){0!=this.logCacheSend.length&&(this.env%2===s.ZEGO_ENV.BROWSER?this.SendHttpsLogWeb():this.SendHttpsLogWeChatMini())},e.prototype.SendHttpsLogWeb=function(){var e=this,t=this.logCacheSend.join("\n"),r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){if(0==r.responseText.length)return;try{var t=JSON.parse(r.responseText).interval;"number"==typeof t&&e.logUploadInterval!==t&&(e.timeInterval=t,e.openHttpsLogServer(e.url))}catch(e){console.log("send result failed "+e)}}else console.log("send failed "+r.status)},r.open("POST",this.url,!0),0==this.env?r.send(t):2==this.env&&(r.setRequestHeader("content-type","application/json"),r.send(JSON.stringify({user_id:this.userid,log:t}))),this.logCacheSend=[]},e.prototype.SendHttpsLogWeChatMini=function(){var e=this;!this.existUserID&&this.userid&&this.logCacheSend.forEach(function(t){Array.isArray(t)&&t.forEach(function(r,o){var s=JSON.parse(r);s&&""==JSON.parse(r).userid?(s.userid=e.userid,s.id_name=e.userid,t[o]=JSON.stringify(s)):e.existUserID=!0})});var t=this.logCacheSend.join("\n"),r=1==this.env?t:JSON.stringify({user_id:this.userid,log:t});wx.request({url:this.url,data:r,method:"POST",success:function(t){if(0!=t.data.length){var r=t&&t.data&&t.data.interval;"number"==typeof r&&e.logUploadInterval!==r&&(e.timeInterval=r,e.openHttpsLogServer(e.url))}},fail:function(e){console.log("send failed "+e.statusCode)}}),this.logCacheSend=[]},e}();t.ZegoLogger=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTime=t.getCurrentEnv=t.getBrowser=void 0;var o=r(0);t.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),s=null!=window.opr,i=e.indexOf("Chrome")&&window.chrome,n=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version"),a=e.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===e.toLowerCase().match(/MicroMessenger/i)[0];return t?o.ZEGO_BROWSER_TYPE.IE:r?o.ZEGO_BROWSER_TYPE.FIREFOX:s?o.ZEGO_BROWSER_TYPE.OPERA:i?o.ZEGO_BROWSER_TYPE.CHROME:n?o.ZEGO_BROWSER_TYPE.SAFARI:a?o.ZEGO_BROWSER_TYPE.WEIXIN:o.ZEGO_BROWSER_TYPE.UNKOWN},t.getCurrentEnv=function(){var e=window.navigator.userAgent;return new Promise(function(t){-1==e.indexOf("MicroMessage")?t(o.ZEGO_ENV.BROWSER):wx.miniProgram.getEnv(function(e){})})};var s=["00","01","02","03","04","05","06","07","08","09"];t.getCurrentTime=function(){var e=new Date;return[e.getFullYear()+"/",(s[e.getMonth()+1]||e.getMonth()+1)+"/",(s[e.getDate()]||e.getDate())+" ",(s[e.getHours()]||e.getHours())+":",(s[e.getMinutes()]||e.getMinutes())+":",s[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")}}])},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Base64=void 0;var o=function(){function e(){}return e.base64encode=function(t){var r,o,s,i,n,a;for(s=t.length,o=0,r="";o<s;){if(i=255&t.charCodeAt(o++),o==s){r+=e.base64EncodeChars.charAt(i>>2),r+=e.base64EncodeChars.charAt((3&i)<<4),r+="==";break}if(n=t.charCodeAt(o++),o==s){r+=e.base64EncodeChars.charAt(i>>2),r+=e.base64EncodeChars.charAt((3&i)<<4|(240&n)>>4),r+=e.base64EncodeChars.charAt((15&n)<<2),r+="=";break}a=t.charCodeAt(o++),r+=e.base64EncodeChars.charAt(i>>2),r+=e.base64EncodeChars.charAt((3&i)<<4|(240&n)>>4),r+=e.base64EncodeChars.charAt((15&n)<<2|(192&a)>>6),r+=e.base64EncodeChars.charAt(63&a)}return r},e.base64decode=function(t){var r,o,s,i,n,a,l;for(a=t.length,n=0,l="";n<a;){do{r=e.base64DecodeChars[255&t.charCodeAt(n++)]}while(n<a&&-1==r);if(-1==r)break;do{o=e.base64DecodeChars[255&t.charCodeAt(n++)]}while(n<a&&-1==o);if(-1==o)break;l+=String.fromCharCode(r<<2|(48&o)>>4);do{if(61==(s=255&t.charCodeAt(n++)))return l;s=e.base64DecodeChars[s]}while(n<a&&-1==s);if(-1==s)break;l+=String.fromCharCode((15&o)<<4|(60&s)>>2);do{if(61==(i=255&t.charCodeAt(n++)))return l;i=e.base64DecodeChars[i]}while(n<a&&-1==i);if(-1==i)break;l+=String.fromCharCode((3&s)<<6|i)}return l},e.utf16to8=function(e){var t,r,o,s;for(t="",o=e.length,r=0;r<o;r++)(s=e.charCodeAt(r))>=1&&s<=127?t+=e.charAt(r):s>2047?(t+=String.fromCharCode(224|s>>12&15),t+=String.fromCharCode(128|s>>6&63),t+=String.fromCharCode(128|s>>0&63)):(t+=String.fromCharCode(192|s>>6&31),t+=String.fromCharCode(128|s>>0&63));return t},e.utf8to16=function(e){var t,r,o,s,i,n;for(t="",o=e.length,r=0;r<o;)switch((s=e.charCodeAt(r++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(r-1);break;case 12:case 13:i=e.charCodeAt(r++),t+=String.fromCharCode((31&s)<<6|63&i);break;case 14:i=e.charCodeAt(r++),n=e.charCodeAt(r++),t+=String.fromCharCode((15&s)<<12|(63&i)<<6|(63&n)<<0)}return t},e.base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e.base64DecodeChars=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],e}();t.Base64=o},function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryRoomHandler=void 0;var i=r(5),n=r(0),a=r(2),l=r(1),c=r(3),d=function(e){function t(t,r,o){var s=e.call(this,t,r)||this;return s.logger=t,s.stateCenter=r,s.room=o,s}return s(t,e),t.prototype.renewToken=function(e){if(this.token=e,this.room.token=this.token,"03"===e.substr(0,2)){var t=c.ClientUtil.decodeTokenExpire(e.substr(2));this.roomHandler.resetTokenTimer(1e3*t-(new Date).getTime()-this.stateCenter.local_time_deviation-3e4)}this.stateCenter.actionListener("_tokenRenewed",e,this.room.roomID)},t.prototype.initRoom=function(e,t,r,o,s,i,n){this.roomHandler=e,this.roomID=t,this.renewToken(r),this.user=o,this.server=s,this.serverBak=i||s,this.config=n},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry call"),this.roomHandler.setRunState(n.ENUM_RUN_STATE.trylogin),this.room.isMulti&&this.room.service.isDisConnect())this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" service is disconnected, multi room stop retry");else if(this.stateCenter.networkState!=n.ENUM_NETWORK_STATE.offline)if(this.retryTimer)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" has actived, ignore");else if(this.isOverTime)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry over time, stop retry");else{if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r}this.retryTimer=setTimeout(function(){t.roomHandler.login(t.retryActiveCount%2==1?t.server:t.serverBak,t.roomID,t.token,t.user,t.config,function(e){t.handleLoginFinish(e)},function(e,r){t.handleLoginFinish(!1,e,r)}),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++},e?0:1e3*this.retryActiveInterval)}else this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" network is broken, stop retry")},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout(function(){e.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.roomHandler.resetRoom(),e.stopMaxTime(),e.invalid(),e.onactive(!1,l.errorCodeList.LOGIN_TIMEOUT)},1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(e,t){},t.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){var r=e.code+"";return!["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"].includes(r)&&(!!["1100040001","1100040100"].includes(r)||this.room.lastRunState==n.ENUM_RUN_STATE.login&&(this.room.sessionID="",this.invalid(),!0))}return!0},t.prototype.handleLoginFinish=function(e,t,r){t?this.handleError(t,r)?(!this.maxTimer&&this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(e,t)):(this.stopMaxTime(),this.invalid(),this.onactive(e,{code:0,msg:""}))},t}(i.TryHandler);t.RetryRoomHandler=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkParams=t.RULE_SUCCESS=t.RULE_PARAM_NAME=void 0;var o,s=r(3);!function(e){e.NOT_EMPTY="NOT_EMPTY",e.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",e.TYPE_STRING="TYPE_STRING",e.TYPE_INTEGER="TYPE_INTEGER",e.TYPE_OBJECT="TYPE_OBJECT",e.MAX_LENGTH_10="MAX_LENGTH_10",e.MAX_LENGTH_64="MAX_LENGTH_64",e.MAX_LENGTH_100="MAX_LENGTH_100",e.MAX_LENGTH_128="MAX_LENGTH_128",e.MAX_LENGTH_256="MAX_LENGTH_256",e.MAX_LENGTH_1024="MAX_LENGTH_1024"}(o=t.RULE_PARAM_NAME||(t.RULE_PARAM_NAME={})),t.RULE_SUCCESS={error:{code:0,msg:"suc"}};var i={NOT_EMPTY:function(e,r,o,s,i){return void 0===r||""===r||null===r?(s.error(o+" "+e+" is empty"),i):t.RULE_SUCCESS},ILLEGAL_CHARACTERS:function(e,r,o,i,n){return s.ClientUtil.checkIllegalCharacters(r)?t.RULE_SUCCESS:(i.error(o+" "+e+" contains illegal characters"),n)},TYPE_STRING:function(e,r,o,s,i){return"string"!=typeof r?(s.error(o+" "+e+" must be string"),i):t.RULE_SUCCESS},TYPE_INTEGER:function(e,r,o,i,n){return s.ClientUtil.checkInteger(r,!1)?t.RULE_SUCCESS:(i.error(o+" "+e+"  must be integer number"),n)},TYPE_OBJECT:function(e,r,o,s,i){return r&&"object"==typeof r?t.RULE_SUCCESS:(s.error(o+" "+e+"  must be object"),i)},MAX_LENGTH_10:function(e,r,o,s,i){return r.length>10?(s.error(o+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_64:function(e,r,o,s,i){return r.length>64?(s.error(o+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_100:function(e,r,o,s,i){return r.length>100?(s.error(o+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_128:function(e,r,o,s,i){return r.length>128?(s.error(o+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_256:function(e,r,o,s,i){return r.length>256?(s.error(o+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_1024:function(e,r,o,s,i){return r.length>1024?(s.error(o+" "+e+" is too long"),i):t.RULE_SUCCESS}};t.checkParams=function(e,r){var s=[],n={};for(var a in e)n[e[a].order]=e[a],e[a].key=a;for(var l in n)s.push(n[l]);for(var c=0;c<s.length;c++)for(var d=s[c].rules,u=0;u<d.length;u++){var h={key:s[c].key,value:s[c].value,action:r.action,logger:r.logger},p=h.value,g=d[u].name?""+d[u].name:"";if((void 0===p&&g===o.NOT_EMPTY||void 0!==p)&&i[g]){var m=i[g](h.key,p,h.action,h.logger,d[u]);if(m!=t.RULE_SUCCESS)return m}}return t.RULE_SUCCESS}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0;var o=r(0),s=r(2),i=r(4),n=function(){function e(e,t){this.logger=e,this.dataReport=t,this._debug=!1,this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=o.ENUM_NETWORK_STATE.offline,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this._sdkVersion="unknown"}return Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,o.LoggerStateCenter.getInstance().debug=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e,o.LoggerStateCenter.getInstance().testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._env},set:function(e){this._env=e,o.LoggerStateCenter.getInstance().ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),e.prototype.getRequestId=function(){return this.idName+"-"+o.getSeq()},e.prototype.actionListener=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(this.listenerList[e]){var a=o.getReportSeq();this.dataReport.newReport(a,i.ZegoRTMLogEvent.kZegoListener.event),this.dataReport.addMsgInfo(a,{listener:e,params:r}),this.dataReport.uploadReport(a)}this.listenerList[e]&&this.listenerList[e].forEach(function(o){try{o.apply(void 0,r)}catch(r){t.logger.error(s.ZEGO_RTM_ACTION.STATE_ACTION+" ",e," ",JSON.stringify(r))}})},Object.defineProperty(e.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(e){this._sdkVersion=e},enumerable:!1,configurable:!0}),e}();t.StateCenter=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomModules=void 0;var o=r(0),s=r(6),i=r(7),n=r(8),a=r(20),l=r(9),c=function(){function e(e,t,r,c,d){this.roomID=e,this.stateCenter=t,this.logger=r,this.dataReport=c,this.service=d,this.runState=o.ENUM_RUN_STATE.logout,this.lastRunState=o.ENUM_RUN_STATE.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomSessionID="0",this.sessionID="0",this.isMulti=!1,this.token="",this.thirdToken="",this.roomHandler=new a.RoomHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.heartBeatHandler=new s.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.userHandler=new l.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.messageHandler=new n.MessageHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.liveHandler=new i.LiveHandler(this.logger,this.stateCenter,this.service,this),this.init()}return e.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},e.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(t){e.roomHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t){e.messageHandler.loginRsp(t),e.userHandler.patchUserList(t),e.HBResponse(t)}},e.prototype.bindRoomHandler=function(){var e=this;this.roomHandler.loginSuccessCallBack=function(t,r){e.heartBeatHandler.init(r),e.service.startCheck(),e.userHandler.loginRsp(r,t),e.messageHandler.loginRsp(r),e.handleMultiRoom(),e.roomLoginResponse(r)},this.roomHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.liveHandler.resetLiveHandler(),e.messageHandler.resetMessageInfo(),e.userHandler.resetUserHandler(),e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.stopMaxTime(),e.roomTryHandler=void 0)}},e.prototype.bindUserHandler=function(){},e.prototype.bindMessageHandler=function(){},e.prototype.bindLiveHandler=function(){},e.prototype.HBResponse=function(e){this.stateCenter.actionListener("HBResponse",e)},e.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},e.prototype.handleMultiRoom=function(){this.stateCenter.roomModulesList.forEach(function(e){e.runState!==o.ENUM_RUN_STATE.login&&e.roomTryHandler&&1==e.isMulti&&(e.roomTryHandler.onactive=function(t,r){e.roomHandler.roomStateHandle(r&&0!==r.code?"DISCONNECTED":"CONNECTED",r)},e.roomTryHandler.startMaxTime(),e.roomTryHandler.active())})},e.prototype.isLogin=function(){return this.runState===o.ENUM_RUN_STATE.login},e}();t.LiveRoomModules=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomHandler=void 0;var o=r(0),s=r(3),i=r(2),n=r(1),a=r(4),l=function(){function e(e,t,r,o,s){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=s,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4,this.tokenTimer=null,this.beforeExpire=30}return e.prototype.resetTokenTimer=function(e){var t=this;e=(e=e<0?0:e)>2147483648?2147483648:e,this.logger.info(i.ZEGO_RTM_ACTION.ROOM_RESETTOKEN_TIMER+"  call: "+e),this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=setTimeout(function(){t.stateCenter.actionListener("tokenWillExpire",t.room.roomID),t.stateCenter.actionListener("roomTokenWillExpire",t.room.roomID)},e)},e.prototype.stopTokenTimer=function(){clearTimeout(this.tokenTimer)},e.prototype.setRunState=function(e){this.room.lastRunState=this.room.runState,this.room.runState=e},e.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},e.prototype.resetRoom=function(e){var t=this;if(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call"),this.stateCenter.roomModulesList.length>1&&!e&&(this.room.isMulti=!0),this.resetTryLogin(),"0"!==this.room.sessionID&&this.room.runState!==o.ENUM_RUN_STATE.logout){var r=function(e){t.handleLogoutRsp(e)};this.service.logout(this.room,r,r)}this.setRunState(o.ENUM_RUN_STATE.logout),this.room.sessionID="",this.room.roomSessionID="",this.room.isMulti||(this.stateCenter.userid="",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.service.closeSocket()),this.resetRoomCallBack(),this.stateCenter.roomModulesList=this.stateCenter.roomModulesList.filter(function(e){return e!==t.room});var s=this.stateCenter.roomModulesList[0];s&&(s.isMulti=!1,s.runState!==o.ENUM_RUN_STATE.login&&s.roomTryHandler&&(s.roomTryHandler.startMaxTime(),s.roomTryHandler.active())),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.handlePushKickout=function(e,t){var r=this;this.logger.info(i.ZEGO_RTM_ACTION.ROOM_KICK_OUT+"  call "+JSON.stringify(e));var l=o.getReportSeq();this.dataReport.newReport(l,a.ZegoRTMLogEvent.kZegoTaskKickout.event),this.dataReport.addMsgInfo(l,{user_id:a.ZegoRTMLogEvent.kZegoTaskKickout.user_id(this.stateCenter.idName)});var c=s.ClientUtil.getKickoutError(e.body.reason);this.dataReport.addMsgInfo(l,{error:c.code,message:c.message}),this.dataReport.uploadReport(l);var d=this.room.roomTryHandler;if(d)if(d.onactive=function(e,t){r.disconnectedHandle(t),r.stateCenter.actionListener("_kickout",t)},e.body.need_relogin&&1==e.body.need_relogin)this.room.sessionID="",d.startMaxTime(),d.active();else{this.resetRoom(t);var u={};e&&e.body.custom_reason?u.custom_kickout_message=e.body.custom_reason:c.name&&n.errorCodeList[c.name]&&(u.custom_kickout_message=n.errorCodeList[c.name].msg+" kickout\uff0creason: "+e.body.reason),this.disconnectedHandle(c.name&&n.errorCodeList[c.name]?n.errorCodeList[c.name]:n.errorCodeList.ROOM_INNER_ERROR,JSON.stringify(u)),this.stateCenter.actionListener("_kickout",{code:n.errorCodeList.MANUAL_KICKOUT.code,msg:n.errorCodeList.MANUAL_KICKOUT.msg+e.body.reason})}else this.logger.info(i.ZEGO_RTM_ACTION.ROOM_KICK_OUT+" try handler no found")},e.prototype.handleHbLogout=function(e){var t=this,r=this.room.roomTryHandler;r&&(r.onactive=function(e,r){t.disconnectedHandle(r)},[n.errorCodeList.HEARTBEAT_TIMEOUT,n.errorCodeList.SOCKET_CLOSE,n.errorCodeList.TIMEOUT].includes(e)||e.msg.endsWith("1000002001")||e.msg.endsWith("1000000152")?(r.startMaxTime(),r.active()):(r.stopMaxTime(),r.invalid(),this.resetRoom(),this.disconnectedHandle(e)))},e.prototype.onDisconnect=function(e){var t=this;if(this.logger.error(i.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" "+e.msg),"string"==typeof e.code&&"Error.Network"===e.code)this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.code,message:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.msg});else if("number"==typeof e.code){var r;(r=e.code<2e9&&e.code>1e9||e.code<1e6?s.ClientUtil.decodeServerError(e.code,e.msg):{code:e.code,message:e.msg})&&this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:r.code,message:r.message})}this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,s.ClientUtil.unregisterCallback(a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.stateCenter.reportList);var o=this.room.roomTryHandler;o?(o.onactive=function(e,r){t.roomStateHandle(r&&0!==r.code?"DISCONNECTED":"CONNECTED",r)},o.startMaxTime(),o.active()):this.logger.error(i.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" try handler no found")},e.prototype.onConnecting=function(e){this.roomStateHandle("CONNECTING",e)},e.prototype.disconnectedHandle=function(e,t){e&&0!==e.code?(this.stopTokenTimer(),this.roomStateHandle("DISCONNECTED",e,t)):this.roomStateHandle("CONNECTED",e,t)},e.prototype.roomStateHandle=function(e,t,r){this.logger.info(i.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(t)),this.room.lastRoomState=this.room.roomState,this.room.roomState=e,this.room.roomState!==this.room.lastRoomState&&(this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,e,t?t.code:0,r),this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,t?t.code:0,r))},e.prototype.login=function(e,t,r,l,c,d,u){if(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call:",t,r),!this.room.isMulti&&this.logger.setSessionInfo(this.stateCenter.appid,t,"",l.userID,"",this.stateCenter.sdKVersion),c&&(c.userUpdate&&"boolean"==typeof c.userUpdate&&(this.stateCenter.userStateUpdate=c.userUpdate),c.maxMemberCount&&"number"==typeof c.maxMemberCount&&(this.stateCenter.maxMemberCount=c.maxMemberCount)),!this.stateCenter.configOK)return this.logger.error(i.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" init sdk wrong"),void u(n.errorCodeList.INIT);if(this.room.runState!==o.ENUM_RUN_STATE.trylogin&&this.setRunState(o.ENUM_RUN_STATE.trylogin),this.room.roomID=t,this.room.token=r,this.room.thirdToken=r,this.stateCenter.idName=l.userID,this.stateCenter.nickName=l.userName||l.userID,s.ClientUtil.registerCallback("login",{success:d,error:u},this.stateCenter.callbackList),0===this.stateCenter.reportSeqList.login){var h=o.getReportSeq();this.stateCenter.reportSeqList.relogin=h,this.dataReport.newReport(h,a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event),this.dataReport.addMsgInfo(h,{server:e}),s.ClientUtil.logReportCallback(a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.dataReport,h,this.stateCenter.reportList)}this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin(e),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call success")},e.prototype.tryLogin=function(e){var t=this;if(this.room.runState===o.ENUM_RUN_STATE.trylogin){var r=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(this.service.isDisConnect())try{this.service.closeSocket(),this.logger.debug(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" new websocket"),s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&(this.tryLoginCount>1&&s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.eventEnd,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.addEventMsg,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.server("server"),e)),this.service.createSocket(e),this.service.openHandler(function(){t.openHandler()}),this.service.closeHandler(function(e){t.logger.error(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" close "+JSON.stringify(e.code?e.code:e)),t.service.closeSocket(),t.closeHandler(e)}),this.service.errorHandler(function(e){t.logger.error(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" error "+JSON.stringify(e.code?e.code:e)),t.service.closeSocket(),t.closeHandler(e)})}catch(e){this.logger.error(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+"  websocket err:"+JSON.stringify(e))}else{this.logger.info(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" use current websocket and sent login"),s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var n=function(e,r){t.handleLoginRsp(e,r)};this.service.login(this.room,n,n)}this.tryLoginTimer=setTimeout(function(){t.logger.info(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" over time no response, login timeout"),s.ClientUtil.actionErrorCallback("login",t.stateCenter.callbackList)(a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT)},this.tryLoginInterval),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" call success")}else this.logger.error("zb.rh.tl state error")},e.prototype.openHandler=function(){var e=this;this.logger.info(i.ZEGO_RTM_ACTION.ROOM_OPEN_HANDLER+" websocket.onpen call");var t=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(o.REPORT_ACTION.eventEndWithMsgInfo,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,{try_cnt:this.tryLoginCount}),this.service.onPush(),s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(o.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var r=function(t,r){e.handleLoginRsp(t,r)};this.service.login(this.room,r,r)},e.prototype.handleLoginRsp=function(e,t){var r=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.eventEndWithMsgInfo,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event),this.room.runState===o.ENUM_RUN_STATE.trylogin)if(e.header&&e.body){if(e.header.seq!==t&&0==this.room.isMulti)return void this.logger.error(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" in wrong seq, local=",t+"",",recv=",e.header.seq);0!==e.body.err_code?(this.logger.error(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" server error=",e.body.err_code),this.handleLoginFail(e)):(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" call success."),this.handleLoginSuccess(e))}else this.logger.error(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" "+JSON.stringify(e)),this.handleLoginFail(e);else this.logger.error(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" state error")},e.prototype.handleLoginFail=function(e){this.resetTryLogin();var t=a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INNER_ERROR;e.header&&e.body?t=s.ClientUtil.getServerError(e.body.err_code):e.code&&e.msg&&(t=e),s.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(t,!0)},e.prototype.handleLoginSuccess=function(e){var t={},r=this.room.lastRunState;if(this.setRunState(o.ENUM_RUN_STATE.login),this.stateCenter.userid=e.body.user_id,this.room.sessionID=e.body.session_id,this.room.roomSessionID=e.body.room_session_id,e.body.ret_timestamp&&"03"===this.room.token.substr(0,2)){var i=(new Date).getTime()-e.body.ret_timestamp;this.stateCenter.local_time_deviation=i<5e3?0:i;var n=s.ClientUtil.decodeTokenExpire(this.room.token.substr(2));this.resetTokenTimer(1e3*n-(new Date).getTime()-this.stateCenter.local_time_deviation-3e4)}!this.room.isMulti&&this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),e.body.config_info&&(this.logger.setRemoteLogLevel(e.body.config_info.log_level),t.log_level=e.body.config_info.log_level,""==e.body.config_info.log_url||this.logger.url||(this.logger.setLogServer(e.body.config_info.log_url),t.log_url=e.body.config_info.log_url)),e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,t.test_environment="true",!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0));var l=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;s.ClientUtil.actionSuccessCallback(l,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(l,this.stateCenter.reportList)(o.REPORT_ACTION.addEventMsg,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.respond_info("respond_info"),t),this.resetTryLogin(),this.loginSuccessCallBack(r,e),s.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)&&s.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)(!0),this.roomStateHandle("CONNECTED",{code:0,msg:""})},e.prototype.closeHandler=function(e){this.logger.error(i.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" room websocket close "+JSON.stringify(e.code?e.code:e)),this.room.runState!==o.ENUM_RUN_STATE.logout?this.room.runState===o.ENUM_RUN_STATE.trylogin?(this.resetTryLogin(),s.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(1006==e.code?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT:e)):this.room.runState===o.ENUM_RUN_STATE.login&&(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.NETWORK_BROKEN)):this.logger.info(i.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" onclose logout flow call websocket.close")},e.prototype.logout=function(e){this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call"),this.room.runState!==o.ENUM_RUN_STATE.logout?(this.resetRoom(e),this.roomStateHandle("DISCONNECTED",{code:0,msg:""}),this.stopTokenTimer(),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call success")):this.logger.warn("zb.rh.lo at logout")},e.prototype.handleLogoutRsp=function(e){this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGOUT+" result=",e.body&&e.body.err_code?e.body.err_code:"-1")},e}();t.RoomHandler=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomModules=void 0;var o=r(0),s=r(6),i=r(7),n=r(8),a=r(9),l=r(22),c=r(23),d=r(1),u=r(4),h=function(){function e(e,t,r,d){this.stateCenter=e,this.logger=t,this.dataReport=r,this.service=d,this.roomID="",this.dispatchServer="",this.deviceID="",this.deviceType="",this.anType=0,this.sessionExpire="",this.pri_roomID="",this.roomSid="0",this.roomFlag=1,this.timeStamp=0,this.netType=2,this.userSeq=0,this.hallRunState=o.ENUM_RUN_STATE.logout,this.hallToken="",this.roomSessionID="",this.lastHallRunState=o.ENUM_RUN_STATE.logout,this.runRoomState=o.ENUM_RUN_STATE.logout,this.lastRunRoomState=o.ENUM_RUN_STATE.logout,this.lastHallState="DISCONNECTED",this.hallState="DISCONNECTED",this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.sessionID="",this.hallHandler=new l.HallHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.roomPrivateHandler=new c.RoomPrivateHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.heartBeatHandler=new s.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.stateCenter.priModules),this.userHandler=new a.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.stateCenter.priModules),this.messageHandler=new n.MessageHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.stateCenter.priModules),this.liveHandler=new i.LiveHandler(this.logger,this.stateCenter,this.service,this.stateCenter.priModules),this.init()}return e.prototype.init=function(){this.bindSocketHandler(),this.bindHeatBeatHandler(),this.bindHallHandler(),this.bindMessageHandler(),this.bindLiveHandler(),this.bindRoomHandler()},e.prototype.bindSocketHandler=function(){var e=this;this.service.handleHallKickout=function(t){e.hallHandler.handleHallKickout(t)},this.service.handlePushKickout=function(t){e.logger.info("zb.cm.bsh.0  call hpk");var r=o.getReportSeq();e.dataReport.newReport(r,u.ZegoRTMLogEvent.kZegoTaskRoomKickout.event),e.dataReport.addMsgInfo(r,{user_id:u.ZegoRTMLogEvent.kZegoTaskRoomKickout.user_id(e.stateCenter.idName),room_id:u.ZegoRTMLogEvent.kZegoTaskRoomKickout.room_id(e.stateCenter.priModules.roomID)}),e.dataReport.addMsgInfo(r,{error:t.body.reason,message:t.body.message}),e.dataReport.uploadReport(r),e.setRoomRunState(o.ENUM_RUN_STATE.logout),e.roomPrivateHandler.resetRoom();var s={};t&&t.body&&(t.body.reason&&(s.custom_kickout_message=t.body.message),t.body.reason&&(s.reason=t.body.reason)),e.roomPrivateHandler.roomStateHandle("DISCONNECTED",{code:d.errorCodeList.MULTIPLE_LOGIN_KICKOUT.code,msg:s}),e.logger.info("zb.cm.bsh.0  call hpk success")},this.service.handlePushUserStateUpdateMsg=function(t){e.userHandler.handlePushUserStateUpdateMsg(t)},this.service.handlePushTransMsg=function(t){e.messageHandler.handlePushTransMsg(t)},this.service.handlePushRoomMsg=function(t){e.messageHandler.handlePushRoomMsg(t)},this.service.handlePushCustomMsg=function(t){e.messageHandler.handlePushCustomMsg(t)},this.service.handlePushMergeMsg=function(t){e.messageHandler.handlePushMergeMsg(t)},this.service.handlePushSignalMsg=function(t){e.liveHandler.handlePushSignalMsg(t)}},e.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(t){e.hallHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t){e.messageHandler.loginRsp(t),e.HBResponse(t)}},e.prototype.bindHallHandler=function(){var e=this;this.hallHandler.loginSuccessCallBack=function(t,r){if(e.heartBeatHandler.init(r),e.service.startCheck(),e.runRoomState===o.ENUM_RUN_STATE.login){var s=function(t,r){0!==t.body.code?(e.setRoomRunState(o.ENUM_RUN_STATE.logout),e.roomPrivateHandler.roomStateHandle("DISCONNECTED",{code:t.body.code,msg:t.body.message})):(e.timeStamp=t.header.timeStamp,e.roomSid=t.body.room_header.room_sid,e.roomSessionID=t.body.room_header.room_user_session_id,e.userSeq=t.body.userlist_seq,e.setRoomRunState(o.ENUM_RUN_STATE.login),e.roomPrivateHandler.roomStateHandle("CONNECTED",{code:0,msg:""}),e.userHandler.loginPrivateRsp(t),e.roomLoginResponse(t))};e.roomPrivateHandler.enterRoom(s,s)}},this.hallHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.liveHandler.resetLiveHandler(),e.messageHandler.resetMessageInfo(),e.userHandler.resetUserHandler()}},e.prototype.bindUserHandler=function(){},e.prototype.bindMessageHandler=function(){},e.prototype.bindLiveHandler=function(){},e.prototype.bindRoomHandler=function(){var e=this;this.roomPrivateHandler.resetRoomCallBack=function(){e.liveHandler.resetLiveHandler(),e.messageHandler.resetMessageInfo(),e.userHandler.resetUserHandler()}},e.prototype.HBResponse=function(e){this.stateCenter.actionListener("HBResponse",e)},e.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},e.prototype.setRoomRunState=function(e){this.roomPrivateHandler.setRoomRunState(e)},e.prototype.isLogin=function(){return this.hallRunState===o.ENUM_RUN_STATE.login},e}();t.LiveRoomModules=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HallHandler=void 0;var o=r(0),s=r(3),i=r(0),n=r(2),a=r(1),l=r(4),c=function(){function e(e,t,r,o,s){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=s,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4}return e.prototype.setRunState=function(e){this.room.lastHallRunState=this.room.hallRunState,this.room.hallRunState=e},e.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},e.prototype.resetHall=function(){var e=this;if(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call"),this.resetTryLogin(),"0"!==this.room.sessionID&&this.room.hallRunState!==o.ENUM_RUN_STATE.logout){var t=function(t){e.handleLogoutRsp(t)};this.service.logoutHall(t,t)}this.setRunState(o.ENUM_RUN_STATE.logout),this.stateCenter.userid="",this.room.sessionID="",this.room.roomSessionID="",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.service.closeSocket(),this.resetRoomCallBack(),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.handleHallKickout=function(e){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_KICK_OUT+"  call "+e);var t=i.getReportSeq();this.dataReport.newReport(t,l.ZegoRTMLogEvent.kZegoTaskKickout.event),this.dataReport.addMsgInfo(t,{user_id:l.ZegoRTMLogEvent.kZegoTaskKickout.user_id(this.stateCenter.idName)});var r=s.ClientUtil.getKickoutError(e.body.reason);this.dataReport.addMsgInfo(t,{error:r.code,message:r.message}),this.dataReport.uploadReport(t),this.resetHall();var o={};e&&e.body&&(e.body.reason&&(o.custom_kickout_message=e.body.message),e.body.reason&&(o.reason=e.body.reason)),this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,"DISCONNECTED",a.errorCodeList.MULTIPLE_LOGIN_KICKOUT.code,o)},e.prototype.handleHbLogout=function(e){var t=this,r=this.room.retryHallHandler;r&&(r.onactive=function(e,r){t.disconnectedHandle(r)},e==a.errorCodeList.HEARTBEAT_TIMEOUT||e.msg.endsWith("1000002001")||e.msg.endsWith("1000000152")?(r.startMaxTime(),r.active()):(r.stopMaxTime(),r.invalid(),this.resetHall(),this.disconnectedHandle(e)))},e.prototype.onDisconnect=function(e){var t=this;if(this.logger.error(n.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" "+e.msg),"string"==typeof e.code&&"Error.Network"===e.code)this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:l.ZegoRTMLogEvent.kZegoTaskReLoginHall.error.ROOM_DISCONNECT.code,message:l.ZegoRTMLogEvent.kZegoTaskReLoginHall.error.ROOM_DISCONNECT.msg});else if("number"==typeof e.code){var r;(r=e.code<2e9&&e.code>1e9||e.code<1e6?s.ClientUtil.decodeServerError(e.code,e.msg):{code:e.code,message:e.msg})&&this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:r.code,message:r.message})}this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,s.ClientUtil.unregisterCallback(l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event,this.stateCenter.reportList);var o=this.room.retryHallHandler;o?(o.onactive=function(e,r){t.hallStateHandle(r?"DISCONNECTED":"CONNECTED",r)},o.startMaxTime(),o.active()):this.logger.error(n.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" try handler no found")},e.prototype.onConnecting=function(e){this.hallStateHandle("CONNECTING",e)},e.prototype.disconnectedHandle=function(e){this.hallStateHandle(e?"DISCONNECTED":"CONNECTED",e)},e.prototype.hallStateHandle=function(e,t,r){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(t)),this.room.lastHallState=this.room.hallState,this.room.hallState=e,this.room.hallState!==this.room.lastHallState&&(this.stateCenter.actionListener("hallStateUpdate",e,t?t.code:0,r||""),this.stateCenter.actionListener("_hallStateUpdate",e,t?t.code:0,r||""),this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,t?t.code:0,r))},e.prototype.loginHall=function(e,t,r,c,d){if(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call:"),this.logger.setSessionInfo(this.stateCenter.appid,"","",t.userID,"",this.stateCenter.sdKVersion),!this.stateCenter.configOK)return this.logger.error(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" init sdk wrong"),void d(a.errorCodeList.INIT);if(this.room.hallRunState!==o.ENUM_RUN_STATE.trylogin&&this.setRunState(o.ENUM_RUN_STATE.trylogin),this.stateCenter.idName=t.userID,this.stateCenter.nickName=t.userName||t.userID,s.ClientUtil.registerCallback("login",{success:c,error:d},this.stateCenter.callbackList),0===this.stateCenter.reportSeqList.login){var u=i.getReportSeq();this.stateCenter.reportSeqList.relogin=u,this.dataReport.newReport(u,l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event),s.ClientUtil.logReportCallback(l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event,this.dataReport,u,this.stateCenter.reportList)}this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLoginHall(e),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call success")},e.prototype.tryLoginHall=function(e){var t=this;if(this.room.hallRunState===o.ENUM_RUN_STATE.trylogin){var r=0!==this.stateCenter.reportSeqList.login?l.ZegoRTMLogEvent.kZegoTaskLoginHall.event:l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event;if(this.service.isDisConnect())try{this.service.closeSocket(),this.logger.debug(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" new websocket"),s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&(this.tryLoginCount>1&&s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(i.REPORT_ACTION.eventEnd,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.event),s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.event),s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.event,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.server("server"),e)),this.service.createSocket(e),this.service.openHandler(function(){t.openHandler()}),this.service.closeHandler(function(e){t.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" close "+JSON.stringify(e)),t.service.closeSocket(),t.closeHandler(e)}),this.service.errorHandler(function(e){t.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" error "+JSON.stringify(e)),t.service.closeSocket(),t.closeHandler(e)})}catch(e){this.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+"  websocket err:"+JSON.stringify(e))}else{this.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" use current websocket and sent login"),s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.event);var a=function(e,r){t.handleLoginRsp(e,r)};this.service.loginHall(a,a)}this.tryLoginTimer=setTimeout(function(){t.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" over time no response, login timeout"),s.ClientUtil.actionErrorCallback("login",t.stateCenter.callbackList)(l.ZegoRTMLogEvent.kZegoTaskLoginHall.error.LOGIN_TIMEOUT)},this.tryLoginInterval),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" call success")}else this.logger.error("zb.rh.tl state error")},e.prototype.openHandler=function(){var e=this;this.logger.info(n.ZEGO_RTM_ACTION.ROOM_OPEN_HANDLER+" websocket.onpen call");var t=0!==this.stateCenter.reportSeqList.login?l.ZegoRTMLogEvent.kZegoTaskLoginHall.event:l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event;s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(i.REPORT_ACTION.eventEndWithMsgInfo,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.event,{try_cnt:this.tryLoginCount}),this.service.onPush(),s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.event);var r=function(t,r){e.handleLoginRsp(t,r)};this.service.loginHall(r,r)},e.prototype.handleLoginRsp=function(e,t){var r=0!==this.stateCenter.reportSeqList.login?l.ZegoRTMLogEvent.kZegoTaskLoginHall.event:l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event;if(s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(i.REPORT_ACTION.eventEndWithMsgInfo,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.event),this.room.hallRunState===o.ENUM_RUN_STATE.trylogin){if(e.header.seq===t)return 0!==e.body.code?(this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" server error=",e.body.code),void this.handleLoginFail(e)):(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" call success."),void this.handleLoginSuccess(e));this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" in wrong seq, local=",t+"",",recv=",e.header.seq)}else this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" state error")},e.prototype.handleLoginFail=function(e){this.resetTryLogin();var t={code:e.body.code,msg:e.body.message};s.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(t,!0)},e.prototype.handleLoginSuccess=function(e){var t={},r=this.room.lastHallRunState;this.setRunState(o.ENUM_RUN_STATE.login),this.stateCenter.userid=e.body.user_uid,this.room.sessionID=e.body.session_id,this.room.timeStamp=e.header.timestamp,this.room.roomSessionID=e.body.room_session_id,this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),e.body.log_sever_addr&&""!=e.body.log_sever_addr&&this.logger.logRemoteLevel!==o.ENUM_LOG_LEVEL.disable&&(this.logger.setLogServer(e.body.log_sever_addr),t.log_url=e.body.log_sever_addr),e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,t.test_environment="true",!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0));var n=0!==this.stateCenter.reportSeqList.login?l.ZegoRTMLogEvent.kZegoTaskLoginHall.event:l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event;s.ClientUtil.actionSuccessCallback(n,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(n,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.event,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.respond_info("respond_info"),t),this.resetTryLogin(),this.loginSuccessCallBack(r,e),s.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)&&s.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)(!0),this.hallStateHandle("CONNECTED",{code:0,msg:""})},e.prototype.closeHandler=function(e){this.logger.error(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" room websocket close "+JSON.stringify(e.code)),this.room.hallRunState!==o.ENUM_RUN_STATE.logout?this.room.hallRunState===o.ENUM_RUN_STATE.trylogin?(this.resetTryLogin(),s.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(1006==e.code?l.ZegoRTMLogEvent.kZegoTaskLoginHall.error.LOGIN_TIMEOUT:e)):this.room.hallRunState===o.ENUM_RUN_STATE.login&&(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(l.ZegoRTMLogEvent.kZegoTaskLoginHall.error.NETWORK_BROKEN)):this.logger.info(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" onclose logout flow call websocket.close")},e.prototype.logout=function(){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call"),this.room.hallRunState!==o.ENUM_RUN_STATE.logout?(this.resetHall(),this.hallStateHandle("DISCONNECTED",{code:0,msg:""}),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call success")):this.logger.warn("zb.rh.lo at logout")},e.prototype.handleLogoutRsp=function(e){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+"result=",e.body&&e.body.err_code?e.body.err_code:"")},e}();t.HallHandler=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomPrivateHandler=void 0;var o=r(0),s=r(2),i=function(){function e(e,t,r,o,s){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=s,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4}return e.prototype.setRoomRunState=function(e){this.room.lastRunRoomState=this.room.runRoomState,this.room.runRoomState=e},e.prototype.enterRoom=function(e,t){this.service.enterRoom(e,t)},e.prototype.leaveRoom=function(e,t){this.resetRoom(e,t)},e.prototype.resetRoom=function(e,t){this.logger.info(s.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call"),this.room.runRoomState!==o.ENUM_RUN_STATE.logout&&this.service.leaveRoom(e||function(){},t||function(){}),this.setRoomRunState(o.ENUM_RUN_STATE.logout),this.room.roomSid="0",this.room.roomSessionID="0",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.resetRoomCallBack(),this.logger.info(s.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.roomStateHandle=function(e,t,r){this.logger.info(s.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(t)),this.room.lastRoomState=this.room.roomState,this.room.roomState=e,this.room.roomState!==this.room.lastRoomState&&(this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,e,t?t.code:0,r||""),this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,t?t.code:0,r||""))},e}();t.RoomPrivateHandler=i},function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryHallHandler=void 0;var i=r(5),n=r(0),a=r(2),l=r(1),c=function(e){function t(t,r,o){var s=e.call(this,t,r)||this;return s.logger=t,s.stateCenter=r,s.room=o,s}return s(t,e),t.prototype.initRoom=function(e,t,r,o){this.hallHandler=e,this.user=t,this.server=r,this.config=o},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry call"),this.stateCenter.networkState!=n.ENUM_NETWORK_STATE.offline)if(this.retryTimer)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" has actived, ignore");else if(this.isOverTime)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry over time, stop retry");else{if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r}this.retryTimer=setTimeout(function(){t.hallHandler.loginHall(t.server,t.user,t.config,function(e){t.handleLoginFinish(e)},function(e,r){t.handleLoginFinish(!1,e,r)}),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++},e?0:1e3*this.retryActiveInterval)}else this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" network is broken, stop retry")},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout(function(){console.warn("over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.hallHandler.resetHall(),e.stopMaxTime(),e.invalid(),e.onactive(!1,l.errorCodeList.LOGIN_TIMEOUT)},1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(e,t){},t.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){var r=e.code+"";return!["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"].includes(r)&&(!!["1100040001","1100040100"].includes(r)||this.room.lastHallRunState==n.ENUM_RUN_STATE.login&&(this.room.sessionID="",this.invalid(),!0))}return!0},t.prototype.handleLoginFinish=function(e,t,r){t?this.handleError(t,r)?(!this.maxTimer&&this.startMaxTime(),this.active()):(this.hallHandler.resetHall(),this.stopMaxTime(),this.invalid(),this.onactive(e,t)):(this.stopMaxTime(),this.invalid(),this.onactive(e))},t}(i.TryHandler);t.RetryHallHandler=c},function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomPrivateService=void 0;var i=r(11),n=r(0),a=r(2),l=function(e){function t(t,r){var o=e.call(this,t,r)||this;return o.stateCenter=t,o.logger=r,o.service=new i.ZegoSocketService(o.stateCenter.ENV),o.cmdSeq=0,o.responseRouters={},o}return s(t,e),t.prototype.checkResponse=function(e){return e.header.app_id!==this.stateCenter.appid||e.header.user_uid!==this.stateCenter.userid||this.stateCenter.priModules.hallRunState!==n.ENUM_RUN_STATE.login},t.prototype.handleSendCommandMsgRsp=function(e){var t=this,r=this.service.sendCommandMap[e.header.seq];if(null!=r){var o=r._data;delete this.service.sendCommandMap[e.header.seq],this.service.sendCommandList.remove(r),0===e.body.code?setTimeout(function(){o&&null!=o.success&&o.success(e,t.cmdSeq)},0):setTimeout(function(){o&&null!=o.error&&o.error(e,t.cmdSeq)},0)}},t.prototype.onPush=function(){var e=this;this.service.onMessage=function(t){e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" msg="+JSON.stringify(t)+" "),0!==t.body.code&&t.body.code&&e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", code="+t.body.code+", message="+t.body.message+" "),["zegochat_js.user_login_ws_rsp","zegochat_js.user_logout_rsp"].indexOf(t.header.cmd)>-1?e.handleSendCommandMsgRsp(t):e.stateCenter.priModules.isLogin()?e.checkResponse(t)?e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+"  check session fail."):(e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+",function="+!!e.responseRouters[t.header.cmd]),e.handleSendCommandMsgRsp(t),e.responseRouters[t.header.cmd]&&e.responseRouters[t.header.cmd](t,e.cmdSeq)):e.logger.warn(a.ZEGO_RTM_ACTION.SERVICE_PUSH+"  already logout")}},t.prototype.handleHallKickout=function(e){},t.prototype.handlePushKickout=function(e){},t.prototype.handlePushCustomMsg=function(e){},t.prototype.handlePushRoomMsg=function(e){},t.prototype.handlePushUserStateUpdateMsg=function(e){},t.prototype.handlePushMergeMsg=function(e){},t.prototype.handlePushTransMsg=function(e){},t.prototype.handleBigImMsgRsp=function(e){},t.prototype.handlePushSignalMsg=function(e){},t.prototype.closeHandler=function(e){this.service.closeHandler(e)},t.prototype.openHandler=function(e){this.service.openHandler(e)},t.prototype.errorHandler=function(e){this.service.errorHandler(e)},t.prototype.getHeader=function(e){return{cmd:e,seq:++this.cmdSeq,timestamp:Math.ceil((new Date).getTime()/1e3)+"",app_id:this.stateCenter.appid,user_uid:this.stateCenter.userid||"0",session_id:this.stateCenter.priModules.sessionID||"0"}},t.prototype.startCheck=function(){this.service.startCheck()},t.prototype.stopCheck=function(){this.service.stopCheck()},t.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},t.prototype.createSocket=function(e){var t=this;this.service.createSocket(e),this.responseRouters={"zegochat_js.push_user_kickout":function(e){t.handleHallKickout(e)},"zegochat_js.push_room_kickout":function(e){t.handlePushKickout(e)},"zegochat_js.push_room_custommsg_req":function(e){t.handlePushCustomMsg(e)},"zegochat_js.push_room_im_chat_req":function(e){t.handlePushRoomMsg(e)},"zegochat_js.push_room_userlist_update_req":function(e){t.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){t.handlePushMergeMsg(e)},push_trans:function(e){t.handlePushTransMsg(e)},push_signal:function(e){t.handlePushSignalMsg(e)}}},t.prototype.closeSocket=function(){this.service.closeSocket()},t.prototype.sendMessage=function(e,t,r,o){if(this.service.isDisConnect())return this.logger.info(a.ZEGO_RTM_ACTION.SERVICE_SEND+" socket is disconnect"),0;var s=this.getHeader(e);return this.logger.info(a.ZEGO_RTM_ACTION.SERVICE_SEND+" sendMsg:"+JSON.stringify({header:s,body:t})),this.service.sendMessage(s,t,r,o)},t.prototype.on=function(e,t){this.responseRouters[e]=t},t.prototype.loginHall=function(e,t){this.sendMessage("zegochat_js.user_login_ws_req",{user_id:this.stateCenter.idName,device_id:this.stateCenter.priModules.deviceID,session_expire:this.stateCenter.priModules.sessionExpire,user_name:this.stateCenter.nickName,device_type:this.stateCenter.priModules.deviceType,net_type:this.stateCenter.priModules.netType,token:this.stateCenter.priModules.hallToken,an_type:this.stateCenter.priModules.anType+""},e,t)},t.prototype.logoutHall=function(e,t){this.sendMessage("zegochat_js.user_logout_req",{user_id:this.stateCenter.idName||0},e,t)},t.prototype.enterRoom=function(e,t){this.sendMessage("zegochat_js.room_enter_req",{room_header:{room_id:this.stateCenter.priModules.roomID,room_sid:this.stateCenter.priModules.roomSid||"0",room_user_session_id:this.stateCenter.priModules.roomSessionID||"0"},room_name:"",role:this.stateCenter.role,room_flag:this.stateCenter.priModules.roomFlag},e,t)},t.prototype.leaveRoom=function(e,t){this.sendMessage("zegochat_js.room_quit_req",{room_header:{room_id:this.stateCenter.priModules.roomID,room_sid:this.stateCenter.priModules.roomSid,room_user_session_id:this.stateCenter.priModules.roomSessionID}},e,t)},t.prototype.heartBeat=function(e,t){return this.sendMessage("zegochat_js.user_hb_req",{reserve:0},e,t)},t.prototype.fetchUserList=function(e,t,r){return this.sendMessage("zegochat_js.room_userlist_req",e,t,r)},t.prototype.fetchReliableMessage=function(e,t,r){return this.sendMessage("trans_fetch",e,t,r)},t.prototype.sendReliableMessage=function(e,t,r){return this.sendMessage("trans",e,t,r)},t.prototype.sendRoomMsg=function(e,t,r){return this.sendMessage("zegochat_js.room_im_chat",e,t,r)},t.prototype.sendCustomCommand=function(e,t,r){return this.sendMessage("zegochat_js.room_custommsg_req",e,t,r)},t.prototype.sendBigRoomMessage=function(e,t,r){return this.sendMessage("bigim_chat",e,t,r)},t.prototype.sendRelayMessage=function(e,t,r){return this.sendMessage("relay",e,t,r)},t.prototype.sendSignalCmd=function(e,t,r){return this.sendMessage("signal",e,t,r)},t}(r(10).LiveRoomService);t.LiveRoomPrivateService=l}])},305:(e,t,r)=>{"use strict";function o(e){return"function"==typeof e}let s=!1;const i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else s&&console.log("RxJS: Back to a better error behavior. Thank you. <3");s=e},get useDeprecatedSynchronousErrorHandling(){return s}};function n(e){setTimeout(()=>{throw e},0)}const a={closed:!0,next(e){},error(e){if(i.useDeprecatedSynchronousErrorHandling)throw e;n(e)},complete(){}},l=Array.isArray||(e=>e&&"number"==typeof e.length);function c(e){return null!==e&&"object"==typeof e}const d=(()=>{function e(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((e,t)=>`${t+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e})();class u{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:t,_ctorUnsubscribe:r,_unsubscribe:s,_subscriptions:i}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,t instanceof u)t.remove(this);else if(null!==t)for(let o=0;o<t.length;++o)t[o].remove(this);if(o(s)){r&&(this._unsubscribe=void 0);try{s.call(this)}catch(n){e=n instanceof d?h(n.errors):[n]}}if(l(i)){let t=-1,r=i.length;for(;++t<r;){const r=i[t];if(c(r))try{r.unsubscribe()}catch(n){e=e||[],n instanceof d?e=e.concat(h(n.errors)):e.push(n)}}}if(e)throw new d(e)}add(e){let t=e;if(!e)return u.EMPTY;switch(typeof e){case"function":t=new u(e);case"object":if(t===this||t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if(!(t instanceof u)){const e=t;t=new u,t._subscriptions=[e]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:r}=t;if(null===r)t._parentOrParents=this;else if(r instanceof u){if(r===this)return t;t._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return t;r.push(this)}const o=this._subscriptions;return null===o?this._subscriptions=[t]:o.push(t),t}remove(e){const t=this._subscriptions;if(t){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}}}function h(e){return e.reduce((e,t)=>e.concat(t instanceof d?t.errors:t),[])}u.EMPTY=function(e){return e.closed=!0,e}(new u);const p="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class g extends u{constructor(e,t,r){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=a;break;case 1:if(!e){this.destination=a;break}if("object"==typeof e){e instanceof g?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new m(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new m(this,e,t,r)}}[p](){return this}static create(e,t,r){const o=new g(e,t,r);return o.syncErrorThrowable=!1,o}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class m extends g{constructor(e,t,r,s){let i;super(),this._parentSubscriber=e;let n=this;o(t)?i=t:t&&(i=t.next,r=t.error,s=t.complete,t!==a&&(n=Object.create(t),o(n.unsubscribe)&&this.add(n.unsubscribe.bind(n)),n.unsubscribe=this.unsubscribe.bind(this))),this._context=n,this._next=i,this._error=r,this._complete=s}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;i.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:r}=i;if(this._error)r&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)r?(t.syncErrorValue=e,t.syncErrorThrown=!0):n(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;n(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);i.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(r){if(this.unsubscribe(),i.useDeprecatedSynchronousErrorHandling)throw r;n(r)}}__tryOrSetError(e,t,r){if(!i.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,r)}catch(o){return i.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=o,e.syncErrorThrown=!0,!0):(n(o),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const _="function"==typeof Symbol&&Symbol.observable||"@@observable";function f(e){return e}let E=(()=>{class e{constructor(e){this._isScalar=!1,e&&(this._subscribe=e)}lift(t){const r=new e;return r.source=this,r.operator=t,r}subscribe(e,t,r){const{operator:o}=this,s=function(e,t,r){if(e){if(e instanceof g)return e;if(e[p])return e[p]()}return e||t||r?new g(e,t,r):new g(a)}(e,t,r);if(s.add(o?o.call(s,this.source):this.source||i.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),i.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s}_trySubscribe(e){try{return this._subscribe(e)}catch(t){i.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){const{closed:t,destination:r,isStopped:o}=e;if(t||o)return!1;e=r&&r instanceof g?r:null}return!0}(e)?e.error(t):console.warn(t)}}forEach(e,t){return new(t=T(t))((t,r)=>{let o;o=this.subscribe(t=>{try{e(t)}catch(s){r(s),o&&o.unsubscribe()}},r,t)})}_subscribe(e){const{source:t}=this;return t&&t.subscribe(e)}[_](){return this}pipe(...e){return 0===e.length?this:(0===(t=e).length?f:1===t.length?t[0]:function(e){return t.reduce((e,t)=>t(e),e)})(this);var t}toPromise(e){return new(e=T(e))((e,t)=>{let r;this.subscribe(e=>r=e,e=>t(e),()=>e(r))})}}return e.create=t=>new e(t),e})();function T(e){if(e||(e=i.Promise||Promise),!e)throw new Error("no Promise impl found");return e}const v=(()=>{function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e})();class S extends u{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}class R extends g{constructor(e){super(e),this.destination=e}}let C=(()=>{class e extends E{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[p](){return new R(this)}lift(e){const t=new y(this,this);return t.operator=e,t}next(e){if(this.closed)throw new v;if(!this.isStopped){const{observers:t}=this,r=t.length,o=t.slice();for(let s=0;s<r;s++)o[s].next(e)}}error(e){if(this.closed)throw new v;this.hasError=!0,this.thrownError=e,this.isStopped=!0;const{observers:t}=this,r=t.length,o=t.slice();for(let s=0;s<r;s++)o[s].error(e);this.observers.length=0}complete(){if(this.closed)throw new v;this.isStopped=!0;const{observers:e}=this,t=e.length,r=e.slice();for(let o=0;o<t;o++)r[o].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(e){if(this.closed)throw new v;return super._trySubscribe(e)}_subscribe(e){if(this.closed)throw new v;return this.hasError?(e.error(this.thrownError),u.EMPTY):this.isStopped?(e.complete(),u.EMPTY):(this.observers.push(e),new S(this,e))}asObservable(){const e=new E;return e.source=this,e}}return e.create=(e,t)=>new y(e,t),e})();class y extends C{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):u.EMPTY}}function I(e){return e&&"function"==typeof e.schedule}function L(e,t){return function(r){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new O(e,t))}}class O{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new b(e,this.project,this.thisArg))}}class b extends g{constructor(e,t,r){super(e),this.project=t,this.count=0,this.thisArg=r||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(t)}}const M=e=>t=>{for(let r=0,o=e.length;r<o&&!t.closed;r++)t.next(e[r]);t.complete()},N="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",A=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function k(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}const P=e=>{if(e&&"function"==typeof e[_])return r=e,e=>{const t=r[_]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(A(e))return M(e);if(k(e))return(e=>t=>(e.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,n),t))(e);if(e&&"function"==typeof e[N])return t=e,e=>{const r=t[N]();for(;;){let t;try{t=r.next()}catch(o){return e.error(o),e}if(t.done){e.complete();break}if(e.next(t.value),e.closed)break}return"function"==typeof r.return&&e.add(()=>{r.return&&r.return()}),e};{const t=c(e)?"an invalid object":`'${e}'`;throw new TypeError(`You provided ${t} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`)}var t,r};function U(e,t){return new E(r=>{const o=new u;let s=0;return o.add(t.schedule(function(){s!==e.length?(r.next(e[s++]),r.closed||o.add(this.schedule())):r.complete()})),o})}function D(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[_]}(e))return function(e,t){return new E(r=>{const o=new u;return o.add(t.schedule(()=>{const s=e[_]();o.add(s.subscribe({next(e){o.add(t.schedule(()=>r.next(e)))},error(e){o.add(t.schedule(()=>r.error(e)))},complete(){o.add(t.schedule(()=>r.complete()))}}))})),o})}(e,t);if(k(e))return function(e,t){return new E(r=>{const o=new u;return o.add(t.schedule(()=>e.then(e=>{o.add(t.schedule(()=>{r.next(e),o.add(t.schedule(()=>r.complete()))}))},e=>{o.add(t.schedule(()=>r.error(e)))}))),o})}(e,t);if(A(e))return U(e,t);if(function(e){return e&&"function"==typeof e[N]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new E(r=>{const o=new u;let s;return o.add(()=>{s&&"function"==typeof s.return&&s.return()}),o.add(t.schedule(()=>{s=e[N](),o.add(t.schedule(function(){if(r.closed)return;let e,t;try{const r=s.next();e=r.value,t=r.done}catch(o){return void r.error(o)}t?r.complete():(r.next(e),this.schedule())}))})),o})}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof E?e:new E(P(e))}class w extends g{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class Z extends g{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function x(e,t,r=Number.POSITIVE_INFINITY){return"function"==typeof t?o=>o.pipe(x((r,o)=>D(e(r,o)).pipe(L((e,s)=>t(r,e,o,s))),r)):("number"==typeof t&&(r=t),t=>t.lift(new B(e,r)))}class B{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new H(e,this.project,this.concurrent))}}class H extends Z{constructor(e,t,r=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(o){return void this.destination.error(o)}this.active++,this._innerSub(t)}_innerSub(e){const t=new w(this),r=this.destination;r.add(t);const o=function(e,t){if(t.closed)return;if(e instanceof E)return e.subscribe(t);let r;try{r=P(e)(t)}catch(o){t.error(o)}return r}(e,t);o!==t&&r.add(o)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function G(e,t){return t?U(e,t):new E(M(e))}function V(){return function(e){return e.lift(new W(e))}}class W{constructor(e){this.connectable=e}call(e,t){const{connectable:r}=this;r._refCount++;const o=new q(e,r),s=t.subscribe(o);return o.closed||(o.connection=r.connect()),s}}class q extends g{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:r}=this,o=e._connection;this.connection=null,!o||r&&o!==r||o.unsubscribe()}}class z extends E{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new u,e.add(this.source.subscribe(new j(this.getSubject(),this))),e.closed&&(this._connection=null,e=u.EMPTY)),e}refCount(){return V()(this)}}const F=(()=>{const e=z.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}})();class j extends R{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}function Y(){return new C}function X(e){for(let t in e)if(e[t]===X)return t;throw Error("Could not find renamed property on target object.")}function Q(e,t){for(const r in t)t.hasOwnProperty(r)&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function K(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(K).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const r=t.indexOf("\n");return-1===r?t:t.substring(0,r)}function J(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const $=X({__forward_ref__:X});function ee(e){return e.__forward_ref__=ee,e.toString=function(){return K(this())},e}function te(e){return re(e)?e():e}function re(e){return"function"==typeof e&&e.hasOwnProperty($)&&e.__forward_ref__===ee}class oe extends Error{constructor(e,t){super(function(e,t){return`${e?`NG0${e}: `:""}${t}`}(e,t)),this.code=e}}function se(e){return"string"==typeof e?e:null==e?"":String(e)}function ie(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():se(e)}function ne(e,t){const r=t?` in ${t}`:"";throw new oe("201",`No provider for ${ie(e)} found${r}`)}function ae(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function le(e){return{providers:e.providers||[],imports:e.imports||[]}}function ce(e){return de(e,he)||de(e,ge)}function de(e,t){return e.hasOwnProperty(t)?e[t]:null}function ue(e){return e&&(e.hasOwnProperty(pe)||e.hasOwnProperty(me))?e[pe]:null}const he=X({"\u0275prov":X}),pe=X({"\u0275inj":X}),ge=X({ngInjectableDef:X}),me=X({ngInjectorDef:X});var _e=(()=>((_e=_e||{})[_e.Default=0]="Default",_e[_e.Host=1]="Host",_e[_e.Self=2]="Self",_e[_e.SkipSelf=4]="SkipSelf",_e[_e.Optional=8]="Optional",_e))();let fe;function Ee(e){const t=fe;return fe=e,t}function Te(e,t,r){const o=ce(e);return o&&"root"==o.providedIn?void 0===o.value?o.value=o.factory():o.value:r&_e.Optional?null:void 0!==t?t:void ne(K(e),"Injector")}function ve(e){return{toString:e}.toString()}var Se=(()=>((Se=Se||{})[Se.OnPush=0]="OnPush",Se[Se.Default=1]="Default",Se))(),Re=(()=>((Re=Re||{})[Re.Emulated=0]="Emulated",Re[Re.None=2]="None",Re[Re.ShadowDom=3]="ShadowDom",Re))();const Ce="undefined"!=typeof globalThis&&globalThis,ye="undefined"!=typeof window&&window,Ie="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Le="undefined"!=typeof global&&global,Oe=Ce||Le||ye||Ie,be={},Me=[],Ne=X({"\u0275cmp":X}),Ae=X({"\u0275dir":X}),ke=X({"\u0275pipe":X}),Pe=X({"\u0275mod":X}),Ue=X({"\u0275loc":X}),De=X({"\u0275fac":X}),we=X({__NG_ELEMENT_ID__:X});let Ze=0;function xe(e){return ve(()=>{const t={},r={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Se.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||Me,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Re.Emulated,id:"c",styles:e.styles||Me,_:null,setInput:null,schemas:e.schemas||null,tView:null},o=e.directives,s=e.features,i=e.pipes;return r.id+=Ze++,r.inputs=We(e.inputs,t),r.outputs=We(e.outputs),s&&s.forEach(e=>e(r)),r.directiveDefs=o?()=>("function"==typeof o?o():o).map(Be):null,r.pipeDefs=i?()=>("function"==typeof i?i():i).map(He):null,r})}function Be(e){return ze(e)||function(e){return e[Ae]||null}(e)}function He(e){return function(e){return e[ke]||null}(e)}const Ge={};function Ve(e){return ve(()=>{const t={type:e.type,bootstrap:e.bootstrap||Me,declarations:e.declarations||Me,imports:e.imports||Me,exports:e.exports||Me,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(Ge[e.id]=e.type),t})}function We(e,t){if(null==e)return be;const r={};for(const o in e)if(e.hasOwnProperty(o)){let s=e[o],i=s;Array.isArray(s)&&(i=s[1],s=s[0]),r[s]=o,t&&(t[s]=i)}return r}const qe=xe;function ze(e){return e[Ne]||null}function Fe(e,t){const r=e[Pe]||null;if(!r&&!0===t)throw new Error(`Type ${K(e)} does not have '\u0275mod' property.`);return r}const je=20,Ye=10;function Xe(e){return Array.isArray(e)&&"object"==typeof e[1]}function Qe(e){return Array.isArray(e)&&!0===e[1]}function Ke(e){return 0!=(8&e.flags)}function Je(e){return 2==(2&e.flags)}function $e(e){return 1==(1&e.flags)}function et(e){return null!==e.template}function tt(e,t){return e.hasOwnProperty(De)?e[De]:null}class rt{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function ot(){return st}function st(e){return e.type.prototype.ngOnChanges&&(e.setInput=nt),it}function it(){const e=at(this),t=null==e?void 0:e.current;if(t){const r=e.previous;if(r===be)e.previous=t;else for(let e in t)r[e]=t[e];e.current=null,this.ngOnChanges(t)}}function nt(e,t,r,o){const s=at(e)||function(e,t){return e.__ngSimpleChanges__=t}(e,{previous:be,current:null}),i=s.current||(s.current={}),n=s.previous,a=this.declaredInputs[r],l=n[a];i[a]=new rt(l&&l.currentValue,t,n===be),e[o]=t}function at(e){return e.__ngSimpleChanges__||null}ot.ngInherit=!0;const lt="http://www.w3.org/2000/svg";let ct;function dt(e){return!!e.listen}const ut={createRenderer:(e,t)=>void 0!==ct?ct:"undefined"!=typeof document?document:void 0};function ht(e){for(;Array.isArray(e);)e=e[0];return e}function pt(e,t){return ht(t[e])}function gt(e,t){return ht(t[e.index])}function mt(e,t){return e.data[t]}function _t(e,t){const r=t[e];return Xe(r)?r:r[0]}function ft(e){return 128==(128&e[2])}function Et(e,t){return null==t?null:e[t]}function Tt(e){e[18]=0}function vt(e,t){e[5]+=t;let r=e,o=e[3];for(;null!==o&&(1===t&&1===r[5]||-1===t&&0===r[5]);)o[5]+=t,r=o,o=o[3]}const St={lFrame:Gt(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Rt(){return St.bindingsEnabled}function Ct(){return St.lFrame.lView}function yt(){return St.lFrame.tView}function It(e){return St.lFrame.contextLView=e,e[8]}function Lt(){let e=Ot();for(;null!==e&&64===e.type;)e=e.parent;return e}function Ot(){return St.lFrame.currentTNode}function bt(e,t){const r=St.lFrame;r.currentTNode=e,r.isParent=t}function Mt(){return St.lFrame.isParent}function Nt(){return St.isInCheckNoChangesMode}function At(e){St.isInCheckNoChangesMode=e}function kt(){return St.lFrame.bindingIndex++}function Pt(e){const t=St.lFrame,r=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,r}function Ut(e,t){const r=St.lFrame;r.bindingIndex=r.bindingRootIndex=e,Dt(t)}function Dt(e){St.lFrame.currentDirectiveIndex=e}function wt(e){St.lFrame.currentQueryIndex=e}function Zt(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function xt(e,t,r){if(r&_e.SkipSelf){let o=t,s=e;for(;o=o.parent,!(null!==o||r&_e.Host||(o=Zt(s),null===o)||(s=s[15],10&o.type)););if(null===o)return!1;t=o,e=s}const o=St.lFrame=Ht();return o.currentTNode=t,o.lView=e,!0}function Bt(e){const t=Ht(),r=e[1];St.lFrame=t,t.currentTNode=r.firstChild,t.lView=e,t.tView=r,t.contextLView=e,t.bindingIndex=r.bindingStartIndex,t.inI18n=!1}function Ht(){const e=St.lFrame,t=null===e?null:e.child;return null===t?Gt(e):t}function Gt(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function Vt(){const e=St.lFrame;return St.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Wt=Vt;function qt(){const e=Vt();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function zt(){return St.lFrame.selectedIndex}function Ft(e){St.lFrame.selectedIndex=e}function jt(){St.lFrame.currentNamespace=lt}function Yt(){St.lFrame.currentNamespace=null}function Xt(e,t){for(let r=t.directiveStart,o=t.directiveEnd;r<o;r++){const t=e.data[r].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:s,ngAfterViewInit:i,ngAfterViewChecked:n,ngOnDestroy:a}=t;o&&(e.contentHooks||(e.contentHooks=[])).push(-r,o),s&&((e.contentHooks||(e.contentHooks=[])).push(r,s),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(r,s)),i&&(e.viewHooks||(e.viewHooks=[])).push(-r,i),n&&((e.viewHooks||(e.viewHooks=[])).push(r,n),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(r,n)),null!=a&&(e.destroyHooks||(e.destroyHooks=[])).push(r,a)}}function Qt(e,t,r){$t(e,t,3,r)}function Kt(e,t,r,o){(3&e[2])===r&&$t(e,t,r,o)}function Jt(e,t){let r=e[2];(3&r)===t&&(r&=2047,r+=1,e[2]=r)}function $t(e,t,r,o){const s=null!=o?o:-1,i=t.length-1;let n=0;for(let a=void 0!==o?65535&e[18]:0;a<i;a++)if("number"==typeof t[a+1]){if(n=t[a],null!=o&&n>=o)break}else t[a]<0&&(e[18]+=65536),(n<s||-1==s)&&(er(e,r,t,a),e[18]=(4294901760&e[18])+a+2),a++}function er(e,t,r,o){const s=r[o]<0,i=r[o+1],n=e[s?-r[o]:r[o]];if(s){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{i.call(n)}finally{}}}else try{i.call(n)}finally{}}const tr=-1;class rr{constructor(e,t,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function or(e,t,r){const o=dt(e);let s=0;for(;s<r.length;){const i=r[s];if("number"==typeof i){if(0!==i)break;s++;const n=r[s++],a=r[s++],l=r[s++];o?e.setAttribute(t,a,l,n):t.setAttributeNS(n,a,l)}else{const n=i,a=r[++s];sr(n)?o&&e.setProperty(t,n,a):o?e.setAttribute(t,n,a):t.setAttribute(n,a),s++}}return s}function sr(e){return 64===e.charCodeAt(0)}function ir(e,t){if(null===t||0===t.length);else if(null===e||0===e.length)e=t.slice();else{let r=-1;for(let o=0;o<t.length;o++){const s=t[o];"number"==typeof s?r=s:0===r||nr(e,r,s,null,-1===r||2===r?t[++o]:null)}}return e}function nr(e,t,r,o,s){let i=0,n=e.length;if(-1===t)n=-1;else for(;i<e.length;){const r=e[i++];if("number"==typeof r){if(r===t){n=-1;break}if(r>t){n=i-1;break}}}for(;i<e.length;){const t=e[i];if("number"==typeof t)break;if(t===r){if(null===o)return void(null!==s&&(e[i+1]=s));if(o===e[i+1])return void(e[i+2]=s)}i++,null!==o&&i++,null!==s&&i++}-1!==n&&(e.splice(n,0,t),i=n+1),e.splice(i++,0,r),null!==o&&e.splice(i++,0,o),null!==s&&e.splice(i++,0,s)}function ar(e){return e!==tr}function lr(e){return 32767&e}function cr(e,t){let r=e>>16,o=t;for(;r>0;)o=o[15],r--;return o}let dr=!0;function ur(e){const t=dr;return dr=e,t}let hr=0;function pr(e,t){const r=mr(e,t);if(-1!==r)return r;const o=t[1];o.firstCreatePass&&(e.injectorIndex=t.length,gr(o.data,e),gr(t,null),gr(o.blueprint,null));const s=_r(e,t),i=e.injectorIndex;if(ar(s)){const e=lr(s),r=cr(s,t),o=r[1].data;for(let s=0;s<8;s++)t[i+s]=r[e+s]|o[e+s]}return t[i+8]=s,i}function gr(e,t){e.push(0,0,0,0,0,0,0,0,t)}function mr(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function _r(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let r=0,o=null,s=t;for(;null!==s;){const e=s[1],t=e.type;if(o=2===t?e.declTNode:1===t?s[6]:null,null===o)return tr;if(r++,s=s[15],-1!==o.injectorIndex)return o.injectorIndex|r<<16}return tr}function fr(e,t,r){!function(e,t,r){let o;"string"==typeof r?o=r.charCodeAt(0)||0:r.hasOwnProperty(we)&&(o=r[we]),null==o&&(o=r[we]=hr++);const s=255&o;t.data[e+(s>>5)]|=1<<s}(e,t,r)}function Er(e,t,r){if(r&_e.Optional)return e;ne(t,"NodeInjector")}function Tr(e,t,r,o){if(r&_e.Optional&&void 0===o&&(o=null),0==(r&(_e.Self|_e.Host))){const s=e[9],i=Ee(void 0);try{return s?s.get(t,o,r&_e.Optional):Te(t,o,r&_e.Optional)}finally{Ee(i)}}return Er(o,t,r)}function vr(e,t,r,o=_e.Default,s){if(null!==e){const i=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(we)?e[we]:void 0;return"number"==typeof t?t>=0?255&t:Rr:t}(r);if("function"==typeof i){if(!xt(t,e,o))return o&_e.Host?Er(s,r,o):Tr(t,r,o,s);try{const e=i(o);if(null!=e||o&_e.Optional)return e;ne(r)}finally{Wt()}}else if("number"==typeof i){let s=null,n=mr(e,t),a=tr,l=o&_e.Host?t[16][6]:null;for((-1===n||o&_e.SkipSelf)&&(a=-1===n?_r(e,t):t[n+8],a!==tr&&Lr(o,!1)?(s=t[1],n=lr(a),t=cr(a,t)):n=-1);-1!==n;){const e=t[1];if(Ir(i,n,e.data)){const e=Cr(n,t,r,s,o,l);if(e!==Sr)return e}a=t[n+8],a!==tr&&Lr(o,t[1].data[n+8]===l)&&Ir(i,n,t)?(s=e,n=lr(a),t=cr(a,t)):n=-1}}}return Tr(t,r,o,s)}const Sr={};function Rr(){return new Or(Lt(),Ct())}function Cr(e,t,r,o,s,i){const n=t[1],a=n.data[e+8],l=function(e,t,r,o,s){const i=e.providerIndexes,n=t.data,a=1048575&i,l=e.directiveStart,c=i>>20,d=s?a+c:e.directiveEnd;for(let u=o?a:a+c;u<d;u++){const e=n[u];if(u<l&&r===e||u>=l&&e.type===r)return u}if(s){const e=n[l];if(e&&et(e)&&e.type===r)return l}return null}(a,n,r,null==o?Je(a)&&dr:o!=n&&0!=(3&a.type),s&_e.Host&&i===a);return null!==l?yr(t,n,l,a):Sr}function yr(e,t,r,o){let s=e[r];const i=t.data;if(s instanceof rr){const n=s;n.resolving&&function(e,t){throw new oe("200",`Circular dependency in DI detected for ${e}`)}(ie(i[r]));const a=ur(n.canSeeViewProviders);n.resolving=!0;const l=n.injectImpl?Ee(n.injectImpl):null;xt(e,o,_e.Default);try{s=e[r]=n.factory(void 0,i,e,o),t.firstCreatePass&&r>=o.directiveStart&&function(e,t,r){const{ngOnChanges:o,ngOnInit:s,ngDoCheck:i}=t.type.prototype;if(o){const o=st(t);(r.preOrderHooks||(r.preOrderHooks=[])).push(e,o),(r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(e,o)}s&&(r.preOrderHooks||(r.preOrderHooks=[])).push(0-e,s),i&&((r.preOrderHooks||(r.preOrderHooks=[])).push(e,i),(r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(e,i))}(r,i[r],t)}finally{null!==l&&Ee(l),ur(a),n.resolving=!1,Wt()}}return s}function Ir(e,t,r){return!!(r[t+(e>>5)]&1<<e)}function Lr(e,t){return!(e&_e.Self||e&_e.Host&&t)}class Or{constructor(e,t){this._tNode=e,this._lView=t}get(e,t){return vr(this._tNode,this._lView,e,void 0,t)}}function br(e){return ve(()=>{const t=e.prototype.constructor,r=t[De]||Mr(t),o=Object.prototype;let s=Object.getPrototypeOf(e.prototype).constructor;for(;s&&s!==o;){const e=s[De]||Mr(s);if(e&&e!==r)return e;s=Object.getPrototypeOf(s)}return e=>new e})}function Mr(e){return re(e)?()=>{const t=Mr(te(e));return t&&t()}:tt(e)}const Nr="__parameters__";function Ar(e,t,r){return ve(()=>{const o=function(e){return function(...t){if(e){const r=e(...t);for(const e in r)this[e]=r[e]}}}(t);function s(...e){if(this instanceof s)return o.apply(this,e),this;const t=new s(...e);return r.annotation=t,r;function r(e,r,o){const s=e.hasOwnProperty(Nr)?e[Nr]:Object.defineProperty(e,Nr,{value:[]})[Nr];for(;s.length<=o;)s.push(null);return(s[o]=s[o]||[]).push(t),e}}return r&&(s.prototype=Object.create(r.prototype)),s.prototype.ngMetadataName=e,s.annotationCls=s,s})}class kr{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=ae({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}function Pr(e,t){e.forEach(e=>Array.isArray(e)?Pr(e,t):t(e))}function Ur(e,t,r){t>=e.length?e.push(r):e.splice(t,0,r)}function Dr(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function wr(e,t,r){let o=xr(e,t);return o>=0?e[1|o]=r:(o=~o,function(e,t,r,o){let s=e.length;if(s==t)e.push(r,o);else if(1===s)e.push(o,e[0]),e[0]=r;else{for(s--,e.push(e[s-1],e[s]);s>t;)e[s]=e[s-2],s--;e[t]=r,e[t+1]=o}}(e,o,t,r)),o}function Zr(e,t){const r=xr(e,t);if(r>=0)return e[1|r]}function xr(e,t){return function(e,t,r){let o=0,s=e.length>>1;for(;s!==o;){const r=o+(s-o>>1),i=e[r<<1];if(t===i)return r<<1;i>t?s=r:o=r+1}return~(s<<1)}(e,t)}const Br={},Hr=/\n/gm,Gr="__source",Vr=X({provide:String,useValue:X});let Wr;function qr(e){const t=Wr;return Wr=e,t}function zr(e,t=_e.Default){if(void 0===Wr)throw new Error("inject() must be called from an injection context");return null===Wr?Te(e,void 0,t):Wr.get(e,t&_e.Optional?null:void 0,t)}function Fr(e,t=_e.Default){return(fe||zr)(te(e),t)}function jr(e){const t=[];for(let r=0;r<e.length;r++){const o=te(e[r]);if(Array.isArray(o)){if(0===o.length)throw new Error("Arguments array must have arguments.");let e,r=_e.Default;for(let t=0;t<o.length;t++){const s=o[t],i=s.__NG_DI_FLAG__;"number"==typeof i?-1===i?e=s.token:r|=i:e=s}t.push(Fr(e,r))}else t.push(Fr(o))}return t}function Yr(e,t){return e.__NG_DI_FLAG__=t,e.prototype.__NG_DI_FLAG__=t,e}const Xr=Yr(Ar("Inject",e=>({token:e})),-1),Qr=Yr(Ar("Optional"),8),Kr=Yr(Ar("SkipSelf"),4);function Jr(e){return e instanceof class{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?e.changingThisBreaksApplicationSecurity:e}function $r(e,t){e.__ngContext__=t}function eo(e){const t=function(e){return e.__ngContext__||null}(e);return t?Array.isArray(t)?t:t.lView:null}function to(e){return e.ngOriginalError}function ro(e,...t){e.error(...t)}class oo{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),r=this._findContext(e),o=function(e){return e&&e.ngErrorLogger||ro}(e);o(this._console,"ERROR",e),t&&o(this._console,"ORIGINAL ERROR",t),r&&o(this._console,"ERROR CONTEXT",r)}_findContext(e){return e?function(e){return e.ngDebugContext}(e)||this._findContext(to(e)):null}_findOriginalError(e){let t=e&&to(e);for(;t&&to(t);)t=to(t);return t||null}}const so=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Oe))();function io(e){return e instanceof Function?e():e}var no=(()=>((no=no||{})[no.Important=1]="Important",no[no.DashCase=2]="DashCase",no))();function ao(e,t){return(void 0)(e,t)}function lo(e){const t=e[3];return Qe(t)?t[3]:t}function co(e){return ho(e[13])}function uo(e){return ho(e[4])}function ho(e){for(;null!==e&&!Qe(e);)e=e[4];return e}function po(e,t,r,o,s){if(null!=o){let i,n=!1;Qe(o)?i=o:Xe(o)&&(n=!0,o=o[0]);const a=ht(o);0===e&&null!==r?null==s?vo(t,r,a):To(t,r,a,s||null,!0):1===e&&null!==r?To(t,r,a,s||null,!0):2===e?function(e,t,r){const o=Ro(e,t);o&&function(e,t,r,o){dt(e)?e.removeChild(t,r,o):t.removeChild(r)}(e,o,t,r)}(t,a,n):3===e&&t.destroyNode(a),null!=i&&function(e,t,r,o,s){const i=r[7];i!==ht(r)&&po(t,e,o,i,s);for(let n=Ye;n<r.length;n++){const s=r[n];bo(s[1],s,e,t,o,i)}}(t,e,i,r,s)}}function go(e,t,r){return dt(e)?e.createElement(t,r):null===r?e.createElement(t):e.createElementNS(r,t)}function mo(e,t){const r=e[9],o=r.indexOf(t),s=t[3];1024&t[2]&&(t[2]&=-1025,vt(s,-1)),r.splice(o,1)}function _o(e,t){if(e.length<=Ye)return;const r=Ye+t,o=e[r];if(o){const i=o[17];null!==i&&i!==e&&mo(i,o),t>0&&(e[r-1][4]=o[4]);const n=Dr(e,Ye+t);bo(o[1],s=o,s[11],2,null,null),s[0]=null,s[6]=null;const a=n[19];null!==a&&a.detachView(n[1]),o[3]=null,o[4]=null,o[2]&=-129}var s;return o}function fo(e,t){if(!(256&t[2])){const r=t[11];dt(r)&&r.destroyNode&&bo(e,t,r,3,null,null),function(e){let t=e[13];if(!t)return Eo(e[1],e);for(;t;){let r=null;if(Xe(t))r=t[13];else{const e=t[10];e&&(r=e)}if(!r){for(;t&&!t[4]&&t!==e;)Xe(t)&&Eo(t[1],t),t=t[3];null===t&&(t=e),Xe(t)&&Eo(t[1],t),r=t&&t[4]}t=r}}(t)}}function Eo(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){let r;if(null!=e&&null!=(r=e.destroyHooks))for(let o=0;o<r.length;o+=2){const e=t[r[o]];if(!(e instanceof rr)){const t=r[o+1];if(Array.isArray(t))for(let r=0;r<t.length;r+=2){const o=e[t[r]],s=t[r+1];try{s.call(o)}finally{}}else try{t.call(e)}finally{}}}}(e,t),function(e,t){const r=e.cleanup,o=t[7];let s=-1;if(null!==r)for(let i=0;i<r.length-1;i+=2)if("string"==typeof r[i]){const e=r[i+1],n="function"==typeof e?e(t):ht(t[e]),a=o[s=r[i+2]],l=r[i+3];"boolean"==typeof l?n.removeEventListener(r[i],a,l):l>=0?o[s=l]():o[s=-l].unsubscribe(),i+=2}else{const e=o[s=r[i+1]];r[i].call(e)}if(null!==o){for(let e=s+1;e<o.length;e++)(0,o[e])();t[7]=null}}(e,t),1===t[1].type&&dt(t[11])&&t[11].destroy();const r=t[17];if(null!==r&&Qe(t[3])){r!==t[3]&&mo(r,t);const o=t[19];null!==o&&o.detachView(e)}}}function To(e,t,r,o,s){dt(e)?e.insertBefore(t,r,o,s):t.insertBefore(r,o,s)}function vo(e,t,r){dt(e)?e.appendChild(t,r):t.appendChild(r)}function So(e,t,r,o,s){null!==o?To(e,t,r,o,s):vo(e,t,r)}function Ro(e,t){return dt(e)?e.parentNode(t):t.parentNode}function Co(e,t,r,o){const s=function(e,t,r){return function(e,t,r){let o=t;for(;null!==o&&40&o.type;)o=(t=o).parent;if(null===o)return r[0];if(2&o.flags){const t=e.data[o.directiveStart].encapsulation;if(t===Re.None||t===Re.Emulated)return null}return gt(o,r)}(e,t.parent,r)}(e,o,t),i=t[11],n=function(e,t,r){return function(e,t,r){return 40&e.type?gt(e,r):null}(e,0,r)}(o.parent||t[6],0,t);if(null!=s)if(Array.isArray(r))for(let a=0;a<r.length;a++)So(i,s,r[a],n,!1);else So(i,s,r,n,!1)}function yo(e,t){if(null!==t){const r=t.type;if(3&r)return gt(t,e);if(4&r)return Lo(-1,e[t.index]);if(8&r){const r=t.child;if(null!==r)return yo(e,r);{const r=e[t.index];return Qe(r)?Lo(-1,r):ht(r)}}if(32&r)return ao(t,e)()||ht(e[t.index]);{const r=Io(e,t);return null!==r?Array.isArray(r)?r[0]:yo(lo(e[16]),r):yo(e,t.next)}}return null}function Io(e,t){return null!==t?e[16][6].projection[t.projection]:null}function Lo(e,t){const r=Ye+e+1;if(r<t.length){const e=t[r],o=e[1].firstChild;if(null!==o)return yo(e,o)}return t[7]}function Oo(e,t,r,o,s,i,n){for(;null!=r;){const a=o[r.index],l=r.type;if(n&&0===t&&(a&&$r(ht(a),o),r.flags|=4),64!=(64&r.flags))if(8&l)Oo(e,t,r.child,o,s,i,!1),po(t,e,s,a,i);else if(32&l){const n=ao(r,o);let l;for(;l=n();)po(t,e,s,l,i);po(t,e,s,a,i)}else 16&l?Mo(e,t,o,r,s,i):po(t,e,s,a,i);r=n?r.projectionNext:r.next}}function bo(e,t,r,o,s,i){Oo(r,o,e.firstChild,t,s,i,!1)}function Mo(e,t,r,o,s,i){const n=r[16],a=n[6].projection[o.projection];if(Array.isArray(a))for(let l=0;l<a.length;l++)po(t,e,s,a[l],i);else Oo(e,t,a,n[3],s,i,!0)}function No(e,t,r){dt(e)?e.setAttribute(t,"style",r):t.style.cssText=r}function Ao(e,t,r){dt(e)?""===r?e.removeAttribute(t,"class"):e.setAttribute(t,"class",r):t.className=r}function ko(e,t,r){let o=e.length;for(;;){const s=e.indexOf(t,r);if(-1===s)return s;if(0===s||e.charCodeAt(s-1)<=32){const r=t.length;if(s+r===o||e.charCodeAt(s+r)<=32)return s}r=s+1}}const Po="ng-template";function Uo(e,t,r){let o=0;for(;o<e.length;){let s=e[o++];if(r&&"class"===s){if(s=e[o],-1!==ko(s.toLowerCase(),t,0))return!0}else if(1===s){for(;o<e.length&&"string"==typeof(s=e[o++]);)if(s.toLowerCase()===t)return!0;return!1}}return!1}function Do(e){return 4===e.type&&e.value!==Po}function wo(e,t,r){return t===(4!==e.type||r?e.value:Po)}function Zo(e,t,r){let o=4;const s=e.attrs||[],i=function(e){for(let r=0;r<e.length;r++)if(3===(t=e[r])||4===t||6===t)return r;var t;return e.length}(s);let n=!1;for(let a=0;a<t.length;a++){const l=t[a];if("number"!=typeof l){if(!n)if(4&o){if(o=2|1&o,""!==l&&!wo(e,l,r)||""===l&&1===t.length){if(xo(o))return!1;n=!0}}else{const c=8&o?l:t[++a];if(8&o&&null!==e.attrs){if(!Uo(e.attrs,c,r)){if(xo(o))return!1;n=!0}continue}const d=Bo(8&o?"class":l,s,Do(e),r);if(-1===d){if(xo(o))return!1;n=!0;continue}if(""!==c){let e;e=d>i?"":s[d+1].toLowerCase();const t=8&o?e:null;if(t&&-1!==ko(t,c,0)||2&o&&c!==e){if(xo(o))return!1;n=!0}}}}else{if(!n&&!xo(o)&&!xo(l))return!1;if(n&&xo(l))continue;n=!1,o=l|1&o}}return xo(o)||n}function xo(e){return 0==(1&e)}function Bo(e,t,r,o){if(null===t)return-1;let s=0;if(o||!r){let r=!1;for(;s<t.length;){const o=t[s];if(o===e)return s;if(3===o||6===o)r=!0;else{if(1===o||2===o){let e=t[++s];for(;"string"==typeof e;)e=t[++s];continue}if(4===o)break;if(0===o){s+=4;continue}}s+=r?1:2}return-1}return function(e,t){let r=e.indexOf(4);if(r>-1)for(r++;r<e.length;){const o=e[r];if("number"==typeof o)return-1;if(o===t)return r;r++}return-1}(t,e)}function Ho(e,t,r=!1){for(let o=0;o<t.length;o++)if(Zo(e,t[o],r))return!0;return!1}function Go(e,t){return e?":not("+t.trim()+")":t}function Vo(e){let t=e[0],r=1,o=2,s="",i=!1;for(;r<e.length;){let n=e[r];if("string"==typeof n)if(2&o){const t=e[++r];s+="["+n+(t.length>0?'="'+t+'"':"")+"]"}else 8&o?s+="."+n:4&o&&(s+=" "+n);else""===s||xo(n)||(t+=Go(i,s),s=""),o=n,i=i||!xo(o);r++}return""!==s&&(t+=Go(i,s)),t}const Wo={};function qo(e){zo(yt(),Ct(),zt()+e,Nt())}function zo(e,t,r,o){if(!o)if(3==(3&t[2])){const o=e.preOrderCheckHooks;null!==o&&Qt(t,o,r)}else{const o=e.preOrderHooks;null!==o&&Kt(t,o,0,r)}Ft(r)}function Fo(e,t){return e<<17|t<<2}function jo(e){return e>>17&32767}function Yo(e){return 2|e}function Xo(e){return(131068&e)>>2}function Qo(e,t){return-131069&e|t<<2}function Ko(e){return 1|e}function Jo(e,t){const r=e.contentQueries;if(null!==r)for(let o=0;o<r.length;o+=2){const s=r[o],i=r[o+1];if(-1!==i){const r=e.data[i];wt(s),r.contentQueries(2,t[i],i)}}}function $o(e,t,r,o,s,i,n,a,l,c){const d=t.blueprint.slice();return d[0]=s,d[2]=140|o,Tt(d),d[3]=d[15]=e,d[8]=r,d[10]=n||e&&e[10],d[11]=a||e&&e[11],d[12]=l||e&&e[12]||null,d[9]=c||e&&e[9]||null,d[6]=i,d[16]=2==t.type?e[16]:d,d}function es(e,t,r,o,s){let i=e.data[t];if(null===i)i=function(e,t,r,o,s){const i=Ot(),n=Mt(),a=e.data[t]=function(e,t,r,o,s,i){return{type:r,index:o,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:s,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,n?i:i&&i.parent,r,t,o,s);return null===e.firstChild&&(e.firstChild=a),null!==i&&(n?null==i.child&&null!==a.parent&&(i.child=a):null===i.next&&(i.next=a)),a}(e,t,r,o,s),St.lFrame.inI18n&&(i.flags|=64);else if(64&i.type){i.type=r,i.value=o,i.attrs=s;const e=function(){const e=St.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();i.injectorIndex=null===e?-1:e.injectorIndex}return bt(i,!0),i}function ts(e,t,r,o){if(0===r)return-1;const s=t.length;for(let i=0;i<r;i++)t.push(o),e.blueprint.push(o),e.data.push(null);return s}function rs(e,t,r){Bt(t);try{const o=e.viewQuery;null!==o&&Ms(1,o,r);const s=e.template;null!==s&&is(e,t,s,1,r),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Jo(e,t),e.staticViewQueries&&Ms(2,e.viewQuery,r);const i=e.components;null!==i&&function(e,t){for(let r=0;r<t.length;r++)ys(e,t[r])}(t,i)}catch(o){throw e.firstCreatePass&&(e.incompleteFirstPass=!0),o}finally{t[2]&=-5,qt()}}function os(e,t,r,o){const s=t[2];if(256==(256&s))return;Bt(t);const i=Nt();try{Tt(t),St.lFrame.bindingIndex=e.bindingStartIndex,null!==r&&is(e,t,r,2,o);const n=3==(3&s);if(!i)if(n){const r=e.preOrderCheckHooks;null!==r&&Qt(t,r,null)}else{const r=e.preOrderHooks;null!==r&&Kt(t,r,0,null),Jt(t,0)}if(function(e){for(let t=co(e);null!==t;t=uo(t)){if(!t[2])continue;const e=t[9];for(let t=0;t<e.length;t++){const r=e[t],o=r[3];0==(1024&r[2])&&vt(o,1),r[2]|=1024}}}(t),function(e){for(let t=co(e);null!==t;t=uo(t))for(let e=Ye;e<t.length;e++){const r=t[e],o=r[1];ft(r)&&os(o,r,o.template,r[8])}}(t),null!==e.contentQueries&&Jo(e,t),!i)if(n){const r=e.contentCheckHooks;null!==r&&Qt(t,r)}else{const r=e.contentHooks;null!==r&&Kt(t,r,1),Jt(t,1)}!function(e,t){const r=e.hostBindingOpCodes;if(null!==r)try{for(let e=0;e<r.length;e++){const o=r[e];if(o<0)Ft(~o);else{const s=o,i=r[++e],n=r[++e];Ut(i,s),n(2,t[s])}}}finally{Ft(-1)}}(e,t);const a=e.components;null!==a&&function(e,t){for(let r=0;r<t.length;r++)Rs(e,t[r])}(t,a);const l=e.viewQuery;if(null!==l&&Ms(2,l,o),!i)if(n){const r=e.viewCheckHooks;null!==r&&Qt(t,r)}else{const r=e.viewHooks;null!==r&&Kt(t,r,2),Jt(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),i||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,vt(t[3],-1))}finally{qt()}}function ss(e,t,r,o){const s=t[10],i=!Nt(),n=4==(4&t[2]);try{i&&!n&&s.begin&&s.begin(),n&&rs(e,t,o),os(e,t,r,o)}finally{i&&!n&&s.end&&s.end()}}function is(e,t,r,o,s){const i=zt(),n=2&o;try{Ft(-1),n&&t.length>je&&zo(e,t,je,Nt()),r(o,s)}finally{Ft(i)}}function ns(e,t,r){Rt()&&(function(e,t,r,o){const s=r.directiveStart,i=r.directiveEnd;e.firstCreatePass||pr(r,t),$r(o,t);const n=r.initialInputs;for(let a=s;a<i;a++){const o=e.data[a],i=et(o);i&&Es(t,r,o);const l=yr(t,e,a,r);$r(l,t),null!==n&&Ts(0,a-s,l,o,0,n),i&&(_t(r.index,t)[8]=l)}}(e,t,r,gt(r,t)),128==(128&r.flags)&&function(e,t,r){const o=r.directiveStart,s=r.directiveEnd,i=r.index,n=St.lFrame.currentDirectiveIndex;try{Ft(i);for(let r=o;r<s;r++){const o=e.data[r],s=t[r];Dt(r),null===o.hostBindings&&0===o.hostVars&&null===o.hostAttrs||ps(o,s)}}finally{Ft(-1),Dt(n)}}(e,t,r))}function as(e,t,r=gt){const o=t.localNames;if(null!==o){let s=t.index+1;for(let i=0;i<o.length;i+=2){const n=o[i+1],a=-1===n?r(t,e):e[n];e[s++]=a}}}function ls(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=cs(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function cs(e,t,r,o,s,i,n,a,l,c){const d=je+o,u=d+s,h=function(e,t){const r=[];for(let o=0;o<t;o++)r.push(o<e?null:Wo);return r}(d,u),p="function"==typeof c?c():c;return h[1]={type:e,blueprint:h,template:r,queries:null,viewQuery:a,declTNode:t,data:h.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:u,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof i?i():i,pipeRegistry:"function"==typeof n?n():n,firstChild:null,schemas:l,consts:p,incompleteFirstPass:!1}}function ds(e,t,r){for(let o in e)if(e.hasOwnProperty(o)){const s=e[o];(r=null===r?{}:r).hasOwnProperty(o)?r[o].push(t,s):r[o]=[t,s]}return r}function us(e,t,r,o){let s=!1;if(Rt()){const i=function(e,t,r){const o=e.directiveRegistry;let s=null;if(o)for(let i=0;i<o.length;i++){const n=o[i];Ho(r,n.selectors,!1)&&(s||(s=[]),fr(pr(r,t),e,n.type),et(n)?(gs(e,r),s.unshift(n)):s.push(n))}return s}(e,t,r),n=null===o?null:{"":-1};if(null!==i){s=!0,_s(r,e.data.length,i.length);for(let e=0;e<i.length;e++){const t=i[e];t.providersResolver&&t.providersResolver(t)}let o=!1,a=!1,l=ts(e,t,i.length,null);for(let s=0;s<i.length;s++){const c=i[s];r.mergedAttrs=ir(r.mergedAttrs,c.hostAttrs),fs(e,r,t,l,c),ms(l,c,n),null!==c.contentQueries&&(r.flags|=8),null===c.hostBindings&&null===c.hostAttrs&&0===c.hostVars||(r.flags|=128);const d=c.type.prototype;!o&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(r.index),o=!0),a||!d.ngOnChanges&&!d.ngDoCheck||((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(r.index),a=!0),l++}!function(e,t){const r=t.directiveEnd,o=e.data,s=t.attrs,i=[];let n=null,a=null;for(let l=t.directiveStart;l<r;l++){const e=o[l],r=e.inputs,c=null===s||Do(t)?null:vs(r,s);i.push(c),n=ds(r,l,n),a=ds(e.outputs,l,a)}null!==n&&(n.hasOwnProperty("class")&&(t.flags|=16),n.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=i,t.inputs=n,t.outputs=a}(e,r)}n&&function(e,t,r){if(t){const o=e.localNames=[];for(let e=0;e<t.length;e+=2){const s=r[t[e+1]];if(null==s)throw new oe("301",`Export of name '${t[e+1]}' not found!`);o.push(t[e],s)}}}(r,o,n)}return r.mergedAttrs=ir(r.mergedAttrs,r.attrs),s}function hs(e,t,r,o,s,i){const n=i.hostBindings;if(n){let r=e.hostBindingOpCodes;null===r&&(r=e.hostBindingOpCodes=[]);const i=~t.index;(function(e){let t=e.length;for(;t>0;){const r=e[--t];if("number"==typeof r&&r<0)return r}return 0})(r)!=i&&r.push(i),r.push(o,s,n)}}function ps(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function gs(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function ms(e,t,r){if(r){if(t.exportAs)for(let o=0;o<t.exportAs.length;o++)r[t.exportAs[o]]=e;et(t)&&(r[""]=e)}}function _s(e,t,r){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+r,e.providerIndexes=t}function fs(e,t,r,o,s){e.data[o]=s;const i=s.factory||(s.factory=tt(s.type)),n=new rr(i,et(s),null);e.blueprint[o]=n,r[o]=n,hs(e,t,0,o,ts(e,r,s.hostVars,Wo),s)}function Es(e,t,r){const o=gt(t,e),s=ls(r),i=e[10],n=Is(e,$o(e,s,null,r.onPush?64:16,o,t,i,i.createRenderer(o,r),null,null));e[t.index]=n}function Ts(e,t,r,o,s,i){const n=i[t];if(null!==n){const e=o.setInput;for(let t=0;t<n.length;){const s=n[t++],i=n[t++],a=n[t++];null!==e?o.setInput(r,a,s,i):r[i]=a}}}function vs(e,t){let r=null,o=0;for(;o<t.length;){const s=t[o];if(0!==s)if(5!==s){if("number"==typeof s)break;e.hasOwnProperty(s)&&(null===r&&(r=[]),r.push(s,e[s],t[o+1])),o+=2}else o+=2;else o+=4}return r}function Ss(e,t,r,o){return new Array(e,!0,!1,t,null,0,o,r,null,null)}function Rs(e,t){const r=_t(t,e);if(ft(r)){const e=r[1];80&r[2]?os(e,r,e.template,r[8]):r[5]>0&&Cs(r)}}function Cs(e){for(let r=co(e);null!==r;r=uo(r))for(let e=Ye;e<r.length;e++){const t=r[e];if(1024&t[2]){const e=t[1];os(e,t,e.template,t[8])}else t[5]>0&&Cs(t)}const t=e[1].components;if(null!==t)for(let r=0;r<t.length;r++){const o=_t(t[r],e);ft(o)&&o[5]>0&&Cs(o)}}function ys(e,t){const r=_t(t,e),o=r[1];!function(e,t){for(let r=t.length;r<e.blueprint.length;r++)t.push(e.blueprint[r])}(o,r),rs(o,r,r[8])}function Is(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function Ls(e){for(;e;){e[2]|=64;const t=lo(e);if(0!=(512&e[2])&&!t)return e;e=t}return null}function Os(e,t,r){const o=t[10];o.begin&&o.begin();try{os(e,t,e.template,r)}catch(s){throw Ps(t,s),s}finally{o.end&&o.end()}}function bs(e){!function(e){for(let t=0;t<e.components.length;t++){const r=e.components[t],o=eo(r),s=o[1];ss(s,o,s.template,r)}}(e[8])}function Ms(e,t,r){wt(0),t(e,r)}const Ns=(()=>Promise.resolve(null))();function As(e){return e[7]||(e[7]=[])}function ks(e){return e.cleanup||(e.cleanup=[])}function Ps(e,t){const r=e[9],o=r?r.get(oo,null):null;o&&o.handleError(t)}function Us(e,t,r,o,s){for(let i=0;i<r.length;){const n=r[i++],a=r[i++],l=t[n],c=e.data[n];null!==c.setInput?c.setInput(l,s,o,a):l[a]=s}}function Ds(e,t,r){let o=r?e.styles:null,s=r?e.classes:null,i=0;if(null!==t)for(let n=0;n<t.length;n++){const e=t[n];"number"==typeof e?i=e:1==i?s=J(s,e):2==i&&(o=J(o,e+": "+t[++n]+";"))}r?e.styles=o:e.stylesWithoutHost=o,r?e.classes=s:e.classesWithoutHost=s}const ws=new kr("INJECTOR",-1);class Zs{get(e,t=Br){if(t===Br){const t=new Error(`NullInjectorError: No provider for ${K(e)}!`);throw t.name="NullInjectorError",t}return t}}const xs=new kr("Set Injector scope."),Bs={},Hs={};let Gs;function Vs(){return void 0===Gs&&(Gs=new Zs),Gs}function Ws(e,t=null,r=null,o){return new qs(e,r,t||Vs(),o)}class qs{constructor(e,t,r,o=null){this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const s=[];t&&Pr(t,r=>this.processProvider(r,e,t)),Pr([e],e=>this.processInjectorType(e,[],s)),this.records.set(ws,js(void 0,this));const i=this.records.get(xs);this.scope=null!=i?i.value:null,this.source=o||("object"==typeof e?null:K(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=Br,r=_e.Default){this.assertNotDestroyed();const o=qr(this),s=Ee(void 0);try{if(!(r&_e.SkipSelf)){let t=this.records.get(e);if(void 0===t){const r=("function"==typeof(i=e)||"object"==typeof i&&i instanceof kr)&&ce(e);t=r&&this.injectableDefInScope(r)?js(zs(e),Bs):null,this.records.set(e,t)}if(null!=t)return this.hydrate(e,t)}return(r&_e.Self?Vs():this.parent).get(e,t=r&_e.Optional&&t===Br?null:t)}catch(n){if("NullInjectorError"===n.name){if((n.ngTempTokenPath=n.ngTempTokenPath||[]).unshift(K(e)),o)throw n;return function(e,t,r,o){const s=e.ngTempTokenPath;throw t[Gr]&&s.unshift(t[Gr]),e.message=function(e,t,r,o=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let s=K(t);if(Array.isArray(t))s=t.map(K).join(" -> ");else if("object"==typeof t){let e=[];for(let r in t)if(t.hasOwnProperty(r)){let o=t[r];e.push(r+":"+("string"==typeof o?JSON.stringify(o):K(o)))}s=`{${e.join(", ")}}`}return`${r}${o?"("+o+")":""}[${s}]: ${e.replace(Hr,"\n  ")}`}("\n"+e.message,s,r,o),e.ngTokenPath=s,e.ngTempTokenPath=null,e}(n,e,"R3InjectorError",this.source)}throw n}finally{Ee(s),qr(o)}var i}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((t,r)=>e.push(K(r))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,r){if(!(e=te(e)))return!1;let o=ue(e);const s=null==o&&e.ngModule||void 0,i=void 0===s?e:s,n=-1!==r.indexOf(i);if(void 0!==s&&(o=ue(s)),null==o)return!1;if(null!=o.imports&&!n){let e;r.push(i);try{Pr(o.imports,o=>{this.processInjectorType(o,t,r)&&(void 0===e&&(e=[]),e.push(o))})}finally{}if(void 0!==e)for(let t=0;t<e.length;t++){const{ngModule:r,providers:o}=e[t];Pr(o,e=>this.processProvider(e,r,o||Me))}}this.injectorDefTypes.add(i);const a=tt(i)||(()=>new i);this.records.set(i,js(a,Bs));const l=o.providers;if(null!=l&&!n){const t=e;Pr(l,e=>this.processProvider(e,t,l))}return void 0!==s&&void 0!==e.providers}processProvider(e,t,r){let o=Xs(e=te(e))?e:te(e&&e.provide);const s=function(e,t,r){return Ys(e)?js(void 0,e.useValue):js(Fs(e),Bs)}(e);if(Xs(e)||!0!==e.multi)this.records.get(o);else{let t=this.records.get(o);t||(t=js(void 0,Bs,!0),t.factory=()=>jr(t.multi),this.records.set(o,t)),o=e,t.multi.push(e)}this.records.set(o,s)}hydrate(e,t){var r;return t.value===Bs&&(t.value=Hs,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(r=t.value)&&"object"==typeof r&&"function"==typeof r.ngOnDestroy&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=te(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function zs(e){const t=ce(e),r=null!==t?t.factory:tt(e);if(null!==r)return r;if(e instanceof kr)throw new Error(`Token ${K(e)} is missing a \u0275prov definition.`);if(e instanceof Function)return function(e){const t=e.length;if(t>0){const r=function(e,t){const r=[];for(let o=0;o<e;o++)r.push("?");return r}(t);throw new Error(`Can't resolve all parameters for ${K(e)}: (${r.join(", ")}).`)}const r=function(e){const t=e&&(e[he]||e[ge]);if(t){const r=function(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${r}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${r}" class.`),t}return null}(e);return null!==r?()=>r.factory(e):()=>new e}(e);throw new Error("unreachable")}function Fs(e,t,r){let o;if(Xs(e)){const t=te(e);return tt(t)||zs(t)}if(Ys(e))o=()=>te(e.useValue);else if((s=e)&&s.useFactory)o=()=>e.useFactory(...jr(e.deps||[]));else if(function(e){return!(!e||!e.useExisting)}(e))o=()=>Fr(te(e.useExisting));else{const t=te(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return tt(t)||zs(t);o=()=>new t(...jr(e.deps))}var s;return o}function js(e,t,r=!1){return{factory:e,value:t,multi:r?[]:void 0}}function Ys(e){return null!==e&&"object"==typeof e&&Vr in e}function Xs(e){return"function"==typeof e}const Qs=function(e,t,r){return function(e,t=null,r=null,o){const s=Ws(e,t,r,o);return s._resolveInjectorDefTypes(),s}({name:r},t,e,r)};class Ks{static create(e,t){return Array.isArray(e)?Qs(e,t,""):Qs(e.providers,e.parent,e.name||"")}}function Js(e,t){Xt(eo(e)[1],Lt())}function $s(e){let t=Object.getPrototypeOf(e.type.prototype).constructor,r=!0;const o=[e];for(;t;){let s;if(et(e))s=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");s=t.\u0275dir}if(s){if(r){o.push(s);const t=e;t.inputs=ei(e.inputs),t.declaredInputs=ei(e.declaredInputs),t.outputs=ei(e.outputs);const r=s.hostBindings;r&&oi(e,r);const i=s.viewQuery,n=s.contentQueries;if(i&&ti(e,i),n&&ri(e,n),Q(e.inputs,s.inputs),Q(e.declaredInputs,s.declaredInputs),Q(e.outputs,s.outputs),et(s)&&s.data.animation){const t=e.data;t.animation=(t.animation||[]).concat(s.data.animation)}}const t=s.features;if(t)for(let o=0;o<t.length;o++){const s=t[o];s&&s.ngInherit&&s(e),s===$s&&(r=!1)}}t=Object.getPrototypeOf(t)}!function(e){let t=0,r=null;for(let o=e.length-1;o>=0;o--){const s=e[o];s.hostVars=t+=s.hostVars,s.hostAttrs=ir(s.hostAttrs,r=ir(r,s.hostAttrs))}}(o)}function ei(e){return e===be?{}:e===Me?[]:e}function ti(e,t){const r=e.viewQuery;e.viewQuery=r?(e,o)=>{t(e,o),r(e,o)}:t}function ri(e,t){const r=e.contentQueries;e.contentQueries=r?(e,o,s)=>{t(e,o,s),r(e,o,s)}:t}function oi(e,t){const r=e.hostBindings;e.hostBindings=r?(e,o)=>{t(e,o),r(e,o)}:t}Ks.THROW_IF_NOT_FOUND=Br,Ks.NULL=new Zs,Ks.\u0275prov=ae({token:Ks,providedIn:"any",factory:()=>Fr(ws)}),Ks.__NG_ELEMENT_ID__=-1;let si=null;function ii(){if(!si){const e=Oe.Symbol;if(e&&e.iterator)si=e.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const r=e[t];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(si=r)}}}return si}function ni(e){return!!ai(e)&&(Array.isArray(e)||!(e instanceof Map)&&ii()in e)}function ai(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function li(e,t,r){return!Object.is(e[t],r)&&(e[t]=r,!0)}function ci(e,t,r,o,s,i,n,a){const l=Ct(),c=yt(),d=e+je,u=c.firstCreatePass?function(e,t,r,o,s,i,n,a,l){const c=t.consts,d=es(t,e,4,n||null,Et(c,a));us(t,r,d,Et(c,l)),Xt(t,d);const u=d.tViews=cs(2,d,o,s,i,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c);return null!==t.queries&&(t.queries.template(t,d),u.queries=t.queries.embeddedTView(d)),d}(d,c,l,t,r,o,s,i,n):c.data[d];bt(u,!1);const h=l[11].createComment("");Co(c,l,h,u),$r(h,l),Is(l,l[d]=Ss(h,l,h,u)),$e(u)&&ns(c,l,u),null!=n&&as(l,u,a)}function di(e,t=_e.Default){const r=Ct();return null===r?Fr(e,t):vr(Lt(),r,te(e),t)}function ui(e,t,r){const o=Ct();return li(o,kt(),t)&&function(e,t,r,o,s,i,n,a){const l=gt(t,r);let c,d=t.inputs;var u;null!=d&&(c=d[o])?(Us(e,r,c,o,s),Je(t)&&function(e,t){const r=_t(t,e);16&r[2]||(r[2]|=64)}(r,t.index)):3&t.type&&(o="class"===(u=o)?"className":"for"===u?"htmlFor":"formaction"===u?"formAction":"innerHtml"===u?"innerHTML":"readonly"===u?"readOnly":"tabindex"===u?"tabIndex":u,s=null!=n?n(s,t.value||"",o):s,dt(i)?i.setProperty(l,o,s):sr(o)||(l.setProperty?l.setProperty(o,s):l[o]=s))}(yt(),function(){const e=St.lFrame;return mt(e.tView,e.selectedIndex)}(),o,e,t,o[11],r),ui}function hi(e,t,r,o,s){const i=s?"class":"style";Us(e,r,t.inputs[i],i,o)}function pi(e,t,r,o){const s=Ct(),i=yt(),n=je+e,a=s[11],l=s[n]=go(a,t,St.lFrame.currentNamespace),c=i.firstCreatePass?function(e,t,r,o,s,i,n){const a=t.consts,l=es(t,e,2,s,Et(a,i));return us(t,r,l,Et(a,n)),null!==l.attrs&&Ds(l,l.attrs,!1),null!==l.mergedAttrs&&Ds(l,l.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,l),l}(n,i,s,0,t,r,o):i.data[n];bt(c,!0);const d=c.mergedAttrs;null!==d&&or(a,l,d);const u=c.classes;null!==u&&Ao(a,l,u);const h=c.styles;null!==h&&No(a,l,h),64!=(64&c.flags)&&Co(i,s,l,c),0===St.lFrame.elementDepthCount&&$r(l,s),St.lFrame.elementDepthCount++,$e(c)&&(ns(i,s,c),function(e,t,r){if(Ke(t)){const o=t.directiveEnd;for(let s=t.directiveStart;s<o;s++){const t=e.data[s];t.contentQueries&&t.contentQueries(1,r[s],s)}}}(i,c,s)),null!==o&&as(s,c)}function gi(){let e=Lt();Mt()?St.lFrame.isParent=!1:(e=e.parent,bt(e,!1));const t=e;St.lFrame.elementDepthCount--;const r=yt();r.firstCreatePass&&(Xt(r,e),Ke(e)&&r.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&hi(r,t,Ct(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&hi(r,t,Ct(),t.stylesWithoutHost,!1)}function mi(e,t,r,o){pi(e,t,r,o),gi()}function _i(){return Ct()}function fi(e){return!!e&&"function"==typeof e.then}const Ei=function(e){return!!e&&"function"==typeof e.subscribe};function Ti(e,t,r,o){const s=Ct(),i=yt(),n=Lt();return function(e,t,r,o,s,i,n,a){const l=$e(o),c=e.firstCreatePass&&ks(e),d=As(t);let u=!0;if(3&o.type||a){const h=gt(o,t),p=a?a(h):h,g=d.length,m=a?e=>a(ht(e[o.index])):o.index;if(dt(r)){let n=null;if(!a&&l&&(n=function(e,t,r,o){const s=e.cleanup;if(null!=s)for(let i=0;i<s.length-1;i+=2){const e=s[i];if(e===r&&s[i+1]===o){const e=t[7],r=s[i+2];return e.length>r?e[r]:null}"string"==typeof e&&(i+=2)}return null}(e,t,s,o.index)),null!==n)(n.__ngLastListenerFn__||n).__ngNextListenerFn__=i,n.__ngLastListenerFn__=i,u=!1;else{i=Si(o,t,0,i,!1);const e=r.listen(p,s,i);d.push(i,e),c&&c.push(s,m,g,g+1)}}else i=Si(o,t,0,i,!0),p.addEventListener(s,i,n),d.push(i),c&&c.push(s,m,g,n)}else i=Si(o,t,0,i,!1);const h=o.outputs;let p;if(u&&null!==h&&(p=h[s])){const e=p.length;if(e)for(let r=0;r<e;r+=2){const e=t[p[r]][p[r+1]].subscribe(i),n=d.length;d.push(i,e),c&&c.push(s,o.index,n,-(n+1))}}}(i,s,s[11],n,e,t,!!r,o),Ti}function vi(e,t,r,o){try{return!1!==r(o)}catch(s){return Ps(e,s),!1}}function Si(e,t,r,o,s){return function r(i){if(i===Function)return o;const n=2&e.flags?_t(e.index,t):t;0==(32&t[2])&&Ls(n);let a=vi(t,0,o,i),l=r.__ngNextListenerFn__;for(;l;)a=vi(t,0,l,i)&&a,l=l.__ngNextListenerFn__;return s&&!1===a&&(i.preventDefault(),i.returnValue=!1),a}}function Ri(e=1){return function(e){return(St.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,St.lFrame.contextLView))[8]}(e)}function Ci(e,t,r,o,s){const i=e[r+1],n=null===t;let a=o?jo(i):Xo(i),l=!1;for(;0!==a&&(!1===l||n);){const r=e[a+1];yi(e[a],t)&&(l=!0,e[a+1]=o?Ko(r):Yo(r)),a=o?jo(r):Xo(r)}l&&(e[r+1]=o?Yo(i):Ko(i))}function yi(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&xr(e,t)>=0}const Ii={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Li(e){return e.substring(Ii.key,Ii.keyEnd)}function Oi(e,t){const r=Ii.textEnd;return r===t?-1:(t=Ii.keyEnd=function(e,t,r){for(;t<r&&e.charCodeAt(t)>32;)t++;return t}(e,Ii.key=t,r),bi(e,t,r))}function bi(e,t,r){for(;t<r&&e.charCodeAt(t)<=32;)t++;return t}function Mi(e,t){return function(e,t,r,o){const s=Ct(),i=yt(),n=Pt(2);i.firstUpdatePass&&Pi(i,e,n,true),t!==Wo&&li(s,n,t)&&wi(i,i.data[zt()],s,s[11],e,s[n+1]=function(e,t){return null==e||"object"==typeof e&&(e=K(Jr(e))),e}(t),true,n)}(e,t),Mi}function Ni(e){!function(e,t,r,o){const s=yt(),i=Pt(2);s.firstUpdatePass&&Pi(s,null,i,o);const n=Ct();if(r!==Wo&&li(n,i,r)){const a=s.data[zt()];if(Bi(a,o)&&!ki(s,i)){let e=a.classesWithoutHost;null!==e&&(r=J(e,r||"")),hi(s,a,n,r,o)}else!function(e,t,r,o,s,i,n,a){s===Wo&&(s=Me);let l=0,c=0,d=0<s.length?s[0]:null,u=0<i.length?i[0]:null;for(;null!==d||null!==u;){const n=l<s.length?s[l+1]:void 0,h=c<i.length?i[c+1]:void 0;let p,g=null;d===u?(l+=2,c+=2,n!==h&&(g=u,p=h)):null===u||null!==d&&d<u?(l+=2,g=d):(c+=2,g=u,p=h),null!==g&&wi(e,t,r,o,g,p,true,a),d=l<s.length?s[l]:null,u=c<i.length?i[c]:null}}(s,a,n,n[11],n[i+1],n[i+1]=function(e,t,r){if(null==r||""===r)return Me;const o=[],s=Jr(r);if(Array.isArray(s))for(let i=0;i<s.length;i++)e(o,s[i],!0);else if("object"==typeof s)for(const i in s)s.hasOwnProperty(i)&&e(o,i,s[i]);else"string"==typeof s&&t(o,s);return o}(e,t,r),0,i)}}(wr,Ai,e,!0)}function Ai(e,t){for(let r=function(e){return function(e){Ii.key=0,Ii.keyEnd=0,Ii.value=0,Ii.valueEnd=0,Ii.textEnd=e.length}(e),Oi(e,bi(e,0,Ii.textEnd))}(t);r>=0;r=Oi(t,r))wr(e,Li(t),!0)}function ki(e,t){return t>=e.expandoStartIndex}function Pi(e,t,r,o){const s=e.data;if(null===s[r+1]){const i=s[zt()],n=ki(e,r);Bi(i,o)&&null===t&&!n&&(t=!1),t=function(e,t,r,o){const s=function(e){const t=St.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let i=o?t.residualClasses:t.residualStyles;if(null===s)0===(o?t.classBindings:t.styleBindings)&&(r=Di(r=Ui(null,e,t,r,o),t.attrs,o),i=null);else{const n=t.directiveStylingLast;if(-1===n||e[n]!==s)if(r=Ui(s,e,t,r,o),null===i){let r=function(e,t,r){const o=r?t.classBindings:t.styleBindings;if(0!==Xo(o))return e[jo(o)]}(e,t,o);void 0!==r&&Array.isArray(r)&&(r=Ui(null,e,t,r[1],o),r=Di(r,t.attrs,o),function(e,t,r,o){e[jo(r?t.classBindings:t.styleBindings)]=o}(e,t,o,r))}else i=function(e,t,r){let o;const s=t.directiveEnd;for(let i=1+t.directiveStylingLast;i<s;i++)o=Di(o,e[i].hostAttrs,r);return Di(o,t.attrs,r)}(e,t,o)}return void 0!==i&&(o?t.residualClasses=i:t.residualStyles=i),r}(s,i,t,o),function(e,t,r,o,s,i){let n=i?t.classBindings:t.styleBindings,a=jo(n),l=Xo(n);e[o]=r;let c,d=!1;if(Array.isArray(r)){const e=r;c=e[1],(null===c||xr(e,c)>0)&&(d=!0)}else c=r;if(s)if(0!==l){const t=jo(e[a+1]);e[o+1]=Fo(t,a),0!==t&&(e[t+1]=Qo(e[t+1],o)),e[a+1]=131071&e[a+1]|o<<17}else e[o+1]=Fo(a,0),0!==a&&(e[a+1]=Qo(e[a+1],o)),a=o;else e[o+1]=Fo(l,0),0===a?a=o:e[l+1]=Qo(e[l+1],o),l=o;d&&(e[o+1]=Yo(e[o+1])),Ci(e,c,o,!0),Ci(e,c,o,!1),function(e,t,r,o,s){const i=s?e.residualClasses:e.residualStyles;null!=i&&"string"==typeof t&&xr(i,t)>=0&&(r[o+1]=Ko(r[o+1]))}(t,c,e,o,i),n=Fo(a,l),i?t.classBindings=n:t.styleBindings=n}(s,i,t,r,n,o)}}function Ui(e,t,r,o,s){let i=null;const n=r.directiveEnd;let a=r.directiveStylingLast;for(-1===a?a=r.directiveStart:a++;a<n&&(i=t[a],o=Di(o,i.hostAttrs,s),i!==e);)a++;return null!==e&&(r.directiveStylingLast=a),o}function Di(e,t,r){const o=r?1:2;let s=-1;if(null!==t)for(let i=0;i<t.length;i++){const n=t[i];"number"==typeof n?s=n:s===o&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),wr(e,n,!!r||t[++i]))}return void 0===e?null:e}function wi(e,t,r,o,s,i,n,a){if(!(3&t.type))return;const l=e.data,c=l[a+1];xi(1==(1&c)?Zi(l,t,r,s,Xo(c),n):void 0)||(xi(i)||2==(2&c)&&(i=Zi(l,null,r,s,a,n)),function(e,t,r,o,s){const i=dt(e);if(t)s?i?e.addClass(r,o):r.classList.add(o):i?e.removeClass(r,o):r.classList.remove(o);else{let t=-1===o.indexOf("-")?void 0:no.DashCase;if(null==s)i?e.removeStyle(r,o,t):r.style.removeProperty(o);else{const n="string"==typeof s&&s.endsWith("!important");n&&(s=s.slice(0,-10),t|=no.Important),i?e.setStyle(r,o,s,t):r.style.setProperty(o,s,n?"important":"")}}}(o,n,pt(zt(),r),s,i))}function Zi(e,t,r,o,s,i){const n=null===t;let a;for(;s>0;){const t=e[s],i=Array.isArray(t),l=i?t[1]:t,c=null===l;let d=r[s+1];d===Wo&&(d=c?Me:void 0);let u=c?Zr(d,o):l===o?d:void 0;if(i&&!xi(u)&&(u=Zr(t,o)),xi(u)&&(a=u,n))return a;const h=e[s+1];s=n?jo(h):Xo(h)}if(null!==t){let e=i?t.residualClasses:t.residualStyles;null!=e&&(a=Zr(e,o))}return a}function xi(e){return void 0!==e}function Bi(e,t){return 0!=(e.flags&(t?16:32))}function Hi(e,t=""){const r=Ct(),o=yt(),s=e+je,i=o.firstCreatePass?es(o,s,1,t,null):o.data[s],n=r[s]=function(e,t){return dt(e)?e.createText(t):e.createTextNode(t)}(r[11],t);Co(o,r,n,i),bt(i,!1)}function Gi(e){return Vi("",e,""),Gi}function Vi(e,t,r){const o=Ct(),s=function(e,t,r,o){return li(e,kt(),r)?t+se(r)+o:Wo}(o,e,t,r);return s!==Wo&&function(e,t,r){const o=pt(t,e);!function(e,t,r){dt(e)?e.setValue(t,r):t.textContent=r}(e[11],o,r)}(o,zt(),s),Vi}const Wi=void 0;var qi=["en",[["a","p"],["AM","PM"],Wi],[["AM","PM"],Wi,Wi],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Wi,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Wi,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Wi,"{1} 'at' {0}",Wi],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){let t=Math.floor(Math.abs(e)),r=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===r?1:5}];let zi={};function Fi(e){return e in zi||(zi[e]=Oe.ng&&Oe.ng.common&&Oe.ng.common.locales&&Oe.ng.common.locales[e]),zi[e]}var ji=(()=>((ji=ji||{})[ji.LocaleId=0]="LocaleId",ji[ji.DayPeriodsFormat=1]="DayPeriodsFormat",ji[ji.DayPeriodsStandalone=2]="DayPeriodsStandalone",ji[ji.DaysFormat=3]="DaysFormat",ji[ji.DaysStandalone=4]="DaysStandalone",ji[ji.MonthsFormat=5]="MonthsFormat",ji[ji.MonthsStandalone=6]="MonthsStandalone",ji[ji.Eras=7]="Eras",ji[ji.FirstDayOfWeek=8]="FirstDayOfWeek",ji[ji.WeekendRange=9]="WeekendRange",ji[ji.DateFormat=10]="DateFormat",ji[ji.TimeFormat=11]="TimeFormat",ji[ji.DateTimeFormat=12]="DateTimeFormat",ji[ji.NumberSymbols=13]="NumberSymbols",ji[ji.NumberFormats=14]="NumberFormats",ji[ji.CurrencyCode=15]="CurrencyCode",ji[ji.CurrencySymbol=16]="CurrencySymbol",ji[ji.CurrencyName=17]="CurrencyName",ji[ji.Currencies=18]="Currencies",ji[ji.Directionality=19]="Directionality",ji[ji.PluralCase=20]="PluralCase",ji[ji.ExtraData=21]="ExtraData",ji))();const Yi="en-US";let Xi=Yi;function Qi(e){var t,r;r="Expected localeId to be defined",null==(t=e)&&function(e,t,r,o){throw new Error(`ASSERTION ERROR: ${e} [Expected=> null != ${t} <=Actual]`)}(r,t),"string"==typeof e&&(Xi=e.toLowerCase().replace(/_/g,"-"))}function Ki(e,t,r,o,s){if(e=te(e),Array.isArray(e))for(let i=0;i<e.length;i++)Ki(e[i],t,r,o,s);else{const i=yt(),n=Ct();let a=Xs(e)?e:te(e.provide),l=Fs(e);const c=Lt(),d=1048575&c.providerIndexes,u=c.directiveStart,h=c.providerIndexes>>20;if(Xs(e)||!e.multi){const o=new rr(l,s,di),p=en(a,t,s?d:d+h,u);-1===p?(fr(pr(c,n),i,a),Ji(i,e,t.length),t.push(a),c.directiveStart++,c.directiveEnd++,s&&(c.providerIndexes+=1048576),r.push(o),n.push(o)):(r[p]=o,n[p]=o)}else{const p=en(a,t,d+h,u),g=en(a,t,d,d+h),m=p>=0&&r[p],_=g>=0&&r[g];if(s&&!_||!s&&!m){fr(pr(c,n),i,a);const d=function(e,t,r,o,s){const i=new rr(e,r,di);return i.multi=[],i.index=t,i.componentProviders=0,$i(i,s,o&&!r),i}(s?rn:tn,r.length,s,o,l);!s&&_&&(r[g].providerFactory=d),Ji(i,e,t.length,0),t.push(a),c.directiveStart++,c.directiveEnd++,s&&(c.providerIndexes+=1048576),r.push(d),n.push(d)}else Ji(i,e,p>-1?p:g,$i(r[s?g:p],l,!s&&o));!s&&o&&_&&r[g].componentProviders++}}}function Ji(e,t,r,o){const s=Xs(t);if(s||t.useClass){const i=(t.useClass||t).prototype.ngOnDestroy;if(i){const n=e.destroyHooks||(e.destroyHooks=[]);if(!s&&t.multi){const e=n.indexOf(r);-1===e?n.push(r,[o,i]):n[e+1].push(o,i)}else n.push(r,i)}}}function $i(e,t,r){return r&&e.componentProviders++,e.multi.push(t)-1}function en(e,t,r,o){for(let s=r;s<o;s++)if(t[s]===e)return s;return-1}function tn(e,t,r,o){return on(this.multi,[])}function rn(e,t,r,o){const s=this.multi;let i;if(this.providerFactory){const e=this.providerFactory.componentProviders,t=yr(r,r[1],this.providerFactory.index,o);i=t.slice(0,e),on(s,i);for(let r=e;r<t.length;r++)i.push(t[r])}else i=[],on(s,i);return i}function on(e,t){for(let r=0;r<e.length;r++)t.push((0,e[r])());return t}function sn(e,t=[]){return r=>{r.providersResolver=(r,o)=>function(e,t,r){const o=yt();if(o.firstCreatePass){const s=et(e);Ki(r,o.data,o.blueprint,s,!0),Ki(t,o.data,o.blueprint,s,!1)}}(r,o?o(e):e,t)}}class nn{}class an{resolveComponentFactory(e){throw function(e){const t=Error(`No component factory found for ${K(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(e)}}class ln{}function cn(...e){}function dn(e,t){return new hn(gt(e,t))}ln.NULL=new an;const un=function(){return dn(Lt(),Ct())};let hn=(()=>{class e{constructor(e){this.nativeElement=e}}return e.__NG_ELEMENT_ID__=un,e})();class pn{}let gn=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>mn(),e})();const mn=function(){const e=Ct(),t=_t(Lt().index,e);return function(e){return e[11]}(Xe(t)?t:e)};let _n=(()=>{class e{}return e.\u0275prov=ae({token:e,providedIn:"root",factory:()=>null}),e})();class fn{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const En=new fn("12.1.4");class Tn{constructor(){}supports(e){return ni(e)}create(e){return new Sn(e)}}const vn=(e,t)=>t;class Sn{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||vn}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,o=0,s=null;for(;t||r;){const i=!r||t&&t.currentIndex<In(r,o,s)?t:r,n=In(i,o,s),a=i.currentIndex;if(i===r)o--,r=r._nextRemoved;else if(t=t._next,null==i.previousIndex)o++;else{s||(s=[]);const e=n-o,t=a-o;if(e!=t){for(let r=0;r<e;r++){const o=r<s.length?s[r]:s[r]=0,i=o+r;t<=i&&i<e&&(s[r]=o+1)}s[i.previousIndex]=t-e}}n!==a&&e(i,n,a)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!ni(e))throw new Error(`Error trying to diff '${K(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t,r,o,s=this._itHead,i=!1;if(Array.isArray(e)){this.length=e.length;for(let t=0;t<this.length;t++)r=e[t],o=this._trackByFn(t,r),null!==s&&Object.is(s.trackById,o)?(i&&(s=this._verifyReinsertion(s,r,o,t)),Object.is(s.item,r)||this._addIdentityChange(s,r)):(s=this._mismatch(s,r,o,t),i=!0),s=s._next}else t=0,function(e,t){if(Array.isArray(e))for(let r=0;r<e.length;r++)t(e[r]);else{const r=e[ii()]();let o;for(;!(o=r.next()).done;)t(o.value)}}(e,e=>{o=this._trackByFn(t,e),null!==s&&Object.is(s.trackById,o)?(i&&(s=this._verifyReinsertion(s,e,o,t)),Object.is(s.item,e)||this._addIdentityChange(s,e)):(s=this._mismatch(s,e,o,t),i=!0),s=s._next,t++}),this.length=t;return this._truncate(s),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,o){let s;return null===e?s=this._itTail:(s=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,o)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,o))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,o)):e=this._addAfter(new Rn(t,r),s,o),e}_verifyReinsertion(e,t,r,o){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==s?e=this._reinsertAfter(s,e._prev,o):e.currentIndex!=o&&(e.currentIndex=o,this._addToMoves(e,o)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const o=e._prevRemoved,s=e._nextRemoved;return null===o?this._removalsHead=s:o._nextRemoved=s,null===s?this._removalsTail=o:s._prevRemoved=o,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){const o=null===t?this._itHead:t._next;return e._next=o,e._prev=t,null===o?this._itTail=e:o._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new yn),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,r=e._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new yn),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class Rn{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Cn{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){const t=e._prevDup,r=e._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class yn{constructor(){this.map=new Map}put(e){const t=e.trackById;let r=this.map.get(t);r||(r=new Cn,this.map.set(t,r)),r.add(e)}get(e,t){const r=this.map.get(e);return r?r.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function In(e,t,r){const o=e.previousIndex;if(null===o)return o;let s=0;return r&&o<r.length&&(s=r[o]),o+t+s}class Ln{constructor(){}supports(e){return e instanceof Map||ai(e)}create(){return new On}}class On{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||ai(e)))throw new Error(`Error trying to diff '${K(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(e,r)=>{if(t&&t.key===r)this._maybeAddToChanges(t,e),this._appendAfter=t,t=t._next;else{const o=this._getOrCreateRecordForKey(r,e);t=this._insertBeforeOrAppend(t,o)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let e=t;null!==e;e=e._nextRemoved)e===this._mapHead&&(this._mapHead=null),this._records.delete(e.key),e._nextRemoved=e._next,e.previousValue=e.currentValue,e.currentValue=null,e._prev=null,e._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const r=e._prev;return t._next=e,t._prev=r,e._prev=t,r&&(r._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const r=this._records.get(e);this._maybeAddToChanges(r,t);const o=r._prev,s=r._next;return o&&(o._next=s),s&&(s._prev=o),r._next=null,r._prev=null,r}const r=new bn(e);return this._records.set(e,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(r=>t(e[r],r))}}class bn{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Mn(){return new Nn([new Tn])}let Nn=(()=>{class e{constructor(e){this.factories=e}static create(t,r){if(null!=r){const e=r.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:r=>e.create(t,r||Mn()),deps:[[e,new Kr,new Qr]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(null!=t)return t;throw new Error(`Cannot find a differ supporting object '${e}' of type '${r=e,r.name||typeof r}'`);var r}}return e.\u0275prov=ae({token:e,providedIn:"root",factory:Mn}),e})();function An(){return new kn([new Ln])}let kn=(()=>{class e{constructor(e){this.factories=e}static create(t,r){if(r){const e=r.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:r=>e.create(t,r||An()),deps:[[e,new Kr,new Qr]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(t)return t;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return e.\u0275prov=ae({token:e,providedIn:"root",factory:An}),e})();function Pn(e,t,r,o,s=!1){for(;null!==r;){const i=t[r.index];if(null!==i&&o.push(ht(i)),Qe(i))for(let e=Ye;e<i.length;e++){const t=i[e],r=t[1].firstChild;null!==r&&Pn(t[1],t,r,o)}const n=r.type;if(8&n)Pn(e,t,r.child,o);else if(32&n){const e=ao(r,t);let s;for(;s=e();)o.push(s)}else if(16&n){const e=Io(t,r);if(Array.isArray(e))o.push(...e);else{const r=lo(t[16]);Pn(r[1],r,e,o,!0)}}r=s?r.projectionNext:r.next}return o}class Un{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return Pn(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(Qe(e)){const t=e[8],r=t?t.indexOf(this):-1;r>-1&&(_o(e,r),Dr(t,r))}this._attachedToViewContainer=!1}fo(this._lView[1],this._lView)}onDestroy(e){!function(e,t,r,o){const s=As(t);s.push(o)}(0,this._lView,0,e)}markForCheck(){Ls(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Os(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(e,t,r){At(!0);try{Os(e,t,r)}finally{At(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var e;this._appRef=null,bo(this._lView[1],e=this._lView,e[11],2,null,null)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class Dn extends Un{constructor(e){super(e),this._view=e}detectChanges(){bs(this._view)}checkNoChanges(){!function(e){At(!0);try{bs(e)}finally{At(!1)}}(this._view)}get context(){return null}}const wn=[new Ln],Zn=new Nn([new Tn]),xn=new kn(wn),Bn=function(){return e=Lt(),t=Ct(),4&e.type?new Vn(t,e,dn(e,t)):null;var e,t};let Hn=(()=>{class e{}return e.__NG_ELEMENT_ID__=Bn,e})();const Gn=Hn,Vn=class extends Gn{constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}createEmbeddedView(e){const t=this._declarationTContainer.tViews,r=$o(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);r[17]=this._declarationLView[this._declarationTContainer.index];const o=this._declarationLView[19];return null!==o&&(r[19]=o.createEmbeddedView(t)),rs(t,r,e),new Un(r)}};class Wn{}const qn=function(){return function(e,t){let r;const o=t[e.index];if(Qe(o))r=o;else{let s;if(8&e.type)s=ht(o);else{const r=t[11];s=r.createComment("");const o=gt(e,t);To(r,Ro(r,o),s,function(e,t){return dt(e)?e.nextSibling(t):t.nextSibling}(r,o),!1)}t[e.index]=r=Ss(o,t,s,e),Is(t,r)}return new jn(r,e,t)}(Lt(),Ct())};let zn=(()=>{class e{}return e.__NG_ELEMENT_ID__=qn,e})();const Fn=zn,jn=class extends Fn{constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return dn(this._hostTNode,this._hostLView)}get injector(){return new Or(this._hostTNode,this._hostLView)}get parentInjector(){const e=_r(this._hostTNode,this._hostLView);if(ar(e)){const t=cr(e,this._hostLView),r=lr(e);return new Or(t[1].data[r+8],t)}return new Or(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=Yn(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-Ye}createEmbeddedView(e,t,r){const o=e.createEmbeddedView(t||{});return this.insert(o,r),o}createComponent(e,t,r,o,s){const i=r||this.parentInjector;if(!s&&null==e.ngModule&&i){const e=i.get(Wn,null);e&&(s=e)}const n=e.create(i,o,void 0,s);return this.insert(n.hostView,t),n}insert(e,t){const r=e._lView,o=r[1];if(Qe(r[3])){const t=this.indexOf(e);if(-1!==t)this.detach(t);else{const t=r[3],o=new jn(t,t[6],t[3]);o.detach(o.indexOf(e))}}const s=this._adjustIndex(t),i=this._lContainer;!function(e,t,r,o){const s=Ye+o,i=r.length;o>0&&(r[s-1][4]=t),o<i-Ye?(t[4]=r[s],Ur(r,Ye+o,t)):(r.push(t),t[4]=null),t[3]=r;const n=t[17];null!==n&&r!==n&&function(e,t){const r=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===r?e[9]=[t]:r.push(t)}(n,t);const a=t[19];null!==a&&a.insertView(e),t[2]|=128}(o,r,i,s);const n=Lo(s,i),a=r[11],l=Ro(a,i[7]);return null!==l&&function(e,t,r,o,s,i){o[0]=s,o[6]=t,bo(e,o,r,1,s,i)}(o,i[6],a,r,l,n),e.attachToViewContainerRef(),Ur(Xn(i),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=Yn(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),r=_o(this._lContainer,t);r&&(Dr(Xn(this._lContainer),t),fo(r[1],r))}detach(e){const t=this._adjustIndex(e,-1),r=_o(this._lContainer,t);return r&&null!=Dr(Xn(this._lContainer),t)?new Un(r):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function Yn(e){return e[8]}function Xn(e){return e[8]||(e[8]=[])}const Qn={};class Kn extends ln{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=ze(e);return new ea(t,this.ngModule)}}function Jn(e){const t=[];for(let r in e)e.hasOwnProperty(r)&&t.push({propName:e[r],templateName:r});return t}const $n=new kr("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>so});class ea extends nn{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=e.selectors.map(Vo).join(","),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return Jn(this.componentDef.inputs)}get outputs(){return Jn(this.componentDef.outputs)}create(e,t,r,o){const s=(o=o||this.ngModule)?function(e,t){return{get:(r,o,s)=>{const i=e.get(r,Qn,s);return i!==Qn||o===Qn?i:t.get(r,o,s)}}}(e,o.injector):e,i=s.get(pn,ut),n=s.get(_n,null),a=i.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",c=r?function(e,t,r){if(dt(e))return e.selectRootElement(t,r===Re.ShadowDom);let o="string"==typeof t?e.querySelector(t):t;return o.textContent="",o}(a,r,this.componentDef.encapsulation):go(i.createRenderer(null,this.componentDef),l,function(e){const t=e.toLowerCase();return"svg"===t?lt:"math"===t?"http://www.w3.org/1998/MathML/":null}(l)),d=this.componentDef.onPush?576:528,u={components:[],scheduler:so,clean:Ns,playerHandler:null,flags:0},h=cs(0,null,null,1,0,null,null,null,null,null),p=$o(null,h,u,d,null,null,i,a,n,s);let g,m;Bt(p);try{const e=function(e,t,r,o,s,i){const n=r[1];r[20]=e;const a=es(n,20,2,"#host",null),l=a.mergedAttrs=t.hostAttrs;null!==l&&(Ds(a,l,!0),null!==e&&(or(s,e,l),null!==a.classes&&Ao(s,e,a.classes),null!==a.styles&&No(s,e,a.styles)));const c=o.createRenderer(e,t),d=$o(r,ls(t),null,t.onPush?64:16,r[20],a,o,c,null,null);return n.firstCreatePass&&(fr(pr(a,r),n,t.type),gs(n,a),_s(a,r.length,1)),Is(r,d),r[20]=d}(c,this.componentDef,p,i,a);if(c)if(r)or(a,c,["ng-version",En.full]);else{const{attrs:e,classes:t}=function(e){const t=[],r=[];let o=1,s=2;for(;o<e.length;){let i=e[o];if("string"==typeof i)2===s?""!==i&&t.push(i,e[++o]):8===s&&r.push(i);else{if(!xo(s))break;s=i}o++}return{attrs:t,classes:r}}(this.componentDef.selectors[0]);e&&or(a,c,e),t&&t.length>0&&Ao(a,c,t.join(" "))}if(m=mt(h,je),void 0!==t){const e=m.projection=[];for(let r=0;r<this.ngContentSelectors.length;r++){const o=t[r];e.push(null!=o?Array.from(o):null)}}g=function(e,t,r,o,s){const i=r[1],n=function(e,t,r){const o=Lt();e.firstCreatePass&&(r.providersResolver&&r.providersResolver(r),fs(e,o,t,ts(e,t,1,null),r));const s=yr(t,e,o.directiveStart,o);$r(s,t);const i=gt(o,t);return i&&$r(i,t),s}(i,r,t);if(o.components.push(n),e[8]=n,s&&s.forEach(e=>e(n,t)),t.contentQueries){const e=Lt();t.contentQueries(1,n,e.directiveStart)}const a=Lt();return!i.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(Ft(a.index),hs(r[1],a,0,a.directiveStart,a.directiveEnd,t),ps(t,n)),n}(e,this.componentDef,p,u,[Js]),rs(h,p,null)}finally{qt()}return new ta(this.componentType,g,dn(m,p),p,m)}}class ta extends class{}{constructor(e,t,r,o,s){super(),this.location=r,this._rootLView=o,this._tNode=s,this.instance=t,this.hostView=this.changeDetectorRef=new Dn(o),this.componentType=e}get injector(){return new Or(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const ra=new Map;class oa extends Wn{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Kn(this);const r=Fe(e),o=e[Ue]||null;o&&Qi(o),this._bootstrapComponents=io(r.bootstrap),this._r3Injector=Ws(e,t,[{provide:Wn,useValue:this},{provide:ln,useValue:this.componentFactoryResolver}],K(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=Ks.THROW_IF_NOT_FOUND,r=_e.Default){return e===Ks||e===Wn||e===ws?this:this._r3Injector.get(e,t,r)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class sa extends class{}{constructor(e){super(),this.moduleType=e,null!==Fe(e)&&function(e){const t=new Set;!function e(r){const o=Fe(r,!0),s=o.id;null!==s&&(function(e,t,r){if(t&&t!==r)throw new Error(`Duplicate module registered for ${e} - ${K(t)} vs ${K(t.name)}`)}(s,ra.get(s),r),ra.set(s,r));const i=io(o.imports);for(const n of i)t.has(n)||(t.add(n),e(n))}(e)}(e)}create(e){return new oa(this.moduleType,e)}}function ia(e){return t=>{setTimeout(e,void 0,t)}}const na=class extends C{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,r){var o,s,i;let n=e,a=t||(()=>null),l=r;if(e&&"object"==typeof e){const t=e;n=null===(o=t.next)||void 0===o?void 0:o.bind(t),a=null===(s=t.error)||void 0===s?void 0:s.bind(t),l=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}this.__isAsync&&(a=ia(a),n&&(n=ia(n)),l&&(l=ia(l)));const c=super.subscribe({next:n,error:a,complete:l});return e instanceof u&&e.add(c),c}};Symbol;const aa=new kr("Application Initializer");let la=(()=>{class e{constructor(e){this.appInits=e,this.resolve=cn,this.reject=cn,this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}runInitializers(){if(this.initialized)return;const e=[],t=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const t=this.appInits[r]();if(fi(t))e.push(t);else if(Ei(t)){const r=new Promise((e,r)=>{t.subscribe({complete:e,error:r})});e.push(r)}}Promise.all(e).then(()=>{t()}).catch(e=>{this.reject(e)}),0===e.length&&t(),this.initialized=!0}}return e.\u0275fac=function(t){return new(t||e)(Fr(aa,8))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();const ca=new kr("AppId"),da={provide:ca,useFactory:function(){return`${ua()}${ua()}${ua()}`},deps:[]};function ua(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const ha=new kr("Platform Initializer"),pa=new kr("Platform ID"),ga=new kr("appBootstrapListener");let ma=(()=>{class e{log(e){console.log(e)}warn(e){console.warn(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();const _a=new kr("LocaleId"),fa=new kr("DefaultCurrencyCode");class Ea{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const Ta=function(e){return new sa(e)},va=Ta,Sa=function(e){return Promise.resolve(Ta(e))},Ra=function(e){const t=Ta(e),r=io(Fe(e).declarations).reduce((e,t)=>{const r=ze(t);return r&&e.push(new ea(r)),e},[]);return new Ea(t,r)},Ca=Ra,ya=function(e){return Promise.resolve(Ra(e))};let Ia=(()=>{class e{constructor(){this.compileModuleSync=va,this.compileModuleAsync=Sa,this.compileModuleAndAllComponentsSync=Ca,this.compileModuleAndAllComponentsAsync=ya}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();const La=(()=>Promise.resolve(0))();function Oa(e){"undefined"==typeof Zone?La.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class ba{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new na(!1),this.onMicrotaskEmpty=new na(!1),this.onStable=new na(!1),this.onError=new na(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&t,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function(){let e=Oe.requestAnimationFrame,t=Oe.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r);const o=t[Zone.__symbol__("OriginalDelegate")];o&&(t=o)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(e){const t=()=>{!function(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Oe,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Aa(e),e.isCheckStableRunning=!0,Na(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Aa(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(r,o,s,i,n,a)=>{try{return ka(e),r.invokeTask(s,i,n,a)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===i.type||e.shouldCoalesceRunChangeDetection)&&t(),Pa(e)}},onInvoke:(r,o,s,i,n,a,l)=>{try{return ka(e),r.invoke(s,i,n,a,l)}finally{e.shouldCoalesceRunChangeDetection&&t(),Pa(e)}},onHasTask:(t,r,o,s)=>{t.hasTask(o,s),r===o&&("microTask"==s.change?(e._hasPendingMicrotasks=s.microTask,Aa(e),Na(e)):"macroTask"==s.change&&(e.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,r,o,s)=>(t.handleError(o,s),e.runOutsideAngular(()=>e.onError.emit(s)),!1)})}(o)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ba.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(ba.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,o){const s=this._inner,i=s.scheduleEventTask("NgZoneEvent: "+o,e,Ma,cn,cn);try{return s.runTask(i,t,r)}finally{s.cancelTask(i)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}}const Ma={};function Na(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Aa(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function ka(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function Pa(e){e._nesting--,Na(e)}class Ua{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new na,this.onMicrotaskEmpty=new na,this.onStable=new na,this.onError=new na}run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,o){return e.apply(t,r)}}let Da=(()=>{class e{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ba.assertNotInAngularZone(),Oa(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Oa(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(t=>!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,t,r){let o=-1;t&&t>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(e=>e.timeoutId!==o),e(this._didWork,this.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:o,updateCb:r})}whenStable(e,t,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,t,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,t,r){return[]}}return e.\u0275fac=function(t){return new(t||e)(Fr(ba))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})(),wa=(()=>{class e{constructor(){this._applications=new Map,Ba.addToWindow(this)}registerApplication(e,t){this._applications.set(e,t)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,t=!0){return Ba.findTestabilityInTree(this,e,t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();class Za{addToWindow(e){}findTestabilityInTree(e,t,r){return null}}let xa,Ba=new Za,Ha=!0,Ga=!1;const Va=new kr("AllowMultipleToken");function Wa(e,t,r=[]){const o=`Platform: ${t}`,s=new kr(o);return(t=[])=>{let i=qa();if(!i||i.injector.get(Va,!1))if(e)e(r.concat(t).concat({provide:s,useValue:!0}));else{const e=r.concat(t).concat({provide:s,useValue:!0},{provide:xs,useValue:"platform"});!function(e){if(xa&&!xa.destroyed&&!xa.injector.get(Va,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");xa=e.get(za);const t=e.get(ha,null);t&&t.forEach(e=>e())}(Ks.create({providers:e,name:o}))}return function(e){const t=qa();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(s)}}function qa(){return xa&&!xa.destroyed?xa:null}let za=(()=>{class e{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,t){const r=function(e,t){let r;return r="noop"===e?new Ua:("zone.js"===e?void 0:e)||new ba({enableLongStackTrace:(Ga=!0,Ha),shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),r}(t?t.ngZone:void 0,{ngZoneEventCoalescing:t&&t.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:t&&t.ngZoneRunCoalescing||!1}),o=[{provide:ba,useValue:r}];return r.run(()=>{const t=Ks.create({providers:o,parent:this.injector,name:e.moduleType.name}),s=e.create(t),i=s.injector.get(oo,null);if(!i)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return r.runOutsideAngular(()=>{const e=r.onError.subscribe({next:e=>{i.handleError(e)}});s.onDestroy(()=>{Ya(this._modules,s),e.unsubscribe()})}),function(e,t,r){try{const o=r();return fi(o)?o.catch(r=>{throw t.runOutsideAngular(()=>e.handleError(r)),r}):o}catch(o){throw t.runOutsideAngular(()=>e.handleError(o)),o}}(i,r,()=>{const e=s.injector.get(la);return e.runInitializers(),e.donePromise.then(()=>(Qi(s.injector.get(_a,Yi)||Yi),this._moduleDoBootstrap(s),s))})})}bootstrapModule(e,t=[]){const r=Fa({},t);return function(e,t,r){const o=new sa(r);return Promise.resolve(o)}(0,0,e).then(e=>this.bootstrapModuleFactory(e,r))}_moduleDoBootstrap(e){const t=e.injector.get(ja);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(e=>t.bootstrap(e));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${K(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(t)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(t){return new(t||e)(Fr(Ks))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();function Fa(e,t){return Array.isArray(t)?t.reduce(Fa,e):Object.assign(Object.assign({},e),t)}let ja=(()=>{class e{constructor(e,t,r,o,s){this._zone=e,this._injector=t,this._exceptionHandler=r,this._componentFactoryResolver=o,this._initStatus=s,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const i=new E(e=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{e.next(this._stable),e.complete()})}),n=new E(e=>{let t;this._zone.runOutsideAngular(()=>{t=this._zone.onStable.subscribe(()=>{ba.assertNotInAngularZone(),Oa(()=>{this._stable||this._zone.hasPendingMacrotasks||this._zone.hasPendingMicrotasks||(this._stable=!0,e.next(!0))})})});const r=this._zone.onUnstable.subscribe(()=>{ba.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{e.next(!1)}))});return()=>{t.unsubscribe(),r.unsubscribe()}});this.isStable=function(...e){let t=Number.POSITIVE_INFINITY,r=null,o=e[e.length-1];return I(o)?(r=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof o&&(t=e.pop()),null===r&&1===e.length&&e[0]instanceof E?e[0]:function(e=Number.POSITIVE_INFINITY){return x(f,e)}(t)(G(e,r))}(i,n.pipe(e=>{return V()((t=Y,function(e){let r;r="function"==typeof t?t:function(){return t};const o=Object.create(e,F);return o.source=e,o.subjectFactory=r,o})(e));var t}))}bootstrap(e,t){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let r;r=e instanceof nn?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(r.componentType);const o=r.isBoundToModule?void 0:this._injector.get(Wn),s=r.create(Ks.NULL,[],t||r.selector,o),i=s.location.nativeElement,n=s.injector.get(Da,null),a=n&&s.injector.get(wa);return n&&a&&a.registerApplication(i,n),s.onDestroy(()=>{this.detachView(s.hostView),Ya(this.components,s),a&&a.unregisterApplication(i)}),this._loadComponent(s),s}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const t=e;this._views.push(t),t.attachToAppRef(this)}detachView(e){const t=e;Ya(this._views,t),t.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(ga,[]).concat(this._bootstrapListeners).forEach(t=>t(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(t){return new(t||e)(Fr(ba),Fr(Ks),Fr(oo),Fr(ln),Fr(la))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();function Ya(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}const Xa=Wa(null,"core",[{provide:pa,useValue:"unknown"},{provide:za,deps:[Ks]},{provide:wa,deps:[]},{provide:ma,deps:[]}]),Qa=[{provide:ja,useClass:ja,deps:[ba,Ks,oo,ln,la]},{provide:$n,deps:[ba],useFactory:function(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:la,useClass:la,deps:[[new Qr,aa]]},{provide:Ia,useClass:Ia,deps:[]},da,{provide:Nn,useFactory:function(){return Zn},deps:[]},{provide:kn,useFactory:function(){return xn},deps:[]},{provide:_a,useFactory:function(e){return Qi(e=e||"undefined"!=typeof $localize&&$localize.locale||Yi),e},deps:[[new Xr(_a),new Qr,new Kr]]},{provide:fa,useValue:"USD"}];let Ka=(()=>{class e{constructor(e){}}return e.\u0275fac=function(t){return new(t||e)(Fr(ja))},e.\u0275mod=Ve({type:e}),e.\u0275inj=le({providers:Qa}),e})(),Ja=null;function $a(){return Ja}const el=new kr("DocumentToken");var tl=(()=>((tl=tl||{})[tl.Zero=0]="Zero",tl[tl.One=1]="One",tl[tl.Two=2]="Two",tl[tl.Few=3]="Few",tl[tl.Many=4]="Many",tl[tl.Other=5]="Other",tl))();class rl{}let ol=(()=>{class e extends rl{constructor(e){super(),this.locale=e}getPluralCategory(e,t){switch(function(e){return function(e){const t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e);let r=Fi(t);if(r)return r;const o=t.split("-")[0];if(r=Fi(o),r)return r;if("en"===o)return qi;throw new Error(`Missing locale data for the locale "${e}".`)}(e)[ji.PluralCase]}(t||this.locale)(e)){case tl.Zero:return"zero";case tl.One:return"one";case tl.Two:return"two";case tl.Few:return"few";case tl.Many:return"many";default:return"other"}}}return e.\u0275fac=function(t){return new(t||e)(Fr(_a))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();function sl(e,t){t=encodeURIComponent(t);for(const r of e.split(";")){const e=r.indexOf("="),[o,s]=-1==e?[r,""]:[r.slice(0,e),r.slice(e+1)];if(o.trim()===t)return decodeURIComponent(s)}return null}class il{constructor(e,t,r,o){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=o}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let nl=(()=>{class e{constructor(e,t,r){this._viewContainer=e,this._template=t,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const r=this._ngForOf;if(!this._differ&&r)try{this._differ=this._differs.find(r).create(this.ngForTrackBy)}catch(t){throw new Error(`Cannot find a differ supporting object '${r}' of type '${e=r,e.name||typeof e}'. NgFor only supports binding to Iterables such as Arrays.`)}}var e;if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const t=[];e.forEachOperation((e,r,o)=>{if(null==e.previousIndex){const r=this._viewContainer.createEmbeddedView(this._template,new il(null,this._ngForOf,-1,-1),null===o?void 0:o),s=new al(e,r);t.push(s)}else if(null==o)this._viewContainer.remove(null===r?void 0:r);else if(null!==r){const s=this._viewContainer.get(r);this._viewContainer.move(s,o);const i=new al(e,s);t.push(i)}});for(let r=0;r<t.length;r++)this._perViewChange(t[r].view,t[r].record);for(let r=0,o=this._viewContainer.length;r<o;r++){const e=this._viewContainer.get(r);e.context.index=r,e.context.count=o,e.context.ngForOf=this._ngForOf}e.forEachIdentityChange(e=>{this._viewContainer.get(e.currentIndex).context.$implicit=e.item})}_perViewChange(e,t){e.context.$implicit=t.item}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(di(zn),di(Hn),di(Nn))},e.\u0275dir=qe({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();class al{constructor(e,t){this.record=e,this.view=t}}let ll=(()=>{class e{constructor(e,t){this._viewContainer=e,this._context=new cl,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=t}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){dl("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){dl("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(di(zn),di(Hn))},e.\u0275dir=qe({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class cl{constructor(){this.$implicit=null,this.ngIf=null}}function dl(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${K(t)}'.`)}let ul=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Ve({type:e}),e.\u0275inj=le({providers:[{provide:rl,useClass:ol}]}),e})();class hl{}class pl extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){var e;e=new pl,Ja||(Ja=e)}onAndCancel(e,t,r){return e.addEventListener(t,r,!1),()=>{e.removeEventListener(t,r,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(ml=ml||document.querySelector("base"),ml?ml.getAttribute("href"):null);return null==t?null:function(e){gl=gl||document.createElement("a"),gl.setAttribute("href",e);const t=gl.pathname;return"/"===t.charAt(0)?t:`/${t}`}(t)}resetBaseElement(){ml=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return sl(document.cookie,e)}}let gl,ml=null;const _l=new kr("TRANSITION_ID"),fl=[{provide:aa,useFactory:function(e,t,r){return()=>{r.get(la).donePromise.then(()=>{const r=$a();Array.prototype.slice.apply(t.querySelectorAll("style[ng-transition]")).filter(t=>t.getAttribute("ng-transition")===e).forEach(e=>r.remove(e))})}},deps:[_l,el,Ks],multi:!0}];class El{static init(){var e;e=new El,Ba=e}addToWindow(e){Oe.getAngularTestability=(t,r=!0)=>{const o=e.findTestabilityInTree(t,r);if(null==o)throw new Error("Could not find testability for element.");return o},Oe.getAllAngularTestabilities=()=>e.getAllTestabilities(),Oe.getAllAngularRootElements=()=>e.getAllRootElements(),Oe.frameworkStabilizers||(Oe.frameworkStabilizers=[]),Oe.frameworkStabilizers.push(e=>{const t=Oe.getAllAngularTestabilities();let r=t.length,o=!1;const s=function(t){o=o||t,r--,0==r&&e(o)};t.forEach(function(e){e.whenStable(s)})})}findTestabilityInTree(e,t,r){if(null==t)return null;const o=e.getTestability(t);return null!=o?o:r?$a().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let Tl=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();const vl=new kr("EventManagerPlugins");let Sl=(()=>{class e{constructor(e,t){this._zone=t,this._eventNameToPlugin=new Map,e.forEach(e=>e.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,t,r){return this._findPluginFor(t).addEventListener(e,t,r)}addGlobalEventListener(e,t,r){return this._findPluginFor(t).addGlobalEventListener(e,t,r)}getZone(){return this._zone}_findPluginFor(e){const t=this._eventNameToPlugin.get(e);if(t)return t;const r=this._plugins;for(let o=0;o<r.length;o++){const t=r[o];if(t.supports(e))return this._eventNameToPlugin.set(e,t),t}throw new Error(`No event manager plugin found for event ${e}`)}}return e.\u0275fac=function(t){return new(t||e)(Fr(vl),Fr(ba))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();class Rl{constructor(e){this._doc=e}addGlobalEventListener(e,t,r){const o=$a().getGlobalEventTarget(this._doc,e);if(!o)throw new Error(`Unsupported event target ${o} for event ${t}`);return this.addEventListener(o,t,r)}}let Cl=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(e){const t=new Set;e.forEach(e=>{this._stylesSet.has(e)||(this._stylesSet.add(e),t.add(e))}),this.onStylesAdded(t)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})(),yl=(()=>{class e extends Cl{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,t,r){e.forEach(e=>{const o=this._doc.createElement("style");o.textContent=e,r.push(t.appendChild(o))})}addHost(e){const t=[];this._addStylesToHost(this._stylesSet,e,t),this._hostNodes.set(e,t)}removeHost(e){const t=this._hostNodes.get(e);t&&t.forEach(Il),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((t,r)=>{this._addStylesToHost(e,r,t)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(Il))}}return e.\u0275fac=function(t){return new(t||e)(Fr(el))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();function Il(e){$a().remove(e)}const Ll={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Ol=/%COMP%/g;function bl(e,t,r){for(let o=0;o<t.length;o++){let s=t[o];Array.isArray(s)?bl(e,s,r):(s=s.replace(Ol,e),r.push(s))}return r}function Ml(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let Nl=(()=>{class e{constructor(e,t,r){this.eventManager=e,this.sharedStylesHost=t,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new Al(e)}createRenderer(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case Re.Emulated:{let r=this.rendererByCompId.get(t.id);return r||(r=new kl(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,r)),r.applyToHost(e),r}case 1:case Re.ShadowDom:return new Pl(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){const e=bl(t.id,t.styles,[]);this.sharedStylesHost.addStyles(e),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(t){return new(t||e)(Fr(Sl),Fr(yl),Fr(ca))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();class Al{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(Ll[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,r){e&&e.insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error(`The selector "${e}" did not match any elements`);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,o){if(o){t=o+":"+t;const s=Ll[o];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const o=Ll[r];o?e.removeAttributeNS(o,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,o){o&(no.DashCase|no.Important)?e.style.setProperty(t,r,o&no.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&no.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e[t]=r}setValue(e,t){e.nodeValue=t}listen(e,t,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,Ml(r)):this.eventManager.addEventListener(e,t,Ml(r))}}class kl extends Al{constructor(e,t,r,o){super(e),this.component=r;const s=bl(o+"-"+r.id,r.styles,[]);t.addStyles(s),this.contentAttr="_ngcontent-%COMP%".replace(Ol,o+"-"+r.id),this.hostAttr="_nghost-%COMP%".replace(Ol,o+"-"+r.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}class Pl extends Al{constructor(e,t,r,o){super(e),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=bl(o.id,o.styles,[]);for(let i=0;i<s.length;i++){const e=document.createElement("style");e.textContent=s[i],this.shadowRoot.appendChild(e)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let Ul=(()=>{class e extends Rl{constructor(e){super(e)}supports(e){return!0}addEventListener(e,t,r){return e.addEventListener(t,r,!1),()=>this.removeEventListener(e,t,r)}removeEventListener(e,t,r){return e.removeEventListener(t,r)}}return e.\u0275fac=function(t){return new(t||e)(Fr(el))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();const Dl=["alt","control","meta","shift"],wl={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Zl={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},xl={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Bl=(()=>{class e extends Rl{constructor(e){super(e)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,r,o){const s=e.parseEventName(r),i=e.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>$a().onAndCancel(t,s.domEventName,i))}static parseEventName(t){const r=t.toLowerCase().split("."),o=r.shift();if(0===r.length||"keydown"!==o&&"keyup"!==o)return null;const s=e._normalizeKey(r.pop());let i="";if(Dl.forEach(e=>{const t=r.indexOf(e);t>-1&&(r.splice(t,1),i+=e+".")}),i+=s,0!=r.length||0===s.length)return null;const n={};return n.domEventName=o,n.fullKey=i,n}static getEventFullKey(e){let t="",r=function(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Zl.hasOwnProperty(t)&&(t=Zl[t]))}return wl[t]||t}(e);return r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),Dl.forEach(o=>{o!=r&&(0,xl[o])(e)&&(t+=o+".")}),t+=r,t}static eventCallback(t,r,o){return s=>{e.getEventFullKey(s)===t&&o.runGuarded(()=>r(s))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}return e.\u0275fac=function(t){return new(t||e)(Fr(el))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();const Hl=Wa(Xa,"browser",[{provide:pa,useValue:"browser"},{provide:ha,useValue:function(){pl.makeCurrent(),El.init()},multi:!0},{provide:el,useFactory:function(){return function(e){ct=e}(document),document},deps:[]}]),Gl=[[],{provide:xs,useValue:"root"},{provide:oo,useFactory:function(){return new oo},deps:[]},{provide:vl,useClass:Ul,multi:!0,deps:[el,ba,pa]},{provide:vl,useClass:Bl,multi:!0,deps:[el]},[],{provide:Nl,useClass:Nl,deps:[Sl,yl,ca]},{provide:pn,useExisting:Nl},{provide:Cl,useExisting:yl},{provide:yl,useClass:yl,deps:[el]},{provide:Da,useClass:Da,deps:[ba]},{provide:Sl,useClass:Sl,deps:[vl,ba]},{provide:hl,useClass:Tl,deps:[]},[]];let Vl=(()=>{class e{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:e,providers:[{provide:ca,useValue:t.appId},{provide:_l,useExisting:ca},fl]}}}return e.\u0275fac=function(t){return new(t||e)(Fr(e,12))},e.\u0275mod=Ve({type:e}),e.\u0275inj=le({providers:Gl,imports:[ul,Ka]}),e})();function Wl(e,t){return new E(r=>{const o=e.length;if(0===o)return void r.complete();const s=new Array(o);let i=0,n=0;for(let a=0;a<o;a++){const l=D(e[a]);let c=!1;r.add(l.subscribe({next:e=>{c||(c=!0,n++),s[a]=e},error:e=>r.error(e),complete:()=>{i++,i!==o&&c||(n===o&&r.next(t?t.reduce((e,t,r)=>(e[t]=s[r],e),{}):s),r.complete())}}))}})}"undefined"!=typeof window&&window;let ql=(()=>{class e{constructor(e,t){this._renderer=e,this._elementRef=t,this.onChange=e=>{},this.onTouched=()=>{}}setProperty(e,t){this._renderer.setProperty(this._elementRef.nativeElement,e,t)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return e.\u0275fac=function(t){return new(t||e)(di(gn),di(hn))},e.\u0275dir=qe({type:e}),e})(),zl=(()=>{class e extends ql{}return e.\u0275fac=function(){let t;return function(r){return(t||(t=br(e)))(r||e)}}(),e.\u0275dir=qe({type:e,features:[$s]}),e})();const Fl=new kr("NgValueAccessor"),jl={provide:Fl,useExisting:ee(()=>Yl),multi:!0};let Yl=(()=>{class e extends zl{writeValue(e){this.setProperty("checked",e)}}return e.\u0275fac=function(){let t;return function(r){return(t||(t=br(e)))(r||e)}}(),e.\u0275dir=qe({type:e,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(e,t){1&e&&Ti("change",function(e){return t.onChange(e.target.checked)})("blur",function(){return t.onTouched()})},features:[sn([jl]),$s]}),e})();const Xl={provide:Fl,useExisting:ee(()=>Kl),multi:!0},Ql=new kr("CompositionEventMode");let Kl=(()=>{class e extends ql{constructor(e,t,r){super(e,t),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const e=$a()?$a().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return e.\u0275fac=function(t){return new(t||e)(di(gn),di(hn),di(Ql,8))},e.\u0275dir=qe({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,t){1&e&&Ti("input",function(e){return t._handleInput(e.target.value)})("blur",function(){return t.onTouched()})("compositionstart",function(){return t._compositionStart()})("compositionend",function(e){return t._compositionEnd(e.target.value)})},features:[sn([Xl]),$s]}),e})();const Jl=new kr("NgValidators"),$l=new kr("NgAsyncValidators");function ec(e){return null!=e}function tc(e){const t=fi(e)?D(e):e;return Ei(t),t}function rc(e){let t={};return e.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function oc(e,t){return t.map(t=>t(e))}function sc(e){return e.map(e=>function(e){return!e.validate}(e)?e:t=>e.validate(t))}function ic(e){return null!=e?function(e){if(!e)return null;const t=e.filter(ec);return 0==t.length?null:function(e){return rc(oc(e,t))}}(sc(e)):null}function nc(e){return null!=e?function(e){if(!e)return null;const t=e.filter(ec);return 0==t.length?null:function(e){return function(...e){if(1===e.length){const t=e[0];if(l(t))return Wl(t,null);if(c(t)&&Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);return Wl(e.map(e=>t[e]),e)}}if("function"==typeof e[e.length-1]){const t=e.pop();return Wl(e=1===e.length&&l(e[0])?e[0]:e,null).pipe(L(e=>t(...e)))}return Wl(e,null)}(oc(e,t).map(tc)).pipe(L(rc))}}(sc(e)):null}function ac(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}let lc=(()=>{class e{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=ic(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=nc(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=qe({type:e}),e})(),cc=(()=>{class e extends lc{get formDirective(){return null}get path(){return null}}return e.\u0275fac=function(){let t;return function(r){return(t||(t=br(e)))(r||e)}}(),e.\u0275dir=qe({type:e,features:[$s]}),e})();class dc extends lc{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}let uc=(()=>{class e extends class{constructor(e){this._cd=e}is(e){var t,r,o;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(o=null===(r=this._cd)||void 0===r?void 0:r.control)||void 0===o?void 0:o[e])}}{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(di(dc,2))},e.\u0275dir=qe({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,t){2&e&&Mi("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))},features:[$s]}),e})();function hc(e,t){e.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function pc(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function gc(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}const mc="VALID",_c="INVALID",fc="PENDING",Ec="DISABLED";function Tc(e){return(Cc(e)?e.validators:e)||null}function vc(e){return Array.isArray(e)?ic(e):e||null}function Sc(e,t){return(Cc(t)?t.asyncValidators:e)||null}function Rc(e){return Array.isArray(e)?nc(e):e||null}function Cc(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class yc{constructor(e,t){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=vc(this._rawValidators),this._composedAsyncValidatorFn=Rc(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===mc}get invalid(){return this.status===_c}get pending(){return this.status==fc}get disabled(){return this.status===Ec}get enabled(){return this.status!==Ec}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=vc(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=Rc(e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=fc,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Ec,this.errors=null,this._forEachChild(t=>{t.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=mc,this._forEachChild(t=>{t.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),this.status!==mc&&this.status!==fc||this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ec:mc}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=fc,this._hasOwnPendingAsyncValidator=!0;const t=tc(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(t=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(t,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function(e,t,r){if(null==t)return null;if(Array.isArray(t)||(t=t.split(".")),Array.isArray(t)&&0===t.length)return null;let o=e;return t.forEach(e=>{o=o instanceof Lc?o.controls.hasOwnProperty(e)?o.controls[e]:null:o instanceof Oc&&o.at(e)||null}),o}(this,e)}getError(e,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new na,this.statusChanges=new na}_calculateStatus(){return this._allControlsDisabled()?Ec:this.errors?_c:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(fc)?fc:this._anyControlsHaveStatus(_c)?_c:mc}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Cc(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class Ic extends yc{constructor(e=null,t,r){super(Tc(t),Sc(r,t)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(e=>e(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=null,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){gc(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){gc(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class Lc extends yc{constructor(e,t,r){super(Tc(t),Sc(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(r=>{this._throwIfControlMissing(r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(r=>{this.controls[r]&&this.controls[r].patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,o)=>{r.reset(e[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t instanceof Ic?t.value:t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(e,t)=>!!t._syncPendingControls()||e);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const r=this.controls[t];if(this.contains(t)&&e(r))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,r)=>((t.enabled||this.disabled)&&(e[r]=t.value),e))}_reduceChildren(e,t){let r=e;return this._forEachChild((e,o)=>{r=t(r,e,o)}),r}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((t,r)=>{if(void 0===e[r])throw new Error(`Must supply a value for form control with name: '${r}'.`)})}}class Oc extends yc{constructor(e,t,r){super(Tc(t),Sc(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){this._checkAllValuesPresent(e),e.forEach((e,r)=>{this._throwIfControlMissing(r),this.at(r).setValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((e,r)=>{this.at(r)&&this.at(r).patchValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,o)=>{r.reset(e[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e instanceof Ic?e.value:e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((e,t)=>!!t._syncPendingControls()||e,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error(`Cannot find form control at index ${e}`)}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((t,r)=>{if(void 0===e[r])throw new Error(`Must supply a value for form control at index: ${r}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const bc={provide:dc,useExisting:ee(()=>Nc)},Mc=(()=>Promise.resolve(null))();let Nc=(()=>{class e extends dc{constructor(e,t,r,o){super(),this.control=new Ic,this._registered=!1,this.update=new na,this._parent=e,this._setValidators(t),this._setAsyncValidators(r),this.valueAccessor=function(e,t){if(!t)return null;let r,o,s;return Array.isArray(t),t.forEach(e=>{e.constructor===Kl?r=e:Object.getPrototypeOf(e.constructor)===zl?o=e:s=e}),s||o||r||null}(0,o)}ngOnChanges(e){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in e&&this._updateDisabled(e),function(e,t){if(!e.hasOwnProperty("model"))return!1;const r=e.model;return!!r.isFirstChange()||!Object.is(t,r.currentValue)}(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?[...this._parent.path,this.name]:[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){var e,t;(function(e,t){const r=function(e){return e._rawValidators}(e);null!==t.validator?e.setValidators(ac(r,t.validator)):"function"==typeof r&&e.setValidators([r]);const o=function(e){return e._rawAsyncValidators}(e);null!==t.asyncValidator?e.setAsyncValidators(ac(o,t.asyncValidator)):"function"==typeof o&&e.setAsyncValidators([o]);const s=()=>e.updateValueAndValidity();hc(t._rawValidators,s),hc(t._rawAsyncValidators,s)})(e=this.control,t=this),t.valueAccessor.writeValue(e.value),function(e,t){t.valueAccessor.registerOnChange(r=>{e._pendingValue=r,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&pc(e,t)})}(e,t),function(e,t){const r=(e,r)=>{t.valueAccessor.writeValue(e),r&&t.viewToModelUpdate(e)};e.registerOnChange(r),t._registerOnDestroy(()=>{e._unregisterOnChange(r)})}(e,t),function(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&pc(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function(e,t){if(t.valueAccessor.setDisabledState){const r=e=>{t.valueAccessor.setDisabledState(e)};e.registerOnDisabledChange(r),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(r)})}}(e,t),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){Mc.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1})})}_updateDisabled(e){const t=e.isDisabled.currentValue,r=""===t||t&&"false"!==t;Mc.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable()})}}return e.\u0275fac=function(t){return new(t||e)(di(cc,9),di(Jl,10),di($l,10),di(Fl,10))},e.\u0275dir=qe({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[sn([bc]),$s,ot]}),e})(),Ac=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Ve({type:e}),e.\u0275inj=le({}),e})();const kc={provide:Fl,useExisting:ee(()=>Uc),multi:!0};function Pc(e,t){return null==e?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let Uc=(()=>{class e extends zl{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;const t=this._getOptionId(e);null==t&&this.setProperty("selectedIndex",-1);const r=Pc(t,e);this.setProperty("value",r)}registerOnChange(e){this.onChange=t=>{this.value=this._getOptionValue(t),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t),e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t):e}}return e.\u0275fac=function(){let t;return function(r){return(t||(t=br(e)))(r||e)}}(),e.\u0275dir=qe({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(e,t){1&e&&Ti("change",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[sn([kc]),$s]}),e})(),Dc=(()=>{class e{constructor(e,t,r){this._element=e,this._renderer=t,this._select=r,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(Pc(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(di(hn),di(gn),di(Uc,9))},e.\u0275dir=qe({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const wc={provide:Fl,useExisting:ee(()=>xc),multi:!0};function Zc(e,t){return null==e?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let xc=(()=>{class e extends zl{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){let t;if(this.value=e,Array.isArray(e)){const r=e.map(e=>this._getOptionId(e));t=(e,t)=>{e._setSelected(r.indexOf(t.toString())>-1)}}else t=(e,t)=>{e._setSelected(!1)};this._optionMap.forEach(t)}registerOnChange(e){this.onChange=t=>{const r=[];if(void 0!==t.selectedOptions){const e=t.selectedOptions;for(let t=0;t<e.length;t++){const o=e.item(t),s=this._getOptionValue(o.value);r.push(s)}}else{const e=t.options;for(let t=0;t<e.length;t++){const o=e.item(t);if(o.selected){const e=this._getOptionValue(o.value);r.push(e)}}}this.value=r,e(r)}}_registerOption(e){const t=(this._idCounter++).toString();return this._optionMap.set(t,e),t}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t)._value,e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t)._value:e}}return e.\u0275fac=function(){let t;return function(r){return(t||(t=br(e)))(r||e)}}(),e.\u0275dir=qe({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(e,t){1&e&&Ti("change",function(e){return t.onChange(e.target)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[sn([wc]),$s]}),e})(),Bc=(()=>{class e{constructor(e,t,r){this._element=e,this._renderer=t,this._select=r,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(Zc(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(Zc(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(di(hn),di(gn),di(xc,9))},e.\u0275dir=qe({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})(),Hc=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Ve({type:e}),e.\u0275inj=le({imports:[[Ac]]}),e})(),Gc=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Ve({type:e}),e.\u0275inj=le({imports:[Hc]}),e})();class Vc{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new Wc(e,this.predicate,this.thisArg))}}class Wc extends g{constructor(e,t,r){super(e),this.predicate=t,this.thisArg=r,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}t&&this.destination.next(e)}}class qc{}class zc{}class Fc{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(e=>{const t=e.indexOf(":");if(t>0){const r=e.slice(0,t),o=r.toLowerCase(),s=e.slice(t+1).trim();this.maybeSetNormalizedName(r,o),this.headers.has(o)?this.headers.get(o).push(s):this.headers.set(o,[s])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let r=e[t];const o=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(o,r),this.maybeSetNormalizedName(t,o))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Fc?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Fc;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Fc?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);const o=("a"===e.op?this.headers.get(t):void 0)||[];o.push(...r),this.headers.set(t,o);break;case"d":const s=e.value;if(s){let e=this.headers.get(t);if(!e)return;e=e.filter(e=>-1===s.indexOf(e)),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class jc{encodeKey(e){return Yc(e)}encodeValue(e){return Yc(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}function Yc(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}function Xc(e){return`${e}`}class Qc{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new jc,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){const r=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(e=>{const o=e.indexOf("="),[s,i]=-1==o?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,o)),t.decodeValue(e.slice(o+1))],n=r.get(s)||[];n.push(i),r.set(s,n)}),r}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const r=e.fromObject[t];this.map.set(t,Array.isArray(r)?r:[r])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(r=>{const o=e[r];Array.isArray(o)?o.forEach(e=>{t.push({param:r,value:e,op:"a"})}):t.push({param:r,value:o,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(e=>t+"="+this.encoder.encodeValue(e)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new Qc({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(Xc(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let t=this.map.get(e.param)||[];const r=t.indexOf(Xc(e.value));-1!==r&&t.splice(r,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class Kc{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}keys(){return this.map.keys()}}function Jc(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function $c(e){return"undefined"!=typeof Blob&&e instanceof Blob}function ed(e){return"undefined"!=typeof FormData&&e instanceof FormData}class td{constructor(e,t,r,o){let s;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==r?r:null,s=o):s=r,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new Fc),this.context||(this.context=new Kc),this.params){const e=this.params.toString();if(0===e.length)this.urlWithParams=t;else{const r=t.indexOf("?");this.urlWithParams=t+(-1===r?"?":r<t.length-1?"&":"")+e}}else this.params=new Qc,this.urlWithParams=t}serializeBody(){return null===this.body?null:Jc(this.body)||$c(this.body)||ed(this.body)||"undefined"!=typeof URLSearchParams&&this.body instanceof URLSearchParams||"string"==typeof this.body?this.body:this.body instanceof Qc?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||ed(this.body)?null:$c(this.body)?this.body.type||null:Jc(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Qc?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var t;const r=e.method||this.method,o=e.url||this.url,s=e.responseType||this.responseType,i=void 0!==e.body?e.body:this.body,n=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,a=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let l=e.headers||this.headers,c=e.params||this.params;const d=null!==(t=e.context)&&void 0!==t?t:this.context;return void 0!==e.setHeaders&&(l=Object.keys(e.setHeaders).reduce((t,r)=>t.set(r,e.setHeaders[r]),l)),e.setParams&&(c=Object.keys(e.setParams).reduce((t,r)=>t.set(r,e.setParams[r]),c)),new td(r,o,i,{params:c,headers:l,context:d,reportProgress:a,responseType:s,withCredentials:n})}}var rd=(()=>((rd=rd||{})[rd.Sent=0]="Sent",rd[rd.UploadProgress=1]="UploadProgress",rd[rd.ResponseHeader=2]="ResponseHeader",rd[rd.DownloadProgress=3]="DownloadProgress",rd[rd.Response=4]="Response",rd[rd.User=5]="User",rd))();class od{constructor(e,t=200,r="OK"){this.headers=e.headers||new Fc,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class sd extends od{constructor(e={}){super(e),this.type=rd.ResponseHeader}clone(e={}){return new sd({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class id extends od{constructor(e={}){super(e),this.type=rd.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new id({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class nd extends od{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function ad(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let ld=(()=>{class e{constructor(e){this.handler=e}request(e,t,r={}){let o;if(e instanceof td)o=e;else{let s,i;s=r.headers instanceof Fc?r.headers:new Fc(r.headers),r.params&&(i=r.params instanceof Qc?r.params:new Qc({fromObject:r.params})),o=new td(e,t,void 0!==r.body?r.body:null,{headers:s,context:r.context,params:i,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const s=function(...e){let t=e[e.length-1];return I(t)?(e.pop(),U(e,t)):G(e)}(o).pipe(x(e=>this.handler.handle(e),void 0,1));if(e instanceof td||"events"===r.observe)return s;const i=s.pipe((n=e=>e instanceof id,function(e){return e.lift(new Vc(n,void 0))}));var n;switch(r.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return i.pipe(L(e=>{if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body}));case"blob":return i.pipe(L(e=>{if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body}));case"text":return i.pipe(L(e=>{if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body}));case"json":default:return i.pipe(L(e=>e.body))}case"response":return i;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,t={}){return this.request("DELETE",e,t)}get(e,t={}){return this.request("GET",e,t)}head(e,t={}){return this.request("HEAD",e,t)}jsonp(e,t){return this.request("JSONP",e,{params:(new Qc).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,t={}){return this.request("OPTIONS",e,t)}patch(e,t,r={}){return this.request("PATCH",e,ad(r,t))}post(e,t,r={}){return this.request("POST",e,ad(r,t))}put(e,t,r={}){return this.request("PUT",e,ad(r,t))}}return e.\u0275fac=function(t){return new(t||e)(Fr(qc))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();class cd{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const dd=new kr("HTTP_INTERCEPTORS");let ud=(()=>{class e{intercept(e,t){return t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();const hd=/^\)\]\}',?\n/;let pd=(()=>{class e{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new E(t=>{const r=this.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach((e,t)=>r.setRequestHeader(e,t.join(","))),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const t=e.detectContentTypeHeader();null!==t&&r.setRequestHeader("Content-Type",t)}if(e.responseType){const t=e.responseType.toLowerCase();r.responseType="json"!==t?t:"text"}const o=e.serializeBody();let s=null;const i=()=>{if(null!==s)return s;const t=1223===r.status?204:r.status,o=r.statusText||"OK",i=new Fc(r.getAllResponseHeaders()),n=function(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(r)||e.url;return s=new sd({headers:i,status:t,statusText:o,url:n}),s},n=()=>{let{headers:o,status:s,statusText:n,url:a}=i(),l=null;204!==s&&(l=void 0===r.response?r.responseText:r.response),0===s&&(s=l?200:0);let c=s>=200&&s<300;if("json"===e.responseType&&"string"==typeof l){const e=l;l=l.replace(hd,"");try{l=""!==l?JSON.parse(l):null}catch(d){l=e,c&&(c=!1,l={error:d,text:l})}}c?(t.next(new id({body:l,headers:o,status:s,statusText:n,url:a||void 0})),t.complete()):t.error(new nd({error:l,headers:o,status:s,statusText:n,url:a||void 0}))},a=e=>{const{url:o}=i(),s=new nd({error:e,status:r.status||0,statusText:r.statusText||"Unknown Error",url:o||void 0});t.error(s)};let l=!1;const c=o=>{l||(t.next(i()),l=!0);let s={type:rd.DownloadProgress,loaded:o.loaded};o.lengthComputable&&(s.total=o.total),"text"===e.responseType&&r.responseText&&(s.partialText=r.responseText),t.next(s)},d=e=>{let r={type:rd.UploadProgress,loaded:e.loaded};e.lengthComputable&&(r.total=e.total),t.next(r)};return r.addEventListener("load",n),r.addEventListener("error",a),r.addEventListener("timeout",a),r.addEventListener("abort",a),e.reportProgress&&(r.addEventListener("progress",c),null!==o&&r.upload&&r.upload.addEventListener("progress",d)),r.send(o),t.next({type:rd.Sent}),()=>{r.removeEventListener("error",a),r.removeEventListener("abort",a),r.removeEventListener("load",n),r.removeEventListener("timeout",a),e.reportProgress&&(r.removeEventListener("progress",c),null!==o&&r.upload&&r.upload.removeEventListener("progress",d)),r.readyState!==r.DONE&&r.abort()}})}}return e.\u0275fac=function(t){return new(t||e)(Fr(hl))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})();const gd=new kr("XSRF_COOKIE_NAME"),md=new kr("XSRF_HEADER_NAME");class _d{}let fd=(()=>{class e{constructor(e,t,r){this.doc=e,this.platform=t,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=sl(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return e.\u0275fac=function(t){return new(t||e)(Fr(el),Fr(pa),Fr(gd))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})(),Ed=(()=>{class e{constructor(e,t){this.tokenService=e,this.headerName=t}intercept(e,t){const r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return t.handle(e);const o=this.tokenService.getToken();return null===o||e.headers.has(this.headerName)||(e=e.clone({headers:e.headers.set(this.headerName,o)})),t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(Fr(_d),Fr(md))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})(),Td=(()=>{class e{constructor(e,t){this.backend=e,this.injector=t,this.chain=null}handle(e){if(null===this.chain){const e=this.injector.get(dd,[]);this.chain=e.reduceRight((e,t)=>new cd(e,t),this.backend)}return this.chain.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(Fr(zc),Fr(Ks))},e.\u0275prov=ae({token:e,factory:e.\u0275fac}),e})(),vd=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:Ed,useClass:ud}]}}static withOptions(t={}){return{ngModule:e,providers:[t.cookieName?{provide:gd,useValue:t.cookieName}:[],t.headerName?{provide:md,useValue:t.headerName}:[]]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Ve({type:e}),e.\u0275inj=le({providers:[Ed,{provide:dd,useExisting:Ed,multi:!0},{provide:_d,useClass:fd},{provide:gd,useValue:"XSRF-TOKEN"},{provide:md,useValue:"X-XSRF-TOKEN"}]}),e})(),Sd=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Ve({type:e}),e.\u0275inj=le({providers:[ld,{provide:qc,useClass:Td},pd,{provide:zc,useExisting:pd}],imports:[[vd.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})();function Rd(e,t,r,o,s,i,n){try{var a=e[i](n),l=a.value}catch(c){return void r(c)}a.done?t(l):Promise.resolve(l).then(o,s)}function Cd(e){return function(){var t=this,r=arguments;return new Promise(function(o,s){var i=e.apply(t,r);function n(e){Rd(i,o,s,n,a,"next",e)}function a(e){Rd(i,o,s,n,a,"throw",e)}n(void 0)})}}var yd=r(576);function Id(e,t){1&e&&(pi(0,"div",121),jt(),pi(1,"svg",122),mi(2,"circle",123),gi(),gi())}function Ld(e,t){1&e&&(pi(0,"div",124),jt(),pi(1,"svg",122),mi(2,"circle",123),gi(),gi())}function Od(e,t){if(1&e&&(pi(0,"span",125),Hi(1),gi()),2&e){const e=Ri();qo(1),Gi(e.publishInfoStreamID)}}function bd(e,t){if(1&e&&mi(0,"video",126),2&e){const e=Ri();Ni("onlyPreview"==e.mirrorVal||"both"==e.mirrorVal?"mirror":""),ui("srcObject",e.localStream)}}function Md(e,t){if(1&e&&(pi(0,"span",127),Hi(1),gi()),2&e){const e=Ri();qo(1),Gi(e.playInfoStreamID)}}function Nd(e,t){if(1&e&&mi(0,"video",128),2&e){const e=Ri();Ni("onlyPlay"==e.mirrorVal||"both"==e.mirrorVal?"mirror":""),ui("srcObject",e.remoteStream)}}function Ad(e,t){1&e&&(pi(0,"div",129),jt(),pi(1,"svg",130),mi(2,"circle",123),mi(3,"path",131),gi(),gi())}function kd(e,t){1&e&&(pi(0,"div",132),jt(),pi(1,"svg",130),mi(2,"circle",123),mi(3,"path",131),gi(),gi())}function Pd(e,t){1&e&&(pi(0,"div",133),jt(),pi(1,"svg",130),mi(2,"circle",123),mi(3,"path",134),gi(),gi())}function Ud(e,t){1&e&&(pi(0,"div",135),jt(),pi(1,"svg",130),mi(2,"circle",123),mi(3,"path",131),gi(),gi())}function Dd(e,t){1&e&&(pi(0,"div",136),jt(),pi(1,"svg",130),mi(2,"circle",123),mi(3,"path",131),gi(),gi())}function wd(e,t){if(1&e&&(pi(0,"option",139),Hi(1),gi()),2&e){const e=t.$implicit;ui("value",e.deviceID),qo(1),Gi(e.deviceName)}}function Zd(e,t){if(1&e){const e=_i();pi(0,"select",137),Ti("ngModelChange",function(t){return It(e),Ri().cameraDevicesVal=t}),ci(1,wd,2,2,"option",138),gi()}if(2&e){const e=Ri();ui("ngModel",e.cameraDevicesVal)("disabled",e.publishStreamStatus),qo(1),ui("ngForOf",e.videoDeviceList)}}function xd(e,t){if(1&e&&(pi(0,"option",139),Hi(1),gi()),2&e){const e=t.$implicit;ui("value",e.deviceID),qo(1),Gi(e.deviceName)}}function Bd(e,t){if(1&e){const e=_i();pi(0,"select",140),Ti("change",function(){return It(e),Ri().changeAudioDevices()})("ngModelChange",function(t){return It(e),Ri().microphoneDevicesVal=t}),ci(1,xd,2,2,"option",138),gi()}if(2&e){const e=Ri();ui("disabled",!e.microphoneCheckStatus)("ngModel",e.microphoneDevicesVal),qo(1),ui("ngForOf",e.audioDeviceList)}}function Hd(e,t){1&e&&(pi(0,"div",141),jt(),pi(1,"svg",130),mi(2,"circle",123),mi(3,"path",131),gi(),gi())}const Gd=function(e){return[e,"btn","cuBtn"]};let Vd=(()=>{class e{constructor(e){this.http=e,this.appID=1739272706,this.server="wss://webliveroom-test.zego.im/ws",this.tokenUrl="https://wsliveroom-alpha.zego.im:8282/token",this.userID=(()=>{const e=function(){var e=navigator.userAgent;return navigator,{ios:e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1,android:e.indexOf("Android")>-1||e.indexOf("Adr")>-1}}();for(let t in e)if(e[t])return t;return"web"})()+"_"+(new Date).getTime(),this.roomID="0001",this.streamID="0001",this.playStreamID="0001",this.zg=null,this.localStream=null,this.remoteStream=null,this.isLogin=!1,this.videoCodec="H.264"===localStorage.getItem("VideoCodec")?"H264":"VP8",this.createSuccessSvgStatus=!1,this.connectStatus="DISCONNECTED",this.checkSystemRequireStatus="",this.audioDeviceList=[],this.videoDeviceList=[],this.microphoneDevicesVal="",this.cameraDevicesVal="",this.cameraCheckStatus=!0,this.microphoneCheckStatus=!0,this.publishStreamStatus=!1,this.mirrorVal="none",this.playStreamStatus=!1,this.videoCheckStatus=!0,this.audioCheckStatus=!1,this.publishInfoStreamID="",this.playInfoStreamID=""}enumDevices(){var e=this;return Cd(function*(){const t=yield e.zg.enumDevices();e.audioDeviceList=t&&t.microphones.map((e,t)=>(e.deviceName||(e.deviceName="microphone"+t),console.log("microphone: "+e.deviceName),e)),e.audioDeviceList.push({deviceID:"0",deviceName:"\u7981\u6b62"}),e.microphoneDevicesVal=e.audioDeviceList[0].deviceID,e.videoDeviceList=t&&t.cameras.map((e,t)=>(e.deviceName||(e.deviceName="camera"+t),console.log("camera: "+e.deviceName),e)),e.videoDeviceList.push({deviceID:"0",deviceName:"\u7981\u6b62"}),e.cameraDevicesVal=e.videoDeviceList[0].deviceID})()}initEvent(){this.zg.on("roomStateUpdate",(e,t)=>{"CONNECTED"===t&&this.isLogin&&(this.connectStatus="CONNECTED"),"DISCONNECTED"!==t||this.isLogin||(this.connectStatus="DISCONNECTED"),"DISCONNECTED"===t&&this.isLogin&&location.reload()}),this.zg.on("publisherStateUpdate",e=>{"PUBLISHING"===e.state?this.publishInfoStreamID=e.streamID:"NO_PUBLISH"===e.state&&(this.publishInfoStreamID="")}),this.zg.on("playerStateUpdate",e=>{"PLAYING"===e.state?this.playInfoStreamID=e.streamID:"NO_PLAY"===e.state&&(this.playInfoStreamID="")})}createZegoExpressEngine(){this.zg=new yd.ZegoExpressEngine(this.appID,this.server)}checkSystemRequirements(){var e=this;return Cd(function*(){console.log("sdk version is",e.zg.getVersion());try{const t=yield e.zg.checkSystemRequirements();return console.warn("checkSystemRequirements ",t),t.webRTC?t.videoCodec.H264||t.videoCodec.VP8?t.camera||t.microphones?(t.videoCodec.VP8?t.screenSharing||console.warn("browser is not support screenSharing"):console.log("\u4e0d\u652f\u6301VP8\uff0c\u8bf7\u524d\u5f80\u6df7\u6d41\u8f6c\u7801\u6d4b\u8bd5"),!0):(console.error("camera and microphones not allowed to use"),!1):(console.error("browser is not support H264 and VP8"),!1):(console.error("browser is not support webrtc!!"),!1)}catch(t){return console.error("checkSystemRequirements",t),!1}})()}loginRoom(e,t,r){var o=this;this.http.get(this.tokenUrl+"?app_id="+this.appID+"&id_name="+t,{responseType:"text"}).subscribe(function(){var s=Cd(function*(s){console.log(s);try{yield o.zg.loginRoom(e,s,{userID:t,userName:r})}catch(i){console.error(i)}});return function(e){return s.apply(this,arguments)}}())}startPublishingStream(e,t){var r=this;return Cd(function*(){try{return r.localStream=yield r.zg.createStream(t),r.zg.startPublishingStream(e,r.localStream,{videoCodec:r.videoCodec}),!0}catch(o){return!1}})()}startPlayingStream(e,t={}){var r=this;return Cd(function*(){try{return r.remoteStream=yield r.zg.startPlayingStream(e,t),!0}catch(o){return!1}})()}logoutRoom(e){this.zg.logoutRoom(e)}stopPublishingStream(e){var t=this;return Cd(function*(){t.zg.stopPublishingStream(e)})()}stopPlayingStream(e){var t=this;return Cd(function*(){t.zg.stopPlayingStream(e)})()}clearStream(){this.localStream&&this.zg.destroyStream(this.localStream),this.localStream=null,this.remoteStream&&this.zg.destroyStream(this.remoteStream),this.remoteStream=null}changeAudioDevices(){if(!this.zg||!this.localStream)return;const e=this.zg.isMicrophoneMuted();isNaN(this.microphoneDevicesVal)||e?(this.zg.muteMicrophone(!1),this.zg.useAudioDevice(this.localStream,this.microphoneDevicesVal)):this.zg.muteMicrophone(!0)}createZegoExpressEngineOption(){this.createZegoExpressEngine(),this.createSuccessSvgStatus=!0,this.initEvent()}checkSystemRequire(){var e=this;return Cd(function*(){if(!e.zg)return alert("you should create zegoExpressEngine");(yield e.checkSystemRequirements())?(e.checkSystemRequireStatus="SUCCESS",e.enumDevices()):e.checkSystemRequireStatus="ERROR"})()}loginRoomOption(){var e=this;return Cd(function*(){if(!e.zg)return alert("you should create zegoExpressEngine");try{e.isLogin=!0,yield e.loginRoom(e.roomID,e.userID,e.userID)}catch(t){e.isLogin=!1,console.log(t)}})()}startPublishing(){var e=this;return Cd(function*(){(yield e.startPublishingStream(e.streamID,{camera:{audioInput:e.microphoneDevicesVal,videoInput:e.cameraDevicesVal,video:e.cameraCheckStatus,audio:e.microphoneCheckStatus}}))&&(e.publishStreamStatus=!0)})()}startPlaying(){var e=this;return Cd(function*(){(yield e.startPlayingStream(e.playStreamID,{video:e.videoCheckStatus,audio:e.audioCheckStatus}))&&(e.playStreamStatus=!0)})()}reset(){var e=this;return Cd(function*(){e.zg&&(yield e.stopPublishingStream(e.streamID),yield e.stopPlayingStream(e.playStreamID),e.isLogin&&(e.isLogin=!1,e.logoutRoom(e.roomID)),e.clearStream(),e.zg=null,e.playStreamStatus=!1,e.publishStreamStatus=!1,e.createSuccessSvgStatus=!1,e.checkSystemRequireStatus="",e.audioCheckStatus=!1)})()}}return e.\u0275fac=function(t){return new(t||e)(di(ld))},e.\u0275cmp=xe({type:e,selectors:[["app-root"]],decls:247,vars:36,consts:[[1,"preloader"],["viewBox","25 25 50 50",1,"circular"],["cx","50","cy","50","r","20","fill","none","stroke-width","2","stroke-miterlimit","10",1,"path"],[1,"container","main-wrapper"],[1,"left-sidebar"],[1,"scroll-sidebar"],[1,"sidebar-nav"],["id","sidebarnav"],["data-lang","Quickstart",1,"sidebar-title"],["href","../../../QuickStart/CommonUsage/index.html","data-lang","CommonUsage",1,"waves-effect"],["href","../../../QuickStart/Publishing/index.html","data-lang","Publishing",1,"waves-effect"],["href","../../../QuickStart/Playing/index.html","data-lang","Playing",1,"waves-effect"],["data-lang","Scenes",1,"sidebar-title"],["href","../../../Scenes/VideoForMultipleUsers/index.html","data-lang","VideoForMultipleUsers",1,"waves-effect"],["href","../../../Framework/Vue/index.html","data-lang","Vue",1,"waves-effect"],["href","index.html","data-lang","Angular",1,"waves-effect"],["href","./../../../Framework/React/index.html","data-lang","React",1,"waves-effect"],["data-lang","CommonFeatures",1,"sidebar-title"],["href","../../../CommonFeatures/CommonVideoConfig/index.html","data-lang","CommonVideoConfig",1,"waves-effect"],["href","../../../CommonFeatures/RoomMessage/index.html","data-lang","RoomMessage",1,"waves-effect"],["data-lang","AdvancedStreaming",1,"sidebar-title"],["href","../../../AdvancedStreaming/StreamMonitoring/index.html","data-lang","StreamMonitoring",1,"waves-effect"],["href","../../../AdvancedStreaming/PublishingMultipleStreams/index.html","data-lang","PublishingMultipleStreams",1,"waves-effect"],["href","../../../AdvancedStreaming/StreamByCDN/index.html","data-lang","StreamByCDN",1,"waves-effect"],["href","../../../AdvancedStreaming/LowLatencyLive/index.html","data-lang","LowLatencyLive",1,"waves-effect"],["data-lang","AdvancedVideoProcessing",1,"sidebar-title"],["href","../../../AdvancedVideoProcessing/EncodingAndDecoding/index.html","data-lang","SetVideoProperties",1,"waves-effect"],["href","../../../AdvancedVideoProcessing/CustomVideoCapture/index.html","data-lang","CustomVideoCapture",1,"waves-effect"],["data-lang","AdvancedAudioProcessing",1,"sidebar-title"],["href","../../../AdvancedAudioProcessing/EarReturnAndChannelSettings/index.html","data-lang","EarReturnAndChannelSettings",1,"waves-effect"],["href","../../../AdvancedAudioProcessing/SoundLevelAndAudioSpectrum/index.html","data-lang","SoundLevelAndAudioSpectrum",1,"waves-effect"],["href","../../../AdvancedAudioProcessing/AEC_ANS_AGC/index.html","data-lang","AEC_ANS_AGC",1,"waves-effect"],["href","../../../AdvancedAudioProcessing/AudioMixing/index.html","data-lang","AudioMixing",1,"waves-effect"],["href","../../../AdvancedAudioProcessing/CustomAudioCaptureAndRendering/index.html","data-lang","CustomAudioCaptureAndRendering",1,"waves-effect"],["data-lang","Others",1,"sidebar-title"],["href","../../../Others/StreamMixing/index.html","data-lang","StreamMixing",1,"waves-effect"],["href","../../../Others/ScreenSharing/index.html","data-lang","ScreenSharing",1,"waves-effect"],["href","../../../Others/MediaTrackReplacement/index.html","data-lang","MediaTrackReplacement",1,"waves-effect"],["data-lang","DebugAndConfig",1,"sidebar-title"],["href","../../../DebugAndConfig/LogAndVersionAndDebug/index.html","data-lang","Log_Version_Debug",1,"waves-effect"],[1,"page-wrapper"],[1,"container-fluid"],[1,"row"],[1,"col-12","col-lg-6","preview-wrapper"],[1,"preview-roomInfo"],["id","roomInfo-id",1,"m-r-10"],["id","roomInfo-state"],["class","success-svg","id","roomStateSuccessSvg","style","display: inline-block;",4,"ngIf"],["class","error-svg","id","roomStateErrorSvg","style","display: inline-block;",4,"ngIf"],[1,"preview-pushlishInfo","col-lg-12","col-6"],[1,"pushlishInfo-title"],["data-lang","Preview"],["id","pushlishInfo-id",4,"ngIf"],[1,"preview-content"],["id","publishVideo","autoplay","","playsinline","","muted","",3,"srcObject","class",4,"ngIf"],[1,"preview-playInfo","m-t-10","col-lg-12","col-6"],["data-lang","PlayStream"],["id","playInfo-id",4,"ngIf"],["id","playVideo","autoplay","","playsinline","",3,"srcObject","class",4,"ngIf"],[1,"col-12","col-lg-6","action-wrapper"],[1,"action-step"],[1,"action-title"],[1,"action-info"],[1,"btn-wrapper"],["id","CreateZegoExpressEngine","type","button","title","new ZegoExpressEngine()",1,"btn-outline-info","btn","cuBtn",3,"click"],["class","success-svg","id","createSuccessSvg","style","display: inline-block;",4,"ngIf"],["id","CheckSystemRequire","type","button","title","checkSystemRequirements()",3,"click"],["class","success-svg","id","checkSuccessSvg","style","display: inline-block;",4,"ngIf"],["class","error-svg","id","checkErrorSvg","style","display: inline-block;",4,"ngIf"],["id","checkWarnSvg",1,"warn-svg",2,"display","none"],["t","1617876217862","viewBox","0 0 1024 1024","version","1.1","xmlns","http://www.w3.org/2000/svg","p-id","8340","width","15","height","15",1,"icon"],["fill","#5bb543","cx","512","cy","512","r","510",1,"circle"],["fill","none","stroke","#FFF","stroke-width","6","stroke-linecap","round","d","M512 736.1m-63 0a63 63 0 1 0 126 0 63 63 0 1 0-126 0Z","fill","#FFFFFF","p-id","8344",1,"tick"],["fill","none","stroke","#FFF","stroke-width","6","stroke-linecap","round","stroke-miterlimit","10","d","M512 611.8s63-220.5 63-306.3S549.5 204 512 204s-63 15.8-63 101.5 63 306.3 63 306.3z",1,"tick"],[1,"action-content"],[1,"action-room","font-14"],[1,"action-roomId","f-b-3"],["type","text","id","RoomID",3,"ngModel","disabled","ngModelChange"],[1,"action-userName","f-b-7"],["type","text","id","UserName",1,"w-70",3,"ngModel","disabled","ngModelChange"],["id","LoginRoom","title","loginRoom()",1,"play-pause-button",3,"click"],["class","success-svg m-r-5","id","loginSuccessSvg","style","display: inline-block;",4,"ngIf"],[1,"publish-setting","m-t-10"],[1,"action-input","font-14","m-b-15"],["type","text","id","PublishID",3,"ngModel","disabled","ngModelChange"],[1,"font-12","publish-check","m-b-15"],[1,"check-wrappre","m-r-5"],["for","Camera","data-lang","Camera",1,"form-check-label","m-r-5"],["type","checkbox","id","Camera",1,"check-input",3,"ngModel","disabled","ngModelChange"],[1,"check-wrappre"],["for","Microphone","data-lang","Microphone",1,"form-check-label","m-r-5"],["type","checkbox","id","Microphone",1,"check-input",3,"ngModel","disabled","ngModelChange"],["id","startPublishing","title","createStream() / startPublishingStream()",1,"play-pause-button",3,"click"],["class","success-svg m-r-5","id","publishSuccessSvg","style","display: inline-block;",4,"ngIf"],[1,"publish-setting","m-t-10","m-b-10"],[1,"font-12","select-wrapper"],["data-lang","Mirror"],["id","Mirror",1,"form-control","form-control-sm","m-l-5",3,"ngModel","disabled","ngModelChange"],["value","none"],["value","onlyPreview"],["value","onlyPlay"],["value","both"],[1,"font-12","select-wrapper","f-b-7"],["data-lang","CameraSwitch"],["class","form-control form-control-sm m-l-5","id","CameraDevices",3,"ngModel","disabled","ngModelChange",4,"ngIf"],["data-lang","MicrophoneSwitch"],["class","form-control form-control-sm m-l-5","id","MicrophoneDevices",3,"disabled","ngModel","change","ngModelChange",4,"ngIf"],[1,"publish-setting","m-t-5"],["type","text","id","PlayID",3,"ngModel","disabled","ngModelChange"],["for","Video","data-lang","Video",1,"form-check-label","m-r-5"],["type","checkbox","id","Video",1,"check-input",3,"ngModel","disabled","ngModelChange"],["for","Audio","data-lang","Audio",1,"form-check-label","m-r-5"],["type","checkbox","id","Audio",1,"check-input",3,"ngModel","disabled","ngModelChange"],["id","startPlaying","title","startPlayingStream()",1,"play-pause-button",3,"click"],["class","success-svg m-r-5","id","playSuccessSvg","style","display: inline-block;",4,"ngIf"],["id","reset","type","button",1,"btn-danger","btn","cuBtn",3,"click"],[1,"goToDoc"],["data-lang","HelpDocsVideoCodec"],["href","https://doc-zh.zego.im/article/7638","data-lang","HelpSettingsPage","target","_blank"],["data-lang","MoreDocs"],["href","https://doc-zh.zego.im/article/7638","data-lang","HelpDocs","target","_blank"],["id","roomStateSuccessSvg",1,"success-svg",2,"display","inline-block"],["xmlns","http://www.w3.org/2000/svg","height","10","width","10","viewBox","0 0 48 48","aria-hidden","true",1,"ft-green-tick"],["fill","#5bb543","cx","24","cy","24","r","22",1,"circle"],["id","roomStateErrorSvg",1,"error-svg",2,"display","inline-block"],["id","pushlishInfo-id"],["id","publishVideo","autoplay","","playsinline","","muted","",3,"srcObject"],["id","playInfo-id"],["id","playVideo","autoplay","","playsinline","",3,"srcObject"],["id","createSuccessSvg",1,"success-svg",2,"display","inline-block"],["xmlns","http://www.w3.org/2000/svg","height","15","width","15","viewBox","0 0 48 48","aria-hidden","true",1,"ft-green-tick"],["fill","none","stroke","#FFF","stroke-width","6","stroke-linecap","round","stroke-linejoin","round","stroke-miterlimit","10","d","M14 27l5.917 4.917L34 17",1,"tick"],["id","checkSuccessSvg",1,"success-svg",2,"display","inline-block"],["id","checkErrorSvg",1,"error-svg",2,"display","inline-block"],["fill","none","stroke","#FFF","stroke-width","6","stroke-linecap","round","stroke-linejoin","round","stroke-miterlimit","10","d","M14 14 34 34 M34 14 14 34",1,"tick"],["id","loginSuccessSvg",1,"success-svg","m-r-5",2,"display","inline-block"],["id","publishSuccessSvg",1,"success-svg","m-r-5",2,"display","inline-block"],["id","CameraDevices",1,"form-control","form-control-sm","m-l-5",3,"ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["id","MicrophoneDevices",1,"form-control","form-control-sm","m-l-5",3,"disabled","ngModel","change","ngModelChange"],["id","playSuccessSvg",1,"success-svg","m-r-5",2,"display","inline-block"]],template:function(e,t){var r,o,s,i;1&e&&(pi(0,"div",0),jt(),pi(1,"svg",1),mi(2,"circle",2),gi(),gi(),Yt(),pi(3,"div",3),pi(4,"aside",4),pi(5,"div",5),pi(6,"nav",6),pi(7,"ul",7),pi(8,"span",8),Hi(9,"\u5feb\u901f\u5f00\u59cb"),gi(),pi(10,"li"),pi(11,"a",9),Hi(12,"\u5b9e\u73b0\u6d41\u7a0b"),gi(),gi(),pi(13,"li"),pi(14,"a",10),Hi(15,"\u63a8\u6d41"),gi(),gi(),pi(16,"li"),pi(17,"a",11),Hi(18,"\u62c9\u6d41"),gi(),gi(),pi(19,"span",12),Hi(20,"\u6700\u4f73\u5b9e\u8df5"),gi(),pi(21,"li"),pi(22,"a",13),Hi(23,"\u591a\u4eba\u89c6\u9891\u901a\u8bdd"),gi(),gi(),pi(24,"li"),pi(25,"a",14),Hi(26,"\u4f7f\u7528 Vue \u5b9e\u73b0\u97f3\u89c6\u9891\u529f\u80fd"),gi(),gi(),pi(27,"li"),pi(28,"a",15),Hi(29,"\u4f7f\u7528 Angular \u5b9e\u73b0\u97f3\u89c6\u9891\u529f\u80fd"),gi(),gi(),pi(30,"li"),pi(31,"a",16),Hi(32,"\u4f7f\u7528 React \u5b9e\u73b0\u97f3\u89c6\u9891\u529f\u80fd"),gi(),gi(),pi(33,"span",17),Hi(34,"\u5e38\u7528\u529f\u80fd"),gi(),pi(35,"li"),pi(36,"a",18),Hi(37,"\u5e38\u7528\u89c6\u9891\u914d\u7f6e"),gi(),gi(),pi(38,"li"),pi(39,"a",19),Hi(40,"\u5b9e\u65f6\u6d88\u606f"),gi(),gi(),pi(41,"span",20),Hi(42,"\u63a8\u62c9\u6d41\u8fdb\u9636"),gi(),pi(43,"li"),pi(44,"a",21),Hi(45,"\u63a8\u62c9\u6d41\u4fe1\u606f\u76d1\u6d4b"),gi(),gi(),pi(46,"li"),pi(47,"a",22),Hi(48,"\u63a8\u591a\u8def\u6d41"),gi(),gi(),pi(49,"li"),pi(50,"a",23),Hi(51,"\u901a\u8fc7CDN\u63a8\u62c9\u6d41"),gi(),gi(),pi(52,"li"),pi(53,"a",24),Hi(54,"\u4f4e\u5ef6\u8fdf\u76f4\u64ad"),gi(),gi(),pi(55,"span",25),Hi(56,"\u89c6\u9891\u8fdb\u9636"),gi(),pi(57,"li"),pi(58,"a",26),Hi(59,"\u8bbe\u7f6e\u89c6\u9891\u5c5e\u6027"),gi(),gi(),pi(60,"li"),pi(61,"a",27),Hi(62,"\u81ea\u5b9a\u4e49\u89c6\u9891\u91c7\u96c6"),gi(),gi(),pi(63,"span",28),Hi(64,"\u97f3\u9891\u8fdb\u9636"),gi(),pi(65,"li"),pi(66,"a",29),Hi(67,"\u8033\u8fd4"),gi(),gi(),pi(68,"li"),pi(69,"a",30),Hi(70,"\u97f3\u9891\u9891\u8c31\u4e0e\u58f0\u6d6a"),gi(),gi(),pi(71,"li"),pi(72,"a",31),Hi(73,"\u97f3\u98913A\u5904\u7406"),gi(),gi(),pi(74,"li"),pi(75,"a",32),Hi(76,"\u6df7\u97f3"),gi(),gi(),pi(77,"li"),pi(78,"a",33),Hi(79,"\u81ea\u5b9a\u4e49\u97f3\u9891\u91c7\u96c6\u4e0e\u6e32\u67d3"),gi(),gi(),pi(80,"span",34),Hi(81,"\u5176\u4ed6\u529f\u80fd"),gi(),pi(82,"li"),pi(83,"a",35),Hi(84,"\u591a\u8def\u6df7\u6d41"),gi(),gi(),pi(85,"li"),pi(86,"a",36),Hi(87,"\u5c4f\u5e55\u5171\u4eab"),gi(),gi(),pi(88,"li"),pi(89,"a",37),Hi(90,"\u97f3\u89c6\u9891\u8f68\u9053\u66ff\u6362"),gi(),gi(),pi(91,"span",38),Hi(92,"\u8c03\u8bd5\u4e0e\u914d\u7f6e"),gi(),pi(93,"li"),pi(94,"a",39),Hi(95,"\u65e5\u5fd7\u3001\u7248\u672c\u53f7\u3001\u8c03\u8bd5\u4fe1\u606f"),gi(),gi(),gi(),gi(),gi(),gi(),pi(96,"div",40),pi(97,"div",41),pi(98,"div",42),pi(99,"div",43),pi(100,"div",44),Hi(101," RoomID:\xa0"),mi(102,"div",45),Hi(103," RoomState:\xa0"),pi(104,"div",46),ci(105,Id,3,0,"div",47),ci(106,Ld,3,0,"div",48),gi(),gi(),pi(107,"div",42),pi(108,"div",49),pi(109,"div",50),pi(110,"span",51),Hi(111,"Preview"),gi(),Hi(112,"\u2003Publish StreamID: "),ci(113,Od,2,1,"span",52),gi(),pi(114,"div",53),ci(115,bd,1,3,"video",54),gi(),gi(),pi(116,"div",55),pi(117,"div",50),pi(118,"span",56),Hi(119,"Play Stream"),gi(),Hi(120,"\u2003StreamID: "),ci(121,Md,2,1,"span",57),gi(),pi(122,"div",53),ci(123,Nd,1,3,"video",58),gi(),gi(),gi(),gi(),pi(124,"div",59),pi(125,"div",60),pi(126,"div",61),Hi(127," Step1\u2003"),pi(128,"span",62),Hi(129,"Create ZegoExpressEngine"),gi(),gi(),pi(130,"div",63),pi(131,"button",64),Ti("click",function(){return t.createZegoExpressEngineOption()}),ci(132,Ad,4,0,"div",65),Hi(133," Create Engine "),gi(),gi(),gi(),pi(134,"div",60),pi(135,"div",61),Hi(136," Step2\u2003"),pi(137,"span",62),Hi(138,"Test Compatiblity"),gi(),gi(),pi(139,"div",63),pi(140,"button",66),Ti("click",function(){return t.checkSystemRequire()}),ci(141,kd,4,0,"div",67),ci(142,Pd,4,0,"div",68),pi(143,"div",69),jt(),pi(144,"svg",70),mi(145,"circle",71),mi(146,"path",72),mi(147,"path",73),gi(),gi(),Hi(148," Test Compatiblity "),gi(),gi(),gi(),Yt(),pi(149,"div",60),pi(150,"div",61),Hi(151," Step3\u2003"),pi(152,"span",62),Hi(153,"Login Room"),gi(),gi(),pi(154,"div",74),pi(155,"div",75),pi(156,"div",76),Hi(157," RoomID "),pi(158,"input",77),Ti("ngModelChange",function(e){return t.roomID=e}),gi(),gi(),pi(159,"div",78),Hi(160," UserName "),pi(161,"input",79),Ti("ngModelChange",function(e){return t.userID=e}),gi(),gi(),gi(),pi(162,"button",80),Ti("click",function(){return t.loginRoomOption()}),ci(163,Ud,4,0,"div",81),Hi(164," Login Room "),gi(),gi(),gi(),pi(165,"div",60),pi(166,"div",61),Hi(167," Step4\u2003"),pi(168,"span",62),Hi(169,"Start Publishing Stream"),gi(),pi(170,"div",74),pi(171,"div",82),pi(172,"div",83),Hi(173," Publish StreamID "),pi(174,"input",84),Ti("ngModelChange",function(e){return t.streamID=e}),gi(),gi(),pi(175,"div",85),pi(176,"div",86),pi(177,"label",87),Hi(178,"Camera"),gi(),pi(179,"input",88),Ti("ngModelChange",function(e){return t.cameraCheckStatus=e}),gi(),gi(),pi(180,"div",89),pi(181,"label",90),Hi(182,"Microphone"),gi(),pi(183,"input",91),Ti("ngModelChange",function(e){return t.microphoneCheckStatus=e}),gi(),gi(),gi(),gi(),pi(184,"button",92),Ti("click",function(){return t.startPublishing()}),ci(185,Dd,4,0,"div",93),Hi(186,"Start Publishing"),gi(),pi(187,"div",94),pi(188,"div",95),pi(189,"span",96),Hi(190,"Mirror"),gi(),pi(191,"select",97),Ti("ngModelChange",function(e){return t.mirrorVal=e}),pi(192,"option",98),Hi(193,"none"),gi(),pi(194,"option",99),Hi(195,"onlyPreview"),gi(),pi(196,"option",100),Hi(197,"onlyPlay"),gi(),pi(198,"option",101),Hi(199,"both"),gi(),gi(),gi(),pi(200,"div",102),pi(201,"span",103),Hi(202,"Camera Switch"),gi(),ci(203,Zd,2,3,"select",104),gi(),gi(),pi(204,"div",95),pi(205,"span",105),Hi(206,"Microphone Switch"),gi(),ci(207,Bd,2,3,"select",106),gi(),gi(),gi(),gi(),pi(208,"div",60),pi(209,"div",61),Hi(210," Step5\u2003"),pi(211,"span",62),Hi(212,"Start Play Stream"),gi(),pi(213,"div",74),pi(214,"div",107),pi(215,"div",83),Hi(216," Play StreamID "),pi(217,"input",108),Ti("ngModelChange",function(e){return t.playStreamID=e}),gi(),gi(),pi(218,"div",85),pi(219,"div",86),pi(220,"label",109),Hi(221,"Video"),gi(),pi(222,"input",110),Ti("ngModelChange",function(e){return t.videoCheckStatus=e}),gi(),gi(),pi(223,"div",89),pi(224,"label",111),Hi(225,"Audio"),gi(),pi(226,"input",112),Ti("ngModelChange",function(e){return t.audioCheckStatus=e}),gi(),gi(),gi(),gi(),pi(227,"button",113),Ti("click",function(){return t.startPlaying()}),ci(228,Hd,4,0,"div",114),Hi(229,"Start Playing"),gi(),gi(),gi(),gi(),pi(230,"div",60),pi(231,"div",74),pi(232,"button",115),Ti("click",function(){return t.reset()}),Hi(233,"Reset"),gi(),gi(),gi(),gi(),gi(),gi(),pi(234,"ul",116),pi(235,"li"),pi(236,"span",117),Hi(237," Web \u7aef\u89c6\u9891\u7f16\u7801\u9ed8\u8ba4\u4f7f\u7528 VP8\uff0c\u4f53\u9a8c\u548c\u5176\u4ed6\u7aef\u4e92\u901a\uff0c\u8bf7\u5728\u8c03\u8bd5\u4e0e\u914d\u7f6e\u9875\u9762\u4fee\u6539\u4e3a H.264 "),gi(),Hi(238," \xa0 "),pi(239,"a",118),Hi(240," \u70b9\u51fb\u4fee\u6539 "),gi(),gi(),pi(241,"li"),pi(242,"span",119),Hi(243,"\u66f4\u591a\u6587\u6863\uff0c\u8bf7\u8df3\u8f6c\u81f3\u5373\u6784 "),gi(),Hi(244," \xa0 "),pi(245,"a",120),Hi(246," \u5e2e\u52a9\u6587\u6863 "),gi(),gi(),gi(),gi(),gi()),2&e&&(qo(105),ui("ngIf","CONNECTED"==t.connectStatus),qo(1),ui("ngIf","DISCONNECTED"==t.connectStatus),qo(7),ui("ngIf",t.publishInfoStreamID),qo(2),ui("ngIf",t.localStream),qo(6),ui("ngIf",t.playInfoStreamID),qo(2),ui("ngIf",t.remoteStream),qo(9),ui("ngIf",t.createSuccessSvgStatus),qo(8),Ni((r=34,o=Gd,s="ERROR"==t.checkSystemRequireStatus?"btn-outline-danger":"btn-outline-info",function(e,t,r,o,s,i){const n=t+r;return li(e,n,s)?function(e,t,r){return e[t]=r}(e,n+1,i?o.call(i,s):o(s)):function(e,t){const r=e[t];return r===Wo?void 0:r}(e,n+1)}(Ct(),function(){const e=St.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}(),r,o,s,i))),qo(1),ui("ngIf","SUCCESS"==t.checkSystemRequireStatus),qo(1),ui("ngIf","ERROR"==t.checkSystemRequireStatus),qo(16),ui("ngModel",t.roomID)("disabled",t.isLogin),qo(3),ui("ngModel",t.userID)("disabled",t.isLogin),qo(2),ui("ngIf",t.isLogin),qo(11),ui("ngModel",t.streamID)("disabled",t.publishStreamStatus),qo(5),ui("ngModel",t.cameraCheckStatus)("disabled",t.publishStreamStatus),qo(4),ui("ngModel",t.microphoneCheckStatus)("disabled",t.publishStreamStatus),qo(2),ui("ngIf",t.publishStreamStatus),qo(6),ui("ngModel",t.mirrorVal)("disabled",t.publishStreamStatus),qo(12),ui("ngIf",t.videoDeviceList),qo(4),ui("ngIf",t.audioDeviceList),qo(10),ui("ngModel",t.playStreamID)("disabled",t.playStreamStatus),qo(5),ui("ngModel",t.videoCheckStatus)("disabled",t.playStreamStatus),qo(4),ui("ngModel",t.audioCheckStatus)("disabled",t.playStreamStatus),qo(2),ui("ngIf",t.playStreamStatus))},directives:[ll,Kl,uc,Nc,Yl,Uc,Dc,Bc,nl],styles:[".pushlishInfo-title[_ngcontent-%COMP%]{font-weight:500}.preview-content[_ngcontent-%COMP%]{width:auto;height:200px;border:1px solid #ccc}.preview-content[_ngcontent-%COMP%] > video[_ngcontent-%COMP%]{width:100%;height:100%}.preview-roomInfo[_ngcontent-%COMP%]{font-weight:500}#roomInfo-id[_ngcontent-%COMP%], #roomInfo-state[_ngcontent-%COMP%]{display:inline-block;font-weight:400}.logger-wrapper[_ngcontent-%COMP%]{margin-top:20px;width:100%;height:250px;background-color:#ccc;color:#fcfafa;overflow:scroll}.btn-wrapper[_ngcontent-%COMP%]{display:flex;width:100%;background-color:#fcfafa;border-radius:10px;height:30px;justify-content:center;align-items:center}.action-step[_ngcontent-%COMP%]{margin:10px 0}.action-content[_ngcontent-%COMP%]{width:100%;background-color:#fcfafa;border-radius:10px;padding:10px}.action-title[_ngcontent-%COMP%]{font-weight:700px;color:#000}.action-info[_ngcontent-%COMP%]{font-size:14px}.cuBtn[_ngcontent-%COMP%]{display:block;padding:0 12px;font-size:13px;cursor:pointer;height:30px;width:95%}.action-room[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding-bottom:15px}.f-b-3[_ngcontent-%COMP%]{flex-basis:30%}.f-b-7[_ngcontent-%COMP%]{flex-basis:70%!important}input[_ngcontent-%COMP%]{width:40%;height:21px;border:1px solid #ced4da;border-radius:.25rem;color:#495057}.w-70[_ngcontent-%COMP%]{width:70%}.publish-setting[_ngcontent-%COMP%]{display:flex;align-items:center}.publish-check[_ngcontent-%COMP%]{flex-basis:50%;display:flex;justify-content:space-around}.check-wrappre[_ngcontent-%COMP%]{text-align:center;display:flex;align-items:center}.check-input[_ngcontent-%COMP%]{display:inline-block;width:auto!important;height:auto!important}select[_ngcontent-%COMP%]{width:45%!important;height:21px!important;padding:0!important;font-size:12px!important}.select-wrapper[_ngcontent-%COMP%]{flex-basis:30%;display:flex;align-items:center;white-space:nowrap}option[_ngcontent-%COMP%]{height:21px!important;font-size:14px}.mirror[_ngcontent-%COMP%]{transform:scaleX(-1)}@media (max-width: 375px){.preview-playInfo[_ngcontent-%COMP%]{margin-top:0!important}}"]}),e})(),Wd=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Ve({type:e,bootstrap:[Vd]}),e.\u0275inj=le({providers:[],imports:[[Vl,Gc,Sd]]}),e})();(function(){if(Ga)throw new Error("Cannot enable prod mode after platform setup.");Ha=!1})(),Hl().bootstrapModule(Wd).catch(e=>console.error(e))}},e=>{"use strict";e(e.s=305)}]);